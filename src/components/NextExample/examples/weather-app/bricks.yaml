brick: sl-card
properties:
  style:
    width: 100%
    maxWidth: 300px
    margin: auto
    display: block
lifeCycle:
  onMount:
    action: context.load
    args:
    - weather
children:
- brick: sl-select
  slot: header
  properties:
    placeholder: Select a city
    size: small
    value: '<% CTX.city %>'
  children:
  - brick: ':forEach'
    dataSource:
    - Shenzhen
    - Guangzhou
    - Beijing
    - Shanghai
    - Chongqing
    - Tokyo
    - Los Angeles
    - New York
    - London
    children:
    - brick: sl-option
      properties:
        value: <% ITEM.replace(/ /g, "_") %>
        textContent: <% ITEM %>
  events:
    sl-change:
      action: context.replace
      args:
      - city
      - '<% EVENT.target.value %>'
- brick: div
  properties:
    style:
      display: grid
      gridTemplateColumns: 50px 1fr
      alignItems: center
      gap: 10px
  children:
  - brick: ':if'
    dataSource: '<% "track context", !!CTX.weather %>'
    slots:
      '':
        bricks:
        - brick: img
          properties:
            src: '<% CTX.weather.current.condition.icon %>'
            style:
              width: 24px
              height: 24px
              justifySelf: center
        - brick: span
          properties:
            textContent: |
              <%
                CTX.weather.current.condition.text
              %>
        - brick: span
          properties:
            textContent: 'üå°Ô∏è'
            style:
              fontSize: 18px
              justifySelf: center
        - brick: span
          children:
          - brick: span
            properties:
              textContent: |
                <%
                  `${Math.round(CTX.weather.current.temp_c)}¬∞C`
                %>
          - brick: span
            properties:
              textContent: |
                <%
                  ` (${
                    Math.round(CTX.weather.forecast.forecastday[0].day.mintemp_c)
                  }¬∞C - ${
                    Math.round(CTX.weather.forecast.forecastday[0].day.maxtemp_c)
                  }¬∞C)`
                %>
              style:
                color: gray
        - brick: span
          properties:
            textContent: Houryly forecast
            style:
              color: gray
              gridColumn: span 2
        - brick: div
          properties:
            style:
              display: grid
              gridAutoFlow: column
              gridTemplateRows: repeat(4, auto)
              columnGap: 10px
              gridColumn: span 2
              overflowX: auto
              justifyItems: center
              alignItems: center
          children:
          - brick: span
            properties:
              textContent: Now
              style:
                justifySelf: center
          - brick: img
            properties:
              src: '<% CTX.weather.current.condition.icon %>'
              style:
                width: 24px
                height: 24px
                gridRow: span 2
          - brick: span
            properties:
              textContent: '<% `${Math.round(CTX.weather.current.temp_c)}¬∞C` %>'
          - brick: ':forEach'
            dataSource: |
              <%
                CTX.weather.forecast.forecastday.flatMap(d => d.hour)
                .filter(
                  h => h.time_epoch * 1e3 > +(new Date())
                )
                .slice(0, 12)
              %>
            children:
            - brick: span
              properties:
                textContent: |
                  <%
                      new Date(ITEM.time_epoch * 1e3)
                        .toLocaleString(undefined, { timeZone: CTX.weather.location.tz_id, hour: 'numeric', hour12: true })
                        .match(/\d\d?/)?.[0]
                  %>
                style:
                  justifySelf: center
            - brick: img
              properties:
                src: '<% ITEM.condition.icon %>'
                style:
                  width: 24px
                  height: 24px
                  gridRow: '<% `span ${ITEM.chance_of_rain > 0 ? 1 : 2}` %>'
            - brick: small
              if: <% ITEM.chance_of_rain > 0 %>
              properties:
                textContent: |
                  <%
                    `${Math.round(ITEM.chance_of_rain)}%`
                  %>
                style:
                  color: '#2a87e5'
            - brick: span
              properties:
                textContent: '<% `${Math.round(ITEM.temp_c)}¬∞C` %>'
        - brick: span
          properties:
            textContent: 'üïí'
            style:
              fontSize: 18px
              justifySelf: center
        - brick: span
          properties:
            textContent: |
              <%
                new Date().toLocaleTimeString(
                  undefined,
                  {
                    timeZone: CTX.weather.location.tz_id,
                    hour12: true,
                    timeStyle: "short"
                  }
                )
              %>
        - brick: sl-icon
          properties:
            name: sunrise
            style:
              fontSize: 18px
              justifySelf: center
        - brick: span
          properties:
            textContent: |
              <%
                CTX.weather.forecast.forecastday[0].astro.sunrise
              %>
        - brick: sl-icon
          properties:
            name: sunset
            style:
              fontSize: 18px
              justifySelf: center
        - brick: span
          properties:
            textContent: |
              <%
                CTX.weather.forecast.forecastday[0].astro.sunset
              %>
      else:
        bricks:
        - brick: sl-spinner
          properties:
            style:
              fontSize: 2em