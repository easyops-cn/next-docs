{"version":3,"file":"chunks/2202.e8ede966.js","mappings":"6HAAO,SAASA,EAAwBC,EAAOC,GAC7C,IAAIC,EAAQC,UAAUC,OAAS,QAAsBC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,EAChF,OAAO,SAA2BG,EAAMC,GACtC,GAAID,EAAKE,OAASP,EAAY,CAE5B,IADA,IAAIQ,EAAW,GACNC,EAAI,EAAGA,GAAKR,EAAOQ,IAAK,CAC/B,IAAIC,EAAeJ,EAAOA,EAAOH,OAASM,GAC1C,GAA6F,sBAAxFC,aAAmD,EAASA,EAAaL,KAAKM,OAAqD,WAArBD,EAAaE,IAAkB,CAChJ,IAAIC,EAAaH,EAAaL,KACzBQ,EAAWC,UAAyC,eAA7BD,EAAWE,SAASJ,KAErCE,EAAWC,UAAyC,YAA7BD,EAAWE,SAASJ,MAA2D,iBAA9BE,EAAWE,SAASC,MACrGR,EAASS,KAAKJ,EAAWE,SAASC,OAElCjB,EAAMmB,mBAAoB,EAJ1BV,EAASS,KAAKJ,EAAWE,SAASR,KAMtC,MACER,EAAMmB,mBAAoB,CAE9B,CACIV,EAASL,SAAWF,GACtBF,EAAMoB,eAAeC,IAAIZ,EAASa,KAAK,KAE3C,CACF,CACF,C,udCvBO,SAASC,EAA8BC,EAAMC,EAEpDC,GACE,IAAIC,EAAO,IAAIC,SACX,sBACFC,EAAqB,gCACrBC,EAA+B,yBAC/BC,EAAwB,YACxBC,GACqB,iBAAZN,EAAuB,CAChCG,sBAAuBI,GAAKA,EAAEC,SAASR,IACrCA,GACJ,SAASS,EAASlB,GAChB,GAAqB,iBAAVA,EACT,IAAI,IAAAmB,aAAYnB,GACd,GAAIY,EAAsBZ,GACxB,KACE,IAAAoB,aAAYpB,EAAO,CACjBqB,YAAY,EACZC,MAAO,CACLd,kBAAkBnB,EAAMC,GAEtBkB,EAAkBnB,EAAMC,EAAQU,EAClC,IAGN,CAAE,MAAOuB,GAEPC,QAAQD,MAAM,sCAAuCA,EACvD,MAEAV,SAAkGA,EAAgCb,QAGpIc,SAAoFA,EAAyBd,QAE1G,IAAI,IAAAyB,UAASzB,GAAQ,CAE1B,GAAIU,EAAKgB,IAAI1B,GACX,OAIF,IAAK,IAAI2B,KAFTjB,EAAKN,IAAIJ,GACTe,SAA0DA,EAAYf,GACrD4B,MAAMC,QAAQ7B,GAASA,EAAQ8B,OAAOC,OAAO/B,IAC5DkB,EAASS,EAEb,CACF,CACAT,CAASX,EACX,CCjDO,SAASyB,EAAyBzB,EAAMvB,GAC7C,IAAIC,EAAQC,UAAUC,OAAS,QAAsBC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,GAC5E,kBACFgB,EAAiB,eACjB+B,EAAc,eACd9B,GACE+B,EAAmB3B,EAAMvB,EAAYC,GACzC,GAAIiB,EACF,MAAM,IAAIiC,MAAM,uBAAuBC,OAAOpD,EAAY,4CAA6CoD,OAAOH,EAAgB,MAEhI,OAAO9B,CACT,CACO,SAAS+B,EAAmB3B,EAAMvB,GACvC,IAAIC,EAAQC,UAAUC,OAAS,QAAsBC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,EAC5EH,EAAQ,CACVoB,eAAgB,IAAIkC,IACpBnC,mBAAmB,GAEjBM,EAAoB1B,EAAwBC,EAAOC,EAAYC,GAOnE,OANAqB,EAA8BC,GAAM,CAAClB,EAAMC,EAAQgD,KACjD9B,EAAkBnB,EAAMC,GACpBP,EAAMmB,oBACRnB,EAAMkD,eAAiBK,EACzB,GACCtD,GACID,CACT,CC1BO,SAASwD,EAAMC,EAAKC,EAAWC,GACpC,GAAIF,EAAIvB,SAASwB,GAAY,CAC3B,IAYIE,EAZA5D,EAAQ,CACVoB,eAAgB,IAAIkC,IACpBnC,mBAAmB,IAEjB,WACF0C,IACE,IAAAxB,aAAYoB,EAAK,CACnBnB,YAAY,EACZC,MAAO,CACLd,kBAAmB1B,EAAwBC,EAAO2D,MAItD,GAAwB,uBAApBE,EAAWjD,OAAkCgD,EAAcC,EAAWC,YAAY,KAA4B,YAArBF,EAAYhD,MAAsBgD,EAAY3C,QAAUyC,EAAW,CAC9J,GAAI1D,EAAMoB,eAAe2C,KAAO,EAC9B,OAAO/D,EAAMoB,eAGbqB,QAAQuB,KAAK,kBAAmBX,OAAOK,EAAW,cAAeL,OAAOM,EAAc,sCAAsCN,OAAOY,KAAKC,UAAUT,IAEtJ,CACF,CACA,OAAO,CACT,CC1BO,SAASU,EAA4BC,EAAW3C,GACrD,GAAIoB,MAAMC,QAAQsB,GAChB,IAAK,IAAIC,KAAMD,EACbE,EAA2BD,EAAI5C,EAGrC,CACO,SAAS6C,EAA2BD,EAAI5C,GAC7C,KACE,IAAA8C,iBAAgBF,EAAGG,OAAQ,CACzBC,WAAYJ,EAAGI,WACfnC,YAAY,EACZC,MAAO,CACLd,sBAGN,CAAE,MAAOe,GAEPC,QAAQD,MAAM,8BAA+Ba,OAAOgB,EAAG7D,KAAM,aAAegC,EAC9E,CACF,CCnBO,SAASkC,EAAmCL,EAAIpE,GACrD,IAAIC,EAAQC,UAAUC,OAAS,QAAsBC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,GAC5E,kBACFgB,EAAiB,eACjBC,GACEuD,EAA6BN,EAAIpE,EAAYC,GACjD,GAAIiB,EACF,MAAM,IAAIiC,MAAM,uBAAuBC,OAAOpD,EAAY,0CAA2CoD,OAAOgB,EAAG7D,KAAM,MAEvH,OAAOY,CACT,CACO,SAASuD,EAA6BN,EAAIpE,GAC/C,IAAIC,EAAQC,UAAUC,OAAS,QAAsBC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,EAC5EH,EAAQ,CACVoB,eAAgB,IAAIkC,IACpBnC,mBAAmB,GAIrB,OAFAmD,EAA2BD,EAAItE,EAAwBC,EAAOC,EAAYC,IAC1EF,EAAMoB,eAAewD,OAAOP,EAAG7D,MACxBR,CACT,CCpBA,IAAI6E,EAAc,cACdC,EAAQ,QACL,SAASC,EAAkCC,GAChD,IAAIC,EACAC,EAAa,IAAI5B,IACjB6B,EAAyBC,EAA8BF,IACvD,gBACFG,EAAe,UACfjB,GAC2C,QAAxCa,EAAmBD,EAAWM,YAAuC,IAArBL,EAA8BA,EAAmB,CAAC,EAGvG,OAFA1D,EAA8B,CAACyD,EAAWO,OAAQF,GAAkBF,EAAwBN,GAC5FV,EAA4BC,EAAWe,GAChCtC,MAAM2C,KAAKN,EACpB,CACO,SAASO,EAA2BjE,GACzC,IAAI0D,EAAa,IAAI5B,IAErB,OADA/B,EAA8BC,EAAM4D,EAA8BF,GAAaL,GACxEhC,MAAM2C,KAAKN,EACpB,CACA,SAASE,EAA8BF,GACrC,OAAO,SAAgC5E,EAAMC,GAC3C,GAAID,EAAKE,OAASqE,EAAa,CAC7B,IAAIlE,EAAeJ,EAAOA,EAAOH,OAAS,GACtCsF,EAAanF,EAAOA,EAAOH,OAAS,GACxC,GAAuF,oBAAlFsF,aAA+C,EAASA,EAAWpF,KAAKM,OAA2G,YAA5E8E,aAA+C,EAASA,EAAW7E,MAA8G,sBAAxFF,aAAmD,EAASA,EAAaL,KAAKM,OAAqD,WAArBD,EAAaE,MAAqBF,EAAaL,KAAKS,SAA+C,YAApCJ,EAAaL,KAAKU,SAASJ,MAAsBD,EAAaL,KAAKU,SAASC,QAAU6D,EAA4C,eAApCnE,EAAaL,KAAKU,SAASJ,MAAyBD,EAAaL,KAAKU,SAASR,OAASsE,GACtiB,IAAK,IAAIa,KAAOD,EAAWpF,KAAKH,UACb,YAAbwF,EAAI/E,MAA2C,iBAAd+E,EAAI1E,OACvCiE,EAAW7D,IAAIsE,EAAI1E,MAI3B,CACF,CACF,C","sources":["webpack:///../../node_modules/@next-core/utils/dist/esm/storyboard/expressions/beforeVisitGlobalMember.js","webpack:///../../node_modules/@next-core/utils/dist/esm/storyboard/expressions/traverse.js","webpack:///../../node_modules/@next-core/utils/dist/esm/storyboard/expressions/collectMemberUsage.js","webpack:///../../node_modules/@next-core/utils/dist/esm/storyboard/expressions/track.js","webpack:///../../node_modules/@next-core/utils/dist/esm/storyboard/functions/traverse.js","webpack:///../../node_modules/@next-core/utils/dist/esm/storyboard/functions/collectMemberUsageInFunction.js","webpack:///../../node_modules/@next-core/utils/dist/esm/storyboard/permissions.js"],"sourcesContent":["export function beforeVisitGlobalMember(usage, objectName) {\n  var level = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  return function beforeVisitGlobal(node, parent) {\n    if (node.name === objectName) {\n      var segments = [];\n      for (var i = 1; i <= level; i++) {\n        var memberParent = parent[parent.length - i];\n        if ((memberParent === null || memberParent === void 0 ? void 0 : memberParent.node.type) === \"MemberExpression\" && memberParent.key === \"object\") {\n          var memberNode = memberParent.node;\n          if (!memberNode.computed && memberNode.property.type === \"Identifier\") {\n            segments.push(memberNode.property.name);\n          } else if (memberNode.computed && memberNode.property.type === \"Literal\" && typeof memberNode.property.value === \"string\") {\n            segments.push(memberNode.property.value);\n          } else {\n            usage.hasNonStaticUsage = true;\n          }\n        } else {\n          usage.hasNonStaticUsage = true;\n        }\n      }\n      if (segments.length === level) {\n        usage.usedProperties.add(segments.join(\".\"));\n      }\n    }\n  };\n}\n//# sourceMappingURL=beforeVisitGlobalMember.js.map","import { isEvaluable, preevaluate } from \"@next-core/cook\";\nimport { isObject } from \"@next-core/utils/general\";\nexport function traverseStoryboardExpressions(data, beforeVisitGlobal,\n// If `options` is a string, it means the *keyword*.\noptions) {\n  var memo = new WeakSet();\n  var {\n    matchExpressionString,\n    visitNotMatchedExpressionString,\n    visitNonExpressionString,\n    visitObject\n  } = typeof options === \"string\" ? {\n    matchExpressionString: v => v.includes(options)\n  } : options;\n  function traverse(value) {\n    if (typeof value === \"string\") {\n      if (isEvaluable(value)) {\n        if (matchExpressionString(value)) {\n          try {\n            preevaluate(value, {\n              withParent: true,\n              hooks: {\n                beforeVisitGlobal(node, parent) {\n                  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                  beforeVisitGlobal(node, parent, value);\n                }\n              }\n            });\n          } catch (error) {\n            // eslint-disable-next-line no-console\n            console.error(\"Parse storyboard expression failed:\", error);\n          }\n        } else {\n          visitNotMatchedExpressionString === null || visitNotMatchedExpressionString === void 0 ? void 0 : visitNotMatchedExpressionString(value);\n        }\n      } else {\n        visitNonExpressionString === null || visitNonExpressionString === void 0 ? void 0 : visitNonExpressionString(value);\n      }\n    } else if (isObject(value)) {\n      // Avoid call stack overflow.\n      if (memo.has(value)) {\n        return;\n      }\n      memo.add(value);\n      visitObject === null || visitObject === void 0 ? void 0 : visitObject(value);\n      for (var item of Array.isArray(value) ? value : Object.values(value)) {\n        traverse(item);\n      }\n    }\n  }\n  traverse(data);\n}\n//# sourceMappingURL=traverse.js.map","import { beforeVisitGlobalMember } from \"./beforeVisitGlobalMember.js\";\nimport { traverseStoryboardExpressions } from \"./traverse.js\";\nexport function strictCollectMemberUsage(data, objectName) {\n  var level = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  var {\n    hasNonStaticUsage,\n    nonStaticUsage,\n    usedProperties\n  } = collectMemberUsage(data, objectName, level);\n  if (hasNonStaticUsage) {\n    throw new Error(\"Non-static usage of \".concat(objectName, \" is prohibited, check your expression: \\\"\").concat(nonStaticUsage, \"\\\"\"));\n  }\n  return usedProperties;\n}\nexport function collectMemberUsage(data, objectName) {\n  var level = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  var usage = {\n    usedProperties: new Set(),\n    hasNonStaticUsage: false\n  };\n  var beforeVisitGlobal = beforeVisitGlobalMember(usage, objectName, level);\n  traverseStoryboardExpressions(data, (node, parent, expr) => {\n    beforeVisitGlobal(node, parent);\n    if (usage.hasNonStaticUsage) {\n      usage.nonStaticUsage = expr;\n    }\n  }, objectName);\n  return usage;\n}\n//# sourceMappingURL=collectMemberUsage.js.map","import { preevaluate } from \"@next-core/cook\";\nimport { beforeVisitGlobalMember } from \"./beforeVisitGlobalMember.js\";\nexport function track(raw, trackText, variableName) {\n  if (raw.includes(trackText)) {\n    var usage = {\n      usedProperties: new Set(),\n      hasNonStaticUsage: false\n    };\n    var {\n      expression\n    } = preevaluate(raw, {\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal: beforeVisitGlobalMember(usage, variableName)\n      }\n    });\n    var trackCtxExp;\n    if (expression.type === \"SequenceExpression\" && (trackCtxExp = expression.expressions[0]) && trackCtxExp.type === \"Literal\" && trackCtxExp.value === trackText) {\n      if (usage.usedProperties.size > 0) {\n        return usage.usedProperties;\n      } else {\n        // eslint-disable-next-line no-console\n        console.warn(\"You are using \\\"\".concat(trackText, \"\\\" but no `\").concat(variableName, \"` usage found in your expression: \").concat(JSON.stringify(raw)));\n      }\n    }\n  }\n  return false;\n}\n//# sourceMappingURL=track.js.map","import { precookFunction } from \"@next-core/cook\";\nexport function traverseStoryboardFunctions(functions, beforeVisitGlobal) {\n  if (Array.isArray(functions)) {\n    for (var fn of functions) {\n      traverseStoryboardFunction(fn, beforeVisitGlobal);\n    }\n  }\n}\nexport function traverseStoryboardFunction(fn, beforeVisitGlobal) {\n  try {\n    precookFunction(fn.source, {\n      typescript: fn.typescript,\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal\n      }\n    });\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(\"Parse storyboard function \\\"\".concat(fn.name, \"\\\" failed:\"), error);\n  }\n}\n//# sourceMappingURL=traverse.js.map","import { beforeVisitGlobalMember } from \"../expressions/beforeVisitGlobalMember.js\";\nimport { traverseStoryboardFunction } from \"./traverse.js\";\nexport function strictCollectMemberUsageInFunction(fn, objectName) {\n  var level = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  var {\n    hasNonStaticUsage,\n    usedProperties\n  } = collectMemberUsageInFunction(fn, objectName, level);\n  if (hasNonStaticUsage) {\n    throw new Error(\"Non-static usage of \".concat(objectName, \" is prohibited, check your function: \\\"\").concat(fn.name, \"\\\"\"));\n  }\n  return usedProperties;\n}\nexport function collectMemberUsageInFunction(fn, objectName) {\n  var level = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  var usage = {\n    usedProperties: new Set(),\n    hasNonStaticUsage: false\n  };\n  traverseStoryboardFunction(fn, beforeVisitGlobalMember(usage, objectName, level));\n  usage.usedProperties.delete(fn.name);\n  return usage;\n}\n//# sourceMappingURL=collectMemberUsageInFunction.js.map","import { traverseStoryboardExpressions } from \"./expressions/index.js\";\nimport { traverseStoryboardFunctions } from \"./functions/index.js\";\nvar PERMISSIONS = \"PERMISSIONS\";\nvar check = \"check\";\nexport function scanPermissionActionsInStoryboard(storyboard) {\n  var _storyboard$meta;\n  var collection = new Set();\n  var beforeVisitPermissions = beforeVisitPermissionsFactory(collection);\n  var {\n    customTemplates,\n    functions\n  } = (_storyboard$meta = storyboard.meta) !== null && _storyboard$meta !== void 0 ? _storyboard$meta : {};\n  traverseStoryboardExpressions([storyboard.routes, customTemplates], beforeVisitPermissions, PERMISSIONS);\n  traverseStoryboardFunctions(functions, beforeVisitPermissions);\n  return Array.from(collection);\n}\nexport function scanPermissionActionsInAny(data) {\n  var collection = new Set();\n  traverseStoryboardExpressions(data, beforeVisitPermissionsFactory(collection), PERMISSIONS);\n  return Array.from(collection);\n}\nfunction beforeVisitPermissionsFactory(collection) {\n  return function beforeVisitPermissions(node, parent) {\n    if (node.name === PERMISSIONS) {\n      var memberParent = parent[parent.length - 1];\n      var callParent = parent[parent.length - 2];\n      if ((callParent === null || callParent === void 0 ? void 0 : callParent.node.type) === \"CallExpression\" && (callParent === null || callParent === void 0 ? void 0 : callParent.key) === \"callee\" && (memberParent === null || memberParent === void 0 ? void 0 : memberParent.node.type) === \"MemberExpression\" && memberParent.key === \"object\" && (memberParent.node.computed ? memberParent.node.property.type === \"Literal\" && memberParent.node.property.value === check : memberParent.node.property.type === \"Identifier\" && memberParent.node.property.name === check)) {\n        for (var arg of callParent.node.arguments) {\n          if (arg.type === \"Literal\" && typeof arg.value === \"string\") {\n            collection.add(arg.value);\n          }\n        }\n      }\n    }\n  };\n}\n//# sourceMappingURL=permissions.js.map"],"names":["beforeVisitGlobalMember","usage","objectName","level","arguments","length","undefined","node","parent","name","segments","i","memberParent","type","key","memberNode","computed","property","value","push","hasNonStaticUsage","usedProperties","add","join","traverseStoryboardExpressions","data","beforeVisitGlobal","options","memo","WeakSet","matchExpressionString","visitNotMatchedExpressionString","visitNonExpressionString","visitObject","v","includes","traverse","isEvaluable","preevaluate","withParent","hooks","error","console","isObject","has","item","Array","isArray","Object","values","strictCollectMemberUsage","nonStaticUsage","collectMemberUsage","Error","concat","Set","expr","track","raw","trackText","variableName","trackCtxExp","expression","expressions","size","warn","JSON","stringify","traverseStoryboardFunctions","functions","fn","traverseStoryboardFunction","precookFunction","source","typescript","strictCollectMemberUsageInFunction","collectMemberUsageInFunction","delete","PERMISSIONS","check","scanPermissionActionsInStoryboard","storyboard","_storyboard$meta","collection","beforeVisitPermissions","beforeVisitPermissionsFactory","customTemplates","meta","routes","from","scanPermissionActionsInAny","callParent","arg"],"sourceRoot":""}