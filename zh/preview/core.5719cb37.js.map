{"version":3,"file":"core.5719cb37.js","mappings":"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","sources":["webpack:///./src/preview/bootstrap.ts","webpack:///../../src/ExecutionContext.ts","webpack:///../../src/traverse.ts","webpack:///../../src/context-free.ts","webpack:///../../src/sanitize.ts","webpack:///../../src/cook.ts","webpack:///../../src/hasOwnProperty.ts","webpack:///../../src/AnalysisContext.ts","webpack:///../../src/precook.ts","webpack:///../../src/parse.ts","webpack:///../../src/precookFunction.ts","webpack:///../../src/preevaluate.ts","webpack:///../../src/fetch.ts","webpack:///../../src/errors.ts","webpack:///../../src/InterceptorManager.ts","webpack:///../../src/http.ts","webpack:///../../src/init.ts","webpack:///../../src/text.ts","webpack:///../../src/index.ts","webpack:///../../src/interfaces.ts","webpack:///../../src/lexical.ts","webpack:///../../src/compile.ts","webpack:///../../src/syntax.ts","webpack:///../../src/loadScript.ts","webpack:///../../src/stableLoadBricks.ts","webpack:///../../src/loadSharedModule.ts","webpack:///../../src/CustomProcessors.ts","webpack:///../../../src/internal/registerAppI18n.ts","webpack:///../../../../src/internal/compute/WidgetI18n.ts","webpack:///../../../../src/internal/compute/images.ts","webpack:///../../../src/internal/devtools.ts","webpack:///../../../src/internal/proxyFactories.ts","webpack:///../../src/themeAndMode.ts","webpack:///../../src/getBasePath.ts","webpack:///../../../../src/internal/compute/getGeneralGlobals.ts","webpack:///../../src/StoryboardFunctionRegistry.ts","webpack:///../../../../src/internal/compute/StoryboardFunctions.ts","webpack:///../../../src/internal/mediaQuery.ts","webpack:///../../../../src/internal/compute/getStorageItem.ts","webpack:///../../../src/internal/matchStoryboard.ts","webpack:///../../src/history.ts","webpack:///../../../src/internal/historyExtended.ts","webpack:///../../../src/internal/Runtime.ts","webpack:///../../../../src/internal/data/CollectContracts.ts","webpack:///../../../../src/internal/data/FlowApi.ts","webpack:///../../../../src/internal/data/FlowApiProvider.ts","webpack:///../../../../src/internal/data/getProviderBrick.ts","webpack:///../../../../src/internal/data/resolveData.ts","webpack:///../../../../src/internal/compute/checkIf.ts","webpack:///../../../../src/internal/compute/getNextStateOfUseBrick.ts","webpack:///../../../../src/internal/compute/getTracks.ts","webpack:///../../../../src/internal/compute/evaluate.ts","webpack:///../../../../src/internal/compute/computeRealProperties.ts","webpack:///../../../../src/internal/compute/setRealProperties.ts","webpack:///../../../../src/internal/compute/setProperties.ts","webpack:///../../src/isStrictMode.ts","webpack:///../../src/CustomTemplates.ts","webpack:///../../../../src/internal/CustomTemplates/utils.ts","webpack:///../../../../src/internal/FormRenderer/utils.ts","webpack:///../../../../src/internal/compute/listenOnTrackingContext.ts","webpack:///../../../src/internal/matchPath.ts","webpack:///../../../src/internal/matchRoutes.ts","webpack:///../../../../src/internal/CustomTemplates/constants.ts","webpack:///../../../src/internal/poll.ts","webpack:///../../../src/internal/i18n.ts","webpack:///../../src/Dialog.ts","webpack:///../../src/handleHttpError.ts","webpack:///../../src/Notification.ts","webpack:///../../../src/internal/bindListeners.ts","webpack:///../../../../src/internal/data/resolveDataStore.ts","webpack:///../../../../src/internal/data/DataStore.ts","webpack:///../../../../src/internal/CustomTemplates/setupTemplateProxy.ts","webpack:///../../../../src/internal/CustomTemplates/setupUseBrickInTemplate.ts","webpack:///../../../../src/internal/CustomTemplates/expandCustomTemplate.ts","webpack:///../../../src/internal/enums.ts","webpack:///../../../../src/internal/FormRenderer/constants.ts","webpack:///../../../../src/internal/FormRenderer/expandFormRenderer.ts","webpack:///../../../../src/internal/FormRenderer/getDefaultProperties.ts","webpack:///../../../src/internal/Renderer.ts","webpack:///../../../../src/internal/CustomTemplates/bindTemplateProxy.ts","webpack:///../../../src/internal/mount.ts","webpack:///../../../src/internal/RendererContext.ts","webpack:///../../src/getPageInfo.ts","webpack:///../../../../src/internal/compute/markAsComputed.ts","webpack:///../../../src/internal/abortController.ts","webpack:///../../../src/internal/registerCustomTemplates.ts","webpack:///../../../src/internal/fulfilStoryboard.ts","webpack:///../../../../src/internal/compute/collectMemberCallUsage.ts","webpack:///../../../src/internal/checkInstalledApps.ts","webpack:///../../../src/internal/insertPreviewRoutes.ts","webpack:///../../../src/internal/Router.ts","webpack:///../../../src/internal/injected.ts","webpack:///../../../../src/internal/compute/WidgetFunctions.ts","webpack:///../../../../src/internal/menu/constants.ts","webpack:///../../../../src/internal/menu/loadDynamicMenuItems.ts","webpack:///../../../../src/internal/menu/mergeMenu.ts","webpack:///../../../../src/internal/menu/reorderMenuItems.ts","webpack:///../../../../src/internal/menu/computeMenuData.ts","webpack:///../../../../src/internal/menu/fetchMenuTitle.ts","webpack:///../../../../src/internal/menu/getMenusOfStandaloneApp.ts","webpack:///../../../../src/internal/menu/fetchMenuById.ts","webpack:///../../../../src/internal/compute/computeRealValue.ts","webpack:///../../../src/internal/checkPermissions.ts","webpack:///../../src/auth.ts","webpack:///../../src/fetchByProvider.ts","webpack:///../../src/createRoot.ts","webpack:///../../../src/internal/secret_internals.ts","webpack:///../../../src/general/createProviderClass.ts","webpack:///../../../src/general/deepFreeze.ts","webpack:///../../../src/general/hasOwnProperty.ts","webpack:///../../../src/general/isObject.ts","webpack:///../../../src/general/JsonStorage.ts","webpack:///../../../src/general/unwrapProvider.ts","webpack:///../../../../src/storyboard/expressions/beforeVisitGlobalMember.ts","webpack:///../../../../src/storyboard/expressions/traverse.ts","webpack:///../../../../src/storyboard/expressions/collectMemberUsage.ts","webpack:///../../../../src/storyboard/expressions/track.ts","webpack:///../../../../src/storyboard/functions/traverse.ts","webpack:///../../../../src/storyboard/functions/collectMemberUsageInFunction.ts","webpack:///../../../src/storyboard/permissions.ts"],"sourcesContent":["import {\n  createRuntime,\n  applyTheme,\n  unstable_createRoot,\n} from \"@next-core/runtime\";\nimport { http, HttpError, HttpResponse } from \"@next-core/http\";\nimport type { BootstrapData, CustomTemplate } from \"@next-core/types\";\nimport { safeLoad, JSON_SCHEMA } from \"js-yaml\";\nimport \"@next-core/theme\";\n\ninterface RenderRequest {\n  type: RenderType;\n  sources: Sources;\n  options?: RenderOptions;\n}\n\nhttp.interceptors.request.use((config) => {\n  if (!config.options?.interceptorParams?.ignoreLoadingBar) {\n    window.dispatchEvent(new Event(\"request.start\"));\n  }\n  return config;\n});\n\nhttp.interceptors.response.use(\n  function (response: HttpResponse) {\n    window.dispatchEvent(new Event(\"request.end\"));\n    return response;\n  },\n  function (error: HttpError) {\n    window.dispatchEvent(new Event(\"request.end\"));\n    return Promise.reject(error);\n  }\n);\n\nconst loadingBar = document.querySelector(\"#global-loading-bar\");\nloadingBar.classList.add(\"rendered\");\n\nlet loading = false;\nlet count = 0;\nfunction updateLoadingStatus() {\n  const hasRemainingRequests = count > 0;\n  if (hasRemainingRequests !== loading) {\n    loading = hasRemainingRequests;\n    loadingBar.classList[hasRemainingRequests ? \"add\" : \"remove\"](\"loading\");\n  }\n}\nconst requestStart = (): void => {\n  count++;\n  updateLoadingStatus();\n};\nconst requestEnd = (): void => {\n  // 兼容 loading bar 在某些请求开始和结束之间初始化时，`count` 可能小于 0 的情况\n  if (count > 0) {\n    count--;\n    updateLoadingStatus();\n  }\n};\nwindow.addEventListener(\"request.start\", requestStart);\nwindow.addEventListener(\"request.end\", requestEnd);\n\nconst runtime = createRuntime();\n\nconst container = document.querySelector(\"#preview-root\") as HTMLElement;\nconst portal = document.querySelector(\"#portal-mount-point\") as HTMLElement;\nconst root = unstable_createRoot(container, {\n  portal,\n  scope: \"page\",\n  unknownBricks: \"silent\",\n});\n\nconst bootstrap = http\n  .get<BootstrapData>(window.BOOTSTRAP_FILE, {\n    responseType: \"json\",\n  })\n  .then((data) => {\n    runtime.initialize(data);\n  });\n\nlet rendering = false;\nlet nextRequest: RenderRequest;\n\nwindow._preview_only_render = (type, sources, options) => {\n  if (rendering) {\n    nextRequest = { type, sources, options };\n  } else {\n    queuedRender({ type, sources, options });\n  }\n};\n\nasync function queuedRender(request: RenderRequest) {\n  rendering = true;\n  try {\n    const { type, sources, options } = request;\n    // Assert: `render()` will not throw\n    await render(type, sources, options);\n  } finally {\n    rendering = false;\n    if (nextRequest) {\n      const req = nextRequest;\n      nextRequest = undefined;\n      queuedRender(req);\n    }\n  }\n}\n\nlet initialized = false;\n\nasync function render(\n  type: \"html\" | \"yaml\",\n  { yaml, html, javascript }: Sources,\n  {\n    theme,\n    context,\n    functions,\n    templates,\n    i18n,\n    styleText,\n    templatesAreArrayOfYaml,\n  }: RenderOptions = {}\n): Promise<void> {\n  try {\n    if (!initialized) {\n      initialized = true;\n      document.body.classList.add(\"bootstrap-ready\");\n      applyTheme(theme === \"light\" ? theme : \"dark-v2\");\n    }\n    document.body.classList.remove(\"bootstrap-error\");\n    if (type === \"html\") {\n      // document.documentElement.dataset.theme =\n      //   theme === \"light\" ? theme : \"dark-v2\";\n      applyTheme(theme === \"light\" ? theme : \"dark-v2\");\n      // Note: if use DOMParser, script tags will not be executed, while using\n      // createContextualFragment they will.\n      const parser = new DOMParser();\n      const dom = parser.parseFromString(html, \"text/html\");\n      // const dom = document.createRange().createContextualFragment(html);\n      const nodes = dom.querySelectorAll(\"*\");\n      const bricks = new Set<string>();\n      for (const node of nodes) {\n        if (node.tagName.includes(\"-\")) {\n          const lowerTagName = node.tagName.toLowerCase();\n          bricks.add(lowerTagName);\n        }\n      }\n\n      await bootstrap;\n\n      await runtime.loadBricks(bricks);\n      container.textContent = \"\";\n      portal.textContent = \"\";\n      container.append(...dom.body.childNodes);\n      // container.append(dom);\n      const scriptTag = document.createElement(\"script\");\n      scriptTag.text = javascript;\n      scriptTag.type = \"module\";\n      container.appendChild(scriptTag);\n    } else {\n      const parsed = yaml\n        ? (safeLoad(yaml, { schema: JSON_SCHEMA, json: true }) as any)\n        : null;\n      const bricks = [].concat(parsed ?? []);\n      if (styleText) {\n        bricks.push({\n          brick: \"style\",\n          portal: true,\n          properties: {\n            textContent: styleText,\n          },\n        });\n      }\n\n      const parsedContext = loadYaml(context) as any[];\n      const parsedFunctions = loadYaml(functions) as any[];\n      const parsedTemplates = loadYaml(\n        templates,\n        templatesAreArrayOfYaml\n      ) as any[];\n      const parsedI18n = loadYaml(i18n) as any;\n\n      await bootstrap;\n      await root.render(bricks, {\n        theme: theme === \"light\" ? theme : \"dark-v2\",\n        context: parsedContext,\n        functions: parsedFunctions,\n        templates: parsedTemplates,\n        i18n: parsedI18n,\n      });\n    }\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error(\"Render failed:\", e);\n\n    // `.bootstrap-error` makes loading-bar invisible.\n    document.body.classList.add(\"bootstrap-error\");\n\n    portal.textContent = \"\";\n    container.textContent = `Render failed: ${String(e)}`;\n  }\n}\n\ninterface YamlTemplate {\n  name: string;\n  yaml: string;\n}\n\nfunction loadYaml(content: unknown, templatesAreArrayOfYaml?: boolean) {\n  return typeof content === \"string\"\n    ? safeLoad(content, { schema: JSON_SCHEMA, json: true })\n    : templatesAreArrayOfYaml\n    ? (content as YamlTemplate[]).map((item) =>\n        typeof item.yaml === \"string\"\n          ? {\n              ...(safeLoad(item.yaml, {\n                schema: JSON_SCHEMA,\n                json: true,\n              }) as CustomTemplate),\n              name: item.name,\n            }\n          : item\n      )\n    : content;\n}\n","import {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Statement,\n} from \"@babel/types\";\n\n// https://tc39.es/ecma262/#sec-execution-contexts\nexport class ExecutionContext {\n  VariableEnvironment?: EnvironmentRecord;\n  LexicalEnvironment?: EnvironmentRecord;\n  Function?: FunctionObject;\n}\n\nexport type EnvironmentRecordType = \"function\" | \"declarative\";\n\n// https://tc39.es/ecma262/#sec-environment-records\nexport class EnvironmentRecord {\n  readonly OuterEnv: EnvironmentRecord | null | undefined;\n  private readonly bindingMap = new Map<string, BindingState>();\n\n  constructor(outer: EnvironmentRecord | null | undefined) {\n    this.OuterEnv = outer;\n  }\n\n  HasBinding(name: string): boolean {\n    return this.bindingMap.has(name);\n  }\n\n  CreateMutableBinding(name: string, deletable: boolean): CompletionRecord {\n    // Assert: binding does not exist.\n    this.bindingMap.set(name, {\n      mutable: true,\n      deletable,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  /**\n   * Create an immutable binding.\n   *\n   * @param name - The binding name.\n   * @param strict - For named function expressions, strict is false, otherwise it's true.\n   * @returns CompletionRecord.\n   */\n  CreateImmutableBinding(name: string, strict: boolean): CompletionRecord {\n    // Assert: binding does not exist.\n    this.bindingMap.set(name, {\n      strict,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  InitializeBinding(name: string, value: unknown): CompletionRecord {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists and uninitialized.\n    Object.assign<BindingState, Partial<BindingState>>(binding, {\n      initialized: true,\n      value,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  /**\n   * Update a mutable binding value, including function declarations.\n   *\n   * @param name - The binding name.\n   * @param value - The binding value.\n   * @param strict - For functions, strict is always false, otherwise it depends on strict-mode.\n   * @returns\n   */\n  SetMutableBinding(\n    name: string,\n    value: unknown,\n    strict?: boolean\n  ): CompletionRecord {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists.\n    if (!binding.initialized) {\n      throw new ReferenceError(`${name} is not initialized`);\n    } else if (binding.mutable) {\n      binding.value = value;\n    } else {\n      throw new TypeError(`Assignment to constant variable`);\n    }\n    return NormalCompletion(undefined);\n  }\n\n  GetBindingValue(name: string, strict?: boolean): unknown {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists.\n    if (!binding.initialized) {\n      throw new ReferenceError(`${name} is not initialized`);\n    }\n    return binding.value;\n  }\n}\n\nexport class DeclarativeEnvironment extends EnvironmentRecord {}\n\nexport class FunctionEnvironment extends EnvironmentRecord {}\n\nexport interface BindingState {\n  initialized?: boolean;\n  value?: unknown;\n  mutable?: boolean;\n\n  /** This is used for mutable bindings only. */\n  deletable?: boolean;\n\n  /**\n   * This is used for immutable bindings only.\n   * For named function expressions, `strict` is false,\n   * otherwise it's true.\n   */\n  strict?: boolean;\n}\n\nexport const SourceNode = Symbol.for(\"SourceNode\");\nexport const FormalParameters = Symbol.for(\"FormalParameters\");\nexport const ECMAScriptCode = Symbol.for(\"ECMAScriptCode\");\nexport const Environment = Symbol.for(\"Environment\");\nexport const IsConstructor = Symbol.for(\"IsConstructor\");\n\nexport interface FunctionObject {\n  (...args: unknown[]): unknown;\n  [SourceNode]:\n    | FunctionDeclaration\n    | FunctionExpression\n    | ArrowFunctionExpression;\n  [FormalParameters]: FunctionDeclaration[\"params\"];\n  [ECMAScriptCode]: Statement[] | Expression;\n  [Environment]: EnvironmentRecord;\n  [IsConstructor]: boolean;\n}\n\n// https://tc39.es/ecma262/#sec-reference-record-specification-type\nexport class ReferenceRecord {\n  readonly Base:\n    | Record<PropertyKey, unknown>\n    | EnvironmentRecord\n    | \"unresolvable\";\n  readonly ReferenceName: PropertyKey;\n  /** Whether the reference is in strict mode. */\n  readonly Strict?: boolean;\n\n  constructor(\n    base: Record<PropertyKey, unknown> | EnvironmentRecord | \"unresolvable\",\n    referenceName: PropertyKey,\n    strict: boolean\n  ) {\n    this.Base = base;\n    this.ReferenceName = referenceName;\n    this.Strict = strict;\n  }\n}\n\n// https://tc39.es/ecma262/#sec-completion-record-specification-type\nexport class CompletionRecord {\n  readonly Type: CompletionRecordType;\n  readonly Value: unknown;\n\n  constructor(type: CompletionRecordType, value: unknown) {\n    this.Type = type;\n    this.Value = value;\n  }\n}\n\nexport type CompletionRecordType =\n  | \"normal\"\n  | \"break\"\n  | \"continue\"\n  | \"return\"\n  | \"throw\";\n\n// https://tc39.es/ecma262/#sec-normalcompletion\nexport function NormalCompletion(value: unknown): CompletionRecord {\n  return new CompletionRecord(\"normal\", value);\n}\n\nexport const Empty = Symbol(\"empty completion\");\n\nexport interface OptionalChainRef {\n  skipped?: boolean;\n}\n","import { FunctionDeclaration, VariableDeclaration } from \"@babel/types\";\nimport { EstreeNode, NodeWithBoundNames } from \"./interfaces.js\";\n\ntype InternalCollect<T = void, O = unknown> = (\n  node: EstreeNode | null | undefined | (EstreeNode | null)[],\n  options?: O\n) => T;\ntype InternalCollectWithOptions<T = void, O = unknown> = (\n  node: EstreeNode | null | undefined | (EstreeNode | null)[],\n  options: O\n) => T;\n\nexport function collectBoundNames(\n  root: NodeWithBoundNames | NodeWithBoundNames[] | null | undefined\n): string[] {\n  const names = new Set<string>();\n  const collect: InternalCollect = (node) => {\n    if (Array.isArray(node)) {\n      for (const n of node) {\n        collect(n);\n      }\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"Identifier\":\n          names.add(node.name);\n          return;\n        case \"VariableDeclaration\":\n          return collect(node.declarations);\n        case \"VariableDeclarator\":\n          return collect(node.id);\n        case \"ArrayPattern\":\n          return collect(node.elements);\n        case \"AssignmentPattern\":\n          return collect(node.left);\n        case \"ObjectPattern\":\n          return collect(node.properties);\n        case \"Property\":\n          return collect(node.value);\n        case \"RestElement\":\n          return collect(node.argument);\n        case \"FunctionDeclaration\":\n          return collect(node.id);\n      }\n    }\n  };\n  collect(root);\n  return Array.from(names);\n}\n\nexport function containsExpression(\n  root: EstreeNode | EstreeNode[]\n): boolean | undefined {\n  const collect: InternalCollect<boolean | undefined> = (node) => {\n    if (Array.isArray(node)) {\n      return node.some(collect);\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"ArrayPattern\":\n          return collect(node.elements);\n        case \"AssignmentPattern\":\n          return true;\n        case \"ObjectPattern\":\n          return collect(node.properties);\n        case \"Property\":\n          return node.computed || collect(node.value);\n        case \"RestElement\":\n          return collect(node.argument);\n      }\n    }\n  };\n  return collect(root);\n}\n\ninterface ScopedDeclarationOptions {\n  var?: boolean;\n  topLevel?: boolean;\n}\n\ntype ScopedDeclaration = VariableDeclaration | FunctionDeclaration;\n\nexport function collectScopedDeclarations(\n  root: EstreeNode | EstreeNode[],\n  options: ScopedDeclarationOptions\n): ScopedDeclaration[] {\n  const declarations: ScopedDeclaration[] = [];\n  const nextOptions = { var: options.var };\n  const collect: InternalCollectWithOptions<void, ScopedDeclarationOptions> = (\n    node,\n    options\n  ): void => {\n    if (Array.isArray(node)) {\n      for (const n of node) {\n        collect(n, options);\n      }\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"FunctionDeclaration\":\n          // At the top level of a function, or script, function declarations are\n          // treated like var declarations rather than like lexical declarations.\n          // See https://tc39.es/ecma262/#sec-static-semantics-toplevellexicallydeclarednames\n          if (Number(!options.var) ^ Number(options.topLevel)) {\n            declarations.push(node);\n          }\n          return;\n        case \"VariableDeclaration\":\n          if (Number(!options.var) ^ Number(node.kind === \"var\")) {\n            declarations.push(node);\n          }\n          return;\n        case \"SwitchCase\":\n          collect(node.consequent, nextOptions);\n          return;\n        case \"CatchClause\":\n          collect(node.body, nextOptions);\n          return;\n      }\n      if (options.var) {\n        switch (node.type) {\n          case \"BlockStatement\":\n            collect(node.body, nextOptions);\n            return;\n          case \"IfStatement\":\n            collect(node.consequent, nextOptions);\n            collect(node.alternate, nextOptions);\n            return;\n          case \"DoWhileStatement\":\n          case \"WhileStatement\":\n            collect(node.body, nextOptions);\n            return;\n          case \"ForStatement\":\n            collect(node.init, nextOptions);\n            collect(node.body, nextOptions);\n            return;\n          case \"ForInStatement\":\n          case \"ForOfStatement\":\n            collect(node.left, nextOptions);\n            collect(node.body, nextOptions);\n            return;\n          case \"SwitchStatement\":\n            collect(node.cases, nextOptions);\n            return;\n          case \"TryStatement\":\n            collect(node.block, nextOptions);\n            collect(node.handler, nextOptions);\n            collect(node.finalizer, nextOptions);\n            return;\n        }\n      }\n    }\n  };\n  collect(root, options);\n  return declarations;\n}\n","import {\n  BinaryExpression,\n  UnaryExpression,\n  VariableDeclaration,\n} from \"@babel/types\";\nimport {\n  CompletionRecord,\n  Empty,\n  EnvironmentRecord,\n  NormalCompletion,\n  ReferenceRecord,\n} from \"./ExecutionContext.js\";\nimport { collectBoundNames } from \"./traverse.js\";\n\n// https://tc39.es/ecma262/#sec-ispropertyreference\nexport function IsPropertyReference(V: ReferenceRecord): boolean {\n  return V.Base !== \"unresolvable\" && !(V.Base instanceof EnvironmentRecord);\n}\n\n// https://tc39.es/ecma262/#sec-initializereferencedbinding\nexport function InitializeReferencedBinding(\n  V: ReferenceRecord,\n  W: unknown\n): CompletionRecord {\n  const base = V.Base as EnvironmentRecord;\n  return base.InitializeBinding(V.ReferenceName as string, W);\n}\n\n// https://tc39.es/ecma262/#sec-copydataproperties\nexport function CopyDataProperties(\n  target: Record<PropertyKey, unknown>,\n  source: unknown,\n  excludedItems: Set<PropertyKey>\n): Record<PropertyKey, unknown> {\n  if (source === undefined || source === null) {\n    return target;\n  }\n  const keys = (Object.getOwnPropertyNames(source) as PropertyKey[]).concat(\n    Object.getOwnPropertySymbols(source)\n  );\n  for (const nextKey of keys) {\n    if (!excludedItems.has(nextKey)) {\n      const desc = Object.getOwnPropertyDescriptor(source, nextKey);\n      if (desc?.enumerable) {\n        target[nextKey] = (source as Record<PropertyKey, unknown>)[nextKey];\n      }\n    }\n  }\n  return target;\n}\n\n// https://tc39.es/ecma262/#sec-runtime-semantics-fordeclarationbindinginstantiation\nexport function ForDeclarationBindingInstantiation(\n  forDeclaration: VariableDeclaration,\n  env: EnvironmentRecord\n): void {\n  const isConst = forDeclaration.kind === \"const\";\n  for (const name of collectBoundNames(forDeclaration)) {\n    if (isConst) {\n      env.CreateImmutableBinding(name, true);\n    } else {\n      env.CreateMutableBinding(name, false);\n    }\n  }\n}\n\n// https://tc39.es/ecma262/#sec-loopcontinues\nexport function LoopContinues(completion: CompletionRecord): boolean {\n  return completion.Type === \"normal\" || completion.Type == \"continue\";\n}\n\n// https://tc39.es/ecma262/#sec-updateempty\nexport function UpdateEmpty(\n  completion: CompletionRecord,\n  value: unknown\n): CompletionRecord {\n  if (completion.Value !== Empty) {\n    return completion;\n  }\n  return new CompletionRecord(completion.Type, value);\n}\n\n// https://tc39.es/ecma262/#sec-getvalue\nexport function GetValue(V: unknown): unknown {\n  if (V instanceof CompletionRecord) {\n    // Assert: V.Type is normal.\n    V = V.Value;\n  }\n  if (!(V instanceof ReferenceRecord)) {\n    return V;\n  }\n  if (V.Base === \"unresolvable\") {\n    throw new ReferenceError(`${V.ReferenceName as string} is not defined`);\n  }\n  if (V.Base instanceof EnvironmentRecord) {\n    const base = V.Base as EnvironmentRecord;\n    return base.GetBindingValue(V.ReferenceName as string, V.Strict);\n  }\n  return V.Base[V.ReferenceName];\n}\n\n// https://tc39.es/ecma262/#sec-topropertykey\nexport function ToPropertyKey(arg: unknown): string | symbol {\n  if (typeof arg === \"symbol\") {\n    return arg;\n  }\n  return String(arg);\n}\n\n// https://tc39.es/ecma262/#sec-getv\nexport function GetV(V: unknown, P: PropertyKey): unknown {\n  return (V as Record<PropertyKey, unknown>)[P];\n}\n\n// https://tc39.es/ecma262/#sec-putvalue\nexport function PutValue(V: ReferenceRecord, W: unknown): CompletionRecord {\n  // Assert: V is a ReferenceRecord.\n  if (V.Base === \"unresolvable\") {\n    throw new ReferenceError(`${V.ReferenceName as string} is not defined`);\n  }\n  if (V.Base instanceof EnvironmentRecord) {\n    return V.Base.SetMutableBinding(V.ReferenceName as string, W, V.Strict);\n  }\n  V.Base[V.ReferenceName] = W;\n  return NormalCompletion(undefined);\n}\n\n// https://tc39.es/ecma262/#sec-createlistiteratorRecord\nexport function CreateListIteratorRecord(\n  args: Iterable<unknown>\n): Iterator<unknown> {\n  if (!isIterable(args)) {\n    throw new TypeError(`${typeof args} is not iterable`);\n  }\n  return args[Symbol.iterator]();\n}\n\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nexport function RequireObjectCoercible(arg: unknown): void {\n  if (arg === null || arg === undefined) {\n    throw new TypeError(\"Cannot destructure properties of undefined or null\");\n  }\n}\n\n// https://tc39.es/ecma262/#sec-getidentifierreference\nexport function GetIdentifierReference(\n  env: EnvironmentRecord | null | undefined,\n  name: string,\n  strict: boolean\n): ReferenceRecord {\n  if (!env) {\n    return new ReferenceRecord(\"unresolvable\", name, strict);\n  }\n  if (env.HasBinding(name)) {\n    return new ReferenceRecord(env, name, strict);\n  }\n  return GetIdentifierReference(env.OuterEnv, name, strict);\n}\n\n// https://tc39.es/ecma262/#sec-applystringornumericbinaryoperator\nexport function ApplyStringOrNumericBinaryOperator(\n  leftValue: number,\n  operator: BinaryExpression[\"operator\"] | \"|>\",\n  rightValue: number\n): unknown {\n  switch (operator) {\n    case \"+\":\n      return leftValue + rightValue;\n    case \"-\":\n      return leftValue - rightValue;\n    case \"/\":\n      return leftValue / rightValue;\n    case \"%\":\n      return leftValue % rightValue;\n    case \"*\":\n      return leftValue * rightValue;\n    case \"**\":\n      return leftValue ** rightValue;\n    case \"==\":\n      return leftValue == rightValue;\n    case \"===\":\n      return leftValue === rightValue;\n    case \"!=\":\n      return leftValue != rightValue;\n    case \"!==\":\n      return leftValue !== rightValue;\n    case \">\":\n      return leftValue > rightValue;\n    case \"<\":\n      return leftValue < rightValue;\n    case \">=\":\n      return leftValue >= rightValue;\n    case \"<=\":\n      return leftValue <= rightValue;\n  }\n  throw new SyntaxError(`Unsupported binary operator \\`${operator}\\``);\n}\n\n// https://tc39.es/ecma262/#sec-assignment-operators\nexport function ApplyStringOrNumericAssignment(\n  leftValue: string | number,\n  operator: string,\n  rightValue: string | number\n): unknown {\n  switch (operator) {\n    case \"+=\":\n    case \"-=\":\n    case \"*=\":\n    case \"/=\":\n    case \"%=\":\n    case \"**=\":\n      return ApplyStringOrNumericBinaryOperator(\n        leftValue as number,\n        operator.substr(0, operator.length - 1) as BinaryExpression[\"operator\"],\n        rightValue as number\n      );\n  }\n\n  throw new SyntaxError(`Unsupported assignment operator \\`${operator}\\``);\n}\n\n// https://tc39.es/ecma262/#sec-unary-operators\nexport function ApplyUnaryOperator(\n  target: unknown,\n  operator: UnaryExpression[\"operator\"]\n): unknown {\n  switch (operator) {\n    case \"!\":\n      return !target;\n    case \"+\":\n      return +(target as string | number);\n    case \"-\":\n      return -(target as string | number);\n    case \"void\":\n      return undefined;\n  }\n  throw new SyntaxError(`Unsupported unary operator \\`${operator}\\``);\n}\n\nexport function isIterable(cooked: unknown): boolean {\n  if (Array.isArray(cooked)) {\n    return true;\n  }\n  if (cooked === null || cooked === undefined) {\n    return false;\n  }\n  return typeof (cooked as Iterable<unknown>)[Symbol.iterator] === \"function\";\n}\n","// Ref https://github.com/tc39/proposal-global\n// In addition, the es6-shim had to switch from Function('return this')()\n// due to CSP concerns, such that the current check to handle browsers,\n// node, web workers, and frames is:\n// istanbul ignore next\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction getGlobal(): object {\n  // the only reliable means to get the global object is\n  // `Function('return this')()`\n  // However, this causes CSP violations in Chrome apps.\n  if (typeof self !== \"undefined\") {\n    return self;\n  }\n  if (typeof window !== \"undefined\") {\n    return window;\n  }\n  if (typeof global !== \"undefined\") {\n    return global;\n  }\n  throw new Error(\"unable to locate global object\");\n}\n\n/**\n * There are chances to construct a `Function` from a string, etc.\n * ```\n * ((a,b)=>a[b])(()=>1, 'constructor')('console.log(`yo`)')()\n * ```\n */\nconst reservedObjects = new WeakSet([\n  // `Function(\"...\")` is considered *extremely vulnerable*.\n  Function,\n  // `Object.assign()` is considered vulnerable.\n  Object,\n  // `prototype` is considered vulnerable.\n  Function.prototype,\n  Object.prototype,\n  // Global `window` is considered vulnerable, too.\n  getGlobal(),\n]);\n\nexport function sanitize(cooked: unknown): void {\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  if (reservedObjects.has(cooked as object)) {\n    throw new TypeError(\"Cannot access reserved objects such as `Function`.\");\n  }\n}\n\nconst allowedConstructors = new WeakSet([\n  Array,\n  Map,\n  Set,\n  URLSearchParams,\n  WeakMap,\n  WeakSet,\n]);\n\nexport function isAllowedConstructor(constructor: unknown): boolean {\n  // `Date` maybe mocked when running tests for storyboard functions.\n  return (\n    allowedConstructors.has(constructor as ArrayConstructor) ||\n    constructor === Date\n  );\n}\n","import {\n  ArrayPattern,\n  ArrowFunctionExpression,\n  CallExpression,\n  CatchClause,\n  DoWhileStatement,\n  Expression,\n  ForInStatement,\n  ForOfStatement,\n  ForStatement,\n  FunctionDeclaration,\n  FunctionExpression,\n  Identifier,\n  LVal,\n  NewExpression,\n  ObjectPattern,\n  PatternLike,\n  RestElement,\n  Statement,\n  SwitchCase,\n  TemplateLiteral,\n  VariableDeclaration,\n  WhileStatement,\n} from \"@babel/types\";\nimport {\n  ApplyStringOrNumericAssignment,\n  CreateListIteratorRecord,\n  ApplyStringOrNumericBinaryOperator,\n  GetV,\n  GetValue,\n  InitializeReferencedBinding,\n  IsPropertyReference,\n  LoopContinues,\n  PutValue,\n  RequireObjectCoercible,\n  ToPropertyKey,\n  UpdateEmpty,\n  ApplyUnaryOperator,\n  GetIdentifierReference,\n  ForDeclarationBindingInstantiation,\n  CopyDataProperties,\n} from \"./context-free.js\";\nimport {\n  CompletionRecord,\n  DeclarativeEnvironment,\n  ECMAScriptCode,\n  Empty,\n  Environment,\n  EnvironmentRecord,\n  ExecutionContext,\n  FormalParameters,\n  FunctionEnvironment,\n  FunctionObject,\n  IsConstructor,\n  NormalCompletion,\n  OptionalChainRef,\n  ReferenceRecord,\n  SourceNode,\n} from \"./ExecutionContext.js\";\nimport {\n  EstreeLVal,\n  EstreeNode,\n  EstreeObjectExpression,\n  EstreeObjectPattern,\n  EstreeProperty,\n  CookRules,\n} from \"./interfaces.js\";\nimport { sanitize, isAllowedConstructor } from \"./sanitize.js\";\nimport {\n  collectBoundNames,\n  collectScopedDeclarations,\n  containsExpression,\n} from \"./traverse.js\";\n\nexport interface CookOptions {\n  rules?: CookRules;\n  globalVariables?: Record<string, unknown>;\n  hooks?: CookHooks;\n}\n\nexport interface CookHooks {\n  beforeEvaluate?(node: EstreeNode): void;\n  beforeCall?(node: EstreeNode): void;\n  beforeBranch?(node: EstreeNode, branch: \"if\" | \"else\"): void;\n}\n\n/** For next-core internal usage only. */\nexport function cook(\n  rootAst: FunctionDeclaration | Expression,\n  codeSource: string,\n  { rules, globalVariables = {}, hooks = {} }: CookOptions = {}\n): unknown {\n  const expressionOnly = rootAst.type !== \"FunctionDeclaration\";\n\n  const rootEnv = new DeclarativeEnvironment(null);\n  const rootContext = new ExecutionContext();\n  rootContext.VariableEnvironment = rootEnv;\n  rootContext.LexicalEnvironment = rootEnv;\n  const executionContextStack = [rootContext];\n\n  for (const [key, value] of Object.entries(globalVariables)) {\n    rootEnv.CreateImmutableBinding(key, true);\n    rootEnv.InitializeBinding(key, value);\n  }\n\n  const TemplateMap = new WeakMap<TemplateLiteral, string[]>();\n\n  // https://tc39.es/ecma262/#sec-gettemplateobject\n  function GetTemplateObject(templateLiteral: TemplateLiteral): string[] {\n    const memo = TemplateMap.get(templateLiteral);\n    if (memo) {\n      return memo;\n    }\n    const rawObj = templateLiteral.quasis.map((quasi) => quasi.value.raw);\n    const template = templateLiteral.quasis.map((quasi) => quasi.value.cooked!);\n    Object.freeze(rawObj);\n    Object.defineProperty(template, \"raw\", {\n      value: rawObj,\n      writable: false,\n      enumerable: false,\n      configurable: false,\n    });\n    Object.freeze(template);\n    TemplateMap.set(templateLiteral, template);\n    return template;\n  }\n\n  function Evaluate(\n    node: EstreeNode,\n    optionalChainRef?: OptionalChainRef\n  ): CompletionRecord {\n    hooks.beforeEvaluate?.(node);\n    // Expressions:\n    switch (node.type) {\n      case \"ArrayExpression\": {\n        // https://tc39.es/ecma262/#sec-array-initializer\n        const array = [];\n        for (const element of node.elements) {\n          if (!element) {\n            array.length += 1;\n          } else if (element.type === \"SpreadElement\") {\n            const spreadValues = GetValue(\n              Evaluate(element.argument)\n            ) as unknown[];\n            array.push(...spreadValues);\n          } else {\n            array.push(GetValue(Evaluate(element)));\n          }\n        }\n        return NormalCompletion(array);\n      }\n      case \"ArrowFunctionExpression\": {\n        // https://tc39.es/ecma262/#sec-arrow-function-definitions\n        ThrowIfFunctionIsInvalid(node);\n        const closure = InstantiateArrowFunctionExpression(node);\n        return NormalCompletion(closure);\n      }\n      case \"BinaryExpression\": {\n        const leftRef = Evaluate(node.left);\n        const leftValue = GetValue(leftRef);\n        const rightRef = Evaluate(node.right).Value;\n        const rightValue = GetValue(rightRef);\n        if (expressionOnly && (node.operator as unknown) === \"|>\") {\n          // Minimal pipeline operator is supported only in expression-only mode.\n          // See https://tc39.es/proposal-pipeline-operator\n          // and https://github.com/tc39/proposal-pipeline-operator\n          if (typeof rightValue !== \"function\") {\n            const funcName = codeSource.substring(\n              node.right.start!,\n              node.right.end!\n            );\n            throw new TypeError(`${funcName} is not a function`);\n          }\n          let thisValue;\n          if (rightRef instanceof ReferenceRecord) {\n            if (IsPropertyReference(rightRef)) {\n              thisValue = rightRef.Base;\n            }\n          }\n          return NormalCompletion(\n            (rightValue as unknown as Function).call(thisValue, leftValue)\n          );\n        }\n        // https://tc39.es/ecma262/#sec-additive-operators\n        const result = ApplyStringOrNumericBinaryOperator(\n          leftValue as number,\n          node.operator,\n          rightValue as number\n        );\n        return NormalCompletion(result);\n      }\n      case \"CallExpression\": {\n        // https://tc39.es/ecma262/#sec-function-calls\n        const ref = Evaluate(node.callee, optionalChainRef)\n          .Value as ReferenceRecord;\n        const func = GetValue(ref) as Function;\n        if (\n          (func === undefined || func === null) &&\n          (node.optional || optionalChainRef?.skipped)\n        ) {\n          optionalChainRef!.skipped = true;\n          return NormalCompletion(undefined);\n        }\n        sanitize(func);\n        return EvaluateCall(func, ref, node.arguments, node.callee);\n      }\n      case \"ChainExpression\":\n        // https://tc39.es/ecma262/#sec-optional-chains\n        return Evaluate(node.expression, {});\n      case \"ConditionalExpression\":\n        // https://tc39.es/ecma262/#sec-conditional-operator\n        return NormalCompletion(\n          GetValue(\n            Evaluate(\n              GetValue(Evaluate(node.test)) ? node.consequent : node.alternate\n            )\n          )\n        );\n      case \"Identifier\":\n        // https://tc39.es/ecma262/#sec-identifiers\n        return NormalCompletion(ResolveBinding(node.name));\n      case \"Literal\": {\n        // https://tc39.es/ecma262/#sec-primary-expression-literals\n        if (node.regex) {\n          if (node.value === null) {\n            // Invalid regular expression fails silently in @babel/parser.\n            throw new SyntaxError(`Invalid regular expression: ${node.raw}`);\n          }\n          if (node.regex.flags.includes(\"u\")) {\n            // Currently unicode flag is not fully supported across major browsers.\n            throw new SyntaxError(\n              `Unsupported unicode flag in regular expression: ${node.raw}`\n            );\n          }\n        }\n        return NormalCompletion(node.value);\n      }\n      case \"LogicalExpression\": {\n        // https://tc39.es/ecma262/#sec-binary-logical-operators\n        const leftValue = GetValue(Evaluate(node.left));\n        switch (node.operator) {\n          case \"&&\":\n            return NormalCompletion(\n              leftValue && GetValue(Evaluate(node.right))\n            );\n          case \"||\":\n            return NormalCompletion(\n              leftValue || GetValue(Evaluate(node.right))\n            );\n          case \"??\":\n            return NormalCompletion(\n              leftValue ?? GetValue(Evaluate(node.right))\n            );\n          // istanbul ignore next\n          default:\n            throw new SyntaxError(\n              // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n              // @ts-ignore never reach here.\n              `Unsupported logical operator '${node.operator}'`\n            );\n        }\n      }\n      case \"MemberExpression\": {\n        // https://tc39.es/ecma262/#sec-property-accessors\n        const baseReference = Evaluate(node.object, optionalChainRef)\n          .Value as ReferenceRecord;\n        const baseValue = GetValue(baseReference) as Record<\n          PropertyKey,\n          unknown\n        >;\n        if (\n          (baseValue === undefined || baseValue === null) &&\n          (node.optional || optionalChainRef?.skipped)\n        ) {\n          optionalChainRef!.skipped = true;\n          return NormalCompletion(undefined);\n        }\n        sanitize(baseValue);\n        const result = node.computed\n          ? EvaluatePropertyAccessWithExpressionKey(\n              baseValue,\n              node.property as Expression,\n              true\n            )\n          : EvaluatePropertyAccessWithIdentifierKey(\n              baseValue,\n              node.property as Identifier,\n              true\n            );\n        sanitize(result);\n        return NormalCompletion(result);\n      }\n      case \"NewExpression\":\n        // https://tc39.es/ecma262/#sec-new-operator\n        return EvaluateNew(node.callee, node.arguments);\n      case \"ObjectExpression\": {\n        // https://tc39.es/ecma262/#sec-object-initializer\n        const object: Record<PropertyKey, unknown> = {};\n        for (const prop of (node as EstreeObjectExpression).properties) {\n          if (prop.type === \"SpreadElement\") {\n            const fromValue = GetValue(Evaluate(prop.argument));\n            CopyDataProperties(object, fromValue, new Set());\n          } else {\n            if (prop.kind !== \"init\") {\n              throw new SyntaxError(\"Unsupported object getter/setter\");\n            }\n            const propName =\n              !prop.computed && prop.key.type === \"Identifier\"\n                ? prop.key.name\n                : EvaluateComputedPropertyName(prop.key as Expression);\n            if (propName === \"__proto__\") {\n              throw new TypeError(\n                \"Setting '__proto__' property is not allowed\"\n              );\n            }\n            object[propName] = GetValue(Evaluate(prop.value));\n          }\n        }\n        return NormalCompletion(object);\n      }\n      case \"SequenceExpression\": {\n        // https://tc39.es/ecma262/#sec-comma-operator\n        let result: CompletionRecord | undefined;\n        for (const expr of node.expressions) {\n          result = NormalCompletion(GetValue(Evaluate(expr)));\n        }\n        return result!;\n      }\n      case \"TemplateLiteral\": {\n        // https://tc39.es/ecma262/#sec-template-literals\n        const chunks: string[] = [node.quasis[0].value.cooked!];\n        let index = 0;\n        for (const expr of node.expressions) {\n          const val = GetValue(Evaluate(expr));\n          chunks.push(String(val));\n          chunks.push(node.quasis[(index += 1)].value.cooked!);\n        }\n        return NormalCompletion(chunks.join(\"\"));\n      }\n      case \"TaggedTemplateExpression\": {\n        // https://tc39.es/ecma262/#sec-tagged-templates\n        const tagRef = Evaluate(node.tag).Value as ReferenceRecord;\n        const tagFunc = GetValue(tagRef) as Function;\n        sanitize(tagFunc);\n        return EvaluateCall(tagFunc, tagRef, node.quasi, node.tag);\n      }\n      case \"UnaryExpression\": {\n        // https://tc39.es/ecma262/#sec-unary-operators\n        const ref = Evaluate(node.argument).Value as ReferenceRecord;\n        if (!expressionOnly && node.operator === \"delete\") {\n          // Delete operator is supported only in function mode.\n          if (!(ref instanceof ReferenceRecord)) {\n            return NormalCompletion(true);\n          }\n          // istanbul ignore else\n          if (IsPropertyReference(ref)) {\n            const deleteStatus = delete (\n              ref.Base as Record<PropertyKey, unknown>\n            )[ref.ReferenceName];\n            return NormalCompletion(deleteStatus);\n          }\n          // Should never reach here in strict mode.\n        }\n        if (node.operator === \"typeof\") {\n          if (ref instanceof ReferenceRecord && ref.Base === \"unresolvable\") {\n            return NormalCompletion(\"undefined\");\n          }\n          return NormalCompletion(typeof GetValue(ref));\n        }\n        return NormalCompletion(\n          ApplyUnaryOperator(GetValue(ref), node.operator)\n        );\n      }\n    }\n    if (!expressionOnly) {\n      // Statements and assignments:\n      switch (node.type) {\n        case \"AssignmentExpression\": {\n          // https://tc39.es/ecma262/#sec-assignment-operators\n          if (node.operator === \"=\") {\n            if (\n              !(\n                node.left.type === \"ArrayPattern\" ||\n                node.left.type === \"ObjectPattern\"\n              )\n            ) {\n              const lref = Evaluate(node.left).Value as ReferenceRecord;\n              // Todo: IsAnonymousFunctionDefinition(lref)\n              const rref = Evaluate(node.right);\n              const rval = GetValue(rref);\n\n              PutValue(lref, rval);\n              return NormalCompletion(rval);\n            }\n            const rref = Evaluate(node.right);\n            const rval = GetValue(rref) as string | number;\n            DestructuringAssignmentEvaluation(node.left, rval);\n            return NormalCompletion(rval);\n          }\n          // Operators other than `=`.\n          const lref = Evaluate(node.left).Value as ReferenceRecord;\n          const lval = GetValue(lref) as string | number;\n          const rref = Evaluate(node.right);\n          const rval = GetValue(rref) as string | number;\n          const r = ApplyStringOrNumericAssignment(lval, node.operator, rval);\n          PutValue(lref, r);\n          return NormalCompletion(r);\n        }\n        case \"BlockStatement\": {\n          // https://tc39.es/ecma262/#sec-block\n          if (!node.body.length) {\n            return NormalCompletion(Empty);\n          }\n          const oldEnv = getRunningContext().LexicalEnvironment;\n          const blockEnv = new DeclarativeEnvironment(oldEnv);\n          BlockDeclarationInstantiation(node.body, blockEnv);\n          getRunningContext().LexicalEnvironment = blockEnv;\n          const blockValue = EvaluateStatementList(node.body);\n          getRunningContext().LexicalEnvironment = oldEnv;\n          return blockValue;\n        }\n        case \"BreakStatement\":\n          // https://tc39.es/ecma262/#sec-break-statement\n          return new CompletionRecord(\"break\", Empty);\n        case \"ContinueStatement\":\n          // https://tc39.es/ecma262/#sec-continue-statement\n          return new CompletionRecord(\"continue\", Empty);\n        case \"EmptyStatement\":\n          // https://tc39.es/ecma262/#sec-empty-statement\n          return NormalCompletion(Empty);\n        case \"DoWhileStatement\":\n          // https://tc39.es/ecma262/#sec-do-while-statement\n          return EvaluateBreakableStatement(DoWhileLoopEvaluation(node));\n        case \"ExpressionStatement\":\n        case \"TSAsExpression\":\n          // https://tc39.es/ecma262/#sec-expression-statement\n          return Evaluate(node.expression);\n        case \"ForInStatement\":\n        case \"ForOfStatement\":\n          // https://tc39.es/ecma262/#sec-for-in-and-for-of-statements\n          return EvaluateBreakableStatement(ForInOfLoopEvaluation(node));\n        case \"ForStatement\":\n          // https://tc39.es/ecma262/#sec-for-statement\n          return EvaluateBreakableStatement(ForLoopEvaluation(node));\n        case \"FunctionDeclaration\":\n          // https://tc39.es/ecma262/#sec-function-definitions\n          return NormalCompletion(Empty);\n        case \"FunctionExpression\":\n          // https://tc39.es/ecma262/#sec-function-defining-expressions\n          ThrowIfFunctionIsInvalid(node);\n          return NormalCompletion(InstantiateOrdinaryFunctionExpression(node));\n        case \"IfStatement\":\n          // https://tc39.es/ecma262/#sec-if-statement\n          return GetValue(Evaluate(node.test))\n            ? (hooks.beforeBranch?.(node, \"if\"),\n              UpdateEmpty(Evaluate(node.consequent), undefined))\n            : (hooks.beforeBranch?.(node, \"else\"), node.alternate)\n            ? UpdateEmpty(Evaluate(node.alternate), undefined)\n            : NormalCompletion(undefined);\n        case \"ReturnStatement\": {\n          // https://tc39.es/ecma262/#sec-return-statement\n          let v: unknown;\n          if (node.argument) {\n            const exprRef = Evaluate(node.argument);\n            v = GetValue(exprRef);\n          }\n          return new CompletionRecord(\"return\", v);\n        }\n        case \"ThrowStatement\":\n          // https://tc39.es/ecma262/#sec-throw-statement\n          throw GetValue(Evaluate(node.argument));\n        case \"UpdateExpression\": {\n          // https://tc39.es/ecma262/#sec-update-expressions\n          const lhs = Evaluate(node.argument).Value as ReferenceRecord;\n          const oldValue = Number(GetValue(lhs));\n          const newValue = node.operator === \"++\" ? oldValue + 1 : oldValue - 1;\n          PutValue(lhs, newValue);\n          return NormalCompletion(node.prefix ? newValue : oldValue);\n        }\n        case \"SwitchCase\":\n          return EvaluateStatementList(node.consequent);\n        case \"SwitchStatement\": {\n          // https://tc39.es/ecma262/#sec-switch-statement\n          const exprRef = Evaluate(node.discriminant);\n          const switchValue = GetValue(exprRef);\n          const oldEnv = getRunningContext().LexicalEnvironment;\n          const blockEnv = new DeclarativeEnvironment(oldEnv);\n          BlockDeclarationInstantiation(node.cases, blockEnv);\n          getRunningContext().LexicalEnvironment = blockEnv;\n          const R = CaseBlockEvaluation(node.cases, switchValue);\n          getRunningContext().LexicalEnvironment = oldEnv;\n          return EvaluateBreakableStatement(R);\n        }\n        case \"TryStatement\": {\n          // https://tc39.es/ecma262/#sec-try-statement\n          let R: CompletionRecord;\n          try {\n            R = Evaluate(node.block);\n          } catch (error) {\n            if (node.handler) {\n              hooks.beforeEvaluate?.(node.handler);\n              R = CatchClauseEvaluation(node.handler, error);\n            } else {\n              throw error;\n            }\n          } finally {\n            if (node.finalizer) {\n              const F = Evaluate(node.finalizer);\n              if (F.Type !== \"normal\") {\n                R = F;\n              }\n            }\n          }\n          return R;\n        }\n        case \"VariableDeclaration\": {\n          // https://tc39.es/ecma262/#sec-declarations-and-the-variable-statement\n          let result: CompletionRecord | undefined;\n          for (const declarator of node.declarations) {\n            if (!declarator.init) {\n              // Assert: a declarator without init is always an identifier.\n              if (node.kind === \"var\") {\n                result = NormalCompletion(Empty);\n              } else {\n                const lhs = ResolveBinding((declarator.id as Identifier).name);\n                result = InitializeReferencedBinding(lhs, undefined);\n              }\n            } else if (declarator.id.type === \"Identifier\") {\n              const bindingId = declarator.id.name;\n              const lhs = ResolveBinding(bindingId);\n              // Todo: IsAnonymousFunctionDefinition(Initializer)\n              const rhs = Evaluate(declarator.init);\n              const value = GetValue(rhs);\n              result =\n                node.kind === \"var\"\n                  ? PutValue(lhs, value)\n                  : InitializeReferencedBinding(lhs, value);\n            } else {\n              const rhs = Evaluate(declarator.init);\n              const rval = GetValue(rhs);\n              result = BindingInitialization(\n                declarator.id,\n                rval,\n                node.kind === \"var\"\n                  ? undefined\n                  : getRunningContext().LexicalEnvironment\n              );\n            }\n          }\n          return result!;\n        }\n        case \"WhileStatement\":\n          // https://tc39.es/ecma262/#sec-while-statement\n          return EvaluateBreakableStatement(WhileLoopEvaluation(node));\n      }\n    }\n    // eslint-disable-next-line no-console\n    throw new SyntaxError(`Unsupported node type \\`${node.type}\\``);\n  }\n\n  // https://tc39.es/ecma262/#sec-execution-contexts\n  function getRunningContext(): ExecutionContext {\n    return executionContextStack[executionContextStack.length - 1];\n  }\n\n  // https://tc39.es/ecma262/#sec-resolvebinding\n  function ResolveBinding(\n    name: string,\n    env?: EnvironmentRecord\n  ): ReferenceRecord {\n    if (!env) {\n      env = getRunningContext().LexicalEnvironment;\n    }\n    return GetIdentifierReference(env, name, true);\n  }\n\n  // Try statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-catchclauseevaluation\n  function CatchClauseEvaluation(\n    node: CatchClause,\n    thrownValue: unknown\n  ): CompletionRecord {\n    if (!node.param) {\n      return Evaluate(node.body);\n    }\n    const oldEnv = getRunningContext().LexicalEnvironment;\n    const catchEnv = new DeclarativeEnvironment(oldEnv);\n    for (const argName of collectBoundNames(node.param)) {\n      catchEnv.CreateMutableBinding(argName, false);\n    }\n    getRunningContext().LexicalEnvironment = catchEnv;\n    BindingInitialization(node.param, thrownValue, catchEnv);\n    const B = Evaluate(node.body);\n    getRunningContext().LexicalEnvironment = oldEnv;\n    return B;\n  }\n\n  // Iteration statements and switch statements.\n  // https://tc39.es/ecma262/#prod-BreakableStatement\n  function EvaluateBreakableStatement(\n    stmtResult: CompletionRecord\n  ): CompletionRecord {\n    return stmtResult.Type === \"break\"\n      ? stmtResult.Value === Empty\n        ? NormalCompletion(undefined)\n        : NormalCompletion(stmtResult.Value)\n      : stmtResult;\n  }\n\n  // Switch statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-caseblockevaluation\n  function CaseBlockEvaluation(\n    cases: SwitchCase[],\n    input: unknown\n  ): CompletionRecord {\n    let V: unknown;\n\n    const defaultCaseIndex = cases.findIndex((switchCase) => !switchCase.test);\n    const hasDefaultCase = defaultCaseIndex >= 0;\n    const A = hasDefaultCase ? cases.slice(0, defaultCaseIndex) : cases;\n    let found = false;\n    for (const C of A) {\n      if (!found) {\n        found = CaseClauseIsSelected(C, input);\n      }\n      if (found) {\n        const R = Evaluate(C);\n        if (R.Value !== Empty) {\n          V = R.Value;\n        }\n        if (R.Type !== \"normal\") {\n          return UpdateEmpty(R, V);\n        }\n      }\n    }\n\n    if (!hasDefaultCase) {\n      return NormalCompletion(V);\n    }\n\n    let foundInB = false;\n    const B = cases.slice(defaultCaseIndex + 1);\n    if (!found) {\n      for (const C of B) {\n        if (!foundInB) {\n          foundInB = CaseClauseIsSelected(C, input);\n        }\n        if (foundInB) {\n          const R = Evaluate(C);\n          if (R.Value !== Empty) {\n            V = R.Value;\n          }\n          if (R.Type !== \"normal\") {\n            return UpdateEmpty(R, V);\n          }\n        }\n      }\n    }\n\n    if (foundInB) {\n      return NormalCompletion(V);\n    }\n    const R = Evaluate(cases[defaultCaseIndex]);\n    if (R.Value !== Empty) {\n      V = R.Value;\n    }\n    if (R.Type !== \"normal\") {\n      return UpdateEmpty(R, V);\n    }\n\n    // NOTE: The following is another complete iteration of the second CaseClauses.\n    for (const C of B) {\n      const R = Evaluate(C);\n      if (R.Value !== Empty) {\n        V = R.Value;\n      }\n      if (R.Type !== \"normal\") {\n        return UpdateEmpty(R, V);\n      }\n    }\n    return NormalCompletion(V);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-caseclauseisselected\n  function CaseClauseIsSelected(C: SwitchCase, input: unknown): boolean {\n    const clauseSelector = GetValue(Evaluate(C.test!));\n    return input === clauseSelector;\n  }\n\n  // While statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-whileloopevaluation\n  function WhileLoopEvaluation(node: WhileStatement): CompletionRecord {\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const exprValue = GetValue(Evaluate(node.test));\n      if (!exprValue) {\n        return NormalCompletion(V);\n      }\n      const stmtResult = Evaluate(node.body);\n      if (!LoopContinues(stmtResult)) {\n        return UpdateEmpty(stmtResult, V);\n      }\n      if (stmtResult.Value !== Empty) {\n        V = stmtResult.Value;\n      }\n    }\n  }\n\n  // Do-while Statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-dowhileloopevaluation\n  function DoWhileLoopEvaluation(node: DoWhileStatement): CompletionRecord {\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const stmtResult = Evaluate(node.body);\n      if (!LoopContinues(stmtResult)) {\n        return UpdateEmpty(stmtResult, V);\n      }\n      if (stmtResult.Value !== Empty) {\n        V = stmtResult.Value;\n      }\n      const exprValue = GetValue(Evaluate(node.test));\n      if (!exprValue) {\n        return NormalCompletion(V);\n      }\n    }\n  }\n\n  // For in/of statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forinofloopevaluation\n  function ForInOfLoopEvaluation(\n    node: ForInStatement | ForOfStatement\n  ): CompletionRecord {\n    const lhs = node.left;\n    const isVariableDeclaration = lhs.type === \"VariableDeclaration\";\n    const lhsKind = isVariableDeclaration\n      ? lhs.kind === \"var\"\n        ? \"varBinding\"\n        : \"lexicalBinding\"\n      : \"assignment\";\n    const uninitializedBoundNames =\n      lhsKind === \"lexicalBinding\" ? collectBoundNames(lhs) : [];\n    const iterationKind =\n      node.type === \"ForInStatement\" ? \"enumerate\" : \"iterate\";\n    const keyResult = ForInOfHeadEvaluation(\n      uninitializedBoundNames,\n      node.right,\n      iterationKind\n    );\n    if (keyResult.Type !== \"normal\") {\n      // When enumerate, if the target is nil, a break completion will be returned.\n      return keyResult;\n    }\n    return ForInOfBodyEvaluation(\n      lhs,\n      node.body,\n      keyResult.Value as Iterator<unknown>,\n      iterationKind,\n      lhsKind\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forinofheadevaluation\n  function ForInOfHeadEvaluation(\n    uninitializedBoundNames: string[],\n    expr: Expression,\n    iterationKind: \"enumerate\" | \"iterate\"\n  ): CompletionRecord {\n    const runningContext = getRunningContext();\n    const oldEnv = runningContext.LexicalEnvironment;\n    if (uninitializedBoundNames.length > 0) {\n      const newEnv = new DeclarativeEnvironment(oldEnv);\n      for (const name of uninitializedBoundNames) {\n        newEnv.CreateMutableBinding(name, false);\n      }\n      runningContext.LexicalEnvironment = newEnv;\n    }\n    const exprRef = Evaluate(expr);\n    runningContext.LexicalEnvironment = oldEnv;\n    const exprValue = GetValue(exprRef);\n    if (iterationKind === \"enumerate\") {\n      if (exprValue === null || exprValue === undefined) {\n        return new CompletionRecord(\"break\", Empty);\n      }\n      const iterator = EnumerateObjectProperties(exprValue);\n      return NormalCompletion(iterator);\n    }\n    const iterator = CreateListIteratorRecord(exprValue as Iterable<unknown>);\n    return NormalCompletion(iterator);\n  }\n\n  function ForInOfBodyEvaluation(\n    node: VariableDeclaration | EstreeLVal,\n    stmt: Statement,\n    iteratorRecord: Iterator<unknown>,\n    iterationKind: \"enumerate\" | \"iterate\",\n    lhsKind: \"varBinding\" | \"lexicalBinding\" | \"assignment\"\n  ): CompletionRecord {\n    const lhs =\n      lhsKind === \"assignment\"\n        ? (node as EstreeLVal)\n        : (node as VariableDeclaration).declarations[0].id;\n    const oldEnv = getRunningContext().LexicalEnvironment;\n    let V: unknown;\n    // When `destructuring` is false,\n    // For `node` whose `kind` is assignment:\n    //   `lhs` is an `Identifier` or a `MemberExpression`,\n    // Otherwise:\n    //   `lhs` is an `Identifier`.\n    const destructuring =\n      lhs.type === \"ObjectPattern\" || lhs.type === \"ArrayPattern\";\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const { done, value: nextValue } = iteratorRecord.next();\n      if (done) {\n        return NormalCompletion(V);\n      }\n      let lhsRef: ReferenceRecord | undefined;\n      let iterationEnv: DeclarativeEnvironment | undefined;\n      if (lhsKind === \"lexicalBinding\") {\n        iterationEnv = new DeclarativeEnvironment(oldEnv);\n        ForDeclarationBindingInstantiation(\n          node as VariableDeclaration,\n          iterationEnv\n        );\n        getRunningContext().LexicalEnvironment = iterationEnv;\n        if (!destructuring) {\n          const [lhsName] = collectBoundNames(lhs);\n          lhsRef = ResolveBinding(lhsName);\n        }\n      } else if (!destructuring) {\n        lhsRef = Evaluate(lhs).Value as ReferenceRecord;\n      }\n      destructuring\n        ? lhsKind === \"assignment\"\n          ? DestructuringAssignmentEvaluation(lhs, nextValue)\n          : lhsKind === \"varBinding\"\n          ? BindingInitialization(lhs, nextValue, undefined)\n          : BindingInitialization(lhs, nextValue, iterationEnv)\n        : lhsKind === \"lexicalBinding\"\n        ? InitializeReferencedBinding(lhsRef!, nextValue)\n        : PutValue(lhsRef!, nextValue);\n\n      const result = Evaluate(stmt);\n      getRunningContext().LexicalEnvironment = oldEnv;\n      if (!LoopContinues(result)) {\n        const status = UpdateEmpty(result, V);\n        if (\n          !(\n            iterationKind === \"enumerate\" || iteratorRecord.return === undefined\n          )\n        ) {\n          // Perform *IteratorClose*\n          // https://tc39.es/ecma262/#sec-iteratorclose\n          const innerResult = iteratorRecord.return();\n          if (\n            !innerResult ||\n            ![\"object\", \"function\"].includes(typeof innerResult)\n          ) {\n            throw new TypeError(`Iterator result is not an object`);\n          }\n        }\n        return status;\n      }\n      if (result.Value !== Empty) {\n        V = result.Value;\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-enumerate-object-properties\n  function* EnumerateObjectProperties(value: any): Iterator<PropertyKey> {\n    for (const key in value) {\n      yield key;\n    }\n  }\n\n  // For statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forloopevaluation\n  function ForLoopEvaluation(node: ForStatement): CompletionRecord {\n    if (node.init?.type === \"VariableDeclaration\") {\n      // `for (var … ; … ; … ) …`\n      if (node.init.kind === \"var\") {\n        Evaluate(node.init);\n        return ForBodyEvaluation(node.test, node.update, node.body, []);\n      }\n      // `for (let/const … ; … ; … ) …`\n      const oldEnv = getRunningContext().LexicalEnvironment;\n      const loopEnv = new DeclarativeEnvironment(oldEnv);\n      const isConst = node.init.kind === \"const\";\n      const boundNames = collectBoundNames(node.init);\n      for (const dn of boundNames) {\n        if (isConst) {\n          loopEnv.CreateImmutableBinding(dn, true);\n        } else {\n          loopEnv.CreateMutableBinding(dn, false);\n        }\n      }\n      getRunningContext().LexicalEnvironment = loopEnv;\n      Evaluate(node.init);\n      const perIterationLets = isConst ? [] : Array.from(boundNames);\n      const bodyResult = ForBodyEvaluation(\n        node.test,\n        node.update,\n        node.body,\n        perIterationLets\n      );\n      getRunningContext().LexicalEnvironment = oldEnv;\n      return bodyResult;\n    }\n    // `for ( … ; … ; … ) …`\n    if (node.init) {\n      const exprRef = Evaluate(node.init);\n      GetValue(exprRef);\n    }\n    return ForBodyEvaluation(node.test, node.update, node.body, []);\n  }\n\n  // https://tc39.es/ecma262/#sec-forbodyevaluation\n  function ForBodyEvaluation(\n    test: Expression | null | undefined,\n    increment: Expression | null | undefined,\n    stmt: Statement,\n    perIterationBindings: string[]\n  ): CompletionRecord {\n    CreatePerIterationEnvironment(perIterationBindings);\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      if (test) {\n        const testRef = Evaluate(test);\n        const testValue = GetValue(testRef);\n        if (!testValue) {\n          return NormalCompletion(V);\n        }\n      }\n      const result = Evaluate(stmt) as CompletionRecord;\n      if (!LoopContinues(result)) {\n        return UpdateEmpty(result, V);\n      }\n      if (result.Value) {\n        V = result.Value;\n      }\n      CreatePerIterationEnvironment(perIterationBindings);\n      if (increment) {\n        const incRef = Evaluate(increment);\n        GetValue(incRef);\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-createperiterationenvironment\n  function CreatePerIterationEnvironment(\n    perIterationBindings: string[]\n  ): unknown {\n    if (perIterationBindings.length === 0) {\n      return;\n    }\n    const lastIterationEnv = getRunningContext().LexicalEnvironment!;\n    const outer = lastIterationEnv.OuterEnv;\n    const thisIterationEnv = new DeclarativeEnvironment(outer);\n    for (const bn of perIterationBindings) {\n      thisIterationEnv.CreateMutableBinding(bn, false);\n      const lastValue = lastIterationEnv.GetBindingValue(bn, false);\n      thisIterationEnv.InitializeBinding(bn, lastValue);\n    }\n    getRunningContext().LexicalEnvironment = thisIterationEnv;\n  }\n\n  // Destructuring assignments.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-destructuringassignmentevaluation\n  function DestructuringAssignmentEvaluation(\n    pattern: ObjectPattern | EstreeObjectPattern | ArrayPattern,\n    value: unknown\n  ): CompletionRecord {\n    if (pattern.type === \"ObjectPattern\") {\n      RequireObjectCoercible(value);\n      if (pattern.properties.length > 0) {\n        PropertyDestructuringAssignmentEvaluation(\n          (pattern as EstreeObjectPattern).properties,\n          value\n        );\n      }\n      return NormalCompletion(Empty);\n    }\n    const iteratorRecord = CreateListIteratorRecord(value as Iterable<unknown>);\n    return IteratorDestructuringAssignmentEvaluation(\n      pattern.elements,\n      iteratorRecord\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-propertydestructuringassignmentevaluation\n  function PropertyDestructuringAssignmentEvaluation(\n    properties: (EstreeProperty | RestElement)[],\n    value: unknown\n  ): void {\n    const excludedNames = new Set<PropertyKey>();\n    for (const prop of properties) {\n      if (prop.type === \"Property\") {\n        const propName =\n          !prop.computed && prop.key.type === \"Identifier\"\n            ? prop.key.name\n            : (EvaluateComputedPropertyName(prop.key as Expression) as string);\n        const valueTarget =\n          prop.value.type === \"AssignmentPattern\"\n            ? prop.value.left\n            : prop.value;\n        if (valueTarget.type === \"Identifier\") {\n          const lref = ResolveBinding(valueTarget.name);\n          let v = GetV(value, propName);\n          if (prop.value.type === \"AssignmentPattern\" && v === undefined) {\n            // Todo(steve): check IsAnonymousFunctionDefinition(Initializer)\n            const defaultValue = Evaluate(prop.value.right);\n            v = GetValue(defaultValue);\n          }\n          PutValue(lref, v);\n          excludedNames.add(propName);\n        } else {\n          KeyedDestructuringAssignmentEvaluation(prop.value, value, propName);\n          excludedNames.add(propName);\n        }\n      } else {\n        RestDestructuringAssignmentEvaluation(prop, value, excludedNames);\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-keyeddestructuringassignmentevaluation\n  function KeyedDestructuringAssignmentEvaluation(\n    node: EstreeNode,\n    value: unknown,\n    propertyName: PropertyKey\n  ): CompletionRecord {\n    const assignmentTarget =\n      node.type === \"AssignmentPattern\" ? node.left : node;\n    const isObjectOrArray =\n      assignmentTarget.type === \"ArrayPattern\" ||\n      assignmentTarget.type === \"ObjectPattern\";\n    let lref: ReferenceRecord | undefined;\n    if (!isObjectOrArray) {\n      lref = Evaluate(assignmentTarget).Value as ReferenceRecord;\n    }\n    const v = GetV(value, propertyName);\n    let rhsValue;\n    if (node.type === \"AssignmentPattern\" && v === undefined) {\n      // Todo(steve): check IsAnonymousFunctionDefinition(Initializer)\n      const defaultValue = Evaluate(node.right);\n      rhsValue = GetValue(defaultValue);\n    } else {\n      rhsValue = v;\n    }\n    if (isObjectOrArray) {\n      return DestructuringAssignmentEvaluation(assignmentTarget, rhsValue);\n    }\n    return PutValue(lref!, rhsValue);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-restdestructuringassignmentevaluation\n  function RestDestructuringAssignmentEvaluation(\n    restProperty: RestElement,\n    value: unknown,\n    excludedNames: Set<PropertyKey>\n  ): CompletionRecord {\n    const lref = Evaluate(restProperty.argument).Value as ReferenceRecord;\n    const restObj = CopyDataProperties({}, value, excludedNames);\n    return PutValue(lref, restObj);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-iteratordestructuringassignmentevaluation\n  function IteratorDestructuringAssignmentEvaluation(\n    elements: (PatternLike | LVal | null)[],\n    iteratorRecord: Iterator<unknown>\n  ): CompletionRecord {\n    let status = NormalCompletion(Empty);\n    for (const element of elements) {\n      if (!element) {\n        iteratorRecord.next();\n        status = NormalCompletion(Empty);\n        continue;\n      }\n      const assignmentTarget =\n        element.type === \"RestElement\"\n          ? element.argument\n          : element.type === \"AssignmentPattern\"\n          ? element.left\n          : element;\n      const isObjectOrArray =\n        assignmentTarget.type === \"ArrayPattern\" ||\n        assignmentTarget.type === \"ObjectPattern\";\n      let lref: ReferenceRecord | undefined;\n      if (!isObjectOrArray) {\n        lref = Evaluate(assignmentTarget).Value as ReferenceRecord;\n      }\n      let v: unknown;\n      if (element.type !== \"RestElement\") {\n        const { done, value: nextValue } = iteratorRecord.next();\n        const value = done ? undefined : nextValue;\n        if (element.type === \"AssignmentPattern\" && value === undefined) {\n          // Todo(steve): check IsAnonymousFunctionDefinition(Initializer)\n          const defaultValue = Evaluate(element.right);\n          v = GetValue(defaultValue);\n        } else {\n          v = value;\n        }\n      } else {\n        // RestElement\n        v = [];\n        let n = 0;\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n          const { done, value: nextValue } = iteratorRecord.next();\n          if (done) {\n            break;\n          }\n          (v as unknown[])[n] = nextValue;\n          n++;\n        }\n      }\n      if (isObjectOrArray) {\n        status = DestructuringAssignmentEvaluation(assignmentTarget, v);\n      } else {\n        status = PutValue(lref!, v);\n      }\n    }\n    return status;\n  }\n\n  // Object expressions.\n  // https://tc39.es/ecma262/#sec-evaluate-property-access-with-expression-key\n  function EvaluatePropertyAccessWithExpressionKey(\n    baseValue: Record<PropertyKey, unknown>,\n    expression: Expression,\n    strict: boolean\n  ): ReferenceRecord {\n    const propertyNameReference = Evaluate(expression);\n    const propertyNameValue = GetValue(propertyNameReference);\n    const propertyKey = ToPropertyKey(propertyNameValue);\n    return new ReferenceRecord(baseValue, propertyKey, strict);\n  }\n\n  // https://tc39.es/ecma262/#sec-evaluate-property-access-with-identifier-key\n  function EvaluatePropertyAccessWithIdentifierKey(\n    baseValue: Record<PropertyKey, unknown>,\n    identifier: Identifier,\n    strict: boolean\n  ): ReferenceRecord {\n    const propertyNameString = identifier.name;\n    return new ReferenceRecord(baseValue, propertyNameString, strict);\n  }\n\n  // Block statements.\n  // https://tc39.es/ecma262/#sec-blockdeclarationinstantiation\n  function BlockDeclarationInstantiation(\n    code: Statement[] | SwitchCase[],\n    env: EnvironmentRecord\n  ): void {\n    const declarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: false,\n    });\n    for (const d of declarations) {\n      const IsConstantDeclaration =\n        d.type === \"VariableDeclaration\" && d.kind === \"const\";\n      for (const dn of collectBoundNames(d)) {\n        if (IsConstantDeclaration) {\n          env.CreateImmutableBinding(dn, true);\n        } else {\n          env.CreateMutableBinding(dn, false);\n        }\n      }\n      if (d.type === \"FunctionDeclaration\") {\n        const [fn] = collectBoundNames(d);\n        const fo = InstantiateFunctionObject(d, env);\n        env.InitializeBinding(fn, fo);\n      }\n    }\n  }\n\n  // Function declarations and expressions.\n  // https://tc39.es/ecma262/#sec-evaluatecall\n  function EvaluateCall(\n    func: Function,\n    ref: ReferenceRecord,\n    args: CallExpression[\"arguments\"] | TemplateLiteral,\n    callee: CallExpression[\"callee\"]\n  ): CompletionRecord {\n    let thisValue;\n    if (ref instanceof ReferenceRecord) {\n      if (IsPropertyReference(ref)) {\n        thisValue = ref.Base;\n      }\n    }\n    const argList = ArgumentListEvaluation(args);\n    if (typeof func !== \"function\") {\n      const funcName = codeSource.substring(callee.start!, callee.end!);\n      throw new TypeError(`${funcName} is not a function`);\n    }\n    const result = func.apply(thisValue, argList);\n    sanitize(result);\n    return NormalCompletion(result);\n  }\n\n  // https://tc39.es/ecma262/#sec-evaluatenew\n  function EvaluateNew(\n    constructExpr: CallExpression[\"callee\"],\n    args: NewExpression[\"arguments\"]\n  ): CompletionRecord {\n    const ref = Evaluate(constructExpr);\n    const constructor = GetValue(ref) as new (...args: unknown[]) => unknown;\n    const argList = ArgumentListEvaluation(args);\n    if (\n      typeof constructor !== \"function\" ||\n      (constructor as unknown as FunctionObject)[IsConstructor] === false\n    ) {\n      const constructorName = codeSource.substring(\n        constructExpr.start!,\n        constructExpr.end!\n      );\n      throw new TypeError(`${constructorName} is not a constructor`);\n    }\n    if (!isAllowedConstructor(constructor)) {\n      const constructorName = codeSource.substring(\n        constructExpr.start!,\n        constructExpr.end!\n      );\n      throw new TypeError(`${constructorName} is not an allowed constructor`);\n    }\n    return NormalCompletion(new constructor(...argList));\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-argumentlistevaluation\n  function ArgumentListEvaluation(\n    args: CallExpression[\"arguments\"] | TemplateLiteral\n  ): unknown[] {\n    const array: unknown[] = [];\n    if (Array.isArray(args)) {\n      for (const arg of args) {\n        if (arg.type === \"SpreadElement\") {\n          const spreadValues = GetValue(Evaluate(arg.argument)) as unknown[];\n          array.push(...spreadValues);\n        } else {\n          array.push(GetValue(Evaluate(arg)));\n        }\n      }\n    } else {\n      array.push(GetTemplateObject(args));\n      for (const expr of args.expressions) {\n        array.push(GetValue(Evaluate(expr)));\n      }\n    }\n    return array;\n  }\n\n  // https://tc39.es/ecma262/#sec-ecmascript-function-objects-call-thisargument-argumentslist\n  function CallFunction(\n    closure: FunctionObject,\n    args: Iterable<unknown>\n  ): unknown {\n    hooks.beforeCall?.(closure[SourceNode]);\n    PrepareForOrdinaryCall(closure);\n    const result = OrdinaryCallEvaluateBody(closure, args);\n    executionContextStack.pop();\n    if (result.Type === \"return\") {\n      return result.Value;\n    }\n    return undefined;\n  }\n\n  // https://tc39.es/ecma262/#sec-prepareforordinarycall\n  function PrepareForOrdinaryCall(F: FunctionObject): ExecutionContext {\n    const calleeContext = new ExecutionContext();\n    calleeContext.Function = F;\n    const localEnv = new FunctionEnvironment(F[Environment]);\n    calleeContext.VariableEnvironment = localEnv;\n    calleeContext.LexicalEnvironment = localEnv;\n    executionContextStack.push(calleeContext);\n    return calleeContext;\n  }\n\n  // https://tc39.es/ecma262/#sec-ordinarycallevaluatebody\n  function OrdinaryCallEvaluateBody(\n    F: FunctionObject,\n    args: Iterable<unknown>\n  ): CompletionRecord {\n    return EvaluateFunctionBody(F[ECMAScriptCode], F, args);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-evaluatefunctionbody\n  function EvaluateFunctionBody(\n    body: Statement[] | Expression,\n    F: FunctionObject,\n    args: Iterable<unknown>\n  ): CompletionRecord {\n    FunctionDeclarationInstantiation(F, args);\n    if (Array.isArray(body)) {\n      return EvaluateStatementList(body);\n    }\n    return new CompletionRecord(\"return\", GetValue(Evaluate(body)));\n  }\n\n  // https://tc39.es/ecma262/#sec-block-runtime-semantics-evaluation\n  function EvaluateStatementList(statements: Statement[]): CompletionRecord {\n    let result = NormalCompletion(Empty);\n    for (const stmt of statements) {\n      const s = Evaluate(stmt);\n      if (s.Type !== \"normal\") {\n        return s;\n      }\n      result = UpdateEmpty(result, s.Value);\n    }\n    return result;\n  }\n\n  // https://tc39.es/ecma262/#sec-functiondeclarationinstantiation\n  function FunctionDeclarationInstantiation(\n    func: FunctionObject,\n    args: Iterable<unknown>\n  ): void {\n    const calleeContext = getRunningContext();\n    const code = func[ECMAScriptCode];\n    const formals = func[FormalParameters] as FunctionDeclaration[\"params\"];\n    const parameterNames = collectBoundNames(formals);\n    const hasParameterExpressions = containsExpression(formals);\n    const varDeclarations = collectScopedDeclarations(code, {\n      var: true,\n      topLevel: true,\n    });\n    const varNames = collectBoundNames(varDeclarations);\n\n    // `functionNames` ∈ `varNames`\n    // `functionsToInitialize` ≈ `functionNames`\n    const functionNames: string[] = [];\n    const functionsToInitialize: FunctionDeclaration[] = [];\n    for (let i = varDeclarations.length - 1; i >= 0; i--) {\n      const d = varDeclarations[i];\n      if (d.type === \"FunctionDeclaration\") {\n        ThrowIfFunctionIsInvalid(d);\n        const [fn] = collectBoundNames(d);\n        if (!functionNames.includes(fn)) {\n          functionNames.unshift(fn);\n          functionsToInitialize.unshift(d);\n        }\n      } else if (rules?.noVar) {\n        throw new SyntaxError(\n          \"Var declaration is not recommended, use `let` or `const` instead\"\n        );\n      }\n    }\n\n    const env = calleeContext.LexicalEnvironment!;\n    for (const paramName of parameterNames) {\n      // In strict mode, it's guaranteed no duplicate params exist.\n      env.CreateMutableBinding(paramName, false);\n    }\n\n    const iteratorRecord = CreateListIteratorRecord(args);\n    IteratorBindingInitialization(formals, iteratorRecord, env);\n\n    let varEnv: EnvironmentRecord;\n    if (!hasParameterExpressions) {\n      // NOTE: Only a single Environment Record is needed for the parameters\n      // and top-level vars.\n      // `varNames` are unique.\n      for (const n of varNames) {\n        if (!parameterNames.includes(n)) {\n          env.CreateMutableBinding(n, false);\n          env.InitializeBinding(n, undefined);\n        }\n      }\n      varEnv = env;\n    } else {\n      // NOTE: A separate Environment Record is needed to ensure that closures\n      // created by expressions in the formal parameter list do not have\n      // visibility of declarations in the function body.\n      varEnv = new DeclarativeEnvironment(env);\n      calleeContext.VariableEnvironment = varEnv;\n      // `varNames` are unique.\n      for (const n of varNames) {\n        varEnv.CreateMutableBinding(n, false);\n        let initialValue: unknown;\n        if (parameterNames.includes(n) && !functionNames.includes(n)) {\n          initialValue = env.GetBindingValue(n, false);\n        }\n        varEnv.InitializeBinding(n, initialValue);\n        // NOTE: A var with the same name as a formal parameter initially has\n        // the same value as the corresponding initialized parameter.\n      }\n    }\n    const lexEnv = varEnv;\n    calleeContext.LexicalEnvironment = lexEnv;\n\n    const lexDeclarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: true,\n    });\n    for (const d of lexDeclarations) {\n      for (const dn of collectBoundNames(d)) {\n        // Only lexical VariableDeclaration here in top-level.\n        if ((d as VariableDeclaration).kind === \"const\") {\n          lexEnv.CreateImmutableBinding(dn, true);\n        } else {\n          lexEnv.CreateMutableBinding(dn, false);\n        }\n      }\n    }\n\n    for (const f of functionsToInitialize) {\n      const [fn] = collectBoundNames(f);\n      const fo = InstantiateFunctionObject(f, lexEnv);\n      varEnv.SetMutableBinding(fn, fo, false);\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiatefunctionobject\n  function InstantiateFunctionObject(\n    func: FunctionDeclaration,\n    scope: EnvironmentRecord\n  ): FunctionObject {\n    return OrdinaryFunctionCreate(func, scope, true);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiateordinaryfunctionexpression\n  function InstantiateOrdinaryFunctionExpression(\n    functionExpression: FunctionExpression\n  ): FunctionObject {\n    const scope = getRunningContext().LexicalEnvironment!;\n    if (functionExpression.id) {\n      const name = functionExpression.id.name;\n      const funcEnv = new DeclarativeEnvironment(scope);\n      funcEnv.CreateImmutableBinding(name, false);\n      const closure = OrdinaryFunctionCreate(functionExpression, funcEnv, true);\n      funcEnv.InitializeBinding(name, closure);\n      return closure;\n    } else {\n      const closure = OrdinaryFunctionCreate(functionExpression, scope, true);\n      return closure;\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiatearrowfunctionexpression\n  function InstantiateArrowFunctionExpression(\n    arrowFunction: ArrowFunctionExpression\n  ): FunctionObject {\n    const scope = getRunningContext().LexicalEnvironment!;\n    const closure = OrdinaryFunctionCreate(arrowFunction, scope, false);\n    return closure;\n  }\n\n  // https://tc39.es/ecma262/#sec-ordinaryfunctioncreate\n  function OrdinaryFunctionCreate(\n    sourceNode:\n      | FunctionDeclaration\n      | FunctionExpression\n      | ArrowFunctionExpression,\n    scope: EnvironmentRecord,\n    isConstructor: boolean\n  ): FunctionObject {\n    const F = function () {\n      // eslint-disable-next-line prefer-rest-params\n      return CallFunction(F, arguments);\n    } as FunctionObject;\n    Object.defineProperties(F, {\n      [SourceNode]: {\n        value: sourceNode,\n      },\n      [FormalParameters]: {\n        value: sourceNode.params,\n      },\n      [ECMAScriptCode]: {\n        value:\n          sourceNode.body.type === \"BlockStatement\"\n            ? sourceNode.body.body\n            : sourceNode.body,\n      },\n      [Environment]: {\n        value: scope,\n      },\n      [IsConstructor]: {\n        value: isConstructor,\n      },\n    });\n    return F;\n  }\n\n  // Patterns initialization.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-bindinginitialization\n  function BindingInitialization(\n    node: EstreeLVal,\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): CompletionRecord | undefined {\n    switch (node.type) {\n      case \"Identifier\":\n        return InitializeBoundName(node.name, value, environment);\n      case \"ObjectPattern\":\n        RequireObjectCoercible(value);\n        return PropertyBindingInitialization(\n          (node as EstreeObjectPattern).properties,\n          value,\n          environment\n        );\n      case \"ArrayPattern\": {\n        const iteratorRecord = CreateListIteratorRecord(\n          value as Iterable<unknown>\n        );\n        return IteratorBindingInitialization(\n          node.elements,\n          iteratorRecord,\n          environment\n        );\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-destructuring-binding-patterns-runtime-semantics-propertybindinginitialization\n  function PropertyBindingInitialization(\n    properties: (EstreeProperty | RestElement)[],\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): CompletionRecord {\n    const excludedNames = new Set<PropertyKey>();\n    for (const prop of properties) {\n      if (prop.type === \"RestElement\") {\n        return RestBindingInitialization(\n          prop,\n          value,\n          environment,\n          excludedNames\n        );\n      }\n      if (!prop.computed && prop.key.type === \"Identifier\") {\n        KeyedBindingInitialization(\n          prop.value as EstreeLVal,\n          value,\n          environment,\n          prop.key.name\n        );\n        excludedNames.add(prop.key.name);\n      } else {\n        const P = EvaluateComputedPropertyName(prop.key as Expression);\n        KeyedBindingInitialization(\n          prop.value as EstreeLVal,\n          value,\n          environment,\n          P\n        );\n        excludedNames.add(P);\n      }\n    }\n    return NormalCompletion(Empty);\n  }\n\n  // https://tc39.es/ecma262/#prod-ComputedPropertyName\n  function EvaluateComputedPropertyName(node: Expression): PropertyKey {\n    const propName = GetValue(Evaluate(node));\n    return ToPropertyKey(propName);\n  }\n\n  // https://tc39.es/ecma262/#sec-destructuring-binding-patterns-runtime-semantics-restbindinginitialization\n  function RestBindingInitialization(\n    restProperty: RestElement,\n    value: unknown,\n    environment: EnvironmentRecord | undefined,\n    excludedNames: Set<PropertyKey>\n  ): CompletionRecord {\n    const lhs = ResolveBinding(\n      (restProperty.argument as Identifier).name,\n      environment\n    );\n    const restObj = CopyDataProperties({}, value, excludedNames);\n    if (!environment) {\n      return PutValue(lhs, restObj);\n    }\n    return InitializeReferencedBinding(lhs, restObj);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-iteratorbindinginitialization\n  function IteratorBindingInitialization(\n    elements: (PatternLike | LVal | null)[],\n    iteratorRecord: Iterator<unknown>,\n    environment?: EnvironmentRecord\n  ): CompletionRecord | undefined {\n    if (elements.length === 0) {\n      return NormalCompletion(Empty);\n    }\n    let result;\n    for (const node of elements) {\n      if (!node) {\n        // Elision element.\n        iteratorRecord.next();\n        result = NormalCompletion(Empty);\n      } else if (node.type === \"RestElement\") {\n        // Rest element.\n        if (node.argument.type === \"Identifier\") {\n          const lhs = ResolveBinding(node.argument.name, environment);\n          const A: unknown[] = [];\n          let n = 0;\n          // eslint-disable-next-line no-constant-condition\n          while (true) {\n            const { done, value } = iteratorRecord.next();\n            if (done) {\n              result = environment\n                ? InitializeReferencedBinding(lhs, A)\n                : PutValue(lhs, A);\n              break;\n            }\n            A[n] = value;\n            n++;\n          }\n        } else {\n          const A: unknown[] = [];\n          let n = 0;\n          // eslint-disable-next-line no-constant-condition\n          while (true) {\n            const { done, value } = iteratorRecord.next();\n            if (done) {\n              result = BindingInitialization(node.argument, A, environment);\n              break;\n            }\n            A[n] = value;\n            n++;\n          }\n        }\n      } else {\n        // Normal element.\n        const bindingElement =\n          node.type === \"AssignmentPattern\" ? node.left : node;\n        switch (bindingElement.type) {\n          case \"ObjectPattern\":\n          case \"ArrayPattern\": {\n            let v: unknown;\n            const { done, value } = iteratorRecord.next();\n            if (!done) {\n              v = value;\n            }\n            if (node.type === \"AssignmentPattern\" && v === undefined) {\n              const defaultValue = Evaluate(node.right);\n              v = GetValue(defaultValue);\n            }\n            result = BindingInitialization(bindingElement, v, environment);\n            break;\n          }\n          case \"Identifier\": {\n            const bindingId = bindingElement.name;\n            const lhs = ResolveBinding(bindingId, environment);\n            let v: unknown;\n            const { done, value } = iteratorRecord.next();\n            if (!done) {\n              v = value;\n            }\n            if (node.type === \"AssignmentPattern\" && v === undefined) {\n              // IsAnonymousFunctionDefinition(Initializer)\n              const defaultValue = Evaluate(node.right);\n              v = GetValue(defaultValue);\n            }\n            result = environment\n              ? InitializeReferencedBinding(lhs, v)\n              : PutValue(lhs, v);\n            break;\n          }\n        }\n      }\n    }\n    return result;\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-keyedbindinginitialization\n  function KeyedBindingInitialization(\n    node: EstreeLVal,\n    value: unknown,\n    environment: EnvironmentRecord | undefined,\n    propertyName: PropertyKey\n  ): CompletionRecord | undefined {\n    const isIdentifier =\n      node.type === \"Identifier\" ||\n      (node.type === \"AssignmentPattern\" && node.left.type === \"Identifier\");\n    if (isIdentifier) {\n      const bindingId =\n        node.type === \"Identifier\" ? node.name : (node.left as Identifier).name;\n      const lhs = ResolveBinding(bindingId, environment);\n      let v = GetV(value, propertyName);\n      if (node.type === \"AssignmentPattern\" && v === undefined) {\n        // If IsAnonymousFunctionDefinition(Initializer)\n        const defaultValue = Evaluate(node.right);\n        v = GetValue(defaultValue);\n      }\n      if (!environment) {\n        return PutValue(lhs, v);\n      }\n      return InitializeReferencedBinding(lhs, v);\n    }\n\n    let v = GetV(value, propertyName);\n    if (node.type === \"AssignmentPattern\" && v === undefined) {\n      const defaultValue = Evaluate(node.right);\n      v = GetValue(defaultValue);\n    }\n    return BindingInitialization(\n      node.type === \"AssignmentPattern\" ? node.left : node,\n      v,\n      environment\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-initializeboundname\n  function InitializeBoundName(\n    name: string,\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): CompletionRecord {\n    // Assert: environment is always present.\n    environment!.InitializeBinding(name, value);\n    return NormalCompletion(Empty);\n  }\n\n  function ThrowIfFunctionIsInvalid(\n    func: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression\n  ): void {\n    if (func.async || func.generator) {\n      throw new SyntaxError(\n        `${func.async ? \"Async\" : \"Generator\"} function is not allowed`\n      );\n    }\n    if (expressionOnly && !(func as ArrowFunctionExpression).expression) {\n      throw new SyntaxError(\n        \"Only an `Expression` is allowed in `ArrowFunctionExpression`'s body\"\n      );\n    }\n  }\n\n  if (expressionOnly) {\n    return GetValue(Evaluate(rootAst));\n  }\n\n  hooks.beforeEvaluate?.(rootAst);\n  ThrowIfFunctionIsInvalid(rootAst);\n  const [fn] = collectBoundNames(rootAst);\n  // Create an immutable binding for the root function.\n  rootEnv.CreateImmutableBinding(fn, true);\n  const fo = InstantiateFunctionObject(rootAst, rootEnv);\n  rootEnv.InitializeBinding(fn, fo);\n  return fo;\n}\n","export function hasOwnProperty(\n  object: unknown,\n  property: string | number | symbol\n): boolean {\n  return Object.prototype.hasOwnProperty.call(object, property);\n}\n","import {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Statement,\n} from \"@babel/types\";\n\n// https://tc39.es/ecma262/#sec-execution-contexts\nexport class AnalysisContext {\n  VariableEnvironment?: AnalysisEnvironment;\n  LexicalEnvironment?: AnalysisEnvironment;\n}\n\n// https://tc39.es/ecma262/#sec-environment-records\nexport class AnalysisEnvironment {\n  readonly OuterEnv: AnalysisEnvironment | null | undefined;\n  private readonly bindingSet = new Set<string>();\n\n  constructor(outer: AnalysisEnvironment | null | undefined) {\n    this.OuterEnv = outer;\n  }\n\n  HasBinding(name: string): boolean {\n    return this.bindingSet.has(name);\n  }\n\n  CreateBinding(name: string): void {\n    this.bindingSet.add(name);\n  }\n}\n\nexport interface AnalysisFunctionObject {\n  Function: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression;\n  FormalParameters: FunctionDeclaration[\"params\"];\n  ECMAScriptCode: Statement[] | Expression;\n  Environment?: AnalysisEnvironment;\n}\n","import {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Identifier,\n  Statement,\n  SwitchCase,\n  VariableDeclaration,\n} from \"@babel/types\";\nimport { hasOwnProperty } from \"./hasOwnProperty.js\";\nimport {\n  AnalysisContext,\n  AnalysisEnvironment,\n  AnalysisFunctionObject,\n} from \"./AnalysisContext.js\";\nimport {\n  EstreeNode,\n  EstreeVisitors,\n  NodeWithBoundNames,\n} from \"./interfaces.js\";\nimport {\n  collectBoundNames,\n  collectScopedDeclarations,\n  containsExpression,\n} from \"./traverse.js\";\n\nexport interface PrecookOptions {\n  expressionOnly?: boolean;\n  /** @deprecated Use hooks instead. */\n  visitors?: EstreeVisitors;\n  hooks?: PrecookHooks;\n  withParent?: boolean;\n}\n\nexport type EstreeParent = EstreeParentItem[];\n\nexport interface EstreeParentItem {\n  node: EstreeNode;\n  key: string;\n  index?: number;\n}\n\nexport interface PrecookHooks {\n  beforeVisit?(node: EstreeNode, parent?: EstreeParent): void;\n  beforeVisitGlobal?(node: Identifier, parent?: EstreeParent): void;\n  /** Return true if want to silent warnings for unknown nodes. */\n  beforeVisitUnknown?(node: EstreeNode, parent?: EstreeParent): boolean | void;\n}\n\n/**\n * Analysis an AST of a storyboard function or an evaluation expression.\n *\n * @param rootAst - The root AST.\n * @param options - Analysis options.\n * @returns A set of global variables the root AST attempts to access.\n */\nexport function precook(\n  rootAst: Expression | FunctionDeclaration,\n  { expressionOnly, visitors, withParent, hooks = {} }: PrecookOptions = {}\n): Set<string> {\n  const attemptToVisitGlobals = new Set<string>();\n  const analysisContextStack: AnalysisContext[] = [];\n  const rootEnv = new AnalysisEnvironment(null);\n  const rootContext = new AnalysisContext();\n  rootContext.VariableEnvironment = rootEnv;\n  rootContext.LexicalEnvironment = rootEnv;\n  analysisContextStack.push(rootContext);\n\n  function getRunningContext(): AnalysisContext {\n    return analysisContextStack[analysisContextStack.length - 1];\n  }\n\n  function visit(node: EstreeNode): void {\n    if (visitors && hasOwnProperty(visitors, node.type)) {\n      visitors[node.type](node);\n    }\n  }\n\n  function EvaluateChildren<T extends EstreeNode>(\n    node: T,\n    keys: (keyof T)[],\n    parent?: EstreeParent\n  ): void {\n    for (const key of keys) {\n      Evaluate(\n        node[key] as unknown as EstreeNode | EstreeNode[],\n        parent?.concat({ node, key } as EstreeParentItem)\n      );\n    }\n  }\n\n  function Evaluate(\n    node: EstreeNode | EstreeNode[],\n    parent?: EstreeParent\n  ): void {\n    if (Array.isArray(node)) {\n      node.forEach((n, index) => {\n        Evaluate(\n          n,\n          parent\n            ? parent.slice(0, -1).concat({\n                ...parent[parent.length - 1],\n                index,\n              })\n            : parent\n        );\n      });\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      hooks.beforeVisit?.(node, parent);\n      visit(node);\n      // Expressions:\n      switch (node.type) {\n        case \"Identifier\":\n          if (!ResolveBinding(node.name)) {\n            hooks.beforeVisitGlobal?.(node, parent);\n            attemptToVisitGlobals.add(node.name);\n          }\n          return;\n        case \"ArrayExpression\":\n        case \"ArrayPattern\":\n          EvaluateChildren(node, [\"elements\"], parent);\n          return;\n        case \"ArrowFunctionExpression\": {\n          const env = getRunningContext().LexicalEnvironment;\n          const closure = OrdinaryFunctionCreate(node, env);\n          CallFunction(closure, parent);\n          return;\n        }\n        case \"AssignmentPattern\":\n        case \"BinaryExpression\":\n        case \"LogicalExpression\":\n          EvaluateChildren(node, [\"left\", \"right\"], parent);\n          return;\n        case \"CallExpression\":\n        case \"NewExpression\":\n          EvaluateChildren(node, [\"callee\", \"arguments\"], parent);\n          return;\n        case \"ChainExpression\":\n          EvaluateChildren(node, [\"expression\"], parent);\n          return;\n        case \"ConditionalExpression\":\n          EvaluateChildren(node, [\"test\", \"consequent\", \"alternate\"], parent);\n          return;\n        case \"MemberExpression\":\n          EvaluateChildren(node, [\"object\"], parent);\n          if (node.computed) {\n            EvaluateChildren(node, [\"property\"], parent);\n          }\n          return;\n        case \"ObjectExpression\":\n        case \"ObjectPattern\":\n          EvaluateChildren(node, [\"properties\"], parent);\n          return;\n        case \"Property\":\n          if (node.computed) {\n            EvaluateChildren(node, [\"key\"], parent);\n          }\n          EvaluateChildren(node, [\"value\"], parent);\n          return;\n        case \"RestElement\":\n        case \"SpreadElement\":\n        case \"UnaryExpression\":\n          EvaluateChildren(node, [\"argument\"], parent);\n          return;\n        case \"SequenceExpression\":\n        case \"TemplateLiteral\":\n          EvaluateChildren(node, [\"expressions\"], parent);\n          return;\n        case \"TaggedTemplateExpression\":\n          EvaluateChildren(node, [\"tag\", \"quasi\"], parent);\n          return;\n        case \"Literal\":\n          return;\n      }\n      if (!expressionOnly) {\n        // Statements and assignments:\n        switch (node.type) {\n          case \"AssignmentExpression\":\n            EvaluateChildren(node, [\"right\", \"left\"], parent);\n            return;\n          case \"BlockStatement\": {\n            if (!node.body.length) {\n              return;\n            }\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const blockEnv = new AnalysisEnvironment(oldEnv);\n            BlockDeclarationInstantiation(node.body, blockEnv);\n            runningContext.LexicalEnvironment = blockEnv;\n            EvaluateChildren(node, [\"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"BreakStatement\":\n          case \"ContinueStatement\":\n          case \"EmptyStatement\":\n            return;\n          case \"CatchClause\": {\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const catchEnv = new AnalysisEnvironment(oldEnv);\n            BoundNamesInstantiation(node.param, catchEnv);\n            runningContext.LexicalEnvironment = catchEnv;\n            EvaluateChildren(node, [\"param\", \"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"DoWhileStatement\":\n            EvaluateChildren(node, [\"body\", \"test\"], parent);\n            return;\n          case \"ExpressionStatement\":\n          case \"TSAsExpression\":\n            EvaluateChildren(node, [\"expression\"], parent);\n            return;\n          case \"ForInStatement\":\n          case \"ForOfStatement\": {\n            // ForIn/OfHeadEvaluation\n            const lexicalBinding =\n              node.left.type === \"VariableDeclaration\" &&\n              node.left.kind !== \"var\";\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            if (lexicalBinding) {\n              const newEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(node.left, newEnv);\n              runningContext.LexicalEnvironment = newEnv;\n            }\n            EvaluateChildren(node, [\"right\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n\n            // ForIn/OfBodyEvaluation\n            if (lexicalBinding) {\n              const iterationEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(node.left, iterationEnv);\n              runningContext.LexicalEnvironment = iterationEnv;\n            }\n            EvaluateChildren(node, [\"left\", \"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"ForStatement\": {\n            const lexicalBinding =\n              node.init?.type === \"VariableDeclaration\" &&\n              node.init.kind !== \"var\";\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            if (lexicalBinding) {\n              const loopEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(\n                node.init as VariableDeclaration,\n                loopEnv\n              );\n              runningContext.LexicalEnvironment = loopEnv;\n            }\n            EvaluateChildren(node, [\"init\", \"test\", \"body\", \"update\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"FunctionDeclaration\": {\n            const [fn] = collectBoundNames(node);\n            const env = getRunningContext().LexicalEnvironment!;\n            const fo = OrdinaryFunctionCreate(node, env);\n            env.CreateBinding(fn);\n            CallFunction(fo, parent);\n            return;\n          }\n          case \"FunctionExpression\": {\n            const closure = InstantiateOrdinaryFunctionExpression(node);\n            CallFunction(closure, parent);\n            return;\n          }\n          case \"IfStatement\":\n            EvaluateChildren(node, [\"test\", \"consequent\", \"alternate\"], parent);\n            return;\n          case \"ReturnStatement\":\n          case \"ThrowStatement\":\n          case \"UpdateExpression\":\n            EvaluateChildren(node, [\"argument\"], parent);\n            return;\n          case \"SwitchCase\":\n            EvaluateChildren(node, [\"test\", \"consequent\"], parent);\n            return;\n          case \"SwitchStatement\": {\n            EvaluateChildren(node, [\"discriminant\"], parent);\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const blockEnv = new AnalysisEnvironment(oldEnv);\n            BlockDeclarationInstantiation(node.cases, blockEnv);\n            runningContext.LexicalEnvironment = blockEnv;\n            EvaluateChildren(node, [\"cases\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"TryStatement\":\n            EvaluateChildren(node, [\"block\", \"handler\", \"finalizer\"], parent);\n            return;\n          case \"VariableDeclaration\":\n            EvaluateChildren(node, [\"declarations\"], parent);\n            return;\n          case \"VariableDeclarator\":\n            EvaluateChildren(node, [\"id\", \"init\"], parent);\n            return;\n          case \"WhileStatement\":\n            EvaluateChildren(node, [\"test\", \"body\"], parent);\n            return;\n        }\n      }\n      const silent = hooks.beforeVisitUnknown?.(node, parent);\n      if (!silent) {\n        // eslint-disable-next-line no-console\n        console.warn(`Unsupported node type \\`${node.type}\\``);\n      }\n    }\n  }\n\n  function BoundNamesInstantiation(\n    declarations: NodeWithBoundNames | NodeWithBoundNames[] | null | undefined,\n    env: AnalysisEnvironment\n  ): void {\n    for (const name of collectBoundNames(declarations)) {\n      env.CreateBinding(name);\n    }\n  }\n\n  function ResolveBinding(name: string): boolean {\n    const env = getRunningContext().LexicalEnvironment;\n    return GetIdentifierReference(env, name);\n  }\n\n  function GetIdentifierReference(\n    env: AnalysisEnvironment | null | undefined,\n    name: string\n  ): boolean {\n    return (\n      !!env &&\n      (env.HasBinding(name) || GetIdentifierReference(env.OuterEnv, name))\n    );\n  }\n\n  function BlockDeclarationInstantiation(\n    code: Statement[] | SwitchCase[],\n    env: AnalysisEnvironment\n  ): void {\n    const declarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: false,\n    });\n    BoundNamesInstantiation(declarations, env);\n  }\n\n  function CallFunction(\n    closure: AnalysisFunctionObject,\n    parent?: EstreeParent\n  ): void {\n    PrepareOrdinaryCall(closure);\n    FunctionDeclarationInstantiation(closure, parent);\n    Evaluate(\n      closure.ECMAScriptCode,\n      parent\n        ?.concat({\n          node: closure.Function,\n          key: \"body\",\n        })\n        .concat(\n          closure.Function.body.type === \"BlockStatement\"\n            ? {\n                node: closure.Function.body,\n                key: \"body\",\n              }\n            : []\n        )\n    );\n    analysisContextStack.pop();\n  }\n\n  function PrepareOrdinaryCall(F: AnalysisFunctionObject): void {\n    const calleeContext = new AnalysisContext();\n    const localEnv = new AnalysisEnvironment(F.Environment);\n    calleeContext.VariableEnvironment = localEnv;\n    calleeContext.LexicalEnvironment = localEnv;\n    analysisContextStack.push(calleeContext);\n  }\n\n  function FunctionDeclarationInstantiation(\n    func: AnalysisFunctionObject,\n    parent?: EstreeParent\n  ): void {\n    const calleeContext = getRunningContext();\n    const code = func.ECMAScriptCode;\n    const formals = func.FormalParameters;\n    const hasParameterExpressions = containsExpression(formals);\n    const varDeclarations = collectScopedDeclarations(code, {\n      var: true,\n      topLevel: true,\n    });\n    const varNames = collectBoundNames(varDeclarations);\n\n    const env = calleeContext.LexicalEnvironment!;\n    BoundNamesInstantiation(formals, env);\n\n    Evaluate(formals, parent?.concat({ node: func.Function, key: \"params\" }));\n\n    let varEnv: AnalysisEnvironment;\n    if (!hasParameterExpressions) {\n      // NOTE: Only a single Environment Record is needed for the parameters\n      // and top-level vars.\n      for (const n of varNames) {\n        env.CreateBinding(n);\n      }\n      varEnv = env;\n    } else {\n      // NOTE: A separate Environment Record is needed to ensure that closures\n      // created by expressions in the formal parameter list do not have\n      // visibility of declarations in the function body.\n      varEnv = new AnalysisEnvironment(env);\n      calleeContext.VariableEnvironment = varEnv;\n      for (const n of varNames) {\n        varEnv.CreateBinding(n);\n      }\n    }\n    const lexEnv = varEnv;\n    calleeContext.LexicalEnvironment = lexEnv;\n\n    const lexDeclarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: true,\n    });\n    BoundNamesInstantiation(lexDeclarations, lexEnv);\n  }\n\n  function InstantiateOrdinaryFunctionExpression(\n    functionExpression: FunctionExpression\n  ): AnalysisFunctionObject {\n    const scope = getRunningContext().LexicalEnvironment;\n    if (!functionExpression.id) {\n      return OrdinaryFunctionCreate(functionExpression, scope);\n    }\n    const name = functionExpression.id.name;\n    const funcEnv = new AnalysisEnvironment(scope);\n    funcEnv.CreateBinding(name);\n    return OrdinaryFunctionCreate(functionExpression, funcEnv);\n  }\n\n  function OrdinaryFunctionCreate(\n    func: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression,\n    scope?: AnalysisEnvironment\n  ): AnalysisFunctionObject {\n    return {\n      Function: func,\n      FormalParameters: func.params,\n      ECMAScriptCode:\n        func.body.type === \"BlockStatement\" ? func.body.body : func.body,\n      Environment: scope,\n    };\n  }\n\n  Evaluate(rootAst, withParent ? [] : undefined);\n\n  return attemptToVisitGlobals;\n}\n","import { parse, parseExpression, type ParserPlugin } from \"@babel/parser\";\nimport type { Expression, FunctionDeclaration, Statement } from \"@babel/types\";\n\nexport function parseAsEstreeExpression(source: string): Expression {\n  return parseExpression(source, {\n    plugins: [\"estree\", [\"pipelineOperator\", { proposal: \"minimal\" }]],\n    attachComment: false,\n  });\n}\n\nexport interface ParseEstreeOptions {\n  typescript?: boolean;\n}\n\nexport function parseAsEstree(\n  source: string,\n  { typescript }: ParseEstreeOptions = {}\n): FunctionDeclaration {\n  const file = parse(source, {\n    plugins: [\"estree\", typescript && \"typescript\"].filter(\n      Boolean\n    ) as ParserPlugin[],\n    strictMode: true,\n    attachComment: false,\n  });\n  const body = file.program.body;\n  const jsNodes: Statement[] = typescript ? [] : body;\n  if (typescript) {\n    for (const node of body) {\n      if (node.type.startsWith(\"TS\")) {\n        if (/Enum|Import|Export/.test(node.type)) {\n          throw new SyntaxError(`Unsupported TypeScript syntax: ${node.type}`);\n        }\n      } else {\n        jsNodes.push(node);\n      }\n    }\n  }\n  if (jsNodes.length === 0) {\n    throw new SyntaxError(\"Function declaration not found\");\n  }\n  if (jsNodes.length > 1 || jsNodes[0].type !== \"FunctionDeclaration\") {\n    throw new SyntaxError(\n      `Expect a single function declaration at top level, but received: ${jsNodes\n        .map((node) => `\"${node.type}\"`)\n        .join(\", \")}`\n    );\n  }\n  return jsNodes[0] as FunctionDeclaration;\n}\n","import { FunctionDeclaration } from \"@babel/types\";\nimport { parseAsEstree } from \"./parse.js\";\nimport { precook, PrecookOptions } from \"./precook.js\";\n\nexport interface PrecookFunctionOptions extends PrecookOptions {\n  typescript?: boolean;\n}\n\nexport interface PrecookFunctionResult {\n  function: FunctionDeclaration;\n  attemptToVisitGlobals: Set<string>;\n}\n\nexport function precookFunction(\n  source: string,\n  { typescript, ...restOptions }: PrecookFunctionOptions = {}\n): PrecookFunctionResult {\n  const func = parseAsEstree(source, { typescript });\n  const attemptToVisitGlobals = precook(func, restOptions);\n  return {\n    function: func,\n    attemptToVisitGlobals,\n  };\n}\n","import { Expression } from \"@babel/types\";\nimport { parseAsEstreeExpression } from \"./parse.js\";\nimport { precook, PrecookOptions } from \"./precook.js\";\n\nexport type PreevaluateOptions = Omit<PrecookOptions, \"expressionOnly\">;\n\nexport interface PreevaluateResult {\n  expression: Expression;\n  attemptToVisitGlobals: Set<string>;\n  source: string;\n  prefix: string;\n  suffix: string;\n}\n\n// `raw` should always be asserted by `isEvaluable`.\nexport function preevaluate(\n  raw: string,\n  options?: PreevaluateOptions\n): PreevaluateResult {\n  const fixes: string[] = [];\n  const source = raw.replace(/^\\s*<%[~=]?\\s|\\s%>\\s*$/g, (m) => {\n    fixes.push(m);\n    return \"\";\n  });\n  const expression = parseAsEstreeExpression(source);\n  const attemptToVisitGlobals = precook(expression, {\n    ...options,\n    expressionOnly: true,\n  });\n  return {\n    expression,\n    attemptToVisitGlobals,\n    source,\n    prefix: fixes[0],\n    suffix: fixes[1],\n  };\n}\n\nexport function isEvaluable(raw: string): boolean {\n  return /^\\s*<%[~=]?\\s/.test(raw) && /\\s%>\\s*$/.test(raw);\n}\n\nexport function shouldAllowRecursiveEvaluations(raw: string): boolean {\n  return /^\\s*<%~\\s/.test(raw);\n}\n\nexport function isTrackAll(raw: string): boolean {\n  return /^\\s*<%=\\s.*\\s%>\\s*$/.test(raw);\n}\n","export const fetch = (\n  input: RequestInfo,\n  init?: RequestInit\n): Promise<Response> => {\n  // Support older browsers which default credentials is \"omit\".\n  // Ref https://github.com/whatwg/fetch/pull/585\n  const req = new Request(\n    input,\n    Object.assign<RequestInit, RequestInit | undefined>(\n      {\n        credentials: \"same-origin\",\n      },\n      init\n    )\n  );\n\n  return self.fetch(req);\n};\n","export class HttpFetchError extends Error {\n  constructor(message: string) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(message);\n\n    this.name = \"HttpFetchError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpFetchError);\n    }\n  }\n}\n\nexport class HttpResponseError extends Error {\n  response: Response;\n  responseJson: any;\n\n  constructor(response: Response, responseJson?: any) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(response.statusText);\n\n    this.name = \"HttpResponseError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpResponseError);\n    }\n\n    this.response = response;\n    this.responseJson = responseJson;\n  }\n}\n\nexport class HttpParseError extends Error {\n  response: Response;\n\n  constructor(response: Response) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(response.statusText);\n\n    this.name = \"HttpParseError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpParseError);\n    }\n\n    this.response = response;\n  }\n}\n\nexport class HttpAbortError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = \"HttpAbortError\";\n  }\n}\n","import type { HttpError } from \"./http.js\";\n\nexport interface InterceptorHandlers<T> {\n  fulfilled?: (config: T) => void;\n  rejected?: (error: HttpError) => void;\n}\n\nexport default class InterceptorManager<T> {\n  handlers: (InterceptorHandlers<T> | null)[] = [];\n\n  use(\n    onFulfilled?: (value: T) => T | Promise<T>,\n    onRejected?: (error: HttpError) => HttpError | Promise<HttpError>\n  ): number {\n    this.handlers.push({\n      fulfilled: onFulfilled,\n      rejected: onRejected,\n    });\n\n    return this.handlers.length - 1;\n  }\n\n  eject(id: number): void {\n    // istanbul ignore else\n    if (this.handlers[id]) {\n      this.handlers[id] = null;\n    }\n  }\n\n  forEach(fn: (h: InterceptorHandlers<T>) => void): void {\n    this.handlers.forEach((handler) => {\n      // istanbul ignore else\n      if (handler !== null) {\n        fn(handler);\n      }\n    });\n  }\n}\n","import { fetch } from \"./fetch.js\";\nimport {\n  HttpAbortError,\n  HttpFetchError,\n  HttpParseError,\n  HttpResponseError,\n} from \"./errors.js\";\nimport InterceptorManager from \"./InterceptorManager.js\";\n\nexport interface HttpRequestConfig {\n  url: string;\n  method: string;\n  data?: unknown;\n  meta?: unknown;\n  options?: HttpOptions;\n}\n\nexport interface HttpResponse<T = unknown> {\n  data: T;\n  status: number;\n  statusText: string;\n  headers: Headers;\n  config: HttpRequestConfig;\n}\n\nexport interface HttpError {\n  config: HttpRequestConfig;\n  error: HttpFetchError | HttpResponseError | HttpParseError | HttpAbortError;\n}\n\nexport interface HttpAdapter {\n  (config: HttpRequestConfig): Promise<HttpResponse<unknown>>;\n}\n\nexport interface HttpConstructorOptions {\n  adapter?: HttpAdapter;\n}\n\n// type NotNil<T> = T extends null ? never : T;\n\nfunction isNil(value: unknown): value is null | undefined {\n  return value === undefined || value === null;\n}\n\nconst base = document.querySelector(\"base\");\nconst fullBaseHref = base ? base.href : location.origin + \"/\";\n\nexport type HttpParams = URLSearchParams | object;\n\nexport interface RequestCustomOptions {\n  observe?: \"data\" | \"response\";\n  responseType?: \"json\" | \"blob\" | \"arrayBuffer\" | \"text\";\n  interceptorParams?: {\n    ignoreLoadingBar?: boolean;\n  };\n  noAbortOnRouteChange?: boolean;\n  useCache?: boolean;\n}\n\nexport type HttpCustomOptions = RequestCustomOptions & {\n  params?: HttpParams;\n};\n\nexport type HttpOptions = HttpCustomOptions & RequestInit;\n\n// https://developer.mozilla.org/en-US/docs/Web/API/DOMException\nexport const isHttpAbortError = (error: any) =>\n  error instanceof DOMException && error.code === 20;\n\nconst createError = (\n  error: HttpFetchError | HttpResponseError | HttpParseError | HttpAbortError,\n  config: HttpRequestConfig\n): HttpError => {\n  return {\n    error,\n    config,\n  };\n};\n\nconst request = async <T>(\n  url: string,\n  init: RequestInit,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  // eslint-disable-next-line no-async-promise-executor\n  return new Promise(async (resolve, reject) => {\n    let response: Response;\n    config.url = url;\n\n    let { responseType } = config.options || {};\n\n    if (!responseType) {\n      // Defaults to `json`\n      responseType = \"json\";\n    }\n\n    try {\n      response = await fetch(url, init);\n    } catch (e: any) {\n      reject(\n        createError(\n          isHttpAbortError(e)\n            ? new HttpAbortError(e.toString())\n            : new HttpFetchError(e.toString()),\n          config\n        )\n      );\n      return;\n    }\n\n    if (!response.ok) {\n      let responseJson;\n      try {\n        responseJson = await response.json();\n      } catch (e) {\n        // Do nothing.\n      }\n      reject(\n        createError(new HttpResponseError(response, responseJson), config)\n      );\n      return;\n    }\n\n    let data: T;\n    try {\n      data = await response[responseType]();\n    } catch (e: any) {\n      reject(\n        createError(\n          isHttpAbortError(e)\n            ? new HttpAbortError(e.toString())\n            : new HttpParseError(response),\n          config\n        )\n      );\n      return;\n    }\n\n    const res: HttpResponse<T> = {\n      config,\n      status: response.status,\n      statusText: response.statusText,\n      headers: response.headers,\n      data,\n    };\n\n    resolve(res);\n  });\n};\n\nexport const getUrlWithParams = (url: string, params?: HttpParams): string => {\n  if (params) {\n    const parsedUrl = new URL(url, fullBaseHref);\n    if (params instanceof URLSearchParams) {\n      params.forEach(function (value, key) {\n        parsedUrl.searchParams.append(key, value);\n      });\n    } else {\n      Object.entries(params).forEach(([key, value]) => {\n        if (Array.isArray(value)) {\n          value.forEach((v) => {\n            parsedUrl.searchParams.append(key, isNil(v) ? \"\" : v);\n          });\n        } else {\n          parsedUrl.searchParams.append(key, isNil(value) ? \"\" : value);\n        }\n      });\n    }\n    const { href } = parsedUrl;\n    if (href.startsWith(fullBaseHref)) {\n      return href.substr(fullBaseHref.length);\n    }\n    return href;\n  }\n  return url;\n};\n\nconst getBodyAndHeaders = (\n  data: unknown,\n  headers?: HeadersInit\n): { body?: BodyInit; headers?: HeadersInit } => {\n  if (data !== undefined) {\n    // `new Headers(undefined)` will throw a TypeError in older browsers (chrome 58).\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=335871\n    const parsedHeaders = new Headers(headers || {});\n    const contentTypeHeader = \"Content-Type\";\n    let body = data as BodyInit | undefined;\n    // If `Content-Type` already provided, ignore detecting content type.\n    if (!parsedHeaders.has(contentTypeHeader)) {\n      if (typeof data === \"string\") {\n        parsedHeaders.set(\n          contentTypeHeader,\n          \"application/x-www-form-urlencoded\"\n        );\n      } else if (data instanceof FormData) {\n        // Do nothing\n      } else {\n        parsedHeaders.set(contentTypeHeader, \"application/json\");\n        body = JSON.stringify(data);\n      }\n    }\n    return {\n      body,\n      headers: parsedHeaders,\n    };\n  }\n  return { headers };\n};\n\nconst simpleRequest = <T = unknown>(\n  method: string,\n  url: string,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  const {\n    params,\n    responseType,\n    interceptorParams,\n    observe,\n    noAbortOnRouteChange,\n    useCache,\n    ...requestInit\n  } = config.options || {};\n  return request<T>(\n    getUrlWithParams(url, params),\n    {\n      ...requestInit,\n      method,\n    },\n    config\n  );\n};\n\nconst requestWithBody = <T = unknown>(\n  method: string,\n  url: string,\n  data: unknown,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  const {\n    params,\n    responseType,\n    interceptorParams,\n    observe,\n    noAbortOnRouteChange,\n    useCache,\n    headers,\n    ...requestInit\n  } = config.options || {};\n  return request<T>(\n    getUrlWithParams(url, params),\n    {\n      ...requestInit,\n      method,\n      ...getBodyAndHeaders(data, headers),\n    },\n    config\n  );\n};\n\nconst defaultAdapter: HttpAdapter = <T>(config: HttpRequestConfig) => {\n  const { url, method, data } = config;\n\n  // \"DELETE\", \"GET\", \"HEAD\" methods.\n  if ([\"DELETE\", \"GET\", \"HEAD\"].includes(config.method)) {\n    return simpleRequest<T>(method, url, config);\n  }\n\n  // \"POST\", \"PUT\" , \"PATCH\" methods.\n  return requestWithBody<T>(method, url, data, config);\n};\n\nclass Http {\n  public readonly interceptors: {\n    request: InterceptorManager<HttpRequestConfig>;\n    response: InterceptorManager<HttpResponse>;\n  };\n\n  #adapter: HttpAdapter = defaultAdapter;\n\n  constructor(config?: HttpConstructorOptions) {\n    this.interceptors = {\n      request: new InterceptorManager(),\n      response: new InterceptorManager(),\n    };\n\n    if (config?.adapter) {\n      this.#adapter = config.adapter;\n    }\n  }\n\n  request = async <T = unknown>(\n    url: string,\n    init?: RequestInit,\n    options?: RequestCustomOptions\n  ): Promise<T> => {\n    const { body, method, ...requestInit } = init || {};\n    return this.#fetch<T>({\n      url,\n      data: body,\n      method: method || \"GET\",\n      options: { ...(options || {}), ...requestInit },\n    });\n  };\n\n  simpleRequest = <T = unknown>(\n    method: string,\n    url: string,\n    options: HttpOptions = {}\n  ): Promise<T> => {\n    return this.#fetch<T>({ url, method, options });\n  };\n\n  requestWithBody = <T = unknown>(\n    method: string,\n    url: string,\n    data?: unknown,\n    options: HttpOptions = {}\n  ): Promise<T> => {\n    return this.#fetch<T>({ url, method, data, options });\n  };\n\n  #fetch<T>(config: HttpRequestConfig): Promise<T> {\n    const chain: any[] = [];\n    let promise: Promise<any> = Promise.resolve(config);\n\n    this.interceptors.request.forEach((interceptor) => {\n      chain.push(interceptor.fulfilled, interceptor.rejected);\n    });\n\n    chain.push((config: HttpRequestConfig) => this.#adapter(config), undefined);\n\n    this.interceptors.response.forEach((interceptor) => {\n      chain.push(interceptor.fulfilled, interceptor.rejected);\n    });\n\n    chain.push(\n      (response: HttpResponse) => {\n        return response.config.options?.observe === \"response\"\n          ? response\n          : response.data;\n      },\n      (error: HttpError) => {\n        return Promise.reject(error.error);\n      }\n    );\n\n    while (chain.length) {\n      promise = promise.then(chain.shift(), chain.shift());\n    }\n\n    return promise;\n  }\n\n  getUrlWithParams(url: string, params?: HttpParams): string {\n    return getUrlWithParams(url, params);\n  }\n\n  getBodyAndHeaders(\n    data: unknown,\n    headers: HeadersInit\n  ): { body?: BodyInit; headers?: HeadersInit } {\n    return getBodyAndHeaders(data, headers);\n  }\n\n  get<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"GET\", options });\n  }\n\n  delete<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"DELETE\", options });\n  }\n\n  head<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"HEAD\", options });\n  }\n\n  post<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"POST\", data, options });\n  }\n\n  put<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"PUT\", data, options });\n  }\n\n  patch<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({\n      url,\n      method: \"PATCH\",\n      data,\n      options,\n    });\n  }\n}\n\nlet http = new Http();\nfunction createHttpInstance(config?: HttpConstructorOptions): void {\n  http = new Http(config);\n}\nexport { http, createHttpInstance, defaultAdapter };\n","import { i18n } from \"@next-core/i18n\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\n\nlet initialized = false;\nconst initializedNamespaces = new Set<string>();\n\nexport type Locales = Record<string, Record<string, string>>;\n\nexport function initializeI18n(): void;\nexport function initializeI18n(NS: string, locales: Locales): void;\nexport function initializeI18n(NS?: string, locales?: Locales) {\n  if (!initialized) {\n    initialized = true;\n    i18n\n      // learn more: https://github.com/i18next/i18next-xhr-backend\n      // .use(Backend)\n      // learn more: https://github.com/i18next/i18next-browser-languageDetector\n      .use(\n        process.env.NODE_ENV === \"test\"\n          ? (LanguageDetector as unknown as LanguageDetector.default)\n          : /* istanbul ignore next */ LanguageDetector.default\n      )\n      // for all options read: https://www.i18next.com/overview/configuration-options\n      .init({\n        fallbackLng: \"zh\",\n        debug: process.env.NODE_ENV === \"development\",\n        supportedLngs: [\"zh\", \"en\"],\n        nonExplicitSupportedLngs: true,\n        interpolation: {\n          escapeValue: false, // not needed for react as it escapes by default\n        },\n        react: {\n          useSuspense: false,\n        },\n        compatibilityJSON: \"v3\",\n        resources: {},\n      });\n  }\n\n  if (!NS || !locales || initializedNamespaces.has(NS)) {\n    return;\n  }\n  initializedNamespaces.add(NS);\n  for (const [lang, resources] of Object.entries(locales)) {\n    i18n.addResourceBundle(lang, NS, resources);\n  }\n}\n","import { i18n } from \"@next-core/i18n\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { I18nData } from \"@next-core/types\";\n\nexport function i18nText(\n  data: I18nData | null | undefined\n): string | undefined {\n  if (!data) {\n    return;\n  }\n  const language = i18n.language ?? \"zh-CN\";\n  // First, make a perfect match.\n  if (hasOwnProperty(data, language)) {\n    return data[language];\n  }\n  // https://en.wikipedia.org/wiki/IETF_language_tag\n  const primaryLanguage = language.split(\"-\")[0];\n  if (primaryLanguage !== language) {\n    // Then, match the primary language (which omits other subtags).\n    // E.g., match `zh` if the current language is `zh-CN`.\n    return hasOwnProperty(data, primaryLanguage)\n      ? data[primaryLanguage]\n      : undefined;\n  }\n  // At last, match the first key which starts with the primary language,\n  // if the current language contains primary subtag only.\n  // E.g., match `zh-CN` if the current language is `zh`.\n  const prefix = `${primaryLanguage}-`;\n  for (const key of Object.keys(data)) {\n    if (key.startsWith(prefix)) {\n      return data[key];\n    }\n  }\n}\n","export * from \"./cook.js\";\nexport * from \"./precook.js\";\nexport * from \"./precookFunction.js\";\nexport * from \"./preevaluate.js\";\nexport * from \"./interfaces.js\";\n// export { tokTypes } from \"@babel/parser\";\n","import { Node, SourceLocation, PipeCall } from \"@next-core/pipes\";\n\nexport enum LexicalStatus {\n  Initial,\n  ExpectField,\n  ExpectOptionalBeginDefault,\n  ExpectDefaultValue,\n  ExpectOptionalBeginPipe,\n  ExpectPipeIdentifier,\n  ExpectOptionalBeginPipeParameter,\n  ExpectPipeParameter,\n  ExpectPlaceholderEnd,\n}\n\nexport enum TokenType {\n  Raw = \"Raw\",\n  BeginPlaceHolder = \"BeginPlaceHolder\",\n  Field = \"Field\",\n  BeginDefault = \"BeginDefault\",\n  LiteralString = \"LiteralString\",\n  BeginPipe = \"BeginPipe\",\n  PipeIdentifier = \"PipeIdentifier\",\n  BeginPipeParameter = \"BeginPipeParameter\",\n  EndPlaceHolder = \"EndPlaceHolder\",\n  JsonValue = \"JsonValue\",\n}\n\nexport enum JsonValueType {\n  Array,\n  Object,\n  String,\n  Others,\n}\n\nexport interface LexicalContext {\n  beginPlaceholder: RegExp;\n  raw: string;\n  cursor: number;\n  status: LexicalStatus;\n  tokens: Token[];\n}\n\nexport interface Token {\n  type: TokenType;\n  value?: any;\n  loc?: SourceLocation;\n}\n\nexport interface InjectableString extends Node {\n  type: \"InjectableString\";\n  elements: (RawString | Placeholder)[];\n}\n\nexport interface RawString extends Node {\n  type: \"RawString\";\n  value: string;\n}\n\nexport interface Placeholder extends Node {\n  type: \"Placeholder\";\n  symbol: string;\n  field: string;\n  defaultValue: any;\n  pipes: PipeCall[];\n}\n","import { escapeRegExp } from \"lodash\";\nimport {\n  LexicalContext,\n  LexicalStatus,\n  Token,\n  TokenType,\n  JsonValueType,\n} from \"./interfaces.js\";\n\nexport function getRegExpOfPlaceholder(symbols: string | string[]): RegExp {\n  return new RegExp(\n    `(${([] as string[])\n      .concat(symbols)\n      .map((symbol) => escapeRegExp(symbol))\n      .join(\"|\")})\\\\{`\n  );\n}\n\nexport function tokenize(raw: string, symbols: string | string[]): Token[] {\n  const context: LexicalContext = {\n    beginPlaceholder: getRegExpOfPlaceholder(symbols),\n    raw,\n    cursor: 0,\n    status: LexicalStatus.Initial,\n    tokens: [],\n  };\n  while (context.cursor < raw.length) {\n    switch (context.status) {\n      case LexicalStatus.Initial:\n        eatOptionalRawAndOptionalPlaceholderBegin(context);\n        break;\n      case LexicalStatus.ExpectField:\n        eatWhitespace(context);\n        eatField(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginDefault:\n        eatWhitespace(context);\n        eatOptionalDefault(context);\n        break;\n      case LexicalStatus.ExpectDefaultValue:\n        eatWhitespace(context);\n        eatDefaultValue(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginPipe:\n        eatWhitespace(context);\n        eatOptionalBeginPipe(context);\n        break;\n      case LexicalStatus.ExpectPipeIdentifier:\n        eatWhitespace(context);\n        eatPipeIdentifier(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginPipeParameter:\n        eatWhitespace(context);\n        eatOptionalBeginPipeParameter(context);\n        break;\n      case LexicalStatus.ExpectPipeParameter:\n        eatWhitespace(context);\n        eatPipeParameter(context);\n        break;\n      case LexicalStatus.ExpectPlaceholderEnd:\n        eatWhitespace(context);\n        eatPlaceholderEnd(context);\n        break;\n    }\n  }\n  if (context.status !== LexicalStatus.Initial) {\n    throw new Error(\"Expected a placeholder end '}' at the end\");\n  }\n  return context.tokens;\n}\n\nfunction eatOptionalRawAndOptionalPlaceholderBegin(\n  context: LexicalContext\n): void {\n  const subRaw = getSubRaw(context);\n  const matchedPlaceholder = subRaw.match(context.beginPlaceholder)?.[0];\n  const subCursor = matchedPlaceholder\n    ? subRaw.indexOf(matchedPlaceholder)\n    : -1;\n  if (\n    subCursor >= 0 &&\n    matchedPlaceholder &&\n    subRaw.charAt(subCursor + matchedPlaceholder.length) !== \"{\"\n  ) {\n    const nextCursor = context.cursor + subCursor;\n    if (subCursor > 0) {\n      context.tokens.push({\n        type: TokenType.Raw,\n        value: subRaw.substring(0, subCursor),\n      });\n    }\n    context.tokens.push({\n      type: TokenType.BeginPlaceHolder,\n      loc: {\n        start: nextCursor,\n        end: nextCursor + matchedPlaceholder.length,\n      },\n      value: matchedPlaceholder.substring(0, matchedPlaceholder.length - 1),\n    });\n    context.cursor += subCursor + matchedPlaceholder.length;\n    context.status = LexicalStatus.ExpectField;\n  } else {\n    context.tokens.push({\n      type: TokenType.Raw,\n      value: subRaw,\n    });\n    context.cursor = context.raw.length;\n  }\n}\n\nfunction eatWhitespace(context: LexicalContext): void {\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  context.cursor += getSubRaw(context).match(/^[ \\r\\n\\t]*/)![0].length;\n}\n\nfunction eatField(context: LexicalContext): void {\n  // Only allow alphanumeric, `_`, `.`, `*`, `[`, `]`, `-` and other non-ascii.\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const [value] = getSubRaw(context).match(/^[\\w.*[\\]\\-\\u{80}-\\u{10FFFF}]*/u)!;\n  context.tokens.push({\n    type: TokenType.Field,\n    value,\n  });\n  context.cursor += value.length;\n  context.status = LexicalStatus.ExpectOptionalBeginDefault;\n}\n\nfunction eatOptionalDefault(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"=\") {\n    context.tokens.push({\n      type: TokenType.BeginDefault,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectDefaultValue;\n  } else {\n    context.status = LexicalStatus.ExpectOptionalBeginPipe;\n  }\n}\n\nfunction eatDefaultValue(context: LexicalContext): void {\n  eatJsonValueOrLiteralString(context, LexicalStatus.ExpectOptionalBeginPipe);\n}\n\nfunction eatOptionalBeginPipe(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"|\") {\n    context.tokens.push({\n      type: TokenType.BeginPipe,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectPipeIdentifier;\n  } else {\n    context.status = LexicalStatus.ExpectPlaceholderEnd;\n  }\n}\n\nfunction eatPipeIdentifier(context: LexicalContext): void {\n  const matches = getSubRaw(context).match(/^[a-zA-Z]\\w*/);\n  if (!matches) {\n    throw new Error(\n      `Expected a pipe identifier at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n  const value = matches[0];\n  context.tokens.push({\n    type: TokenType.PipeIdentifier,\n    value,\n  });\n  context.cursor += value.length;\n  context.status = LexicalStatus.ExpectOptionalBeginPipeParameter;\n}\n\nfunction eatOptionalBeginPipeParameter(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \":\") {\n    context.tokens.push({\n      type: TokenType.BeginPipeParameter,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectPipeParameter;\n  } else {\n    context.status = LexicalStatus.ExpectOptionalBeginPipe;\n  }\n}\n\nfunction eatPipeParameter(context: LexicalContext): void {\n  eatJsonValueOrLiteralString(\n    context,\n    LexicalStatus.ExpectOptionalBeginPipeParameter\n  );\n}\n\nfunction eatPlaceholderEnd(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"}\") {\n    context.tokens.push({\n      type: TokenType.EndPlaceHolder,\n      loc: {\n        start: context.cursor,\n        end: context.cursor + 1,\n      },\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.Initial;\n  } else {\n    throw new Error(\n      `Expected a placeholder end '}' at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n}\n\nconst jsonLiteralMap = new Map([\n  [\"false\", false],\n  [\"null\", null],\n  [\"true\", true],\n]);\n\nfunction eatJsonValueOrLiteralString(\n  context: LexicalContext,\n  nextStatus: LexicalStatus\n): void {\n  const subRaw = getSubRaw(context);\n  if (\n    /[0-9[{\"]/.test(subRaw.charAt(0)) ||\n    /-[0-9]/.test(subRaw.substring(0, 2))\n  ) {\n    eatJsonValue(context, nextStatus);\n  } else {\n    // Accept any characters except controls and whitespace.\n    // Only allow alphanumeric, `_`, `-` and other non-ascii.\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const [value] = getSubRaw(context).match(/^[\\w\\-\\u{80}-\\u{10FFFF}]*/u)!;\n\n    if (jsonLiteralMap.has(value)) {\n      context.tokens.push({\n        type: TokenType.JsonValue,\n        value: jsonLiteralMap.get(value),\n      });\n    } else {\n      context.tokens.push({\n        type: TokenType.LiteralString,\n        value,\n      });\n    }\n\n    context.cursor += value.length;\n    context.status = nextStatus;\n  }\n}\n\n// 我们不需要非常精确地在一段字符串中匹配出一段*完整合法的* JSON value，\n// 而只需要找到一段*可能是完整合法的* JSON value 即可，解析的工作交给 `JSON.parse()`。\n// 由于 JSON 中 object/array/string 的镜像起止符特性，我们尝试去完成这些符号匹配即可。\nfunction eatJsonValue(\n  context: LexicalContext,\n  nextStatus: LexicalStatus\n): void {\n  const subRaw = getSubRaw(context);\n  const firstChar = subRaw.charAt(0);\n  const valueType: JsonValueType =\n    firstChar === \"[\"\n      ? JsonValueType.Array\n      : firstChar === \"{\"\n      ? JsonValueType.Object\n      : firstChar === '\"'\n      ? JsonValueType.String\n      : JsonValueType.Others;\n\n  let subCursor = 0;\n  let objectBracesToMatch = 0;\n  let arrayBracketsToMatch = 0;\n  let stringQuotesToClose = false;\n  let stringBackslashToEscape = false;\n  let matched = false;\n\n  while (subCursor < subRaw.length) {\n    const char = subRaw.charAt(subCursor);\n    if (stringBackslashToEscape) {\n      stringBackslashToEscape = false;\n    } else if (stringQuotesToClose) {\n      if (char === '\"') {\n        stringQuotesToClose = false;\n      } else if (char === \"\\\\\") {\n        stringBackslashToEscape = true;\n      }\n    } else {\n      switch (char) {\n        case \"[\":\n          arrayBracketsToMatch += 1;\n          break;\n        case \"{\":\n          objectBracesToMatch += 1;\n          break;\n        case \"]\":\n          arrayBracketsToMatch -= 1;\n          break;\n        case \"}\":\n          objectBracesToMatch -= 1;\n          break;\n        case '\"':\n          stringQuotesToClose = true;\n          break;\n      }\n    }\n\n    subCursor += 1;\n\n    switch (valueType) {\n      case JsonValueType.Array:\n        matched = !arrayBracketsToMatch;\n        break;\n      case JsonValueType.Object:\n        matched = !objectBracesToMatch;\n        break;\n      case JsonValueType.String:\n        matched = !stringQuotesToClose;\n        break;\n      default:\n        // 对于其它类型，如果下一个字符不再是这些值类型可能的字符时，我们认为 JSON value 完成匹配。\n        // 其它可能的值类型：number/boolean/null/undefined。\n        matched =\n          subCursor < subRaw.length &&\n          /[^a-z0-9E.+-]/.test(subRaw.charAt(subCursor));\n    }\n\n    if (matched) {\n      break;\n    }\n  }\n\n  if (!matched) {\n    throw new Error(\n      `Failed to match a JSON value at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n\n  context.tokens.push({\n    type: TokenType.JsonValue,\n    value: JSON.parse(subRaw.substring(0, subCursor)),\n  });\n  context.cursor += subCursor;\n  context.status = nextStatus;\n}\n\nfunction getSubRaw(context: LexicalContext): string {\n  return context.raw.substring(context.cursor);\n}\n","import { get } from \"lodash\";\nimport type { Location } from \"history\";\nimport type { FeatureFlags, MicroApp } from \"@next-core/types\";\nimport { processPipes } from \"@next-core/pipes\";\nimport { parseInjectableString } from \"./syntax.js\";\nimport type { Placeholder } from \"./interfaces.js\";\nimport { getRegExpOfPlaceholder } from \"./lexical.js\";\n\nexport interface LegacyCompatibleRuntimeContext {\n  app: MicroApp;\n  overrideApp?: MicroApp;\n  location: Location;\n  query: URLSearchParams;\n  /** {@inheritDoc FeatureFlags} */\n  flags: FeatureFlags;\n  /** 系统运行时信息，包括登录信息和页面信息。 */\n  sys: Record<string, unknown>;\n  match?: {\n    path: string;\n    url: string;\n    isExact: boolean;\n    params: Record<string, string>;\n  };\n  event?: Event;\n  data?: unknown;\n}\n\nexport function transform(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, \"@\", context);\n}\n\nexport function inject(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, \"$\", context);\n}\n\nexport function transformAndInject(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, [\"@\", \"$\"], context);\n}\n\ntype CompileNode = (node: Placeholder) => unknown;\n\nfunction compile(\n  raw: string,\n  symbols: string | string[],\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  // const symbols = [\"@\", \"$\"];\n  if (!isInjectable(raw, symbols)) {\n    return raw;\n  }\n\n  const transformNode = transformNodeFactory(context.data);\n  const injectNode = injectNodeFactory(context, raw);\n\n  const tree = parseInjectableString(raw, symbols);\n  const values = tree.elements.map((node) =>\n    node.type === \"RawString\"\n      ? node.value\n      : node.symbol === \"$\"\n      ? injectNode(node)\n      : transformNode(node)\n  );\n\n  return reduceCompiledValues(values);\n}\n\nfunction reduceCompiledValues(values: unknown[]): unknown {\n  // If the whole string is a placeholder, we should keep the original value.\n  if (values.length === 1) {\n    return values[0];\n  }\n\n  // If an element is `undefined`, `null` or an empty array `[]`, it is converted to an empty string.\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join#Description\n  return values.join(\"\");\n}\n\nfunction isInjectable(raw: string, symbols?: string | string[]): boolean {\n  return getRegExpOfPlaceholder(symbols).test(raw);\n}\n\nfunction transformNodeFactory(data: unknown): CompileNode {\n  return function transformNode(node: Placeholder): unknown {\n    // If meet `@{}`, return `data`.\n    let result = node.field ? get(data, node.field) : data;\n\n    if (result === undefined) {\n      result = node.defaultValue;\n    }\n\n    return processPipes(result, node.pipes);\n  };\n}\n\nfunction injectNodeFactory(\n  context: LegacyCompatibleRuntimeContext,\n  raw: string\n): CompileNode {\n  return function injectNode(node: Placeholder): unknown {\n    const matches = node.field.match(\n      /^(?:(QUERY(?:_ARRAY)?|EVENT|query|event|APP|HASH|ANCHOR|SYS|FLAGS|CTX)\\.)?(.+)$/\n    );\n    if (!matches) {\n      // Keep the original raw partial when meet a unknown namespace.\n      return raw.substring(node.loc.start, node.loc.end);\n    }\n    let [, namespace, subField] = matches;\n\n    // Support namespace with no subfield such as `${ANCHOR}`.\n    // But distinguish with match params. E.g. `${query}` is a match param.\n    if (!namespace && /^[A-Z_]+$/.test(subField)) {\n      namespace = subField;\n      subField = \"*\";\n    }\n\n    let result: unknown;\n    const SimpleContextMap: Record<string, \"sys\" | \"flags\"> = {\n      SYS: \"sys\",\n      FLAGS: \"flags\",\n    };\n\n    switch (namespace) {\n      case \"QUERY\":\n      case \"query\":\n        if (subField === \"*\") {\n          result = context.query;\n        } else {\n          result = context.query.has(subField)\n            ? context.query.get(subField)\n            : undefined;\n        }\n        break;\n      case \"QUERY_ARRAY\":\n        result = context.query.has(subField)\n          ? context.query.getAll(subField)\n          : undefined;\n        break;\n      case \"EVENT\":\n      case \"event\":\n        if (context.event === undefined) {\n          // Keep the original raw partial when meet a `${EVENT}` in non-event context.\n          return raw.substring(node.loc.start, node.loc.end);\n        }\n        result =\n          subField === \"*\" ? context.event : get(context.event, subField);\n        break;\n      case \"APP\":\n        result =\n          subField === \"*\"\n            ? context.overrideApp ?? context.app\n            : get(context.overrideApp ?? context.app, subField);\n        break;\n      case \"HASH\":\n        result = context.location.hash;\n        break;\n      case \"SYS\":\n      case \"FLAGS\":\n        result =\n          subField === \"*\"\n            ? context[SimpleContextMap[namespace]]\n            : get(context[SimpleContextMap[namespace]], subField);\n        break;\n      case \"ANCHOR\": {\n        const anchor = context.location.hash\n          ? context.location.hash.substr(1)\n          : null;\n        result = subField === \"*\" ? anchor : get(anchor, subField);\n        break;\n      }\n      case \"CTX\": {\n        const original = raw.substring(node.loc.start, node.loc.end);\n        // eslint-disable-next-line no-console\n        console.error(\n          `CTX is not supported in placeholder any more: \"${original}\"`\n        );\n        return original;\n      }\n      default:\n        if (context.match) {\n          result = context.match.params[subField];\n        } else {\n          // If the context is empty, return the original raw partial.\n          return raw.substring(node.loc.start, node.loc.end);\n        }\n    }\n\n    if (result === undefined) {\n      result = node.defaultValue;\n    }\n\n    return processPipes(result, node.pipes);\n  };\n}\n","import { PipeCall } from \"@next-core/pipes\";\nimport { tokenize } from \"./lexical.js\";\nimport {\n  Token,\n  TokenType,\n  InjectableString,\n  Placeholder,\n} from \"./interfaces.js\";\n\nexport function parseInjectableString(\n  raw: string,\n  symbols: string | string[]\n): InjectableString {\n  return parseTokens(tokenize(raw, symbols));\n}\n\nfunction parseTokens(tokens: Token[]): InjectableString {\n  const tree: InjectableString = {\n    type: \"InjectableString\",\n    elements: [],\n  };\n\n  let token: Token | undefined;\n\n  function optionalToken(type: TokenType): boolean {\n    if (type === tokens[0].type) {\n      token = tokens.shift();\n      return true;\n    }\n    return false;\n  }\n\n  function acceptToken(type: TokenType | TokenType[]): void {\n    token = tokens.shift() as Token;\n    if (\n      Array.isArray(type) ? !type.includes(token.type) : type !== token.type\n    ) {\n      throw new Error(`Expected token: ${type}, received token: ${token.type}`);\n    }\n  }\n\n  while (tokens.length > 0) {\n    if (optionalToken(TokenType.Raw)) {\n      tree.elements.push({\n        type: \"RawString\",\n        value: token.value,\n      });\n    } else {\n      acceptToken(TokenType.BeginPlaceHolder);\n      const start = token.loc.start;\n      const symbol = token.value;\n      acceptToken(TokenType.Field);\n\n      const placeholder: Placeholder = {\n        type: \"Placeholder\",\n        symbol,\n        field: token.value,\n        defaultValue: undefined,\n        pipes: [],\n        loc: {\n          start,\n          end: start,\n        },\n      };\n      tree.elements.push(placeholder);\n\n      if (optionalToken(TokenType.BeginDefault)) {\n        acceptToken([TokenType.JsonValue, TokenType.LiteralString]);\n        placeholder.defaultValue = token.value;\n      }\n\n      while (optionalToken(TokenType.BeginPipe)) {\n        acceptToken(TokenType.PipeIdentifier);\n        const pipe: PipeCall = {\n          type: \"PipeCall\",\n          identifier: token.value,\n          parameters: [],\n        };\n        placeholder.pipes.push(pipe);\n\n        while (optionalToken(TokenType.BeginPipeParameter)) {\n          acceptToken([TokenType.JsonValue, TokenType.LiteralString]);\n          pipe.parameters.push(token.value);\n        }\n      }\n\n      acceptToken(TokenType.EndPlaceHolder);\n      placeholder.loc.end = token.loc.end;\n    }\n  }\n\n  return tree;\n}\n","const cache = new Map<string, Promise<string>>();\n\nexport default function loadScript(\n  src: string,\n  prefix?: string\n): Promise<string>;\nexport default function loadScript(\n  src: string[],\n  prefix?: string\n): Promise<string[]>;\nexport default function loadScript(\n  src: string | string[],\n  prefix?: string\n): Promise<string | string[]> {\n  if (Array.isArray(src)) {\n    return Promise.all(\n      src.map<Promise<string>>((item) => loadScript(item, prefix))\n    );\n  }\n  const fixedSrc = prefix ? `${prefix}${src}` : src;\n  const cachedPromise = cache.get(fixedSrc);\n  if (cachedPromise) {\n    return cachedPromise;\n  }\n  const promise = new Promise<string>((resolve, reject) => {\n    const end = (): void => {\n      window.dispatchEvent(new Event(\"request.end\"));\n    };\n    const script = document.createElement(\"script\");\n    script.src = fixedSrc;\n    script.type = \"text/javascript\";\n    script.async = true;\n    script.onload = () => {\n      resolve(fixedSrc);\n      end();\n    };\n    script.onerror = (e) => {\n      reject(e);\n      end();\n    };\n    const firstScript =\n      document.currentScript || document.getElementsByTagName(\"script\")[0];\n    (firstScript.parentNode as Node).insertBefore(script, firstScript);\n    window.dispatchEvent(new Event(\"request.start\"));\n  });\n  cache.set(fixedSrc, promise);\n  return promise;\n}\n","import loadScript from \"./loadScript.js\";\nimport loadSharedModule from \"./loadSharedModule.js\";\n\ninterface BrickPackage {\n  id: string;\n  filePath: string;\n  elements?: string[];\n  dependencies?: Record<string, string[]>;\n}\n\nlet resolveBasicPkg: () => void;\nlet basicPkgWillBeResolved = false;\nconst waitBasicPkg = new Promise<void>((resolve) => {\n  resolveBasicPkg = resolve;\n});\n\nexport function flushStableLoadBricks(): void {\n  if (!basicPkgWillBeResolved) {\n    resolveBasicPkg();\n  }\n}\n\n/**\n * When loading bundles with webpack module federation concurrently, if\n * these bundles share some modules, webpack will load a singleton module\n * if versions are matched. Webpack will use the first bundle who started\n * to init the shared scope. Generally which bundle to use for a specific\n * module, does not matter. However, it may cause flaky result since the\n * shared module may from different bundles which maybe not exactly the\n * same, especially developers declare dependencies incorrectly sometimes.\n * So in order to make it less flaky, we try to make a BASIC package takes\n * precedence over others. We will always load the shared modules from the\n * basic package bundle if it contains the shared modules.\n */\nexport function enqueueStableLoadBricks(\n  bricks: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"bricks\", bricks, brickPackages);\n  return dispatchRequestStatus(promise);\n}\n\nexport function enqueueStableLoadProcessors(\n  processors: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"processors\", processors, brickPackages);\n  return dispatchRequestStatus(promise);\n}\n\nexport async function loadBricksImperatively(\n  bricks: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"bricks\", bricks, brickPackages);\n  flushStableLoadBricks();\n  return dispatchRequestStatus(promise);\n}\n\nexport function loadProcessorsImperatively(\n  processors: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"processors\", processors, brickPackages);\n  flushStableLoadBricks();\n  return dispatchRequestStatus(promise);\n}\n\ninterface V2AdapterBrick {\n  resolve(\n    adapterPkgFilePath: string,\n    brickPkgFilePath: string,\n    bricks: string[],\n    dlls: string[] | undefined,\n    brickPackages: BrickPackage[]\n  ): Promise<void>;\n}\n\nlet v2AdapterPromise: Promise<V2AdapterBrick> | undefined;\nconst V2_ADAPTER_LOAD_BRICKS = \"v2-adapter.load-bricks\";\n\n// Get brick/processor items including their dependencies\nfunction getItemsByPkg(\n  type: \"bricks\" | \"processors\",\n  list: string[] | Set<string>,\n  brickPackagesMap: Map<string, BrickPackage>\n) {\n  const itemsByPkg = new Map<BrickPackage, string[]>();\n  const listToLoad = new Set<string>();\n  const add = (item: string) => {\n    if (listToLoad.has(item)) {\n      return;\n    }\n    listToLoad.add(item);\n    let pkg: BrickPackage | undefined;\n    let namespace: string;\n    let itemName: string | undefined;\n    if (type === \"processors\" || item.includes(\".\")) {\n      [namespace, itemName] = item.split(\".\");\n      const pkgId = `bricks/${\n        type === \"processors\" ? getProcessorPackageName(namespace) : namespace\n      }`;\n      pkg = brickPackagesMap.get(pkgId);\n    } else {\n      itemName = item;\n      for (const p of brickPackagesMap.values()) {\n        if (p.elements?.some((e) => e === itemName)) {\n          pkg = p;\n          break;\n        }\n      }\n    }\n\n    if (!pkg) {\n      throw new Error(`Package for ${item} not found.`);\n    }\n\n    let groupItems = itemsByPkg.get(pkg);\n    if (!groupItems) {\n      groupItems = [];\n      itemsByPkg.set(pkg, groupItems);\n    }\n    groupItems.push(itemName!);\n\n    // Load their dependencies too\n    const deps = pkg.dependencies?.[item];\n    if (deps) {\n      for (const dep of deps) {\n        add(dep);\n      }\n    }\n  };\n  for (const item of list) {\n    add(item);\n  }\n  return itemsByPkg;\n}\n\nasync function loadBrickModule(\n  type: \"bricks\" | \"processors\",\n  pkgId: string,\n  itemName: string\n) {\n  const moduleName = `${\n    type === \"processors\" ? \"./processors/\" : \"./\"\n  }${itemName}`;\n  try {\n    await loadSharedModule(pkgId, moduleName);\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error);\n    throw new Error(\n      `Load ${type} of \"${pkgId.split(\"/\").pop()}.${moduleName\n        .split(\"/\")\n        .pop()}\" failed`\n    );\n  }\n}\n\nfunction loadRestBricks(\n  type: \"bricks\" | \"processors\",\n  pkgs: BrickPackage[],\n  itemsMap: Map<BrickPackage, string[]>\n) {\n  return pkgs.map(async (pkg) => {\n    await loadScript(pkg.filePath, window.PUBLIC_ROOT ?? \"\");\n    await waitBasicPkg;\n    return Promise.all(\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      itemsMap\n        .get(pkg)!\n        .map((itemName) => loadBrickModule(type, pkg.id, itemName))\n    );\n  });\n}\n\nasync function enqueueStableLoad(\n  type: \"bricks\" | \"processors\",\n  list: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const brickPackagesMap = new Map<string, BrickPackage>();\n  for (const pkg of brickPackages) {\n    const pkgId = pkg.id ?? getPkgIdByFilePath(pkg.filePath);\n    brickPackagesMap.set(pkgId, pkg);\n  }\n\n  const itemsByPkg = getItemsByPkg(type, list, brickPackagesMap);\n\n  let foundBasicPkg: BrickPackage | undefined;\n  const v2Packages: BrickPackage[] = [];\n  const v3PackagesOtherThanBasic: BrickPackage[] = [];\n  let maybeV2Adapter: BrickPackage | undefined;\n  for (const pkg of itemsByPkg.keys()) {\n    if (pkg.id) {\n      if (pkg.id === \"bricks/basic\") {\n        foundBasicPkg = pkg;\n      } else {\n        v3PackagesOtherThanBasic.push(pkg);\n      }\n    } else {\n      // Brick packages of v2 has no `id`\n      v2Packages.push(pkg);\n      maybeV2Adapter = brickPackagesMap.get(\"bricks/v2-adapter\");\n      if (!maybeV2Adapter) {\n        // eslint-disable-next-line no-console\n        console.error(\"Using v2 bricks, but v2-adapter not found\");\n      }\n    }\n  }\n  const v2Adapter = maybeV2Adapter;\n\n  let basicPkgPromise: Promise<unknown> | undefined;\n  const basicPkg = foundBasicPkg;\n  if (basicPkg) {\n    const tempPromise = loadScript(basicPkg.filePath, window.PUBLIC_ROOT ?? \"\");\n    // Packages other than BASIC will wait for an extra micro-task tick.\n    if (!basicPkgWillBeResolved) {\n      basicPkgWillBeResolved = true;\n      tempPromise.then(() => Promise.resolve()).then(resolveBasicPkg);\n    }\n    basicPkgPromise = tempPromise.then(() =>\n      Promise.all(\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        itemsByPkg\n          .get(basicPkg)!\n          .map((itemName) => loadBrickModule(type, basicPkg.id, itemName))\n      )\n    );\n  }\n\n  const pkgPromises = [basicPkgPromise].concat(\n    loadRestBricks(type, v3PackagesOtherThanBasic, itemsByPkg)\n  );\n\n  if (v2Adapter && v2Packages.length > 0) {\n    if (!v2AdapterPromise) {\n      // Load `v2-adapter.load-bricks` and its dependencies\n      const v2AdapterItemsByPkg = getItemsByPkg(\n        \"bricks\",\n        [V2_ADAPTER_LOAD_BRICKS],\n        brickPackagesMap\n      );\n      const v2AdapterPackages = [...v2AdapterItemsByPkg.keys()];\n\n      const loadV2Adapter = async () => {\n        await Promise.all(\n          loadRestBricks(\"bricks\", v2AdapterPackages, v2AdapterItemsByPkg)\n        );\n        return document.createElement(\n          V2_ADAPTER_LOAD_BRICKS\n        ) as unknown as V2AdapterBrick;\n      };\n      v2AdapterPromise = loadV2Adapter();\n    }\n\n    pkgPromises.push(\n      v2AdapterPromise.then((adapter) =>\n        Promise.all(\n          v2Packages.map((pkg) => {\n            const pkgId = getPkgIdByFilePath(pkg.filePath);\n            const pkgNamespace = pkgId.split(\"/\")[1];\n            return adapter.resolve(\n              v2Adapter.filePath,\n              pkg.filePath,\n              type === \"bricks\"\n                ? // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                  itemsByPkg\n                    .get(pkg)!\n                    .map((itemName) => `${pkgNamespace}.${itemName}`)\n                : [],\n              (pkg as { dll?: string[] }).dll,\n              // Todo: remove `brickPackages` as an argument\n              brickPackages\n            );\n          })\n        )\n      )\n    );\n  }\n\n  await Promise.all(pkgPromises);\n}\n\nasync function dispatchRequestStatus(promise: Promise<unknown>) {\n  window.dispatchEvent(new Event(\"request.start\"));\n  try {\n    await promise;\n  } finally {\n    window.dispatchEvent(new Event(\"request.end\"));\n  }\n}\n\nfunction getProcessorPackageName(camelPackageName: string): string {\n  return camelPackageName\n    .replace(/[A-Z]/g, (match) => `-${match[0].toLocaleLowerCase()}`)\n    .replace(/_[0-9]/g, (match) => `-${match[1]}`);\n}\n\nfunction getPkgIdByFilePath(filePath: string) {\n  return filePath.split(\"/\").slice(0, 2).join(\"/\");\n}\n","declare const __webpack_init_sharing__: (scope: string) => Promise<unknown>;\ndeclare const __webpack_share_scopes__: Record<string, unknown>;\n\ninterface WebpackRuntimeContainer {\n  init(arg: unknown): Promise<unknown>;\n  get(module: string): Promise<Function>;\n}\n\n// https://github.com/module-federation/module-federation-examples/blob/eda9493f3991a423479fd834cfb1d7b241d9d1f0/advanced-api/dynamic-remotes/app1/src/App.js\nexport default async function loadSharedModule(scope: string, module: string) {\n  // Initializes the share scope. This fills it with known provided modules from this build and all remotes\n  await __webpack_init_sharing__(\"default\");\n  const container = (window as unknown as Record<string, unknown>)[\n    scope\n  ] as WebpackRuntimeContainer; // or get the container somewhere else\n  // Initialize the container, it may provide shared modules\n  await container.init(__webpack_share_scopes__.default);\n  const factory = await container.get(module);\n  return factory();\n}\n","class CustomProcessorRegistry {\n  readonly #registry = new Map<string, Map<string, Function>>();\n\n  define(processorFullName: string, processorFunc: Function) {\n    // `namespace` should be the camelCase of the package name.\n    const [namespace, processorName] = processorFullName.split(\".\");\n    let pkg = this.#registry.get(namespace);\n    if (!pkg) {\n      pkg = new Map();\n      this.#registry.set(namespace, pkg);\n    }\n    if (pkg.has(processorName)) {\n      // eslint-disable-next-line no-console\n      throw new Error(\n        `Custom processor of \"${processorFullName}\" already registered`\n      );\n    }\n    pkg.set(processorName, processorFunc);\n  }\n\n  get(namespace: string) {\n    return this.#registry.get(namespace);\n  }\n}\n\nexport const customProcessors = new CustomProcessorRegistry();\n","import { i18n } from \"@next-core/i18n\";\nimport { Storyboard } from \"@next-core/types\";\n\nexport function registerAppI18n({ app, meta }: Storyboard) {\n  if (meta?.i18n) {\n    // Prefix to avoid conflict between brick package's i18n namespace.\n    const i18nNamespace = getI18nNamespace(\"app\", app.id);\n    // Support any language in `meta.i18n`.\n    const languages: string[] = [];\n    Object.entries(meta.i18n).forEach(([lang, resources]) => {\n      i18n.addResourceBundle(lang, i18nNamespace, resources);\n      languages.push(lang);\n    });\n    return () => {\n      for (const lang of languages) {\n        i18n.removeResourceBundle(lang, i18nNamespace);\n      }\n    };\n  }\n}\n\nexport function getI18nNamespace(\n  type: \"app\" | \"widget\" | \"menu\",\n  id: string\n): string {\n  return `${type}/${id}`;\n}\n","// import i18next, { getFixedT, TFunction } from \"i18next\";\nimport { i18n } from \"@next-core/i18n\";\nimport type { MetaI18n } from \"@next-core/types\";\nimport { getI18nNamespace } from \"../registerAppI18n.js\";\n\nexport function registerWidgetI18n(widgetId: string, i18nData: MetaI18n): void {\n  const ns = getI18nNamespace(\"widget\", widgetId);\n  Object.entries(i18nData).forEach(([lang, resources]) => {\n    i18n.addResourceBundle(lang, ns, resources);\n  });\n}\n\nexport function widgetI18nFactory(widgetId: string) {\n  return i18n.getFixedT(null, getI18nNamespace(\"widget\", widgetId));\n}\n","export interface ImagesFactory {\n  get(name: string): string;\n}\n\nexport function imagesFactory(\n  appId: string,\n  isBuildPush?: boolean\n): ImagesFactory {\n  return {\n    get(name) {\n      return isBuildPush\n        ? `api/gateway/object_store.object_store.GetObject/api/v1/objectStore/bucket/next-builder/object/${name}`\n        : `${\n            window.APP_ROOT ? `${window.APP_ROOT}-/` : \"\"\n          }micro-apps/${appId}/images/${name}`;\n    },\n  };\n}\n\nexport function widgetImagesFactory(\n  widgetId: string,\n  widgetVersion?: string\n): ImagesFactory {\n  return {\n    get(name) {\n      return `${window.PUBLIC_ROOT ?? \"\"}bricks/${widgetId}/${\n        window.PUBLIC_ROOT_WITH_VERSION && widgetVersion\n          ? `${widgetVersion}/`\n          : \"\"\n      }dist/assets/${name}`;\n    },\n  };\n}\n","interface DevtoolsHookContainer {\n  __BRICK_NEXT_DEVTOOLS_HOOK__?: DevtoolsHook;\n}\n\ninterface DevtoolsHook {\n  emit: (message: unknown) => void;\n  restoreDehydrated: (value: unknown) => unknown;\n}\n\nexport function getDevHook(): DevtoolsHook | undefined {\n  return (window as DevtoolsHookContainer).__BRICK_NEXT_DEVTOOLS_HOOK__;\n}\n","import { getDevHook } from \"./devtools.js\";\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst THROW = (): any => {\n  throw new Error(\"Can't modify read-only proxy object\");\n};\n\nconst readOnlyHandler: ProxyHandler<object> = {\n  set: THROW,\n  defineProperty: THROW,\n  deleteProperty: THROW,\n  setPrototypeOf: THROW,\n};\n\nexport function getReadOnlyProxy<T extends object>(object: T): T {\n  return new Proxy<T>(object, readOnlyHandler);\n}\n\n// First, we want to make accessing property of globals lazy,\n// So we use *Proxy* to make a dynamic accessor for each of these globals.\n// But we also want to keep them working in devtools.\nexport function getDynamicReadOnlyProxy({\n  get,\n  ownKeys,\n}: Required<Pick<ProxyHandler<object>, \"get\" | \"ownKeys\">>): unknown {\n  if (getDevHook()) {\n    // In devtools, we extract them at beginning.\n    const target = Object.fromEntries(\n      (ownKeys(null!) as string[]).map((key) => [key, get(null!, key, null)])\n    );\n    return getReadOnlyProxy(target);\n  }\n  return new Proxy(Object.freeze({}), { get });\n}\n","import type { SiteMode, SiteTheme } from \"@next-core/types\";\nimport { JsonStorage } from \"@next-core/utils/general\";\n\ninterface AppThemes {\n  [appId: string]: SiteTheme;\n}\n\n// Themes.\nlet theme: SiteTheme = \"light\";\nconst storage = new JsonStorage<Record<string, AppThemes>>(localStorage);\nconst LOCAL_STORAGE_APPS_THEME_KEY = \"apps-theme\";\n\nexport function setTheme(value: SiteTheme): void {\n  if (value !== \"dark\" && value !== \"light\" && value !== \"dark-v2\") {\n    throw new Error(`Unsupported theme: ${value}`);\n  }\n  theme = value;\n}\n\nexport function getTheme(): SiteTheme {\n  return theme;\n}\n\nexport function getCurrentTheme(): SiteTheme {\n  return document.documentElement.dataset.theme as SiteTheme;\n}\n\nexport function applyTheme(value?: SiteTheme): void {\n  if (value) {\n    setTheme(value);\n  } else {\n    value = getTheme();\n  }\n  if (value !== getCurrentTheme()) {\n    document.documentElement.dataset.theme = value;\n    window.dispatchEvent(\n      new CustomEvent<SiteTheme>(\"theme.change\", {\n        detail: value,\n      })\n    );\n  }\n}\n\nexport function batchSetAppsLocalTheme(appsTheme: AppThemes): void {\n  storage.setItem(LOCAL_STORAGE_APPS_THEME_KEY, {\n    ...getLocalAppsTheme(),\n    ...appsTheme,\n  });\n}\n\nexport function getLocalAppsTheme(): AppThemes {\n  let result: AppThemes | undefined;\n  try {\n    result = storage.getItem(LOCAL_STORAGE_APPS_THEME_KEY);\n  } catch {\n    // eslint-disable-next-line no-console\n    console.error(\"JSON parse error inside `getLocalAppsTheme()`\");\n  }\n\n  return result ?? {};\n}\n\n// Modes.\nlet mode: SiteMode = \"default\";\n\nexport function setMode(value: SiteMode): void {\n  if (value !== \"dashboard\" && value !== \"default\") {\n    throw new Error(`Unsupported mode: ${value}`);\n  }\n  mode = value;\n}\n\nexport function getMode(): SiteMode {\n  return mode;\n}\n\nexport function getCurrentMode(): SiteMode {\n  return document.documentElement.dataset.mode as SiteMode;\n}\n\nexport function applyMode(value?: SiteMode): void {\n  if (value) {\n    setMode(value);\n  } else {\n    value = getMode();\n  }\n  if (value !== getCurrentMode()) {\n    document.documentElement.dataset.mode = value;\n    window.dispatchEvent(\n      new CustomEvent<SiteMode>(\"mode.change\", {\n        detail: value,\n      })\n    );\n  }\n}\n\nexport function getCssPropertyValue(\n  name: string,\n  el = document.documentElement\n): string {\n  if (!el) return \"\";\n  return window.getComputedStyle(el)?.getPropertyValue(name) || \"\";\n}\n","/**\n * Get site's base path, generally will be `/next/` or `/`.\n */\nexport function getBasePath(): string {\n  const base = document.querySelector(\"base\");\n  const basePath = base ? (base.getAttribute(\"href\") as string) : \"/\";\n  return basePath;\n}\n","import { identity } from \"lodash\";\nimport type { MicroApp } from \"@next-core/types\";\nimport { i18n, i18nText } from \"@next-core/i18n\";\nimport { widgetI18nFactory } from \"./WidgetI18n.js\";\nimport { ImagesFactory, imagesFactory, widgetImagesFactory } from \"./images.js\";\nimport { checkPermissions } from \"../checkPermissions.js\";\nimport { getReadOnlyProxy } from \"../proxyFactories.js\";\nimport { getTheme } from \"../../themeAndMode.js\";\nimport { getBasePath } from \"../../getBasePath.js\";\nimport { getI18nNamespace } from \"../registerAppI18n.js\";\n\nexport interface GeneralGlobalsOptions {\n  collectCoverage?: unknown;\n  widgetId?: string;\n  widgetVersion?: string;\n  app?: PartialMicroApp;\n  appendI18nNamespace?: string;\n  storyboardFunctions?: unknown;\n  isStoryboardFunction?: boolean;\n}\n\nexport type PartialMicroApp = Pick<MicroApp, \"id\" | \"isBuildPush\">;\n\n// `GeneralGlobals` are globals which are page-state-agnostic,\n// thus they can be used both in storyboard expressions and functions.\nexport function getGeneralGlobals(\n  attemptToVisitGlobals: Set<string>,\n  options: GeneralGlobalsOptions\n): Record<string, unknown> {\n  const globalVariables: Record<string, unknown> = {};\n  for (const variableName of attemptToVisitGlobals) {\n    const variable = getIndividualGlobal(variableName, options);\n    if (variable !== undefined) {\n      globalVariables[variableName] = variable;\n    }\n  }\n  return globalVariables;\n}\n\nfunction getIndividualGlobal(\n  variableName: string,\n  {\n    collectCoverage,\n    widgetId,\n    widgetVersion,\n    app,\n    appendI18nNamespace,\n    storyboardFunctions,\n    isStoryboardFunction,\n  }: GeneralGlobalsOptions\n): unknown {\n  switch (variableName) {\n    case \"BASE_URL\":\n      return collectCoverage ? \"/next\" : getBasePath().replace(/\\/$/, \"\");\n    case \"FN\":\n      return storyboardFunctions;\n    case \"IMG\":\n      return collectCoverage\n        ? fakeImageFactory()\n        : widgetId\n        ? widgetImagesFactory(widgetId, widgetVersion)\n        : imagesFactory(app!.id, app!.isBuildPush);\n    case \"I18N\":\n      return collectCoverage\n        ? identity\n        : widgetId\n        ? widgetI18nFactory(widgetId)\n        : i18n.getFixedT(\n            null,\n            [appendI18nNamespace, getI18nNamespace(\"app\", app!.id)].filter(\n              Boolean\n            ) as string[]\n          );\n    case \"I18N_TEXT\":\n      return collectCoverage ? fakeI18nText : i18nText;\n    case \"PERMISSIONS\":\n      return getReadOnlyProxy({\n        check: collectCoverage ? fakeCheckPermissions : checkPermissions,\n      });\n    case \"THEME\":\n      return getReadOnlyProxy({\n        getTheme: collectCoverage ? () => \"light\" : getTheme,\n        // getCssPropertyValue: collectCoverage ? () => \"\" : getCssPropertyValue,\n      });\n    case \"console\":\n      return isStoryboardFunction ? getReadOnlyProxy(console) : undefined;\n    case \"location\":\n      return collectCoverage\n        ? {\n            href: \"http://localhost:3000/functions/test\",\n            origin: \"http://localhost:3000\",\n            host: \"localhost:3000\",\n            hostname: \"localhost\",\n          }\n        : {\n            href: location.href,\n            origin: location.origin,\n            host: location.host,\n            hostname: location.hostname,\n          };\n  }\n}\n\nfunction fakeI18nText(data: Record<string, string>): string {\n  return data?.en;\n}\n\nfunction fakeImageFactory(): ImagesFactory {\n  return {\n    get(name: string) {\n      return `mock/images/${name}`;\n    },\n  };\n}\n\nfunction fakeCheckPermissions(): boolean {\n  return true;\n}\n","import type { MicroApp, StoryboardFunction } from \"@next-core/types\";\nimport { cook, precookFunction, EstreeNode } from \"@next-core/cook\";\nimport { supply } from \"@next-core/supply\";\nimport { strictCollectMemberUsageInFunction } from \"@next-core/utils/storyboard\";\nimport { getGeneralGlobals } from \"./internal/compute/getGeneralGlobals.js\";\n\n/** @internal */\nexport type ReadonlyStoryboardFunctions = Readonly<Record<string, Function>>;\n\n/** @internal */\nexport type StoryboardFunctionPatch = Pick<\n  StoryboardFunction,\n  \"source\" | \"typescript\"\n>;\n\n/** @internal */\nexport interface StoryboardFunctionRegistry {\n  /** A readonly proxy for accessing cooked storyboard functions. */\n  storyboardFunctions: ReadonlyStoryboardFunctions;\n\n  /** Register storyboard functions. */\n  registerStoryboardFunctions(\n    functions: StoryboardFunction[] | undefined,\n    app?: PartialMicroApp\n  ): void;\n\n  /** Update a storyboard function during debugging. */\n  updateStoryboardFunction(name: string, data: StoryboardFunctionPatch): void;\n\n  checkPermissionsUsage(functionNames: string[]): boolean;\n}\n\n/** @internal */\nexport interface RuntimeStoryboardFunction {\n  source: string;\n  typescript?: boolean;\n  processed?: boolean;\n  cooked?: Function;\n  deps: Set<string>;\n  hasPermissionsCheck: boolean;\n}\n\n/** @internal */\nexport interface FunctionCoverageCollector {\n  beforeVisit(node: EstreeNode): void;\n  beforeEvaluate(node: EstreeNode): void;\n  beforeCall(node: EstreeNode): void;\n  beforeBranch(node: EstreeNode, branch: string): void;\n}\n\n/** @internal */\nexport interface FunctionCoverageSettings {\n  createCollector(name: string): FunctionCoverageCollector;\n}\n\n/** @internal */\nexport type PartialMicroApp = Pick<MicroApp, \"id\" | \"isBuildPush\">;\n\n/** @internal */\nexport function StoryboardFunctionRegistryFactory({\n  widgetId,\n  widgetVersion,\n  collectCoverage,\n}: {\n  widgetId?: string;\n  widgetVersion?: string;\n  collectCoverage?: FunctionCoverageSettings;\n} = {}): StoryboardFunctionRegistry {\n  const registeredFunctions = new Map<string, RuntimeStoryboardFunction>();\n\n  // Use `Proxy` with a frozen target, to make a readonly function registry.\n  const storyboardFunctions = new Proxy(Object.freeze({}), {\n    get(target, key) {\n      return getStoryboardFunction(key as string);\n    },\n  }) as ReadonlyStoryboardFunctions;\n\n  let currentApp: PartialMicroApp | undefined;\n\n  function registerStoryboardFunctions(\n    functions: StoryboardFunction[],\n    app?: PartialMicroApp\n  ): void {\n    if (app) {\n      currentApp = app;\n    }\n    registeredFunctions.clear();\n    if (Array.isArray(functions)) {\n      for (const fn of functions) {\n        const deps = strictCollectMemberUsageInFunction(fn, \"FN\");\n        const hasPermissionsCheck = strictCollectMemberUsageInFunction(\n          fn,\n          \"PERMISSIONS\"\n        ).has(\"check\");\n        registeredFunctions.set(fn.name, {\n          source: fn.source,\n          typescript: fn.typescript,\n          deps,\n          hasPermissionsCheck,\n        });\n      }\n    }\n  }\n\n  function getStoryboardFunction(name: string): Function | undefined {\n    const fn = registeredFunctions.get(name);\n    if (!fn) {\n      return undefined;\n    }\n    if (fn.processed) {\n      return fn.cooked;\n    }\n    let collector: FunctionCoverageCollector | undefined;\n    if (collectCoverage) {\n      collector = collectCoverage.createCollector(name);\n    }\n    const precooked = precookFunction(fn.source, {\n      typescript: fn.typescript,\n      hooks: collector && {\n        beforeVisit: collector.beforeVisit,\n      },\n    });\n    fn.cooked = cook(precooked.function, fn.source, {\n      rules: {\n        noVar: true,\n      },\n      globalVariables: supply(\n        precooked.attemptToVisitGlobals,\n        getGeneralGlobals(precooked.attemptToVisitGlobals, {\n          collectCoverage,\n          widgetId,\n          widgetVersion,\n          app: currentApp,\n          storyboardFunctions,\n          isStoryboardFunction: true,\n        }),\n        !!collectCoverage\n      ),\n      hooks: collector && {\n        beforeEvaluate: collector.beforeEvaluate,\n        beforeCall: collector.beforeCall,\n        beforeBranch: collector.beforeBranch,\n      },\n    }) as Function;\n    fn.processed = true;\n    return fn.cooked;\n  }\n\n  return {\n    storyboardFunctions,\n    registerStoryboardFunctions,\n    updateStoryboardFunction(\n      name: string,\n      data: StoryboardFunctionPatch\n    ): void {\n      const newFn = {\n        ...data,\n        name,\n      };\n      const deps = strictCollectMemberUsageInFunction(newFn, \"FN\");\n      const hasPermissionsCheck = strictCollectMemberUsageInFunction(\n        newFn,\n        \"PERMISSIONS\"\n      ).has(\"check\");\n      registeredFunctions.set(name, {\n        source: data.source,\n        typescript: data.typescript,\n        deps,\n        hasPermissionsCheck,\n      });\n    },\n    /**\n     * Check whether listed functions attempt to call `PERMISSIONS.check()`,\n     * includes in nested `FN.*()` calls.\n     */\n    checkPermissionsUsage(functionNames) {\n      const checkedFunctions = new Set<string>();\n      const hasPermissionsCheck = (name: string): boolean => {\n        if (!checkedFunctions.has(name)) {\n          checkedFunctions.add(name);\n          const fn = registeredFunctions.get(name);\n          return (\n            !!fn &&\n            (fn.hasPermissionsCheck || [...fn.deps].some(hasPermissionsCheck))\n          );\n        }\n        return false;\n      };\n      return functionNames.some(hasPermissionsCheck);\n    },\n  };\n}\n","import { StoryboardFunctionRegistryFactory } from \"../../StoryboardFunctionRegistry.js\";\n\nexport const {\n  storyboardFunctions,\n  registerStoryboardFunctions,\n  checkPermissionsUsage,\n} = StoryboardFunctionRegistryFactory();\n","import EventTarget from \"@ungap/event-target\";\n\nexport interface Media {\n  breakpoint?: MediaBreakpoint;\n}\n\nexport enum MediaBreakpoint {\n  xLarge = \"xLarge\",\n  large = \"large\",\n  medium = \"medium\",\n  small = \"small\",\n  xSmall = \"xSmall\",\n}\n\nexport const mediaBreakpointMinWidthMap = new Map<\n  MediaBreakpoint,\n  string | number\n>([\n  [MediaBreakpoint.xLarge, \"1920px\"],\n  [MediaBreakpoint.large, \"1600px\"],\n  [MediaBreakpoint.medium, \"1280px\"],\n  [MediaBreakpoint.small, \"1024px\"],\n  [MediaBreakpoint.xSmall, 0],\n]);\nexport const mediaEventTarget = new EventTarget();\n\nconst breakpointMatchesMap: Partial<Record<MediaBreakpoint, boolean>> = {};\nconst MEDIA: Media = {};\n\nfunction handleMatchesChange(\n  data: { readonly matches: boolean; readonly media: string },\n  breakpoint: MediaBreakpoint\n): void {\n  let changed = false;\n  breakpointMatchesMap[breakpoint] = data.matches;\n\n  for (const [breakpoint] of mediaBreakpointMinWidthMap) {\n    if (breakpointMatchesMap[breakpoint] && MEDIA.breakpoint !== breakpoint) {\n      MEDIA.breakpoint = breakpoint;\n      changed = true;\n      break;\n    }\n  }\n\n  if (changed) {\n    mediaEventTarget.dispatchEvent(\n      new CustomEvent(\"change\", { detail: MEDIA })\n    );\n  }\n}\n\nmediaBreakpointMinWidthMap.forEach((minWidth, breakpoint) => {\n  const mediaQueryList = window.matchMedia(`(min-width: ${minWidth})`);\n\n  handleMatchesChange(mediaQueryList, breakpoint);\n\n  if (mediaQueryList.addEventListener) {\n    mediaQueryList.addEventListener(\"change\", (event) => {\n      handleMatchesChange(event, breakpoint);\n    });\n  } else {\n    mediaQueryList.addListener((event) => {\n      handleMatchesChange(event, breakpoint);\n    });\n  }\n});\n\nexport const getMedia = (): Media => MEDIA;\n","export function getStorageItem(storageType: \"local\" | \"session\") {\n  return function (name: string) {\n    const storage = storageType === \"local\" ? localStorage : sessionStorage;\n    return JSON.parse(storage.getItem(name) ?? \"null\");\n  };\n}\n","import type { RuntimeStoryboard } from \"@next-core/types\";\nimport { orderBy } from \"lodash\";\nimport { getRuntime } from \"./Runtime.js\";\n\nexport function matchStoryboard(\n  storyboards: RuntimeStoryboard[],\n  pathname: string\n): RuntimeStoryboard | undefined {\n  // Put apps with longer homepage before shorter ones.\n  // E.g., `/legacy/tool` will match first before `/legacy`.\n  // This enables two apps with relationship of parent-child of homepage.\n  const sortedStoryboards = orderBy(\n    storyboards,\n    (storyboard) => storyboard.app?.homepage?.length ?? 0,\n    \"desc\"\n  );\n  for (const storyboard of sortedStoryboards) {\n    const homepage = storyboard.app.homepage;\n    if (typeof homepage === \"string\" && homepage[0] === \"/\") {\n      if (\n        homepage === \"/\"\n          ? pathname === homepage\n          : `${pathname.replace(/\\/+$/, \"\")}/`.startsWith(\n              `${homepage.replace(/\\/+$/, \"\")}/`\n            )\n      ) {\n        return storyboard;\n      }\n    }\n  }\n}\n\n/**\n * We say it's an outside app when at least one of the below conditions are true:\n *   - target app is not found.\n *   - target app is not the current app.\n *   - current app is non-standalone mode and target app is standalone mode.\n *\n * Note: when current app is standalone mode, other apps will not be found.\n */\nexport function isOutsideApp(\n  storyboard: RuntimeStoryboard | undefined\n): boolean | undefined {\n  if (process.env.NODE_ENV === \"test\") {\n    return false;\n  }\n  return (\n    !storyboard ||\n    // Sometimes `storyboard.app.standaloneMode` is incorrect.\n    (getRuntime().getCurrentApp()?.id !== storyboard.app.id &&\n      !window.STANDALONE_MICRO_APPS &&\n      storyboard.app.standaloneMode)\n  );\n}\n","import { History, Location, createBrowserHistory } from \"history\";\nimport { getBasePath } from \"./getBasePath.js\";\nimport {\n  type ExtendedHistory,\n  getUserConfirmation,\n  historyExtended,\n  NextHistoryState,\n} from \"./internal/historyExtended.js\";\n\nexport type NextHistory = History<NextHistoryState> & ExtendedHistory;\n\nlet history: NextHistory;\n\nexport function createHistory(): NextHistory {\n  if (!history) {\n    // https://github.com/remix-run/history/issues/810\n    const browserHistory = createBrowserHistory<NextHistoryState>({\n      basename: getBasePath().replace(/\\/$/, \"\"),\n      getUserConfirmation,\n    });\n    Object.assign(browserHistory, historyExtended(browserHistory));\n    history = browserHistory as NextHistory;\n  }\n  return history;\n}\n\nexport function getHistory(): NextHistory {\n  return history;\n}\n\nexport type NextLocation = Location<NextHistoryState>;\n\nexport type { NextHistoryState };\n","import {\n  History,\n  LocationDescriptor,\n  LocationDescriptorObject,\n  parsePath,\n} from \"history\";\nimport { getBasePath } from \"../getBasePath.js\";\nimport { _internalApiMatchStoryboard } from \"./Runtime.js\";\nimport { isOutsideApp } from \"./matchStoryboard.js\";\n\nlet blocked = false;\nexport function getUserConfirmation(\n  message: string,\n  callback: (result: boolean) => void\n): void {\n  blocked = !confirm(message);\n  callback(!blocked);\n}\n\nexport function historyExtended(\n  browserHistory: History<NextHistoryState>\n): ExtendedHistory {\n  const { push: originalPush, replace: originalReplace } = browserHistory;\n\n  function push(\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    blocked = false;\n    originalPush(location, state);\n    callback?.(blocked);\n  }\n\n  function replace(\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    blocked = false;\n    originalReplace(location, state);\n    callback?.(blocked);\n  }\n\n  function updateQueryFactory(method: \"push\" | \"replace\"): UpdateQueryFunction {\n    return function updateQuery(query, options = {}, callback?): void {\n      const { extraQuery, clear, keepHash, ...state } = options;\n      const urlSearchParams = new URLSearchParams(\n        clear ? \"\" : browserHistory.location.search\n      );\n      const params: Record<string, string | string[]> = {};\n      Object.assign(params, query, extraQuery);\n      for (const [key, value] of Object.entries(params)) {\n        if (Array.isArray(value)) {\n          urlSearchParams.delete(key);\n          for (const item of value) {\n            urlSearchParams.append(key, item);\n          }\n        } else if (value === undefined || value === null || value === \"\") {\n          urlSearchParams.delete(key);\n        } else {\n          urlSearchParams.set(key, value);\n        }\n      }\n      (method === \"push\" ? push : replace)(\n        `?${urlSearchParams.toString()}${\n          keepHash ? browserHistory.location.hash : \"\"\n        }`,\n        state,\n        callback\n      );\n    };\n  }\n\n  function pushAnchor(\n    hash: string,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    push(\n      {\n        ...browserHistory.location,\n        key: undefined,\n        hash,\n        state: {\n          // The default notify is false\n          notify: false,\n          ...state,\n        },\n      },\n      undefined,\n      callback\n    );\n  }\n\n  function reload(callback?: (blocked: boolean) => void): void {\n    replace(\n      {\n        ...browserHistory.location,\n        state: {\n          ...browserHistory.location.state,\n          // Always notify\n          notify: true,\n        },\n      },\n      undefined,\n      callback\n    );\n  }\n\n  let blockMessage: string | undefined;\n\n  function setBlockMessage(message: string | undefined): void {\n    blockMessage = message;\n  }\n\n  function getBlockMessage(): string | undefined {\n    return blockMessage;\n  }\n\n  function unblock(): void {\n    blockMessage = undefined;\n  }\n\n  return {\n    pushQuery: updateQueryFactory(\"push\"),\n    replaceQuery: updateQueryFactory(\"replace\"),\n    pushAnchor: pushAnchor,\n    reload,\n    setBlockMessage,\n    getBlockMessage,\n    unblock,\n    ...historyOverridden({ ...browserHistory, push, replace }),\n  };\n}\n\n/**\n * Override history for standalone micro apps.\n *\n * when `push` or `replace` to other apps, force page refresh.\n */\nfunction historyOverridden(\n  browserHistory: History<NextHistoryState> &\n    Pick<ExtendedHistory, \"push\" | \"replace\">\n): Pick<ExtendedHistory, \"push\" | \"replace\"> {\n  const { push: originalPush, replace: originalReplace } = browserHistory;\n  function updateFactory(method: \"push\" | \"replace\"): ExtendedHistory[\"push\"] {\n    return function update(path, state?, callback?) {\n      let pathname: string | undefined;\n      const pathIsString = typeof path === \"string\";\n      if (pathIsString) {\n        pathname = parsePath(path).pathname;\n      } else {\n        pathname = path.pathname;\n      }\n\n      // When history.push or history.replace is performing with an absolute pathname,\n      // force load the target page when it is a page of an outside app.\n      if (\n        typeof pathname === \"string\" &&\n        pathname.startsWith(\"/\") &&\n        isOutsideApp(_internalApiMatchStoryboard(pathname))\n      ) {\n        // Going to outside apps.\n        return location[method === \"push\" ? \"assign\" : \"replace\"](\n          pathIsString\n            ? getBasePath() + path.substring(1)\n            : browserHistory.createHref(\n                path as LocationDescriptorObject<NextHistoryState>\n              )\n        );\n      }\n\n      return (method === \"push\" ? originalPush : originalReplace)(\n        path as string,\n        state,\n        callback\n      );\n    };\n  }\n  return {\n    push: updateFactory(\"push\"),\n    replace: updateFactory(\"replace\"),\n  };\n}\n\nexport interface NextHistoryState {\n  notify?: boolean;\n  from?: LocationDescriptor<NextHistoryState>;\n}\n\n/**\n * 扩展的系统会话对象。\n */\nexport interface ExtendedHistory {\n  /**\n   * 更新指定的 query 参数，会保留当前其它 query 参数，往浏览器会话历史栈中推入一条新记录。\n   */\n  pushQuery: UpdateQueryFunction;\n\n  /**\n   * 更新指定的 query 参数，会保留当前其它 query 参数，替换浏览器会话历史栈中最新的一条记录。\n   */\n  replaceQuery: UpdateQueryFunction;\n\n  /** {@inheritDoc UpdateAnchorFunction} */\n  pushAnchor: UpdateAnchorFunction;\n\n  /** 重载当前会话，即触发页面重新渲染。与 location.reload() 不同，它不会触发浏览器页面的重载。 */\n  reload: (callback?: (blocked: boolean) => void) => void;\n\n  /** @internal */\n  setBlockMessage: (message: string | undefined) => void;\n\n  /** @internal */\n  getBlockMessage: () => string | undefined;\n\n  /** 取消之前设置的阻止页面离开信息的设置。 */\n  unblock: () => void;\n\n  /** 推入一条记录。*/\n  push: (\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ) => void;\n\n  /** 替换一条记录。*/\n  replace: (\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ) => void;\n}\n\n/**\n * 更新指定的 query 参数。\n *\n * @param query - 要更新的 query 参数。\n * @param options - 选项。\n */\nexport type UpdateQueryFunction = (\n  query: Record<string, unknown>,\n  options?: UpdateQueryOptions,\n  callback?: (blocked: boolean) => void\n) => void;\n\n/** 更新 query 参数时的选项 */\nexport interface UpdateQueryOptions extends NextHistoryState {\n  /** 额外要更新的 query 参数。 */\n  extraQuery?: Record<string, unknown>;\n  /** 是否同时清除当前的所有其它 query 参数。 */\n  clear?: boolean;\n  /** 是否保留当前 hash 参数。 */\n  keepHash?: boolean;\n}\n\n/**\n * 设置指定的 anchor （URL hash）地址，此方法默认不会触发页面重新渲染。\n * 往浏览器会话历史栈中推入一条新记录。\n *\n * @param hash - Hash 地址。\n * @param state - 会话状态设置。\n */\nexport type UpdateAnchorFunction = (\n  hash: string,\n  state?: NextHistoryState,\n  callback?: (blocked: boolean) => void\n) => void;\n","import type {\n  RuntimeStoryboard,\n  BootstrapSettings,\n  FeatureFlags,\n  BootstrapData,\n} from \"@next-core/types\";\nimport { i18n, initializeI18n } from \"@next-core/i18n\";\nimport { loadBricksImperatively } from \"@next-core/loader\";\nimport { deepFreeze, isObject } from \"@next-core/utils/general\";\nimport moment from \"moment\";\nimport \"moment/locale/zh-cn.js\";\nimport { createHistory } from \"../history.js\";\nimport { matchStoryboard } from \"./matchStoryboard.js\";\nimport { Router } from \"./Router.js\";\nimport { NS, locales } from \"./i18n.js\";\nimport { loadNotificationService } from \"../Notification.js\";\nimport { loadDialogService } from \"../Dialog.js\";\nimport { injectedBrickPackages } from \"./injected.js\";\n\nlet runtime: Runtime;\n\n// Allow inject bootstrap data in a runtime other than Brick Next.\nlet bootstrapData: BootstrapData | undefined;\nlet router: Router | undefined;\n\nexport interface RuntimeOptions {\n  hooks?: RuntimeHooks;\n}\n\nexport interface RuntimeHooks {\n  fulfilStoryboard?: (storyboard: RuntimeStoryboard) => Promise<void>;\n}\n\nexport let hooks: RuntimeHooks | undefined;\n\nexport function createRuntime(options?: RuntimeOptions) {\n  if (runtime) {\n    throw new Error(\"Cannot create multiple runtimes\");\n  }\n  hooks = options?.hooks;\n  initializeI18n(NS, locales);\n  moment.locale(i18n.language);\n  i18n.on(\"languageChanged\", () => {\n    moment.locale(i18n.language);\n  });\n  createHistory();\n  runtime = new Runtime();\n  return runtime;\n}\n\nexport function getRuntime() {\n  return runtime;\n}\n\nexport class Runtime {\n  #initialized = false;\n  #bootstrapped = false;\n\n  initialize(data: BootstrapData) {\n    if (this.#initialized) {\n      throw new Error(\"The runtime cannot be initialized more than once\");\n    }\n    this.#initialized = true;\n    normalizeBootstrapData(data);\n    bootstrapData = data;\n    // Todo: allow configuration of notification bricks.\n    loadNotificationService(\"shoelace.show-notification\", this.loadBricks);\n    loadDialogService(\"shoelace.show-dialog\", this.loadBricks);\n  }\n\n  async bootstrap(data?: BootstrapData) {\n    if (data) {\n      this.initialize(data);\n    }\n    if (this.#bootstrapped) {\n      throw new Error(\"The runtime cannot be bootstrapped more than once\");\n    }\n    this.#bootstrapped = true;\n    router = new Router(bootstrapData!.storyboards!);\n    await router.bootstrap();\n  }\n\n  getRecentApps() {\n    return router?.getRecentApps() ?? {};\n  }\n\n  getCurrentApp() {\n    return router?.getRecentApps().currentApp;\n  }\n\n  getFeatureFlags(): FeatureFlags {\n    return {\n      ...bootstrapData?.settings?.featureFlags,\n      ...(\n        router?.getRecentApps().currentApp?.config\n          ?.settings as BootstrapSettings\n      )?.featureFlags,\n      \"migrate-to-brick-next-v3\": true,\n    };\n  }\n\n  getMiscSettings() {\n    return {\n      ...bootstrapData?.settings?.misc,\n      ...(\n        router?.getRecentApps().currentApp?.config\n          ?.settings as BootstrapSettings\n      )?.misc,\n    };\n  }\n\n  getBrandSettings(): Record<string, string> {\n    return {\n      base_title: \"DevOps 管理专家\",\n      ...(bootstrapData?.settings?.brand as Record<string, string>),\n      // ...(kernel.getOriginFaviconHref()\n      //   ? { favicon: kernel.getOriginFaviconHref() }\n      //   : {})\n    };\n  }\n\n  getLaunchpadSettings() {\n    return {\n      columns: 7,\n      rows: 4,\n      ...bootstrapData?.settings?.launchpad,\n    };\n  }\n\n  getDesktops(): unknown[] {\n    return bootstrapData?.desktops ?? [];\n  }\n\n  getLaunchpadSiteMap(): unknown[] {\n    return bootstrapData?.siteSort ?? [];\n  }\n\n  toggleLaunchpadEffect(open: boolean): void {\n    document.body.classList.toggle(\"launchpad-open\", open);\n  }\n\n  applyPageTitle(pageTitle: string): void {\n    const baseTitle = this.getBrandSettings().base_title;\n    document.title = pageTitle ? `${pageTitle} - ${baseTitle}` : baseTitle;\n  }\n\n  getNavConfig() {\n    return router?.getNavConfig();\n  }\n\n  loadBricks(bricks: string[] | Set<string>) {\n    return loadBricksImperatively(bricks, getBrickPackages());\n  }\n}\n\nfunction normalizeBootstrapData(data: BootstrapData) {\n  if (Array.isArray(data.storyboards)) {\n    for (const { app } of data.storyboards) {\n      if (app.locales) {\n        // Prefix to avoid conflict between brick package's i18n namespace.\n        const ns = `tmp/${app.id}`;\n        // Support any languages in `app.locales`.\n        Object.entries(app.locales).forEach(([lang, resources]) => {\n          i18n.addResourceBundle(lang, ns, resources);\n        });\n        // Use `app.name` as the fallback `app.localeName`.\n        app.localeName = i18n.getFixedT(null, ns)(\"name\", app.name) as string;\n        // Remove the temporary i18n resource bundles.\n        Object.keys(app.locales).forEach((lang) => {\n          i18n.removeResourceBundle(lang, ns);\n        });\n      } else {\n        app.localeName = app.name;\n      }\n    }\n  }\n  if (isObject(data.settings)) {\n    deepFreeze(data.settings);\n  }\n  if (data.brickPackages) {\n    deepFreeze(data.brickPackages);\n  }\n}\n\nexport function getBrickPackages() {\n  return bootstrapData?.brickPackages ?? injectedBrickPackages;\n}\n\nexport function _internalApiLoadBricks(bricks: string[] | Set<string>) {\n  return loadBricksImperatively(bricks, getBrickPackages());\n}\n\nexport function _internalApiGetRenderId(): string | undefined {\n  return router?.getRenderId();\n}\n\nexport function _internalApiMatchStoryboard(\n  pathname: string\n): RuntimeStoryboard | undefined {\n  return matchStoryboard(bootstrapData?.storyboards ?? [], pathname);\n}\n\nexport function _internalApiGetRuntimeContext() {\n  return router?.getRuntimeContext();\n}\n\nexport function _internalApiGetStoryboardInBootstrapData(appId: string) {\n  return bootstrapData?.storyboards?.find(\n    (storyboard) => storyboard.app.id === appId\n  );\n}\n\nexport function _internalApiGetAppInBootstrapData(appId: string) {\n  return _internalApiGetStoryboardInBootstrapData(appId)?.app;\n}\n\nexport let _test_only_setBootstrapData: (data: BootstrapData) => void;\n\nif (process.env.NODE_ENV === \"test\") {\n  _test_only_setBootstrapData = (data) => {\n    bootstrapData = data as BootstrapData;\n  };\n}\n","import { Contract } from \"@next-core/types\";\n\nconst contractsMap: Map<string, Contract> = new Map();\nconst widgetContractMap: Map<string, Contract> = new Map();\n\nconst addContract = (\n  contracts: Contract[] | undefined,\n  map: Map<string, Contract>\n): void => {\n  contracts?.forEach((contract) => {\n    map.set(`${contract.namespaceId}.${contract.name}`, contract);\n  });\n};\n\nexport function collectContract(contracts: Contract[] | undefined): void {\n  addContract(contracts, contractsMap);\n}\n\nexport function collectWidgetContract(contracts: Contract[] | undefined): void {\n  addContract(contracts, widgetContractMap);\n}\n\nexport function clearCollectWidgetContract(): void {\n  widgetContractMap.clear();\n}\n\nexport function getContract(name: string): Contract | undefined {\n  return contractsMap.get(name) || widgetContractMap.get(name);\n}\n","import yaml from \"js-yaml\";\nimport { ContractApi_searchSingleContract } from \"@next-api-sdk/api-gateway-sdk\";\nimport { ContractRequest, ContractResponse, ExtField } from \"@next-core/types\";\nimport { getContract } from \"./CollectContracts.js\";\n\nconst flowApiDefinitionPromiseMap = new Map<\n  string,\n  Promise<CustomApiDefinition | undefined>\n>();\n\n// Legacy Custom API: `${namespace}@${name}`\n// Flow API: `${namespace}@${name}:${version}`\nexport function isFlowApiProvider(provider: string): boolean {\n  return provider.includes(\"@\");\n}\n\nexport async function getArgsOfFlowApi(\n  provider: string,\n  originalArgs: unknown[],\n  method?: string\n): Promise<unknown[]> {\n  if (!isFlowApiProvider(provider)) {\n    return originalArgs;\n  }\n\n  if (!provider.includes(\":\")) {\n    throw new Error(\n      `You're using legacy Custom API \"${provider}\" which is dropped in v3, please use Flow API instead`\n    );\n  }\n\n  const apiDefinition = await fetchFlowApiDefinition(provider);\n\n  if (!apiDefinition) {\n    throw new Error(`Flow API not found: \"${provider}\"`);\n  }\n\n  const apiProfile = getApiProfileFromApiDefinition(provider, apiDefinition);\n\n  return getApiArgsFromApiProfile(apiProfile, originalArgs, method);\n}\n\nfunction getApiArgsFromApiProfile(\n  {\n    uri,\n    method: apiMethod,\n    ext_fields,\n    name,\n    namespace,\n    serviceName,\n    responseWrapper,\n    version,\n    isFileType,\n    request,\n  }: CustomApiProfile,\n  originalArgs: unknown[],\n  method?: string\n): unknown[] {\n  const isDownload = isFileType && method === \"saveAs\";\n  let fileName: string | undefined;\n  if (isDownload) {\n    fileName = originalArgs.shift() as string;\n  }\n\n  const { url, args } = getTransformedUriAndRestArgs(\n    uri,\n    originalArgs,\n    name,\n    namespace,\n    serviceName,\n    version\n  );\n\n  return [\n    ...(isDownload ? [fileName] : []),\n    {\n      url,\n      originalUri: uri,\n      method: apiMethod,\n      ext_fields,\n      responseWrapper,\n      request,\n      isFileType,\n    },\n    ...args,\n  ];\n}\n\nfunction getTransformedUriAndRestArgs(\n  uri: string,\n  originalArgs: unknown[],\n  name: string,\n  namespace: string,\n  serviceName: string | undefined,\n  version?: string\n): { url: string; args: unknown[] } {\n  const prefix = version\n    ? serviceName\n      ? `api/gateway/${serviceName}`\n      : `api/gateway/${namespace}.${name}@${version}`\n    : `api/gateway/api_service.${namespace}.${name}`;\n  const restArgs = originalArgs.slice();\n  const transformedUri = uri.replace(\n    /:([^/]+)/g,\n    () => restArgs.shift() as string\n  );\n  return {\n    url: prefix + transformedUri,\n    args: restArgs,\n  };\n}\n\nfunction getApiProfileFromApiDefinition(\n  provider: string,\n  api: CustomApiDefinition\n): CustomApiProfile {\n  const contract: CustomApiDefinition[\"contract\"] =\n    typeof api.contract === \"string\"\n      ? (yaml.safeLoad(api.contract, {\n          schema: yaml.JSON_SCHEMA,\n          json: true,\n        }) as CustomApiDefinition[\"contract\"])\n      : api.contract;\n  const { uri, method = \"GET\", ext_fields } = contract?.endpoint ?? {};\n  const responseWrapper = contract?.response\n    ? contract.response.wrapper !== false\n    : false;\n  if (!uri) {\n    throw new Error(\n      `Missing endpoint.uri in contract of provider \"${provider}\"`\n    );\n  }\n  return {\n    uri,\n    method: method.toLowerCase() === \"list\" ? \"get\" : method,\n    ext_fields,\n    name: api.name,\n    namespace: api.namespace,\n    serviceName: api.serviceName,\n    version: api.version,\n    isFileType: contract?.response?.type === \"file\",\n    responseWrapper,\n    request: contract?.request,\n  };\n}\n\nfunction fetchFlowApiDefinition(\n  provider: string\n): Promise<CustomApiDefinition | undefined> {\n  let promise = flowApiDefinitionPromiseMap.get(provider);\n  if (!promise) {\n    promise = _fetchFlowApiDefinition(provider);\n    flowApiDefinitionPromiseMap.set(provider, promise);\n  }\n  return promise;\n}\n\nasync function _fetchFlowApiDefinition(\n  provider: string\n): Promise<CustomApiDefinition | undefined> {\n  const [namespaceName, nameWithVersion] = provider.split(\"@\");\n  const [name, version] = nameWithVersion.split(\":\");\n\n  const contract = getContract(`${namespaceName}.${name}`);\n  if (contract) {\n    return {\n      name: contract.name,\n      namespace: contract.namespaceId,\n      serviceName: contract.serviceName,\n      version: contract.version,\n      contract: {\n        endpoint: contract.endpoint,\n        response: contract.response,\n        request: contract.request,\n      },\n    };\n  } else {\n    const { contractData } = await ContractApi_searchSingleContract({\n      contractName: `${namespaceName}.${name}`,\n      version,\n    });\n\n    // return undefined if don't found contract\n    if (contractData) {\n      return {\n        name: contractData.name,\n        namespace: contractData.namespace?.[0]?.name,\n        serviceName: contractData.serviceName,\n        version: contractData.version,\n        contract: {\n          endpoint: contractData.endpoint,\n          response: contractData.response,\n          request: contractData.request,\n        },\n      };\n    }\n  }\n}\n\nexport interface CustomApiDefinition {\n  name: string;\n  namespace: string;\n  version?: string;\n  serviceName?: string;\n  contract?: {\n    endpoint: {\n      ext_fields?: ExtField[];\n      uri: string;\n      method:\n        | \"POST\"\n        | \"post\"\n        | \"PUT\"\n        | \"put\"\n        | \"GET\"\n        | \"get\"\n        | \"DELETE\"\n        | \"delete\"\n        | \"LIST\"\n        | \"list\"\n        | \"PATCH\"\n        | \"patch\"\n        | \"HEAD\"\n        | \"head\";\n    };\n    request?: ContractRequest;\n    response?: ContractResponse;\n  };\n}\n\nexport interface CustomApiProfile {\n  uri: string;\n  method: string;\n  name: string;\n  namespace: string;\n  serviceName?: string;\n  responseWrapper: boolean;\n  version?: string;\n  isFileType?: boolean;\n  ext_fields?: ExtField[];\n  request?: ContractRequest;\n}\n","import { createProviderClass } from \"@next-core/utils/general\";\nimport {\n  ExtField,\n  ContractRequest,\n  ContractField,\n  ContractFieldItem,\n} from \"@next-core/types\";\nimport { http, HttpOptions, HttpParams } from \"@next-core/http\";\nimport { isEmpty, isObject } from \"lodash\";\n\nexport const FLOW_API_PROVIDER = \"core.provider-flow-api\";\n\nexport interface CustomApiParams {\n  url: string;\n  originalUri?: string;\n  method?: string;\n  responseWrapper?: boolean;\n  ext_fields?: ExtField[];\n  request?: ContractRequest;\n  isFileType?: boolean;\n}\nfunction hasFields(ext_fields: ExtField[], type: \"query\" | \"body\"): boolean {\n  return ext_fields.some((item) => item.source === type);\n}\n\nexport function processExtFields(\n  ext_fields: ExtField[],\n  ...args: unknown[]\n): { data: unknown; options: HttpOptions } {\n  const hasQueryParams = hasFields(ext_fields, \"query\");\n  const hasBodyParams = hasFields(ext_fields, \"body\");\n\n  if (hasQueryParams) {\n    if (hasBodyParams) {\n      const [data, params, options] = args;\n      return {\n        data: data,\n        options: {\n          params: params as HttpParams,\n          ...(options as HttpOptions),\n        },\n      };\n    }\n\n    const [params, options] = args;\n    return {\n      data: {},\n      options: {\n        params: params as HttpParams,\n        ...(options as HttpOptions),\n      },\n    };\n  }\n\n  // only hasBodyParams or default\n  const [data, options] = args;\n  return {\n    data,\n    options: options as HttpOptions,\n  };\n}\n\nexport function hasFileType(request: ContractRequest | undefined): boolean {\n  if (!request || request.type !== \"object\") {\n    return false;\n  }\n\n  const processFields = (fields: ContractField[] | undefined): boolean => {\n    return (\n      !isEmpty(fields) &&\n      fields!.some(\n        (field) =>\n          [\"file\", \"file[]\"].includes((field as ContractFieldItem).type) ||\n          processFields((field as ContractFieldItem).fields)\n      )\n    );\n  };\n\n  return processFields(request.fields);\n}\n\nexport function transformFormData(\n  data: Record<string, unknown> | FormData\n): FormData {\n  if (data instanceof FormData) {\n    return data;\n  }\n\n  const formData = new FormData();\n  for (const [key, value] of Object.entries(data)) {\n    if (Array.isArray(value)) {\n      value.forEach((v) => {\n        formData.append(key, v);\n      });\n    } else if (\n      isObject(value) &&\n      !(value instanceof Blob) &&\n      !(value instanceof Date)\n    ) {\n      Object.entries(value).forEach(([k, v]) => {\n        formData.append(`${key}[${k}]`, v);\n      });\n    } else {\n      formData.append(key, value as string);\n    }\n  }\n\n  return formData;\n}\n\nexport async function callFlowApi(\n  {\n    url,\n    originalUri,\n    method = \"GET\",\n    responseWrapper = true,\n    ext_fields = [],\n    request,\n    isFileType,\n  }: CustomApiParams,\n  ...args: unknown[]\n): Promise<unknown> {\n  const isSimpleRequest = [\"get\", \"delete\", \"head\"].includes(\n    method.toLowerCase()\n  );\n  const defaultOptions: HttpOptions = isFileType\n    ? { responseType: \"blob\" }\n    : {};\n  let response: { data?: unknown };\n\n  if (isSimpleRequest) {\n    const noParams =\n      originalUri && request?.type === \"object\"\n        ? (originalUri.match(/:([^/]+)/g)?.length ?? 0) ===\n          (request.fields?.length ?? 0)\n        : false;\n    let params: HttpParams | undefined;\n    let options: HttpOptions | undefined;\n\n    if (noParams) {\n      [options] = args as [HttpOptions?];\n    } else {\n      [params, options] = args as [HttpParams?, HttpOptions?];\n    }\n\n    response = await http.simpleRequest(method, url, {\n      params,\n      ...defaultOptions,\n      ...(options as HttpOptions),\n    });\n  } else {\n    const isUploadType = hasFileType(request);\n    const result = processExtFields(ext_fields, ...args);\n\n    response = await http.requestWithBody(\n      method,\n      url,\n      isUploadType ? transformFormData(result.data as any) : result.data,\n      { ...defaultOptions, ...result.options }\n    );\n  }\n\n  return (isFileType ? false : responseWrapper) ? response.data : response;\n}\n\nexport function registerFlowApiProvider(): void {\n  customElements.define(FLOW_API_PROVIDER, createProviderClass(callFlowApi));\n}\n","import { loadBricksImperatively } from \"@next-core/loader\";\nimport { isFlowApiProvider } from \"./FlowApi.js\";\nimport {\n  FLOW_API_PROVIDER,\n  registerFlowApiProvider,\n} from \"./FlowApiProvider.js\";\nimport { getBrickPackages } from \"../Runtime.js\";\n\nconst pool = new Map<string, HTMLElement>();\nexport async function getProviderBrick(provider: string): Promise<HTMLElement> {\n  if (isFlowApiProvider(provider)) {\n    provider = FLOW_API_PROVIDER;\n  }\n\n  let brick = pool.get(provider);\n  if (brick) {\n    return brick;\n  }\n\n  if (provider.includes(\"-\") && !customElements.get(provider)) {\n    if (provider === FLOW_API_PROVIDER) {\n      registerFlowApiProvider();\n    } else {\n      await loadBricksImperatively([provider], getBrickPackages());\n\n      if (!customElements.get(provider)) {\n        throw new Error(`Provider not defined: \"${provider}\".`);\n      }\n    }\n  }\n\n  brick = document.createElement(provider);\n  pool.set(provider, brick);\n  return brick;\n}\n","import type {\n  HandleReject,\n  HandleRejectByTransform,\n  ResolveConf,\n} from \"@next-core/types\";\nimport { asyncComputeRealValue } from \"../compute/computeRealValue.js\";\nimport { getProviderBrick } from \"./getProviderBrick.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { getArgsOfFlowApi } from \"./FlowApi.js\";\n\nconst cache = new Map<string, Promise<unknown>>();\n\nexport interface ResolveOptions {\n  /**\n   * Cache mode of resolve.\n   *\n   * See https://developer.mozilla.org/en-US/docs/Web/API/Request/cache\n   *\n   * - `default`: Looks for a matching cache.\n   * - `reload`: Without looking for a matching cache.\n   */\n  cache?: \"default\" | \"reload\";\n}\n\nexport async function resolveData(\n  resolveConf: ResolveConf,\n  runtimeContext: RuntimeContext,\n  options?: ResolveOptions\n) {\n  const { useProvider, method = \"resolve\", args = [], onReject } = resolveConf;\n\n  const legacyProvider = (resolveConf as { provider?: string }).provider;\n  if (legacyProvider && !useProvider) {\n    throw new Error(\n      `You're using \"provider: ${legacyProvider}\" which is dropped in v3, please use \"useProvider\" instead`\n    );\n  }\n\n  const [providerBrick, actualArgs] = await Promise.all([\n    getProviderBrick(useProvider) as unknown as Promise<\n      Record<string, Function>\n    >,\n    asyncComputeRealValue(args, runtimeContext) as Promise<unknown[]>,\n  ]);\n\n  const promise = resolveByProvider(\n    providerBrick,\n    useProvider,\n    method,\n    actualArgs,\n    options,\n    args\n  );\n\n  let { transform } = resolveConf;\n  let data: unknown;\n\n  try {\n    data = await promise;\n    // The fetched data and its inner objects should never be *injected* again.\n    // recursiveMarkAsInjected(data);\n  } catch (error) {\n    if (isHandleRejectByTransform(onReject)) {\n      transform = onReject.transform;\n      data = error;\n    } else {\n      throw error;\n    }\n  }\n\n  if (!transform) {\n    return data;\n  }\n\n  // Keep backward compatibility of string transform.\n  if (typeof transform === \"string\") {\n    return { [transform]: data };\n  }\n\n  return asyncComputeRealValue(transform, { ...runtimeContext, data });\n}\n\nexport function clearResolveCache() {\n  cache.clear();\n}\n\nexport async function resolveByProvider(\n  brick: Record<string, Function>,\n  useProvider: string,\n  method: string,\n  args: unknown[],\n  options?: ResolveOptions,\n  originalArgs?: unknown[]\n) {\n  let cacheKey: string;\n  try {\n    // `args` may contain circular references, which makes\n    // JSON stringify failed, thus we fallback to original args.\n    cacheKey = JSON.stringify({\n      useProvider,\n      method,\n      args,\n    });\n  } catch (e) {\n    if (!originalArgs) {\n      throw e;\n    }\n    cacheKey = JSON.stringify({\n      useProvider,\n      method,\n      originalArgs,\n    });\n  }\n\n  let promise: Promise<unknown> | undefined;\n  if (options?.cache !== \"reload\") {\n    promise = cache.get(cacheKey);\n  }\n  if (!promise) {\n    promise = (async () => {\n      const finalArgs = await getArgsOfFlowApi(useProvider, args, method);\n      return brick.resolve(...finalArgs);\n    })();\n\n    cache.set(cacheKey, promise);\n  }\n\n  return promise;\n}\n\nfunction isHandleRejectByTransform(\n  onReject: HandleReject | undefined\n): onReject is HandleRejectByTransform {\n  return !!(onReject as HandleRejectByTransform)?.transform;\n}\n","import { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport type { BrickConf, ResolveConf } from \"@next-core/types\";\nimport { asyncComputeRealValue, computeRealValue } from \"./computeRealValue.js\";\nimport { isPreEvaluated } from \"./evaluate.js\";\nimport { resolveData } from \"../data/resolveData.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\n\n/**\n * 包含 `if` 条件判断的对象。\n */\nexport interface IfContainer {\n  /**\n   * 条件判断，可以为表达式字符串。\n   *\n   * @example\n   *\n   * ```yaml\n   * - brick: your.any-brick\n   *   if: '<% FLAGS[\"your-feature-flag\"] %>'\n   * ```\n   */\n  if?: unknown;\n}\n\nexport async function asyncCheckIf(\n  ifContainer: IfContainer,\n  runtimeContext: RuntimeContext\n): Promise<boolean> {\n  return (\n    !hasOwnProperty(ifContainer, \"if\") ||\n    !!(typeof ifContainer.if === \"string\" || isPreEvaluated(ifContainer.if)\n      ? await asyncComputeRealValue(ifContainer.if, runtimeContext)\n      : ifContainer.if)\n  );\n}\n\nexport function checkIf(\n  ifContainer: IfContainer,\n  runtimeContext: RuntimeContext\n): boolean {\n  return (\n    !hasOwnProperty(ifContainer, \"if\") ||\n    !!(typeof ifContainer.if === \"string\" || isPreEvaluated(ifContainer.if)\n      ? computeRealValue(ifContainer.if, runtimeContext)\n      : ifContainer.if)\n  );\n}\n\nexport function checkIfOfComputed(ifContainer: IfContainer): boolean {\n  return !hasOwnProperty(ifContainer, \"if\") || !!ifContainer.if;\n}\n\nexport async function asyncCheckBrickIf(\n  brickConf: BrickConf,\n  runtimeContext: RuntimeContext\n): Promise<boolean> {\n  if (isObject(brickConf.if) && !isPreEvaluated(brickConf.if)) {\n    const resolved = (await resolveData(\n      brickConf.if as ResolveConf,\n      runtimeContext\n    )) as { if?: unknown };\n    return checkIfOfComputed(resolved);\n  }\n  return asyncCheckIf(brickConf, runtimeContext);\n}\n\nexport function checkIfByTransform(ifContainer: IfContainer, data: unknown) {\n  return checkIf(ifContainer, { data } as RuntimeContext);\n}\n","export enum StateOfUseBrick {\n  INITIAL,\n  USE_BRICK,\n  USE_BRICK_ITEM,\n  USE_BRICK_PROPERTIES,\n  // Compatible mode\n  USE_BRICK_TRANSFORM,\n  USE_BRICK_EVENTS,\n  USE_BRICK_IF,\n  USE_BRICK_SLOTS,\n  USE_BRICK_SLOTS_ITEM,\n  USE_BRICK_SLOTS_ITEM_BRICKS,\n  USE_BRICK_SLOTS_ITEM_BRICKS_ITEM,\n  USE_BRICK_LIFECYCLE,\n  USE_BRICK_DATA_SOURCE,\n}\n\nexport function isLazyContentInUseBrick(\n  state: StateOfUseBrick | undefined\n): boolean {\n  switch (state) {\n    case StateOfUseBrick.USE_BRICK_PROPERTIES:\n    case StateOfUseBrick.USE_BRICK_TRANSFORM:\n    case StateOfUseBrick.USE_BRICK_EVENTS:\n    case StateOfUseBrick.USE_BRICK_IF:\n    case StateOfUseBrick.USE_BRICK_LIFECYCLE:\n    case StateOfUseBrick.USE_BRICK_DATA_SOURCE:\n      return true;\n  }\n  return false;\n}\n\nexport function getNextStateOfUseBrick(\n  state: StateOfUseBrick | undefined,\n  isArray?: boolean,\n  key?: string\n): StateOfUseBrick | undefined {\n  if (isLazyContentInUseBrick(state)) {\n    return state;\n  }\n  if (isArray) {\n    switch (state) {\n      case StateOfUseBrick.USE_BRICK:\n        return StateOfUseBrick.USE_BRICK_ITEM;\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS:\n        return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM;\n    }\n  } else {\n    switch (state) {\n      case StateOfUseBrick.INITIAL:\n        if (key === \"useBrick\") {\n          return StateOfUseBrick.USE_BRICK;\n        }\n        break;\n      case StateOfUseBrick.USE_BRICK:\n      case StateOfUseBrick.USE_BRICK_ITEM:\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM: {\n        switch (key) {\n          case \"properties\":\n            return StateOfUseBrick.USE_BRICK_PROPERTIES;\n          case \"transform\":\n            return StateOfUseBrick.USE_BRICK_TRANSFORM;\n          case \"dataSource\":\n            return StateOfUseBrick.USE_BRICK_DATA_SOURCE;\n          case \"events\":\n            return StateOfUseBrick.USE_BRICK_EVENTS;\n          case \"slots\":\n            return StateOfUseBrick.USE_BRICK_SLOTS;\n          case \"children\":\n            return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS;\n          case \"if\":\n            return StateOfUseBrick.USE_BRICK_IF;\n          case \"lifeCycle\":\n            return StateOfUseBrick.USE_BRICK_LIFECYCLE;\n        }\n        break;\n      }\n      case StateOfUseBrick.USE_BRICK_SLOTS:\n        return StateOfUseBrick.USE_BRICK_SLOTS_ITEM;\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM:\n        if (key === \"bricks\") {\n          return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS;\n        }\n        break;\n    }\n  }\n  return StateOfUseBrick.INITIAL;\n}\n","import { isEvaluable, isTrackAll } from \"@next-core/cook\";\nimport { track, trackAll } from \"@next-core/utils/storyboard\";\nimport {\n  PreEvaluated,\n  getPreEvaluatedRaw,\n  isPreEvaluated,\n} from \"./evaluate.js\";\n\nexport function getTracks(value: unknown) {\n  let contextNames: string[] | Set<string> | false = false;\n  let stateNames: string[] | Set<string> | false = false;\n  let formStateNames: string[] | Set<string> | false = false;\n  if (typeof value === \"string\" ? isEvaluable(value) : isPreEvaluated(value)) {\n    const raw =\n      typeof value === \"string\"\n        ? value\n        : getPreEvaluatedRaw(value as PreEvaluated);\n    if (isTrackAll(raw)) {\n      const result = trackAll(raw);\n      if (result) {\n        contextNames = result.context;\n        stateNames = result.state;\n        formStateNames = result.formState;\n      }\n    } else {\n      contextNames = track(raw, \"track context\", \"CTX\");\n      stateNames = track(raw, \"track state\", \"STATE\");\n      formStateNames = track(raw, \"track formstate\", \"FORM_STATE\");\n    }\n  }\n\n  return { contextNames, stateNames, formStateNames };\n}\n","import {\n  cook,\n  preevaluate,\n  PreevaluateResult,\n  shouldAllowRecursiveEvaluations,\n} from \"@next-core/cook\";\nimport { loadProcessorsImperatively } from \"@next-core/loader\";\nimport { supply } from \"@next-core/supply\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { strictCollectMemberUsage } from \"@next-core/utils/storyboard\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { cloneDeep, omit } from \"lodash\";\nimport { customProcessors } from \"../../CustomProcessors.js\";\nimport {\n  checkPermissionsUsage,\n  storyboardFunctions,\n} from \"./StoryboardFunctions.js\";\nimport { getGeneralGlobals } from \"./getGeneralGlobals.js\";\nimport {\n  getDynamicReadOnlyProxy,\n  getReadOnlyProxy,\n} from \"../proxyFactories.js\";\nimport { getDevHook } from \"../devtools.js\";\nimport { getMedia } from \"../mediaQuery.js\";\nimport { getStorageItem } from \"./getStorageItem.js\";\nimport { getBrickPackages, getRuntime } from \"../Runtime.js\";\nimport type { DataStore } from \"../data/DataStore.js\";\nimport { getTplStateStore } from \"../CustomTemplates/utils.js\";\nimport { widgetFunctions } from \"./WidgetFunctions.js\";\nimport {\n  collectAppGetMenuUsage,\n  collectInstalledAppsHasUsage,\n  MemberCallUsage,\n} from \"./collectMemberCallUsage.js\";\nimport { fetchMenuById, getMenuById } from \"../menu/fetchMenuById.js\";\nimport { widgetI18nFactory } from \"./WidgetI18n.js\";\nimport { widgetImagesFactory } from \"./images.js\";\nimport { hasInstalledApp, waitForCheckingApps } from \"../checkInstalledApps.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../../isStrictMode.js\";\nimport { getFormStateStore } from \"../FormRenderer/utils.js\";\n\nconst symbolForRaw = Symbol.for(\"pre.evaluated.raw\");\nconst symbolForContext = Symbol.for(\"pre.evaluated.context\");\n\nexport interface PreEvaluated {\n  [symbolForRaw]: string;\n  [symbolForContext]: RuntimeContext;\n}\n\nexport interface EvaluateOptions {\n  lazy?: boolean;\n  isReEvaluation?: boolean;\n  evaluationId?: number;\n}\n\nexport function isPreEvaluated(raw: unknown): raw is PreEvaluated {\n  return !!(raw as PreEvaluated)?.[symbolForRaw];\n}\n\nexport function getPreEvaluatedRaw(pre: PreEvaluated): string {\n  return pre[symbolForRaw];\n}\n\nexport function shouldDismissMarkingComputed(\n  raw: string | PreEvaluated\n): boolean {\n  if (typeof raw === \"string\") {\n    return shouldAllowRecursiveEvaluations(raw);\n  }\n  return shouldAllowRecursiveEvaluations(raw[symbolForRaw]);\n}\n\nconst possibleErrorConstructs = new WeakSet<ErrorConstructor>([\n  SyntaxError,\n  TypeError,\n  ReferenceError,\n]);\n\nexport function getCookErrorConstructor(error: any): ErrorConstructor {\n  return possibleErrorConstructs.has(error.constructor)\n    ? error.constructor\n    : TypeError;\n}\n\nexport async function asyncEvaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options?: EvaluateOptions\n): Promise<unknown> {\n  const { blockingList, run } = lowLevelEvaluate(\n    raw,\n    runtimeContext,\n    options,\n    true\n  );\n  await Promise.all(blockingList);\n  return run();\n}\n\nexport function evaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options?: EvaluateOptions\n): Promise<unknown> {\n  const { run } = lowLevelEvaluate(raw, runtimeContext, options, false);\n  return run();\n}\n\nfunction lowLevelEvaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options: EvaluateOptions = {},\n  isAsync?: boolean\n): {\n  blockingList: (Promise<unknown> | undefined)[];\n  run: Function;\n} {\n  const blockingList: (Promise<unknown> | undefined)[] = [];\n  if (typeof raw !== \"string\") {\n    // If the `raw` is not a string, it must be a pre-evaluated object.\n    // Then fulfil the context, and restore the original `raw`.\n\n    const passByRuntimeContext = omit(runtimeContext, [\n      \"pendingPermissionsPreCheck\",\n      \"tplStateStoreMap\",\n      \"tplStateStoreScope\",\n      \"formStateStoreMap\",\n      \"formStateStoreScope\",\n    ]);\n\n    runtimeContext = {\n      ...raw[symbolForContext],\n      ...passByRuntimeContext,\n    };\n    raw = raw[symbolForRaw];\n  }\n\n  // Collect `APP.getMenu(...)` usage before evaluating.\n  const menuUsage: MemberCallUsage = {\n    usedArgs: new Set(),\n  };\n  const hasAppUsage: MemberCallUsage = {\n    usedArgs: new Set(),\n  };\n\n  // A `SyntaxError` maybe thrown.\n  let precooked: PreevaluateResult;\n  try {\n    precooked = preevaluate(raw, {\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal(node, parent) {\n          collectAppGetMenuUsage(menuUsage, node, parent!);\n          collectInstalledAppsHasUsage(hasAppUsage, node, parent!);\n        },\n      },\n    });\n  } catch (error: any) {\n    const message = `${error.message}, in \"${raw}\"`;\n    // if (options.isReEvaluation) {\n    //   devtoolsHookEmit(\"re-evaluation\", {\n    //     id: options.evaluationId,\n    //     detail: { raw, context: {} },\n    //     error: message,\n    //   });\n    //   return;\n    // } else {\n    const errorConstructor = getCookErrorConstructor(error);\n    throw new errorConstructor(message);\n    // }\n  }\n\n  if (menuUsage.hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of \"APP.getMenu\" is prohibited in v3, check your expression: \"${raw}\"`\n    );\n  }\n\n  if (hasAppUsage.hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of \"INSTALLED_APPS.has\" is prohibited in v3, check your expression: \"${raw}\"`\n    );\n  }\n\n  const globalVariables: Record<string, unknown> = {};\n  const { attemptToVisitGlobals } = precooked;\n\n  // Ignore evaluating if required `event/DATA` is missing in\n  // context. Since they are are provided in different context, whenever\n  // missing one of them, memorize the current context for later consuming.\n  if (\n    options.lazy ||\n    (attemptToVisitGlobals.has(\"EVENT\") &&\n      !hasOwnProperty(runtimeContext, \"event\")) ||\n    (attemptToVisitGlobals.has(\"DATA\") &&\n      !hasOwnProperty(runtimeContext, \"data\"))\n  ) {\n    return {\n      blockingList,\n      run() {\n        return Object.keys(runtimeContext).length > 0\n          ? ({\n              [symbolForRaw]: raw,\n              [symbolForContext]: runtimeContext,\n            } as PreEvaluated)\n          : raw;\n      },\n    };\n  }\n\n  let usedCtx: Set<string>;\n  let usedProcessors: Set<string>;\n  let usedStates: Set<string>;\n  let tplStateStore: DataStore<\"STATE\"> | undefined;\n  const strict = isStrictMode(runtimeContext);\n\n  // For existed TPL usage, treat it as a STATE.\n  if (\n    attemptToVisitGlobals.has(\"STATE\") ||\n    (!strict && attemptToVisitGlobals.has(\"TPL\"))\n  ) {\n    tplStateStore = getTplStateStore(runtimeContext, \"STATE\", `: \"${raw}\"`);\n  }\n\n  let usedFormStates: Set<string>;\n  let formStateStore: DataStore<\"FORM_STATE\"> | undefined;\n  if (attemptToVisitGlobals.has(\"FORM_STATE\")) {\n    formStateStore = getFormStateStore(\n      runtimeContext,\n      \"FORM_STATE\",\n      `: \"${raw}\"`\n    );\n  }\n\n  const devHook = getDevHook();\n  if (isAsync || devHook) {\n    if (attemptToVisitGlobals.has(\"CTX\")) {\n      usedCtx = strictCollectMemberUsage(raw, \"CTX\");\n      isAsync && blockingList.push(runtimeContext.ctxStore.waitFor(usedCtx));\n    }\n\n    if (tplStateStore) {\n      usedStates = strictCollectMemberUsage(raw, \"STATE\");\n      // istanbul ignore if\n      if (!strict) {\n        const usedTpls = strictCollectMemberUsage(raw, \"TPL\");\n        for (const tpl of usedTpls) {\n          usedStates.add(tpl);\n        }\n      }\n      isAsync && blockingList.push(tplStateStore.waitFor(usedStates));\n    }\n\n    if (formStateStore) {\n      usedFormStates = strictCollectMemberUsage(raw, \"FORM_STATE\");\n      isAsync && blockingList.push(formStateStore.waitFor(usedFormStates));\n    }\n\n    if (attemptToVisitGlobals.has(\"PROCESSORS\")) {\n      usedProcessors = strictCollectMemberUsage(raw, \"PROCESSORS\", 2);\n      isAsync &&\n        blockingList.push(\n          loadProcessorsImperatively(usedProcessors, getBrickPackages())\n        );\n    }\n  }\n\n  if (isAsync) {\n    let attemptToCheckPermissions = attemptToVisitGlobals.has(\"PERMISSIONS\");\n    // There maybe `PERMISSIONS.check()` usage in functions\n    if (!attemptToCheckPermissions && attemptToVisitGlobals.has(\"FN\")) {\n      const usedFunctions = [...strictCollectMemberUsage(raw, \"FN\")];\n      attemptToCheckPermissions = checkPermissionsUsage(usedFunctions);\n    }\n\n    if (attemptToCheckPermissions) {\n      blockingList.push(...runtimeContext.pendingPermissionsPreCheck);\n    }\n\n    if (menuUsage.usedArgs.size > 0) {\n      // Block evaluating if has `APP.getMenu(...)` usage.\n      const usedMenuIds = [...menuUsage.usedArgs];\n      blockingList.push(\n        Promise.all(\n          usedMenuIds.map((menuId) => fetchMenuById(menuId, runtimeContext))\n        )\n      );\n    }\n\n    if (hasAppUsage.usedArgs.size > 0) {\n      // Only wait for specific apps\n      blockingList.push(waitForCheckingApps([...hasAppUsage.usedArgs]));\n    }\n  }\n\n  return {\n    blockingList,\n    run() {\n      const {\n        app: currentApp,\n        location,\n        query,\n        match,\n        flags,\n        sys,\n        ctxStore,\n        data,\n        event,\n      } = runtimeContext;\n      const app = runtimeContext.overrideApp ?? currentApp;\n\n      for (const variableName of attemptToVisitGlobals) {\n        switch (variableName) {\n          // case \"ALIAS\":\n          case \"ANCHOR\":\n            globalVariables[variableName] = location.hash\n              ? location.hash.substring(1)\n              : null;\n            break;\n          case \"APP\":\n            globalVariables[variableName] = {\n              ...cloneDeep(app),\n              getMenu: getMenuById,\n            };\n            break;\n          case \"CTX\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                return ctxStore.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedCtx);\n              },\n            });\n            break;\n          case \"DATA\":\n            globalVariables[variableName] = data;\n            break;\n          case \"EVENT\":\n            globalVariables[variableName] = event;\n            break;\n          case \"FLAGS\":\n            globalVariables[variableName] = getReadOnlyProxy(flags);\n            break;\n          case \"FORM_STATE\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                return formStateStore!.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedFormStates);\n              },\n            });\n            break;\n          case \"HASH\":\n            globalVariables[variableName] = location.hash;\n            break;\n          case \"INSTALLED_APPS\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              has: hasInstalledApp,\n            });\n            break;\n          case \"ITEM\":\n            if (!hasOwnProperty(runtimeContext, \"forEachItem\")) {\n              // eslint-disable-next-line no-console\n              console.error(\n                `Using \\`ITEM\\` but no \\`:forEach\\` is found, check your expression: \"${raw}\"`\n              );\n            } else {\n              globalVariables[variableName] = runtimeContext.forEachItem;\n            }\n            break;\n          case \"LOCAL_STORAGE\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              getItem: getStorageItem(\"local\"),\n            });\n            break;\n          case \"MEDIA\":\n            globalVariables[variableName] = getReadOnlyProxy(getMedia());\n            break;\n          case \"MISC\":\n            globalVariables[variableName] = getRuntime().getMiscSettings();\n            break;\n          case \"PARAMS\":\n            globalVariables[variableName] = new URLSearchParams(query);\n            break;\n          case \"PATH\":\n            globalVariables[variableName] = getReadOnlyProxy(\n              match?.params ?? {}\n            );\n            break;\n          case \"PATH_NAME\":\n            globalVariables[variableName] = location.pathname;\n            break;\n          case \"PROCESSORS\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                const pkg = customProcessors.get(key as string);\n                if (!pkg) {\n                  throw new Error(\n                    `'PROCESSORS.${\n                      key as string\n                    }' is not registered! Have you installed the relevant brick package?`\n                  );\n                }\n                return getDynamicReadOnlyProxy({\n                  get(t, k) {\n                    return pkg.get(k as string);\n                  },\n                  ownKeys() {\n                    return Array.from(pkg.keys());\n                  },\n                });\n              },\n              ownKeys() {\n                return Array.from(usedProcessors);\n              },\n            });\n            break;\n          case \"QUERY\":\n            globalVariables[variableName] = Object.fromEntries(\n              Array.from(query.keys()).map((key) => [key, query.get(key)])\n            );\n            break;\n          case \"QUERY_ARRAY\":\n            globalVariables[variableName] = Object.fromEntries(\n              Array.from(query.keys()).map((key) => [key, query.getAll(key)])\n            );\n            // case \"SEGUE\":\n            break;\n          case \"SESSION_STORAGE\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              getItem: getStorageItem(\"session\"),\n            });\n            break;\n          // istanbul ignore next\n          case \"TPL\":\n            warnAboutStrictMode(\n              strict,\n              'Using \"TPL\" in expression',\n              `check your expression: \"${raw}\"`\n            );\n            if (strict) {\n              break;\n            }\n          // eslint-disable-next-line no-fallthrough\n          case \"STATE\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                return tplStateStore!.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedStates);\n              },\n            });\n            break;\n          case \"SYS\":\n            globalVariables[variableName] = getReadOnlyProxy(sys ?? {});\n            break;\n          case \"__WIDGET_FN__\":\n            globalVariables[variableName] = widgetFunctions;\n            break;\n          case \"__WIDGET_IMG__\":\n            globalVariables[variableName] = widgetImagesFactory;\n            break;\n          case \"__WIDGET_I18N__\":\n            globalVariables[variableName] = widgetI18nFactory;\n            break;\n        }\n      }\n\n      Object.assign(\n        globalVariables,\n        getGeneralGlobals(precooked.attemptToVisitGlobals, {\n          storyboardFunctions,\n          app: runtimeContext.app,\n          appendI18nNamespace: runtimeContext.appendI18nNamespace,\n        })\n      );\n\n      try {\n        const result = cook(precooked.expression, precooked.source, {\n          globalVariables: supply(\n            precooked.attemptToVisitGlobals,\n            globalVariables\n          ),\n        });\n        // const detail = { raw, context: globalVariables, result };\n        // if (options.isReEvaluation) {\n        //   devtoolsHookEmit(\"re-evaluation\", {\n        //     id: options.evaluationId,\n        //     detail,\n        //   });\n        // } else {\n        //   devtoolsHookEmit(\"evaluation\", detail);\n        // }\n        return result;\n      } catch (error: any) {\n        const message = `${error.message}, in \"${raw}\"`;\n        // if (options.isReEvaluation) {\n        //   devtoolsHookEmit(\"re-evaluation\", {\n        //     id: options.evaluationId,\n        //     detail: { raw, context: globalVariables },\n        //     error: message,\n        //   });\n        // } else {\n        const errorConstructor = getCookErrorConstructor(error);\n        throw new errorConstructor(message);\n        // }\n      }\n    },\n  };\n}\n","import { isObject } from \"@next-core/utils/general\";\nimport { asyncComputeRealValue, computeRealValue } from \"./computeRealValue.js\";\nimport { TrackingContextItem } from \"./listenOnTrackingContext.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { StateOfUseBrick } from \"./getNextStateOfUseBrick.js\";\nimport { getTracks } from \"./getTracks.js\";\n\nexport async function asyncComputeRealProperties(\n  properties: Record<string, unknown> | undefined,\n  runtimeContext: RuntimeContext,\n  trackingContextList?: TrackingContextItem[]\n): Promise<Record<string, unknown>> {\n  if (isObject(properties)) {\n    return Object.fromEntries(\n      (\n        await Promise.all(\n          Object.entries(properties).map<\n            Promise<[string, unknown] | undefined>\n          >(async ([propName, propValue]) => {\n            if (Array.isArray(trackingContextList)) {\n              const { contextNames, stateNames, formStateNames } =\n                getTracks(propValue);\n              if (contextNames || stateNames || formStateNames) {\n                trackingContextList.push({\n                  contextNames,\n                  stateNames,\n                  formStateNames,\n                  propName,\n                  propValue,\n                });\n              }\n            }\n            // Related: https://github.com/facebook/react/issues/11347\n            const realValue = await asyncComputeRealValue(\n              propValue,\n              runtimeContext,\n              {\n                $$lazyForUseBrick: true,\n                $$stateOfUseBrick:\n                  propName === \"useBrick\"\n                    ? StateOfUseBrick.USE_BRICK\n                    : StateOfUseBrick.INITIAL,\n              }\n            );\n            // For `style` and `dataset`, only object is acceptable.\n            if (\n              (propName !== \"style\" && propName !== \"dataset\") ||\n              isObject(realValue)\n            ) {\n              return [propName, realValue];\n            }\n          })\n        )\n      ).filter(Boolean) as [string, unknown][]\n    );\n  }\n\n  return {};\n}\n\nexport function computeRealProperties(\n  properties: Record<string, unknown> | undefined,\n  runtimeContext: RuntimeContext,\n  trackingContextList?: TrackingContextItem[]\n): Record<string, unknown> {\n  if (isObject(properties)) {\n    return Object.fromEntries(\n      Object.entries(properties)\n        .map<[string, unknown] | undefined>(([propName, propValue]) => {\n          if (Array.isArray(trackingContextList)) {\n            const { contextNames, stateNames, formStateNames } =\n              getTracks(propValue);\n            if (contextNames || stateNames || formStateNames) {\n              trackingContextList.push({\n                contextNames,\n                stateNames,\n                formStateNames,\n                propName,\n                propValue,\n              });\n            }\n          }\n          // Related: https://github.com/facebook/react/issues/11347\n          const realValue = computeRealValue(propValue, runtimeContext, {\n            $$lazyForUseBrick: true,\n            $$stateOfUseBrick:\n              propName === \"useBrick\"\n                ? StateOfUseBrick.USE_BRICK\n                : StateOfUseBrick.INITIAL,\n          });\n          // For `style` and `dataset`, only object is acceptable.\n          if (\n            (propName !== \"style\" && propName !== \"dataset\") ||\n            isObject(realValue)\n          ) {\n            return [propName, realValue];\n          }\n        })\n        .filter(Boolean) as [string, unknown][]\n    );\n  }\n\n  return {};\n}\n","export function setRealProperties(\n  brick: HTMLElement,\n  realProps: Record<string, unknown> | undefined\n): void {\n  if (!realProps) {\n    return;\n  }\n  for (const [propName, propValue] of Object.entries(realProps)) {\n    switch (propName) {\n      case \"style\":\n      case \"dataset\":\n        for (const [k, v] of Object.entries(\n          propValue as Record<string, unknown>\n        )) {\n          (brick[propName] as unknown as Record<string, unknown>)[k] = v;\n        }\n        break;\n      case \"constructor\":\n      case \"__proto__\":\n      case \"innerHTML\":\n        // `innerHTML` is dangerous, use `textContent` instead.\n        throw new Error(`set \\`${propName}\\` is prohibited`);\n      default:\n        (brick as unknown as Record<string, unknown>)[propName] = propValue;\n    }\n  }\n}\n","import { computeRealProperties } from \"./computeRealProperties.js\";\nimport { setRealProperties } from \"./setRealProperties.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\n\nexport function setProperties(\n  bricks: HTMLElement | HTMLElement[],\n  properties: Record<string, unknown>,\n  runtimeContext: RuntimeContext\n): void {\n  const realProps = computeRealProperties(properties, runtimeContext);\n  if (!Array.isArray(bricks)) {\n    bricks = [bricks];\n  }\n  bricks.forEach((brick) => {\n    setRealProperties(brick, realProps);\n  });\n}\n","import { getRuntime } from \"./index.js\";\nimport type { RuntimeContext } from \"./internal/interfaces.js\";\n\nexport function isStrictMode(runtimeContext?: RuntimeContext) {\n  return !!(\n    runtimeContext ? runtimeContext.flags : getRuntime()?.getFeatureFlags()\n  )?.[\"brick-next-v3-strict-mode\"];\n}\n\nexport function warnAboutStrictMode(\n  strict: boolean,\n  message: string,\n  ...extraLogs: unknown[]\n) {\n  const punctuation = extraLogs.length === 0 ? \"\" : \",\";\n  if (strict) {\n    // eslint-disable-next-line no-console\n    console.error(\n      `${message} is dropped in v3 strict mode${punctuation}`,\n      ...extraLogs\n    );\n  } else {\n    // eslint-disable-next-line no-console\n    console.warn(\n      `${message} is deprecated in v3 and will be dropped in strict mode${punctuation}`,\n      ...extraLogs\n    );\n  }\n}\n","import type {\n  ContextConf,\n  CustomTemplate,\n  CustomTemplateConstructor,\n  CustomTemplateProxyBasicProperty,\n} from \"@next-core/types\";\nimport { uniq } from \"lodash\";\nimport type { RuntimeBrickElement } from \"./internal/interfaces.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"./isStrictMode.js\";\n\n// Note: `prefix` is a native prop on Element, but it's only used in XML documents.\nconst allowedNativeProps = new Set([\"prefix\"]);\n\ninterface LegacyTplPropProxy extends CustomTemplateProxyBasicProperty {\n  asVariable?: boolean;\n  mergeProperty?: unknown;\n  refTransform?: unknown;\n}\n\nclass CustomTemplateRegistry {\n  readonly #registry = new Map<string, CustomTemplate>();\n\n  define(tagName: string, constructor: CustomTemplateConstructor): void {\n    let registered = this.#registry.has(tagName);\n    if (registered) {\n      // When open launchpad, the storyboard will be updated.\n      // However, we can't *undefine* a custom element.\n      // Just ignore re-registering custom templates.\n      // eslint-disable-next-line no-console\n      console.warn(`Custom template of \"${tagName}\" already registered.`);\n    } else {\n      registered = !!customElements.get(tagName);\n      if (registered) {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Custom template of \"${tagName}\" already defined by customElements.`\n        );\n      }\n    }\n\n    // Transform legacy `proxy.properties[].asVariable` as states.\n    const strict = isStrictMode();\n    const proxyProperties = (constructor.proxy?.properties ?? {}) as {\n      [name: string]: LegacyTplPropProxy;\n    };\n    const validProxyProps: [string, CustomTemplateProxyBasicProperty][] = [];\n    const legacyTplVariables: string[] = [];\n    for (const [key, value] of Object.entries(proxyProperties)) {\n      if (value.asVariable) {\n        warnAboutStrictMode(strict, \"Template `asVariable`\", tagName, key);\n        // istanbul ignore next\n        if (!strict) {\n          // For existed TPL usage, treat it as a STATE.\n          legacyTplVariables.push(key);\n        }\n      } else if (value.mergeProperty || value.refTransform) {\n        // eslint-disable-next-line no-console\n        console.error(\n          \"Template `mergeProperty` and `refTransform` are dropped in v3:\",\n          tagName,\n          key\n        );\n      } else if (value.ref) {\n        validProxyProps.push([key, value]);\n      }\n      // Else: documentation only, for exposed states.\n    }\n\n    const compatibleConstructor = {\n      ...constructor,\n      proxy: {\n        ...constructor.proxy,\n        properties: Object.fromEntries(validProxyProps),\n      },\n      state: (constructor.state\n        ? strict\n          ? constructor.state\n          : constructor.state.map((item) => ({\n              // Make `expose` defaults to true in non-strict mode.\n              expose: true,\n              ...item,\n            }))\n        : []\n      ).concat(legacyTplVariables.map((tpl) => ({ name: tpl, expose: true }))),\n    };\n\n    // Now we allow re-register custom template\n    this.#registry.set(tagName, {\n      ...compatibleConstructor,\n      name: tagName,\n    });\n\n    const exposedStates = getExposedStates(compatibleConstructor.state);\n    const proxyMethods = Object.entries(\n      compatibleConstructor.proxy?.methods ?? {}\n    );\n\n    const props = exposedStates.concat(\n      validProxyProps.map((entry) => entry[0])\n    );\n    const methods = proxyMethods.map((entry) => entry[0]);\n\n    const nativeProps = props\n      .concat(methods)\n      .filter(\n        (prop) => prop in HTMLElement.prototype && !allowedNativeProps.has(prop)\n      );\n    if (nativeProps.length > 0) {\n      warnAboutStrictMode(\n        strict,\n        \"Using native HTMLElement properties as template properties or methods\",\n        tagName,\n        ...nativeProps\n      );\n      // istanbul ignore next\n      if (strict) {\n        throw new Error(\n          `In custom template \"${tagName}\", ${nativeProps\n            .map((p) => `\"${p}\"`)\n            .join(\n              \", \"\n            )} are native HTMLElement properties, and should be avoid to be used as brick properties or methods.`\n        );\n      }\n    }\n\n    if (registered) {\n      return;\n    }\n\n    class TplElement extends HTMLElement {\n      get $$typeof() {\n        return \"custom-template\" as const;\n      }\n\n      static get _dev_only_definedProperties(): string[] {\n        return props;\n      }\n\n      static get _dev_only_definedMethods(): string[] {\n        return methods;\n      }\n\n      $$getElementByRef(this: RuntimeBrickElement, ref: string) {\n        return this.$$tplStateStore?.hostBrick?.tplHostMetadata?.internalBricksByRef.get(\n          ref\n        )?.element;\n      }\n\n      connectedCallback() {\n        let shadowRoot = this.shadowRoot;\n        if (!shadowRoot) {\n          shadowRoot = this.attachShadow({ mode: \"open\" });\n        }\n        const fragment = document.createDocumentFragment();\n        const style = document.createElement(\"style\");\n        style.textContent = \":host{display:block}:host([hidden]){display:none}\";\n        const slot = document.createElement(\"slot\");\n        fragment.appendChild(style);\n        fragment.appendChild(slot);\n        shadowRoot.appendChild(fragment);\n      }\n\n      disconnectedCallback() {\n        if (this.shadowRoot) {\n          this.shadowRoot.textContent = \"\";\n        }\n      }\n    }\n\n    for (const propName of exposedStates) {\n      if (validProxyProps.some((entry) => entry[0] === propName)) {\n        // eslint-disable-next-line no-console\n        console.error(\n          `Cannot define an exposed state that is also a proxy property: \"${propName}\" in ${tagName}`\n        );\n        continue;\n      }\n      Object.defineProperty(TplElement.prototype, propName, {\n        get(this: RuntimeBrickElement) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          return this.$$tplStateStore!.getValue(propName);\n        },\n        set(this: RuntimeBrickElement, value: unknown) {\n          // 在 mount 过程中，先设置属性，再设置 `$$tplStateStore`，这样，当触发属性设置时，\n          // 避免初始化的一次 state update 操作及其 onChange 事件。\n          this.$$tplStateStore?.updateValue(propName, value, \"replace\");\n        },\n        enumerable: true,\n      });\n    }\n\n    for (const [from, to] of validProxyProps) {\n      Object.defineProperty(TplElement.prototype, from, {\n        get(this: TplElement) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          const element = this.$$getElementByRef!(to.ref) as unknown as Record<\n            string,\n            unknown\n          >;\n          return element[to.refProperty ?? from];\n        },\n        set(this: TplElement, value: unknown) {\n          // 同上 exposedState.set\n          const element = this.$$getElementByRef?.(to.ref) as unknown as Record<\n            string,\n            unknown\n          >;\n          if (element) {\n            element[to.refProperty ?? from] = value;\n          }\n        },\n        enumerable: true,\n      });\n    }\n\n    for (const [from, to] of proxyMethods) {\n      Object.defineProperty(TplElement.prototype, from, {\n        value(this: TplElement, ...args: unknown[]) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          const element = this.$$getElementByRef!(to.ref) as unknown as Record<\n            string,\n            Function\n          >;\n          element[to.refMethod ?? from](...args);\n        },\n        enumerable: true,\n      });\n    }\n\n    customElements.define(tagName, TplElement);\n  }\n\n  get(tagName: string) {\n    return this.#registry.get(tagName);\n  }\n}\n\nexport const customTemplates = new CustomTemplateRegistry();\n\nfunction getExposedStates(state: ContextConf[] | undefined): string[] {\n  // Allow duplicated state names which maybe mutually exclusive.\n  return uniq(\n    state?.filter((item) => item.expose).map((item) => item.name) ?? []\n  );\n}\n","import type { DataStore } from \"../data/DataStore.js\";\nimport type { RuntimeBrickElement, RuntimeContext } from \"../interfaces.js\";\nimport { customTemplates } from \"../../CustomTemplates.js\";\n\ntype MinimalTplStateStoreContext = Pick<\n  RuntimeContext,\n  \"tplStateStoreId\" | \"tplStateStoreMap\"\n>;\n\nexport function getTplStateStore(\n  { tplStateStoreId, tplStateStoreMap }: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): DataStore<\"STATE\"> {\n  if (!tplStateStoreId) {\n    throw new Error(\n      `Using \"${using}\" outside of a custom template${extraInfo ?? \"\"}`\n    );\n  }\n  const store = tplStateStoreMap.get(tplStateStoreId);\n  if (!store) {\n    throw new Error(\n      `Template state store is not found when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return store;\n}\n\nexport function getTplHostElement(\n  runtimeContext: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): RuntimeBrickElement {\n  const store = getTplStateStore(runtimeContext, using, extraInfo);\n  const hostElement = store.hostBrick!.element;\n  if (!hostElement) {\n    throw new Error(\n      `Template host element is gone when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return hostElement;\n}\n\nexport function getTagNameOfCustomTemplate(\n  brick: string,\n  appId?: string\n): false | string {\n  // When a template is registered by an app, it's namespace maybe missed.\n  if (!brick.includes(\".\") && brick.startsWith(\"tpl-\") && appId) {\n    const tagName = `${appId}.${brick}`;\n    if (customTemplates.get(tagName)) {\n      return tagName;\n    }\n  }\n  if (customTemplates.get(brick)) {\n    return brick;\n  }\n  return false;\n}\n","import type { DataStore } from \"../data/DataStore.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\n\ntype MinimalTplStateStoreContext = Pick<\n  RuntimeContext,\n  \"formStateStoreId\" | \"formStateStoreMap\"\n>;\n\nexport function getFormStateStore(\n  { formStateStoreId, formStateStoreMap }: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): DataStore<\"FORM_STATE\"> {\n  if (!formStateStoreId) {\n    throw new Error(\n      `Using \"${using}\" outside of form renderer${extraInfo ?? \"\"}`\n    );\n  }\n  const store = formStateStoreMap.get(formStateStoreId);\n  if (!store) {\n    throw new Error(\n      `Form state store is not found when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return store;\n}\n","import { setProperties } from \"./setProperties.js\";\nimport type { RuntimeBrick } from \"../interfaces.js\";\nimport { getTplStateStore } from \"../CustomTemplates/utils.js\";\nimport { getFormStateStore } from \"../FormRenderer/utils.js\";\n\nexport interface TrackingContextItem {\n  contextNames: string[] | Set<string> | false;\n  stateNames: string[] | Set<string> | false;\n  formStateNames: string[] | Set<string> | false;\n  propName: string;\n  propValue: unknown;\n}\n\nexport function listenOnTrackingContext(\n  brick: RuntimeBrick,\n  trackingContextList: TrackingContextItem[]\n): void {\n  for (const track of trackingContextList) {\n    const listener = (): void => {\n      if (brick.element) {\n        setProperties(\n          brick.element,\n          { [track.propName]: track.propValue },\n          brick.runtimeContext\n        );\n      }\n    };\n    if (track.contextNames) {\n      for (const contextName of track.contextNames) {\n        brick.runtimeContext.ctxStore.onChange(contextName, listener);\n      }\n    }\n    if (track.stateNames) {\n      const tplStateStore = getTplStateStore(\n        brick.runtimeContext,\n        \"STATE\",\n        `: \"${track.propValue}\"`\n      );\n      for (const stateName of track.stateNames) {\n        tplStateStore.onChange(stateName, listener);\n      }\n    }\n    if (track.formStateNames) {\n      const formStateStore = getFormStateStore(\n        brick.runtimeContext,\n        \"FORM_STATE\",\n        `: \"${track.propValue}\"`\n      );\n      for (const stateName of track.formStateNames) {\n        formStateStore.onChange(stateName, listener);\n      }\n    }\n  }\n}\n","// Ref https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/matchPath.js\nimport type { LegacyCompatibleRuntimeContext } from \"@next-core/inject\";\nimport { pathToRegexp, Key, compile } from \"path-to-regexp\";\n\nconst cache: Map<string, Map<string, CompileResult>> = new Map();\nconst cacheLimit = 10000;\nlet cacheCount = 0;\n\nfunction compilePath(path: string, options: CompileOptions): CompileResult {\n  const cacheKey = `${options.end}${options.strict}${options.sensitive}`;\n  let pathCache = cache.get(cacheKey);\n  if (!pathCache) {\n    cache.set(cacheKey, (pathCache = new Map()));\n  }\n\n  const cacheResult = pathCache.get(path);\n  if (cacheResult) {\n    return cacheResult;\n  }\n\n  const keys: Key[] = [];\n  const regexp = pathToRegexp(path, keys, options);\n  const result = { regexp, keys };\n\n  if (cacheCount < cacheLimit) {\n    pathCache.set(path, result);\n    cacheCount++;\n  }\n\n  return result;\n}\n\n/**\n * Public API for matching a URL pathname to a path.\n */\nexport function matchPath(\n  pathname: string,\n  options: MatchPathOptions\n): MatchResult | null {\n  const { path: p, exact = false, strict = false, sensitive = true } = options;\n\n  const paths = Array.isArray(p) ? p : [p];\n\n  return paths.reduce<MatchResult | null>((matched, path) => {\n    if (matched) {\n      return matched;\n    }\n    const { regexp, keys } = compilePath(path, {\n      end: exact,\n      strict,\n      sensitive,\n    });\n    const match = regexp.exec(pathname);\n\n    if (!match) {\n      return null;\n    }\n\n    const [url, ...values] = match;\n    const isExact = pathname === url;\n\n    if (exact && !isExact) {\n      return null;\n    }\n\n    const initialParams: MatchResult[\"params\"] = {};\n    const result = {\n      path, // the path used to match\n      url: path === \"/\" && url === \"\" ? \"/\" : url, // the matched portion of the URL\n      isExact, // whether or not we matched exactly\n      params: keys.reduce((memo, key, index) => {\n        memo[key.name] = values[index];\n        return memo;\n      }, initialParams),\n    };\n\n    return result;\n  }, null);\n}\n\nexport function toPath(\n  path: string,\n  pathParams?: Record<string, unknown>\n): string {\n  return compile(path)(pathParams);\n}\n\ninterface CompileOptions {\n  end?: boolean;\n  strict?: boolean;\n  sensitive?: boolean;\n}\n\ninterface CompileResult {\n  regexp: RegExp;\n  keys: Key[];\n}\n\ninterface MatchOptions {\n  path: string | string[];\n  exact?: boolean;\n}\n\nexport type MatchPathOptions = MatchOptions & CompileOptions;\n\nexport type MatchResult = Exclude<\n  LegacyCompatibleRuntimeContext[\"match\"],\n  undefined\n>;\n","import type { RouteConf } from \"@next-core/types\";\nimport { MatchResult, matchPath } from \"./matchPath.js\";\nimport { asyncCheckIf } from \"./compute/checkIf.js\";\nimport { isLoggedIn } from \"../auth.js\";\nimport type { RuntimeContext } from \"./interfaces.js\";\n\ntype MatchRoutesResult =\n  | {\n      match: MatchResult;\n      route: RouteConf;\n    }\n  | \"missed\"\n  | \"unauthenticated\";\n\nexport async function matchRoutes(\n  routes: RouteConf[],\n  runtimeContext: RuntimeContext\n): Promise<MatchRoutesResult> {\n  for (const route of routes) {\n    if (typeof route.path !== \"string\") {\n      // eslint-disable-next-line no-console\n      console.error(\"Invalid route with invalid path:\", route);\n      throw new Error(\n        `Invalid route with invalid type of path: ${typeof route.path}`\n      );\n    }\n    const routePath = route.path.replace(\n      /^\\$\\{APP.homepage\\}/,\n      runtimeContext.app.homepage\n    );\n    const match = matchPath(runtimeContext.location.pathname, {\n      path: routePath,\n      exact: route.exact,\n    });\n    if (match && (await asyncCheckIf(route, runtimeContext))) {\n      if (runtimeContext.app.noAuthGuard || route.public || isLoggedIn()) {\n        return { match, route };\n      }\n      return \"unauthenticated\";\n    }\n  }\n  return \"missed\";\n}\n","import type { BrickConf } from \"@next-core/types\";\nimport type { AsyncProperties } from \"../interfaces.js\";\n\nexport const symbolForAsyncComputedPropsFromHost = Symbol.for(\n  \"tpl.asyncComputedPropsFromHost\"\n);\nexport const symbolForTplStateStoreId = Symbol.for(\"tpl.stateStoreId\");\nexport const symbolForTPlExternalForEachItem = Symbol.for(\n  \"tpl.externalForEachItem\"\n);\n\nexport type RuntimeBrickConfWithTplSymbols = BrickConf &\n  RuntimeBrickConfOfTplSymbols;\n\nexport interface RuntimeBrickConfOfTplSymbols {\n  [symbolForAsyncComputedPropsFromHost]?: AsyncProperties;\n  [symbolForTplStateStoreId]?: string;\n  [symbolForTPlExternalForEachItem]?: unknown;\n}\n","import type { ProviderPollOptions } from \"@next-core/types\";\nimport { _internalApiGetRenderId } from \"./Runtime.js\";\n\nexport type PollableCallbackFunction = (result?: unknown) => unknown;\n\nexport interface PollableCallback {\n  progress?: PollableCallbackFunction;\n  success?: PollableCallbackFunction;\n  error?: PollableCallbackFunction;\n  finally?: PollableCallbackFunction;\n}\n\nconst timeoutIdList = new Set<number>();\n\nexport function startPoll(\n  task: () => unknown,\n  { progress, success, error, finally: finallyCallback }: PollableCallback,\n  {\n    interval,\n    leadingRequestDelay,\n    continueOnError,\n    delegateLoadingBar,\n    expectPollEnd,\n    expectPollStopImmediately,\n  }: ProviderPollOptions\n): void {\n  const currentRenderId = _internalApiGetRenderId();\n  let currentTimeoutId: number;\n  async function poll(): Promise<void> {\n    timeoutIdList.delete(currentTimeoutId);\n    let shouldStop: boolean | undefined;\n    try {\n      shouldStop = expectPollStopImmediately?.();\n      // Stop polling immediately when the expectation is match before task.\n      if (!shouldStop) {\n        const result = await task();\n        // Stop polling immediately when the expectation is match or a different router\n        // is rendering after the task processed.\n        shouldStop =\n          expectPollStopImmediately?.() ||\n          currentRenderId !== _internalApiGetRenderId();\n        if (!shouldStop) {\n          progress?.(result);\n          if (expectPollEnd?.(result)) {\n            if (delegateLoadingBar) {\n              window.dispatchEvent(new Event(\"request.end\"));\n            }\n            success?.(result);\n            finallyCallback?.();\n          } else {\n            delayedPoll(interval ?? 3000);\n          }\n        }\n      }\n    } catch (e) {\n      // Stop polling immediately when the expectation is match or a different router\n      // is rendering after the task processed.\n      shouldStop =\n        expectPollStopImmediately?.() ||\n        currentRenderId !== _internalApiGetRenderId();\n      if (!shouldStop) {\n        error?.(e);\n        if (continueOnError) {\n          delayedPoll(interval ?? 3000);\n        } else {\n          finallyCallback?.();\n        }\n      }\n    } finally {\n      // Manually dispatch an event of `request.end` when the polling is stopped immediately.\n      if (delegateLoadingBar && shouldStop) {\n        window.dispatchEvent(new Event(\"request.end\"));\n      }\n    }\n  }\n\n  function delayedPoll(delay: number): void {\n    currentTimeoutId = setTimeout(poll, delay) as unknown as number;\n    timeoutIdList.add(currentTimeoutId);\n  }\n\n  delayedPoll(leadingRequestDelay ?? 0);\n\n  if (delegateLoadingBar) {\n    window.dispatchEvent(new Event(\"request.start\"));\n  }\n}\n\nexport function clearPollTimeout(): void {\n  for (const timeoutId of timeoutIdList) {\n    clearTimeout(timeoutId);\n  }\n  timeoutIdList.clear();\n}\n","export enum K {\n  REQUEST_FAILED = \"REQUEST_FAILED\",\n  SOMETHING_WENT_WRONG = \"SOMETHING_WENT_WRONG\",\n  LOGIN_TIMEOUT_MESSAGE = \"LOGIN_TIMEOUT_MESSAGE\",\n  NETWORK_ERROR = \"NETWORK_ERROR\",\n}\n\nconst en: Locale = {\n  [K.REQUEST_FAILED]: \"Request Failed\",\n  [K.SOMETHING_WENT_WRONG]: \"Something went wrong!\",\n  [K.LOGIN_TIMEOUT_MESSAGE]:\n    \"You haven't logged in or your login session has expired. Login right now?\",\n  [K.NETWORK_ERROR]: \"Network error, please check your network.\",\n};\n\nconst zh: Locale = {\n  [K.REQUEST_FAILED]: \"请求失败\",\n  [K.SOMETHING_WENT_WRONG]: \"出现了一些问题！\",\n  [K.LOGIN_TIMEOUT_MESSAGE]: \"您还未登录或登录信息已过期，现在重新登录？\",\n  [K.NETWORK_ERROR]: \"网络错误，请检查您的网络连接。\",\n};\n\nexport const NS = \"core/runtime\";\n\nexport const locales = { en, zh };\n\ntype Locale = { [key in K]: string };\n","let brick: {\n  resolve(options: DialogOptions): Promise<void>;\n};\n\nfunction show(options: DialogOptions): Promise<void> {\n  if (brick) {\n    return brick.resolve(options);\n  } else {\n    if (options.type === \"confirm\") {\n      if (confirm(options.content)) {\n        return new Promise((resolve) =>\n          setTimeout(() => {\n            resolve();\n          }, 1)\n        );\n      } else {\n        return new Promise((resolve, reject) =>\n          setTimeout(() => {\n            reject();\n          }, 1)\n        );\n      }\n    } else {\n      alert(options.content);\n      return new Promise((resolve) =>\n        setTimeout(() => {\n          resolve();\n        }, 1000)\n      );\n    }\n  }\n}\n\nexport function loadDialogService(\n  tagName: string,\n  loader: (bricks: string[]) => Promise<void>\n) {\n  loader([tagName]).then(\n    () => {\n      brick = document.createElement(tagName) as any;\n    },\n    (error: unknown) => {\n      // eslint-disable-next-line no-console\n      console.error(\"Load dialog service failed:\", error);\n    }\n  );\n}\n\nexport interface DialogOptions {\n  type?: \"success\" | \"error\" | \"warn\" | \"info\" | \"confirm\";\n  title?: string | null;\n  content: string;\n  contentStyle?: object;\n}\n\nexport const Dialog = Object.freeze({\n  show,\n});\n","import {\n  HttpAbortError,\n  HttpFetchError,\n  HttpResponseError,\n} from \"@next-core/http\";\nimport { i18n } from \"@next-core/i18n\";\nimport { getRuntime } from \"./internal/Runtime.js\";\nimport { getHistory } from \"./history.js\";\nimport { K, NS } from \"./internal/i18n.js\";\nimport { Dialog } from \"./Dialog.js\";\n\n/**\n * 将 http 请求错误转换为可读的字符串。\n *\n * @remarks\n *\n * 将依次尝试读取返回的 JSON 格式数据的字符串类型的 `error` 和 `msg` 字段，如果没有找到则返回 `error.toString()` 的结果。\n *\n * @param error - 错误对象。\n *\n * @returns 转换为字符串的错误信息。\n */\nexport function httpErrorToString(error: unknown): string {\n  if (error instanceof Event && error.target instanceof HTMLScriptElement) {\n    return error.target.src;\n  }\n  if (error instanceof HttpFetchError) {\n    return i18n.t(`${NS}:${K.NETWORK_ERROR}`);\n  }\n  if (error instanceof HttpResponseError) {\n    if (error.responseJson) {\n      if (typeof error.responseJson.error === \"string\") {\n        return error.responseJson.error;\n      } else if (typeof error.responseJson.msg === \"string\") {\n        return error.responseJson.msg;\n      }\n    }\n  }\n  if (error == null) {\n    return \"Unknown error\";\n  }\n  return error.toString();\n}\n\nexport function isUnauthenticatedError(error: unknown): boolean {\n  return (\n    error instanceof HttpResponseError &&\n    error.response.status === 401 &&\n    !!error.responseJson &&\n    error.responseJson.code === 100003\n  );\n}\n\nlet unauthenticatedConfirming = false;\n\nlet lastErrorMessage: string | undefined;\n\n/**\n * 处理 http 请求错误（使用 AntDesign 模态框弹出错误信息）。\n *\n * @param error - 错误对象。\n */\nexport function handleHttpError(error: unknown) {\n  // Do nothing if aborted http requests\n  if (error instanceof HttpAbortError) {\n    return;\n  }\n\n  // Redirect to login page if not logged in.\n  if (isUnauthenticatedError(error) && !window.NO_AUTH_GUARD) {\n    if (unauthenticatedConfirming) {\n      return;\n    }\n    unauthenticatedConfirming = true;\n    Dialog.show({\n      type: \"confirm\",\n      content: i18n.t(`${NS}:${K.LOGIN_TIMEOUT_MESSAGE}`),\n    }).then(\n      () => {\n        redirectToLogin();\n        unauthenticatedConfirming = false;\n      },\n      () => {\n        unauthenticatedConfirming = false;\n      }\n    );\n    return;\n  }\n\n  // eslint-disable-next-line no-console\n  console.error(error);\n\n  const message = httpErrorToString(error);\n  if (message !== lastErrorMessage) {\n    lastErrorMessage = message;\n    Dialog.show({\n      type: \"error\",\n      title: i18n.t(`${NS}:${K.REQUEST_FAILED}`),\n      content: message,\n      contentStyle: {\n        whiteSpace: \"pre-wrap\",\n      },\n    }).then(() => {\n      lastErrorMessage = undefined;\n    });\n  }\n  return;\n}\n\nfunction redirectToLogin() {\n  const ssoEnabled = getRuntime().getFeatureFlags()[\"sso-enabled\"];\n  const history = getHistory();\n  history.push(ssoEnabled ? \"/sso-auth/login\" : \"/auth/login\", {\n    from: {\n      ...history.location,\n      state: undefined,\n    },\n  });\n}\n","let brick: {\n  resolve(options: NotificationOptions): void;\n};\n\nfunction show(options: NotificationOptions) {\n  if (brick) {\n    brick.resolve(options);\n  } else {\n    alert(options.message);\n  }\n}\n\nexport function loadNotificationService(\n  tagName: string,\n  loader: (bricks: string[]) => Promise<void>\n) {\n  loader([tagName]).then(\n    () => {\n      brick = document.createElement(tagName) as any;\n    },\n    (error: unknown) => {\n      // eslint-disable-next-line no-console\n      console.error(\"Load notification service failed:\", error);\n    }\n  );\n}\n\nexport interface NotificationOptions {\n  type?: \"success\" | \"error\" | \"warn\" | \"info\";\n  message: string;\n}\n\nexport const Notification = Object.freeze({\n  show,\n});\n","import type {\n  BrickEventHandler,\n  BrickEventHandlerCallback,\n  BrickEventsMap,\n  BuiltinBrickEventHandler,\n  CustomBrickEventHandler,\n  ExecuteCustomBrickEventHandler,\n  ProviderPollOptions,\n  SetPropsCustomBrickEventHandler,\n  SiteTheme,\n  UseProviderEventHandler,\n} from \"@next-core/types\";\nimport { isEvaluable } from \"@next-core/cook\";\nimport { checkIf } from \"./compute/checkIf.js\";\nimport { computeRealValue } from \"./compute/computeRealValue.js\";\nimport { getHistory } from \"../history.js\";\nimport { getProviderBrick } from \"./data/getProviderBrick.js\";\nimport { PollableCallback, startPoll } from \"./poll.js\";\nimport { isPreEvaluated } from \"./compute/evaluate.js\";\nimport { setProperties } from \"./compute/setProperties.js\";\nimport { applyMode, applyTheme } from \"../themeAndMode.js\";\nimport type {\n  ElementHolder,\n  RuntimeBrickElement,\n  RuntimeContext,\n} from \"./interfaces.js\";\nimport {\n  getTplHostElement,\n  getTplStateStore,\n} from \"./CustomTemplates/utils.js\";\nimport { handleHttpError, httpErrorToString } from \"../handleHttpError.js\";\nimport { getArgsOfFlowApi } from \"./data/FlowApi.js\";\nimport { Notification } from \"../Notification.js\";\nimport { getFormStateStore } from \"./FormRenderer/utils.js\";\n\nexport function bindListeners(\n  brick: RuntimeBrickElement,\n  eventsMap: BrickEventsMap | undefined,\n  runtimeContext: RuntimeContext\n): void {\n  if (!eventsMap) {\n    return;\n  }\n  Object.entries(eventsMap).forEach(([eventType, handlers]) => {\n    const listener = listenerFactory(handlers, runtimeContext, {\n      element: brick,\n    });\n    brick.addEventListener(eventType, listener);\n\n    // Remember added listeners for unbinding.\n    if (!brick.$$listeners) {\n      brick.$$listeners = [];\n    }\n    brick.$$listeners.push([eventType, listener]);\n\n    // Remember added listeners for devtools.\n    if (!brick.$$eventListeners) {\n      brick.$$eventListeners = [];\n    }\n    for (const handler of ([] as BrickEventHandler[]).concat(handlers)) {\n      brick.$$eventListeners.push([eventType, null, handler]);\n    }\n  });\n}\n\nexport function unbindListeners(brick: RuntimeBrickElement): void {\n  if (brick.$$listeners) {\n    for (const [eventType, listener] of brick.$$listeners) {\n      brick.removeEventListener(eventType, listener);\n    }\n    brick.$$listeners.length = 0;\n  }\n}\n\nexport function isBuiltinHandler(\n  handler: BrickEventHandler\n): handler is BuiltinBrickEventHandler {\n  return typeof (handler as BuiltinBrickEventHandler).action === \"string\";\n}\n\nexport function isUseProviderHandler(\n  handler: BrickEventHandler\n): handler is UseProviderEventHandler {\n  return typeof (handler as UseProviderEventHandler).useProvider === \"string\";\n}\n\nexport function isCustomHandler(\n  handler: BrickEventHandler\n): handler is CustomBrickEventHandler {\n  return !!(\n    ((handler as CustomBrickEventHandler).target ||\n      (handler as CustomBrickEventHandler).targetRef) &&\n    ((handler as ExecuteCustomBrickEventHandler).method ||\n      (handler as SetPropsCustomBrickEventHandler).properties)\n  );\n}\n\nexport function isExecuteCustomHandler(\n  handler: CustomBrickEventHandler\n): handler is ExecuteCustomBrickEventHandler {\n  return !!(handler as ExecuteCustomBrickEventHandler).method;\n}\n\nexport function isSetPropsCustomHandler(\n  handler: CustomBrickEventHandler\n): handler is SetPropsCustomBrickEventHandler {\n  return !!(handler as SetPropsCustomBrickEventHandler).properties;\n}\n\nexport function listenerFactory(\n  handlers: BrickEventHandler | BrickEventHandler[],\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  return function (event: Event): void {\n    for (const handler of ([] as BrickEventHandler[]).concat(handlers)) {\n      if (!checkIf(handler, { ...runtimeContext, event })) {\n        continue;\n      }\n      if (isBuiltinHandler(handler)) {\n        const [object, method] = handler.action.split(\".\") as any;\n        switch (handler.action) {\n          case \"history.push\":\n          case \"history.replace\":\n          case \"history.pushQuery\":\n          case \"history.replaceQuery\":\n          case \"history.pushAnchor\":\n          case \"history.block\":\n          case \"history.goBack\":\n          case \"history.goForward\":\n          case \"history.reload\":\n          case \"history.unblock\":\n            handleHistoryAction(\n              event,\n              method,\n              handler.args,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          // case \"segue.push\":\n          // case \"segue.replace\":\n          // case \"alias.push\":\n          // case \"alias.replace\":\n\n          case \"window.open\":\n            handleWindowAction(event, handler.args, runtimeContext);\n            break;\n\n          case \"location.reload\":\n          case \"location.assign\":\n            handleLocationAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"localStorage.setItem\":\n          case \"localStorage.removeItem\":\n          case \"sessionStorage.setItem\":\n          case \"sessionStorage.removeItem\":\n            handleStorageAction(\n              event,\n              object,\n              method,\n              handler.args,\n              runtimeContext\n            );\n            break;\n\n          case \"event.preventDefault\":\n            event.preventDefault();\n            break;\n\n          case \"console.log\":\n          case \"console.error\":\n          case \"console.warn\":\n          case \"console.info\":\n            handleConsoleAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"message.success\":\n          case \"message.error\":\n          case \"message.info\":\n          case \"message.warn\":\n            handleMessageAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"handleHttpError\":\n            handleHttpError((event as CustomEvent).detail);\n            break;\n\n          case \"context.assign\":\n          case \"context.replace\":\n          case \"context.refresh\":\n          case \"context.load\":\n            handleContextAction(\n              event,\n              method,\n              handler.args,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          case \"state.update\":\n          case \"state.refresh\":\n          case \"state.load\":\n            handleTplStateAction(\n              event,\n              method,\n              handler.args,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          case \"tpl.dispatchEvent\": {\n            const [type, init] = argsFactory(\n              handler.args,\n              runtimeContext,\n              event\n            ) as [string, CustomEventInit];\n            const tplHostElement = getTplHostElement(\n              runtimeContext,\n              handler.action,\n              `: ${type}`\n            );\n            tplHostElement.dispatchEvent(new CustomEvent(type, init));\n            break;\n          }\n\n          case \"formstate.update\":\n            handleFormStateAction(\n              event,\n              handler.args,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          // case \"message.subscribe\":\n          // case \"message.unsubscribe\":\n\n          case \"theme.setDarkTheme\":\n          case \"theme.setLightTheme\":\n            applyTheme(\n              handler.action === \"theme.setDarkTheme\" ? \"dark\" : \"light\"\n            );\n            break;\n          case \"theme.setTheme\": {\n            const [theme] = argsFactory(handler.args, runtimeContext, event);\n            applyTheme(theme as SiteTheme);\n            break;\n          }\n          case \"mode.setDashboardMode\":\n          case \"mode.setDefaultMode\":\n            applyMode(\n              handler.action === \"mode.setDashboardMode\"\n                ? \"dashboard\"\n                : \"default\"\n            );\n            break;\n\n          // case \"menu.clearMenuTitleCache\":\n          // case \"menu.clearMenuCache\":\n\n          // case \"analytics.event\":\n\n          // case \"preview.debug\":\n\n          default:\n            // eslint-disable-next-line no-console\n            console.error(\"unknown event listener action:\", handler.action);\n        }\n      } else if (isUseProviderHandler(handler)) {\n        handleUseProviderAction(event, handler, runtimeContext, runtimeBrick);\n      } else if (isCustomHandler(handler)) {\n        handleCustomAction(event, handler, runtimeContext, runtimeBrick!);\n      } else {\n        // eslint-disable-next-line no-console\n        console.error(\"unknown event handler:\", handler);\n      }\n    }\n  };\n}\n\nasync function handleUseProviderAction(\n  event: Event,\n  handler: UseProviderEventHandler,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  try {\n    const providerBrick = await getProviderBrick(handler.useProvider);\n    const method = handler.method !== \"saveAs\" ? \"resolve\" : \"saveAs\";\n    brickCallback(\n      event,\n      providerBrick,\n      handler,\n      method,\n      runtimeContext,\n      runtimeBrick\n    );\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(httpErrorToString(error));\n  }\n}\n\nfunction handleCustomAction(\n  event: Event,\n  handler: CustomBrickEventHandler,\n  runtimeContext: RuntimeContext,\n  runtimeBrick: ElementHolder\n) {\n  let targets: HTMLElement[] = [];\n  const rawTarget = handler.target;\n  const rawTargetRef = handler.targetRef;\n  let computedTarget = rawTarget;\n  // Allow `target` to be set as evaluable string.\n  if (\n    typeof rawTarget === \"string\"\n      ? isEvaluable(rawTarget)\n      : isPreEvaluated(rawTarget)\n  ) {\n    computedTarget = computeRealValue(rawTarget, { ...runtimeContext, event });\n  }\n  if (typeof computedTarget === \"string\") {\n    if (computedTarget === \"_self\") {\n      targets.push(runtimeBrick.element!);\n    } else if (handler.multiple) {\n      targets = Array.from(document.querySelectorAll(computedTarget));\n    } else {\n      const found = document.querySelector(computedTarget) as HTMLElement;\n      if (found !== null) {\n        targets.push(found);\n      }\n    }\n  } else if (computedTarget) {\n    if (computedTarget instanceof HTMLElement) {\n      targets.push(computedTarget as HTMLElement);\n    } else {\n      // eslint-disable-next-line no-console\n      console.error(\"unexpected target:\", computedTarget);\n    }\n  } else if (rawTargetRef) {\n    let computedTargetRef = rawTargetRef;\n    // Allow `targetRef` to be set as evaluable string.\n    if (\n      typeof rawTargetRef === \"string\"\n        ? isEvaluable(rawTargetRef)\n        : isPreEvaluated(rawTargetRef)\n    ) {\n      computedTargetRef = computeRealValue(rawTargetRef, {\n        ...runtimeContext,\n        event,\n      }) as string | string[];\n    }\n    const targetRefs = ([] as string[]).concat(computedTargetRef);\n    const tplHostElement = getTplHostElement(\n      runtimeContext,\n      \"targetRef\",\n      `: ${targetRefs.join(\", \")}`\n    );\n    targets.push(\n      ...(targetRefs\n        .map((ref) => tplHostElement.$$getElementByRef?.(ref))\n        .filter(Boolean) as HTMLElement[])\n    );\n  }\n  if (targets.length === 0) {\n    // eslint-disable-next-line no-console\n    console.error(\"target not found:\", rawTarget || rawTargetRef);\n    return;\n  }\n  if (isExecuteCustomHandler(handler)) {\n    targets.forEach((target) => {\n      brickCallback(\n        event,\n        target,\n        handler,\n        handler.method,\n        runtimeContext,\n        runtimeBrick,\n        {\n          useEventAsDefault: true,\n        }\n      );\n    });\n  } else if (isSetPropsCustomHandler(handler)) {\n    setProperties(targets, handler.properties, {\n      ...runtimeContext,\n      event,\n    });\n  }\n}\n\nasync function brickCallback(\n  event: Event,\n  target: HTMLElement,\n  handler: ExecuteCustomBrickEventHandler | UseProviderEventHandler,\n  method: string,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder,\n  options?: ArgsFactoryOptions\n): Promise<void> {\n  if (typeof (target as any)[method] !== \"function\") {\n    // eslint-disable-next-line no-console\n    console.error(\"target has no method:\", {\n      target,\n      method: method,\n    });\n    return;\n  }\n\n  const task = async (): Promise<unknown> => {\n    let computedArgs = argsFactory(\n      handler.args,\n      runtimeContext,\n      event,\n      options\n    );\n    if (isUseProviderHandler(handler)) {\n      computedArgs = await getArgsOfFlowApi(\n        handler.useProvider,\n        computedArgs,\n        method\n      );\n    }\n    return (target as any)[method](...computedArgs);\n  };\n\n  if (!handler.callback) {\n    task();\n    return;\n  }\n\n  const callbackFactory = eventCallbackFactory(\n    handler.callback,\n    runtimeContext,\n    runtimeBrick\n  );\n\n  const pollableCallback: Required<PollableCallback> = {\n    progress: callbackFactory(\"progress\"),\n    success: callbackFactory(\"success\"),\n    error: callbackFactory(\"error\"),\n    finally: callbackFactory(\"finally\"),\n  };\n\n  let poll: ProviderPollOptions | undefined;\n  if (isUseProviderHandler(handler)) {\n    poll = computeRealValue(handler.poll, { ...runtimeContext, event }) as\n      | ProviderPollOptions\n      | undefined;\n  }\n\n  if (poll?.enabled) {\n    startPoll(task, pollableCallback, poll);\n  } else {\n    try {\n      // Try to catch synchronized tasks too.\n      const result = await task();\n      pollableCallback.success(result);\n    } catch (err) {\n      pollableCallback.error(err);\n    } finally {\n      pollableCallback[\"finally\"]();\n    }\n  }\n}\n\nfunction handleHistoryAction(\n  event: Event,\n  method:\n    | \"push\"\n    | \"replace\"\n    | \"pushQuery\"\n    | \"replaceQuery\"\n    | \"pushAnchor\"\n    | \"block\"\n    | \"goBack\"\n    | \"goForward\"\n    | \"reload\"\n    | \"unblock\",\n  args: unknown[] | undefined,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  let baseArgsLength = 0;\n  let hasCallback = false;\n  let overrideMethod = method as \"setBlockMessage\";\n  switch (method) {\n    case \"push\":\n    case \"replace\":\n    case \"pushQuery\":\n    case \"replaceQuery\":\n    case \"pushAnchor\":\n      baseArgsLength = 2;\n      hasCallback = true;\n      break;\n    case \"reload\":\n      hasCallback = true;\n      break;\n    case \"block\":\n      baseArgsLength = 1;\n      overrideMethod = \"setBlockMessage\";\n      break;\n  }\n  let computedArgs: unknown[] = [];\n  if (baseArgsLength > 0) {\n    computedArgs = argsFactory(args, runtimeContext, event, {\n      useEventDetailAsDefault: true,\n    });\n    computedArgs.length = baseArgsLength;\n  }\n  if (hasCallback && callback) {\n    const callbackFactory = eventCallbackFactory(\n      callback,\n      runtimeContext,\n      undefined\n    );\n    computedArgs.push((blocked: boolean) => {\n      callbackFactory(blocked ? \"error\" : \"success\")({ blocked });\n      callbackFactory(\"finally\")({ blocked });\n    });\n  }\n  (getHistory()[overrideMethod] as (...args: unknown[]) => unknown)(\n    ...computedArgs\n  );\n}\n\nfunction handleWindowAction(\n  event: Event,\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const [url, target, features] = argsFactory(args, runtimeContext, event) as [\n    string,\n    string,\n    string\n  ];\n  window.open(url, target || \"_self\", features);\n}\n\nfunction handleContextAction(\n  event: Event,\n  method: \"assign\" | \"replace\" | \"refresh\" | \"load\",\n  args: unknown[] | undefined,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const [name, value] = argsFactory(args, runtimeContext, event);\n  runtimeContext.ctxStore.updateValue(\n    name as string,\n    value,\n    method,\n    callback,\n    runtimeContext\n  );\n}\n\nfunction handleTplStateAction(\n  event: Event,\n  method: \"update\" | \"refresh\" | \"load\",\n  args: unknown[] | undefined,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const [name, value] = argsFactory(args, runtimeContext, event);\n  const tplStateStore = getTplStateStore(\n    runtimeContext,\n    `state.${method}`,\n    `: ${name}`\n  );\n  tplStateStore.updateValue(\n    name as string,\n    value,\n    method === \"update\" ? \"replace\" : method,\n    callback,\n    runtimeContext\n  );\n}\n\nfunction handleFormStateAction(\n  event: Event,\n  args: unknown[] | undefined,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const [name, value] = argsFactory(args, runtimeContext, event);\n  const formStateStore = getFormStateStore(\n    runtimeContext,\n    \"formstate.update\",\n    `: ${name}`\n  );\n  formStateStore.updateValue(\n    name as string,\n    value,\n    \"replace\",\n    callback,\n    runtimeContext\n  );\n}\n\nfunction handleLocationAction(\n  event: Event,\n  method: \"assign\" | \"reload\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  if (method === \"assign\") {\n    const [url] = argsFactory(args, runtimeContext, event) as [string];\n    location.assign(url);\n  } else {\n    location[method]();\n  }\n}\n\nfunction handleStorageAction(\n  event: Event,\n  object: \"localStorage\" | \"sessionStorage\",\n  method: \"setItem\" | \"removeItem\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const storage = object === \"localStorage\" ? localStorage : sessionStorage;\n  const [name, value] = argsFactory(args, runtimeContext, event);\n  if (method === \"setItem\") {\n    if (value !== undefined) {\n      storage.setItem(name as string, JSON.stringify(value));\n    }\n  } else {\n    storage.removeItem(name as string);\n  }\n}\n\nfunction handleConsoleAction(\n  event: Event,\n  method: \"log\" | \"error\" | \"warn\" | \"info\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  // eslint-disable-next-line no-console\n  console[method](\n    ...argsFactory(args, runtimeContext, event, {\n      useEventAsDefault: true,\n    })\n  );\n}\n\nfunction handleMessageAction(\n  event: Event,\n  method: \"success\" | \"error\" | \"info\" | \"warn\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const computedArgs = argsFactory(args, runtimeContext, event, {\n    useEventAsDefault: true,\n  });\n  Notification.show({\n    type: method,\n    message: computedArgs[0] as string,\n  });\n}\n\nexport function eventCallbackFactory(\n  callback: BrickEventHandlerCallback,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  return function callbackFactory(\n    type: \"success\" | \"error\" | \"finally\" | \"progress\"\n  ) {\n    return function (result?: unknown) {\n      const handlers = callback?.[type];\n      if (handlers) {\n        try {\n          const event = new CustomEvent(`callback.${type}`, {\n            detail: result,\n          });\n          listenerFactory(handlers, runtimeContext, runtimeBrick)(event);\n        } catch (err) {\n          // Do not throw errors in `callback.success` or `callback.progress`,\n          // to avoid the following triggering of `callback.error`.\n          // eslint-disable-next-line\n          console.error(err);\n        }\n      } else if (type === \"error\") {\n        // eslint-disable-next-line\n        console.error(\"Unhandled callback error:\", result);\n      }\n    };\n  };\n}\n\ninterface ArgsFactoryOptions {\n  useEventAsDefault?: boolean;\n  useEventDetailAsDefault?: boolean;\n}\n\nfunction argsFactory(\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext,\n  event: Event,\n  options: ArgsFactoryOptions = {}\n): unknown[] {\n  return Array.isArray(args)\n    ? (computeRealValue(args, {\n        ...runtimeContext,\n        event,\n      }) as unknown[])\n    : options.useEventAsDefault\n    ? [event]\n    : options.useEventDetailAsDefault\n    ? [(event as CustomEvent).detail]\n    : [];\n}\n","import { ContextConf } from \"@next-core/types\";\nimport { collectMemberUsage, MemberUsage } from \"@next-core/utils/storyboard\";\n\nexport interface DeferredContext {\n  resolve(): void;\n  reject(e: unknown): void;\n}\n\nexport function resolveDataStore(\n  contextConfs: ContextConf[],\n  resolveContext: (contextConf: ContextConf) => Promise<boolean>,\n  keyword = \"CTX\"\n): {\n  pendingResult: Promise<void>;\n  pendingContexts: Map<string, Promise<void>>;\n} {\n  const dependencyMap = getDependencyMapOfContext(contextConfs, keyword);\n  // There maybe multiple context confs for a specific name, since there are conditional contexts.\n  // This is a map of how many pending context confs for each context name.\n  const pendingDeps = new Map<string, number>();\n  for (const contextName of Array.from(dependencyMap.keys()).map(\n    (contextConf) => contextConf.name\n  )) {\n    pendingDeps.set(contextName, (pendingDeps.get(contextName) ?? 0) + 1);\n  }\n  const hasNonStaticUsage = Array.from(dependencyMap.values()).some(\n    (stats) => stats.hasNonStaticUsage\n  );\n  const processed = new WeakSet<ContextConf>();\n\n  const deferredContexts = new Map<string, DeferredContext>();\n  const pendingContexts = new Map(\n    [...new Set(contextConfs.map((contextConf) => contextConf.name))].map(\n      (contextName) => [\n        contextName,\n        new Promise<void>((resolve, reject) => {\n          deferredContexts.set(contextName, { resolve, reject });\n        }),\n      ]\n    )\n  );\n\n  const wrapResolve = async (contextConf: ContextConf): Promise<void> => {\n    processed.add(contextConf);\n    const resolved = await resolveContext(contextConf);\n    dependencyMap.delete(contextConf);\n    const left = pendingDeps.get(contextConf.name) ?? 0;\n    if (resolved) {\n      // Assert: contextConf.name exists in deferredContexts\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      deferredContexts.get(contextConf.name)!.resolve();\n      pendingDeps.delete(contextConf.name);\n      if (left === 0) {\n        throw new Error(`Duplicated context defined: ${contextConf.name}`);\n      }\n    } else {\n      // Assert: left >= 1\n      if (left === 1) {\n        // Assert: contextConf.name exists in deferredContexts\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        deferredContexts.get(contextConf.name)!.resolve();\n        pendingDeps.delete(contextConf.name);\n      } else {\n        pendingDeps.set(contextConf.name, left - 1);\n      }\n    }\n    await scheduleNext();\n  };\n\n  let scheduleAsSerial = hasNonStaticUsage;\n\n  async function scheduleNext(): Promise<void> {\n    const readyContexts = Array.from(dependencyMap.entries())\n      .filter(predicateNextResolveFactory(pendingDeps, scheduleAsSerial))\n      .map((entry) => entry[0])\n      .filter((contextConf) => !processed.has(contextConf));\n    await Promise.all(readyContexts.map(wrapResolve));\n  }\n\n  const pendingResult = scheduleNext()\n    .then(async () => {\n      // If there are still contexts left, it implies one of these situations:\n      //   - Circular contexts.\n      //     Such as: a depends on b, while b depends on a.\n      //   - Related contexts are all ignored.\n      //     Such as: a depends on b,\n      //     while both them are ignore by a falsy result of `if`.\n      if (dependencyMap.size > 0) {\n        // This will throw if circular contexts detected.\n        detectCircularContexts(dependencyMap, keyword);\n        scheduleAsSerial = true;\n        await scheduleNext();\n      }\n      // There maybe ignored contexts which are still not fulfilled.\n      // We treat them as RESOLVED.\n      for (const deferred of deferredContexts.values()) {\n        deferred.resolve();\n      }\n    })\n    .catch((error) => {\n      // There maybe contexts left not fulfilled, when an error occurred.\n      // We treat them as REJECTED.\n      for (const deferred of deferredContexts.values()) {\n        deferred.reject(error);\n      }\n      throw error;\n    });\n  return { pendingResult, pendingContexts };\n}\n\nfunction predicateNextResolveFactory(\n  pendingDeps: Map<string, number>,\n  scheduleAsSerial: boolean\n): (entry: [ContextConf, MemberUsage], index: number) => boolean {\n  return (entry, index) =>\n    // When contexts contain computed CTX accesses, it implies a dynamic dependency map.\n    // So make them process sequentially, keep the same behavior as before.\n    scheduleAsSerial\n      ? index === 0\n      : // A context is ready when it has no pending dependencies.\n        ![...entry[1].usedProperties].some((dep) => pendingDeps.has(dep));\n}\n\nexport function getDependencyMapOfContext(\n  contextConfs: ContextConf[],\n  keyword = \"CTX\"\n): Map<ContextConf, MemberUsage> {\n  const depsMap = new Map<ContextConf, MemberUsage>();\n  for (const contextConf of contextConfs) {\n    const stats = collectMemberUsage(\n      [contextConf.if, contextConf.value, contextConf.resolve],\n      keyword\n    );\n    depsMap.set(contextConf, stats);\n  }\n  return depsMap;\n}\n\nfunction detectCircularContexts(\n  dependencyMap: Map<ContextConf, MemberUsage>,\n  keyword: string\n): void {\n  const duplicatedMap = new Map(dependencyMap);\n  const pendingDeps = new Set<string>(\n    Array.from(duplicatedMap.keys()).map((contextConf) => contextConf.name)\n  );\n  const next = (): void => {\n    let processedAtLeastOne = false;\n    for (const [contextConf, stats] of duplicatedMap.entries()) {\n      if (![...stats.usedProperties].some((dep) => pendingDeps.has(dep))) {\n        duplicatedMap.delete(contextConf);\n        pendingDeps.delete(contextConf.name);\n        processedAtLeastOne = true;\n      }\n    }\n    if (processedAtLeastOne) {\n      next();\n    }\n  };\n  next();\n\n  if (duplicatedMap.size > 0) {\n    throw new ReferenceError(\n      `Circular ${keyword} detected: ${Array.from(duplicatedMap.keys())\n        .map((contextConf) => contextConf.name)\n        .join(\", \")}`\n    );\n  }\n}\n","import type { BrickEventHandlerCallback, ContextConf } from \"@next-core/types\";\nimport { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport { strictCollectMemberUsage } from \"@next-core/utils/storyboard\";\nimport { eventCallbackFactory, listenerFactory } from \"../bindListeners.js\";\nimport { asyncCheckIf } from \"../compute/checkIf.js\";\nimport {\n  asyncComputeRealValue,\n  computeRealValue,\n} from \"../compute/computeRealValue.js\";\nimport { ResolveOptions, resolveData } from \"./resolveData.js\";\nimport { resolveDataStore } from \"./resolveDataStore.js\";\nimport type {\n  AsyncProperties,\n  RuntimeBrick,\n  RuntimeContext,\n} from \"../interfaces.js\";\nimport { handleHttpError } from \"../../handleHttpError.js\";\n\nexport type DataStoreType = \"CTX\" | \"STATE\" | \"FORM_STATE\";\n\nexport interface DataStoreItem {\n  value: unknown;\n  eventTarget: EventTarget;\n  loaded?: boolean;\n  loading?: Promise<unknown>;\n  load?: (options?: ResolveOptions) => Promise<unknown>;\n}\n\nexport class DataStore<T extends DataStoreType = \"CTX\"> {\n  private readonly type: T;\n  private readonly data = new Map<string, DataStoreItem>();\n  private readonly changeEventType: string;\n  private readonly pendingStack: Array<ReturnType<typeof resolveDataStore>> =\n    [];\n  public readonly hostBrick?: RuntimeBrick;\n\n  constructor(type: T, hostBrick?: RuntimeBrick) {\n    this.type = type;\n    this.changeEventType =\n      this.type === \"FORM_STATE\"\n        ? \"formstate.change\"\n        : this.type === \"STATE\"\n        ? \"state.change\"\n        : \"context.change\";\n    this.hostBrick = hostBrick;\n  }\n\n  getValue(name: string): unknown {\n    return this.data.get(name)?.value;\n  }\n\n  updateValue(\n    name: string,\n    value: unknown,\n    method: \"assign\" | \"replace\" | \"refresh\" | \"load\",\n    callback?: BrickEventHandlerCallback,\n    callbackRuntimeContext?: RuntimeContext\n  ): void {\n    const item = this.data.get(name);\n    if (!item) {\n      throw new Error(`${this.type} '${name}' is not defined`);\n    }\n\n    if (method === \"refresh\" || method === \"load\") {\n      if (!item.load) {\n        throw new Error(\n          `You can not ${method} \"${this.type}.${name}\" which has no resolve`\n        );\n      }\n\n      let promise: Promise<unknown> | undefined;\n      if (method === \"load\") {\n        // Try to reuse previous request when calling `load`.\n        if (item.loaded) {\n          promise = Promise.resolve(item.value);\n        } else if (item.loading) {\n          promise = item.loading;\n        }\n      }\n\n      if (!promise) {\n        promise = item.loading = item.load({\n          cache: method === \"load\" ? \"default\" : \"reload\",\n          ...(value as ResolveOptions),\n        });\n        // Do not use the chained promise, since the callbacks need the original promise.\n        promise.then(\n          (val) => {\n            item.loaded = true;\n            item.value = val;\n            item.eventTarget.dispatchEvent(\n              new CustomEvent(this.changeEventType, {\n                detail: item.value,\n              })\n            );\n          },\n          (err) => {\n            // Let users override error handling.\n            if (!callback?.error) {\n              handleHttpError(err);\n            }\n          }\n        );\n      }\n\n      if (callback) {\n        const callbackFactory = eventCallbackFactory(\n          callback,\n          callbackRuntimeContext!\n        );\n\n        promise.then(\n          (val) => {\n            callbackFactory(\"success\")({ value: val });\n            callbackFactory(\"finally\")();\n          },\n          (err) => {\n            callbackFactory(\"error\")(err);\n            callbackFactory(\"finally\")();\n          }\n        );\n      }\n\n      return;\n    }\n\n    if (method === \"replace\") {\n      item.value = value;\n    } else {\n      if (isObject(item.value)) {\n        Object.assign(item.value, value);\n      } else {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Non-object current value of \"${this.type}.${name}\" for \"context.assign\", try \"context.replace\" instead.`\n        );\n        item.value = value;\n      }\n    }\n\n    item.eventTarget.dispatchEvent(\n      new CustomEvent(this.changeEventType, {\n        detail: item.value,\n      })\n    );\n  }\n\n  define(\n    dataConfs: ContextConf[] | undefined,\n    runtimeContext: RuntimeContext,\n    asyncHostProperties?: AsyncProperties\n  ): void {\n    if (Array.isArray(dataConfs) && dataConfs.length > 0) {\n      const pending = resolveDataStore(\n        dataConfs,\n        (dataConf: ContextConf) =>\n          this.resolve(dataConf, runtimeContext, asyncHostProperties),\n        this.type\n      );\n      this.pendingStack.push(pending);\n    }\n  }\n\n  onChange(dataName: string, listener: EventListener): void {\n    this.data\n      .get(dataName)\n      ?.eventTarget.addEventListener(this.changeEventType, listener);\n  }\n\n  async waitFor(dataNames: string[] | Set<string>): Promise<void> {\n    for (const { pendingContexts } of this.pendingStack) {\n      await Promise.all(\n        [...dataNames].map((ctx) => {\n          const p = pendingContexts.get(ctx);\n          return p;\n        })\n      );\n    }\n  }\n\n  async waitForAll(): Promise<void> {\n    for (const { pendingResult } of this.pendingStack) {\n      await pendingResult;\n    }\n  }\n\n  private async resolve(\n    dataConf: ContextConf,\n    runtimeContext: RuntimeContext,\n    asyncHostProperties?: AsyncProperties\n  ): Promise<boolean> {\n    if (!(await asyncCheckIf(dataConf, runtimeContext))) {\n      return false;\n    }\n    let value: unknown;\n    if (\n      asyncHostProperties &&\n      (this.type === \"STATE\" ? dataConf.expose : this.type === \"FORM_STATE\")\n    ) {\n      const hostProps = await asyncHostProperties;\n      if (hasOwnProperty(hostProps, dataConf.name)) {\n        value = hostProps[dataConf.name];\n      }\n    }\n    let load: DataStoreItem[\"load\"];\n    let isLazyResolve: boolean | undefined = false;\n    if (value === undefined) {\n      if (dataConf.resolve) {\n        const resolveConf = {\n          transform: \"value\",\n          ...dataConf.resolve,\n        };\n        if (await asyncCheckIf(dataConf.resolve, runtimeContext)) {\n          load = async (options) =>\n            (\n              (await resolveData(resolveConf, runtimeContext, options)) as {\n                value: unknown;\n              }\n            ).value;\n          isLazyResolve = dataConf.resolve.lazy;\n          if (!isLazyResolve) {\n            value = await load();\n          }\n        } else if (!hasOwnProperty(dataConf, \"value\")) {\n          return false;\n        }\n      }\n      if ((!load || isLazyResolve) && dataConf.value !== undefined) {\n        // If the context has no resolve, just use its `value`.\n        // Or if the resolve is ignored or lazy, use its `value` as a fallback.\n        value = await asyncComputeRealValue(dataConf.value, runtimeContext);\n      }\n    }\n\n    const newData: DataStoreItem = {\n      value,\n      // This is required for tracking context, even if no `onChange` is specified.\n      eventTarget: new EventTarget(),\n      load,\n      loaded: !isLazyResolve,\n    };\n\n    if (dataConf.onChange) {\n      newData.eventTarget.addEventListener(\n        this.changeEventType,\n        listenerFactory(dataConf.onChange, runtimeContext)\n      );\n    }\n\n    if (dataConf.track) {\n      const deps = strictCollectMemberUsage(\n        load ? dataConf.resolve : dataConf.value,\n        this.type\n      );\n      for (const dep of deps) {\n        this.onChange(dep, () => {\n          if (load) {\n            this.updateValue(dataConf.name, { cache: \"default\" }, \"refresh\");\n          } else {\n            this.updateValue(\n              dataConf.name,\n              computeRealValue(dataConf.value, runtimeContext),\n              \"replace\"\n            );\n          }\n        });\n      }\n    }\n\n    if (this.data.has(dataConf.name)) {\n      throw new Error(\n        `${this.type} '${dataConf.name}' has already been declared`\n      );\n    }\n    this.data.set(dataConf.name, newData);\n\n    return true;\n  }\n}\n","import type { BrickConf, RouteConf, SlotsConfOfBricks } from \"@next-core/types\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { clamp } from \"lodash\";\nimport {\n  symbolForAsyncComputedPropsFromHost,\n  symbolForTPlExternalForEachItem,\n  symbolForTplStateStoreId,\n} from \"./constants.js\";\nimport type { AsyncProperties, TemplateHostContext } from \"../interfaces.js\";\n\nexport function setupTemplateProxy(\n  hostContext: TemplateHostContext,\n  ref: string | undefined,\n  slots: SlotsConfOfBricks\n) {\n  const {\n    reversedProxies,\n    asyncHostProperties,\n    externalSlots,\n    tplStateStoreId,\n    hostBrick,\n  } = hostContext;\n\n  let asyncComputedProps: AsyncProperties | undefined;\n\n  if (ref && reversedProxies) {\n    const propertyProxies = reversedProxies.properties.get(ref);\n    if (propertyProxies) {\n      const getComputedProps = (hostProps: Record<string, unknown>) => {\n        const props: Record<string, unknown> = {};\n        for (const { from, to } of propertyProxies) {\n          const propValue = hostProps[from];\n          if (propValue !== undefined && to.refProperty) {\n            props[to.refProperty] = propValue;\n          }\n        }\n        return props;\n      };\n\n      asyncComputedProps = (asyncHostProperties as AsyncProperties).then(\n        getComputedProps\n      );\n    }\n\n    const slotProxies = reversedProxies.slots.get(ref);\n    if (slotProxies && externalSlots) {\n      // Use an approach like template-literal's quasis:\n      // `quasi0${0}quais1${1}quasi2...`\n      // Every quasi (indexed by `refPosition`) can be slotted with multiple bricks.\n      const quasisMap = new Map<string, BrickConf[][]>();\n\n      for (const { from, to } of slotProxies) {\n        const insertBricks = externalSlots[from]?.bricks ?? [];\n        if (!insertBricks.length) {\n          continue;\n        }\n        const refToSlot = to.refSlot ?? from;\n        let expandableSlot = quasisMap.get(refToSlot);\n        if (!expandableSlot) {\n          expandableSlot = [];\n          // The size of quasis should be the existed slotted bricks' size plus one.\n          const size = hasOwnProperty(slots, refToSlot)\n            ? slots[refToSlot].bricks.length + 1\n            : 1;\n          for (let i = 0; i < size; i += 1) {\n            expandableSlot.push([]);\n          }\n          quasisMap.set(refToSlot, expandableSlot);\n        }\n        const refPosition = to.refPosition ?? -1;\n        expandableSlot[\n          clamp(\n            refPosition < 0 ? expandableSlot.length + refPosition : refPosition,\n            0,\n            expandableSlot.length - 1\n          )\n        ].push(\n          ...(hasOwnProperty(hostBrick.runtimeContext, \"forEachItem\")\n            ? setupTemplateExternalBricks(\n                insertBricks,\n                hostBrick.runtimeContext.forEachItem\n              )\n            : insertBricks)\n        );\n      }\n\n      for (const [slotName, quasis] of quasisMap.entries()) {\n        if (!hasOwnProperty(slots, slotName)) {\n          slots[slotName] = {\n            type: \"bricks\",\n            bricks: [],\n          };\n        }\n        const slotConf = slots[slotName];\n        slotConf.bricks = quasis.flatMap((bricks, index) =>\n          index < slotConf.bricks.length\n            ? bricks.concat(slotConf.bricks[index])\n            : bricks\n        );\n\n        if (slotConf.bricks.length === 0) {\n          delete slots[slotName];\n        }\n      }\n    }\n  }\n\n  return {\n    [symbolForAsyncComputedPropsFromHost]: asyncComputedProps,\n    [symbolForTplStateStoreId]: tplStateStoreId,\n  };\n}\n\n// External bricks of a template, have the same forEachItem context as their host.\nfunction setupTemplateExternalBricks(\n  bricks: BrickConf[],\n  forEachItem: unknown\n): BrickConf[] {\n  return bricks.map((brick) => ({\n    ...brick,\n    [symbolForTPlExternalForEachItem]: forEachItem,\n    slots: Object.fromEntries(\n      Object.entries(brick.slots ?? {}).map(([slotName, slotConf]) => [\n        slotName,\n        slotConf.type === \"routes\"\n          ? {\n              type: \"routes\",\n              routes: setupTemplateExternalRoutes(slotConf.routes, forEachItem),\n            }\n          : {\n              type: \"bricks\",\n              bricks: setupTemplateExternalBricks(\n                slotConf.bricks ?? [],\n                forEachItem\n              ),\n            },\n      ])\n    ),\n  }));\n}\n\nfunction setupTemplateExternalRoutes(\n  routes: RouteConf[],\n  forEachItem: unknown\n): RouteConf[] {\n  return routes.map((route) =>\n    route.type && route.type !== \"bricks\"\n      ? route\n      : {\n          ...route,\n          bricks: setupTemplateExternalBricks(route.bricks, forEachItem),\n        }\n  );\n}\n","import type { UseBrickSlotsConf, UseSingleBrickConf } from \"@next-core/types\";\nimport { isObject } from \"@next-core/utils/general\";\nimport type { TemplateHostContext } from \"../interfaces.js\";\nimport { setupTemplateProxy } from \"./setupTemplateProxy.js\";\nimport { childrenToSlots } from \"../Renderer.js\";\n\nexport function setupUseBrickInTemplate<T>(\n  props: T,\n  hostContext: TemplateHostContext\n): T {\n  function walk<P>(props: P): P {\n    if (!isObject(props)) {\n      return props;\n    }\n\n    if (Array.isArray(props)) {\n      return props.map(walk) as P;\n    }\n\n    return Object.fromEntries(\n      Object.entries(props)\n        .map(([key, value]) =>\n          isObject(value) && key === \"useBrick\"\n            ? Array.isArray(value)\n              ? [key, value.map(setup)]\n              : [key, setup(value as UseSingleBrickConf)]\n            : [key, walk(value)]\n        )\n        .concat(\n          Object.getOwnPropertySymbols(props).map((k) => [\n            k,\n            (props as Record<string | symbol, unknown>)[k],\n          ])\n        )\n    ) as P;\n  }\n\n  function setup(item: UseSingleBrickConf): UseSingleBrickConf {\n    const { properties, slots: originalSlots, children, ...restConf } = item;\n\n    const transpiledSlots = childrenToSlots(children, originalSlots) as\n      | UseBrickSlotsConf\n      | undefined;\n\n    const slots = Object.fromEntries(\n      Object.entries(transpiledSlots ?? {}).map(([slotName, slotConf]) => [\n        slotName,\n        {\n          type: \"bricks\",\n          bricks: (slotConf.bricks ?? []).map(setup),\n        },\n      ])\n    ) as UseBrickSlotsConf;\n\n    return {\n      ...restConf,\n      properties: walk(properties),\n      slots,\n      ...setupTemplateProxy(hostContext, restConf.ref, slots),\n    };\n  }\n\n  return walk(props);\n}\n","import type {\n  BrickConf,\n  BrickConfInTemplate,\n  SlotsConfInTemplate,\n  SlotsConfOfBricks,\n  UseSingleBrickConf,\n} from \"@next-core/types\";\nimport { uniqueId } from \"lodash\";\nimport { customTemplates } from \"../../CustomTemplates.js\";\nimport { DataStore } from \"../data/DataStore.js\";\nimport { RuntimeBrickConfWithTplSymbols } from \"./constants.js\";\nimport { setupTemplateProxy } from \"./setupTemplateProxy.js\";\nimport type {\n  AsyncProperties,\n  RuntimeBrick,\n  TemplateHostBrick,\n  TemplateHostContext,\n} from \"../interfaces.js\";\nimport { setupUseBrickInTemplate } from \"./setupUseBrickInTemplate.js\";\nimport { childrenToSlots } from \"../Renderer.js\";\nimport { collectWidgetContract } from \"../data/CollectContracts.js\";\n\nexport function expandCustomTemplate<T extends BrickConf | UseSingleBrickConf>(\n  tplTagName: string,\n  brickConf: T,\n  hostBrick: RuntimeBrick,\n  asyncHostProperties: AsyncProperties\n): T {\n  const tplStateStoreId = uniqueId(\"tpl-state-\");\n  const runtimeContext = {\n    ...hostBrick.runtimeContext,\n    tplStateStoreId,\n  };\n\n  // There is a boundary for `forEachItem` and `FORM_STATE` between template internals and externals.\n  delete runtimeContext.forEachItem;\n  delete runtimeContext.formStateStoreId;\n\n  const tplStateStore = new DataStore(\"STATE\", hostBrick);\n  runtimeContext.tplStateStoreMap.set(tplStateStoreId, tplStateStore);\n  if (runtimeContext.tplStateStoreScope) {\n    runtimeContext.tplStateStoreScope.push(tplStateStore);\n  }\n\n  const { bricks, proxy, state, contracts } = customTemplates.get(tplTagName)!;\n  collectWidgetContract(contracts);\n  tplStateStore.define(state, runtimeContext, asyncHostProperties);\n\n  const {\n    slots: originalExternalSlots,\n    children: externalChildren,\n    ...restBrickConf\n  } = brickConf;\n\n  const newBrickConf = {\n    ...restBrickConf,\n    brick: tplTagName,\n  } as T;\n\n  hostBrick.tplHostMetadata = {\n    internalBricksByRef: new Map(),\n    tplStateStoreId,\n    proxy,\n  };\n\n  // Reversed proxies are used for expand storyboard before rendering page.\n  const reversedProxies: TemplateHostContext[\"reversedProxies\"] = {\n    properties: new Map(),\n    slots: new Map(),\n    // mergeBases: new Map(),\n  };\n\n  if (proxy?.properties) {\n    for (const [from, to] of Object.entries(proxy.properties)) {\n      let proxies = reversedProxies.properties.get(to.ref);\n      if (!proxies) {\n        proxies = [];\n        reversedProxies.properties.set(to.ref, proxies);\n      }\n      proxies.push({\n        from,\n        to,\n      });\n    }\n  }\n\n  if (proxy?.slots) {\n    for (const [from, to] of Object.entries(proxy.slots)) {\n      let proxies = reversedProxies.slots.get(to.ref);\n      if (!proxies) {\n        proxies = [];\n        reversedProxies.slots.set(to.ref, proxies);\n      }\n      proxies.push({\n        from,\n        to,\n      });\n    }\n  }\n\n  const hostContext: TemplateHostContext = {\n    reversedProxies,\n    asyncHostProperties,\n    externalSlots: childrenToSlots(externalChildren, originalExternalSlots) as\n      | SlotsConfOfBricks\n      | undefined,\n    tplStateStoreId,\n    hostBrick: hostBrick as TemplateHostBrick,\n  };\n\n  newBrickConf.slots = {\n    \"\": {\n      type: \"bricks\",\n      bricks: bricks.map((item) => expandBrickInTemplate(item, hostContext)),\n    },\n  };\n\n  return newBrickConf;\n}\n\nfunction expandBrickInTemplate(\n  brickConfInTemplate: BrickConfInTemplate,\n  hostContext: TemplateHostContext\n): RuntimeBrickConfWithTplSymbols {\n  // Ignore `if: null` to make `looseCheckIf` working.\n  if (brickConfInTemplate.if === null) {\n    delete brickConfInTemplate.if;\n  }\n  const {\n    properties,\n    slots: slotsInTemplate,\n    children: childrenInTemplate,\n    ...restBrickConfInTemplate\n  } = brickConfInTemplate;\n\n  const transpiledSlots = childrenToSlots(\n    childrenInTemplate,\n    slotsInTemplate\n  ) as SlotsConfInTemplate | undefined;\n\n  const slots: SlotsConfOfBricks = Object.fromEntries(\n    Object.entries(transpiledSlots ?? {}).map(([slotName, slotConf]) => [\n      slotName,\n      {\n        type: \"bricks\",\n        bricks: (slotConf.bricks ?? []).map((item) =>\n          expandBrickInTemplate(item, hostContext)\n        ),\n      },\n    ])\n  );\n\n  return {\n    ...restBrickConfInTemplate,\n    properties: setupUseBrickInTemplate(properties, hostContext),\n    slots,\n    ...setupTemplateProxy(hostContext, restBrickConfInTemplate.ref, slots),\n  };\n}\n","export enum RenderTag {\n  ROOT = 1,\n  BRICK = 2,\n}\n","import type { BrickConf } from \"@next-core/types\";\n\nexport const FORM_RENDERER = \"form-renderer.form-renderer\";\nexport const symbolForFormStateStoreId = Symbol.for(\"form.stateStoreId\");\n\nexport type RuntimeBrickConfWithFormSymbols = BrickConf &\n  RuntimeBrickConfOfFormSymbols;\n\nexport interface RuntimeBrickConfOfFormSymbols {\n  [symbolForFormStateStoreId]?: string;\n}\n","import type { BrickConf, BrickEventsMap } from \"@next-core/types\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { uniqueId } from \"lodash\";\nimport { DataStore } from \"../data/DataStore.js\";\nimport type { AsyncProperties, RuntimeBrick } from \"../interfaces.js\";\nimport type {\n  FieldProperties,\n  FormDataProperties,\n  FormSchemaProperties,\n} from \"./interfaces.js\";\nimport { getDefaultProperties } from \"./getDefaultProperties.js\";\nimport { symbolForFormStateStoreId } from \"./constants.js\";\n\nexport function expandFormRenderer(\n  formData: unknown,\n  hostBrickConf: BrickConf,\n  hostBrick: RuntimeBrick,\n  asyncHostProperties: AsyncProperties\n): BrickConf {\n  const normalizedFormData = (\n    typeof formData === \"string\" ? JSON.parse(formData) : formData\n  ) as FormDataProperties;\n\n  const formStateStoreId = uniqueId(\"form-state-\");\n  const runtimeContext = {\n    ...hostBrick.runtimeContext,\n    formStateStoreId,\n  };\n\n  // There is a boundary for `forEachItem` and `STATE` between form internals and externals.\n  delete runtimeContext.forEachItem;\n  delete runtimeContext.tplStateStoreId;\n\n  const formStateStore = new DataStore(\"FORM_STATE\");\n  runtimeContext.formStateStoreMap.set(formStateStoreId, formStateStore);\n  if (runtimeContext.formStateStoreScope) {\n    runtimeContext.formStateStoreScope.push(formStateStore);\n  }\n\n  // Always add a state of `params`.\n  const context = normalizedFormData.context ?? [];\n  if (!context.some((ctx) => ctx.name === \"params\")) {\n    context.push({ name: \"params\" });\n  }\n\n  formStateStore.define(context, runtimeContext, asyncHostProperties);\n\n  const formConf = formSchemaToBrick(\n    normalizedFormData.formSchema,\n    normalizedFormData.fields,\n    formStateStoreId\n  );\n\n  if (formConf.brick === \"forms.general-form\" && hostBrickConf.events) {\n    formConf.events = mergeEvents(formConf.events, hostBrickConf.events);\n  }\n\n  const renderRoot =\n    typeof hostBrickConf.properties?.renderRoot !== \"boolean\" ||\n    hostBrickConf.properties.renderRoot;\n\n  if (renderRoot) {\n    return {\n      ...hostBrickConf,\n      slots: undefined,\n      children: [\n        {\n          brick: \"basic-bricks.micro-view\",\n          properties: { style: { padding: \"12px\" } },\n          slots: {\n            content: { bricks: [formConf], type: \"bricks\" },\n          },\n        },\n      ],\n    };\n  }\n\n  return {\n    ...hostBrickConf,\n    slots: undefined,\n    children: [formConf],\n  };\n}\n\nfunction formSchemaToBrick(\n  schema: FormSchemaProperties,\n  fields: FieldProperties[],\n  formStateStoreId: string\n): BrickConf {\n  const { id, bricks, events, context, mountPoint, instanceId: iid } = schema;\n  let { brick, properties } = schema;\n\n  // 根据字段类型获取默认配置\n  const field = fields.find((item: FieldProperties) => item.fieldId === id);\n  if (field) {\n    const defaults = getDefaultProperties(field);\n    if (!brick) {\n      brick = defaults.brick;\n    }\n    properties = {\n      ...defaults.properties,\n      ...properties,\n    };\n  }\n\n  const brickConf = {\n    brick,\n    properties,\n    iid,\n    slot: mountPoint,\n    events,\n    context,\n    children: formSchemasToBricks(bricks, fields, formStateStoreId),\n    [symbolForFormStateStoreId]: formStateStoreId,\n  } as BrickConf;\n\n  if (hasOwnProperty(schema, \"if\")) {\n    brickConf.if = schema.if;\n  }\n\n  return brickConf;\n}\n\nfunction formSchemasToBricks(\n  schemas: FormSchemaProperties[] | undefined,\n  fields: FieldProperties[],\n  formStateStoreId: string\n): BrickConf[] | undefined {\n  if (Array.isArray(schemas)) {\n    return schemas.map((schema) =>\n      formSchemaToBrick(schema, fields, formStateStoreId)\n    );\n  }\n}\n\nfunction mergeEvents(\n  targetEvents: BrickEventsMap | undefined,\n  sourceEvents: BrickEventsMap\n): BrickEventsMap {\n  const events = targetEvents ?? {};\n\n  for (const [eventType, handlers] of Object.entries(sourceEvents)) {\n    events[eventType] = hasOwnProperty(events, eventType)\n      ? [events[eventType], handlers].flat()\n      : handlers;\n  }\n\n  return events;\n}\n","import type { DefaultFieldProperties, FieldProperties } from \"./interfaces.js\";\n\nexport function getDefaultProperties(\n  field: FieldProperties\n): DefaultFieldProperties {\n  let defaultValue: DefaultFieldProperties;\n  const commonProps = {\n    id: field.fieldId,\n    name: field.fieldId,\n    label: field.name,\n    dataset: {\n      testid: field.fieldId,\n    },\n  };\n  const getReadOnlyAndRequired = () => ({\n    readOnly: field.limit?.includes(\"READONLY\"),\n    required: field.limit?.includes(\"REQUIRED\"),\n  });\n  switch (field.fieldType) {\n    case \"INT\":\n      defaultValue = {\n        brick: \"forms.general-input-number\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          precision: 0,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"BOOLEAN\":\n      defaultValue = {\n        brick: \"forms.general-switch\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n        },\n      };\n      break;\n    case \"FLOAT\":\n      defaultValue = {\n        brick: \"forms.general-input-number\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"ENUM\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          options: [\n            { label: \"选项一\", value: 1 },\n            { label: \"选项二\", value: 2 },\n          ],\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"ENUMS\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          mode: \"multiple\",\n          options: [\n            { label: \"选项一\", value: 1 },\n            { label: \"选项二\", value: 2 },\n          ],\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"DATE\":\n    case \"TIME\":\n      defaultValue = {\n        brick: \"forms.general-date-picker\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n        },\n      };\n      break;\n    case \"IP\":\n      defaultValue = {\n        brick: \"forms.general-input\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          pattern:\n            \"((^s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]).){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))s*$)|(^s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?s*$))\",\n          message: {\n            pattern: \"输入字符不匹配IP格式\",\n          },\n        },\n      };\n      break;\n    case \"JSON\":\n      defaultValue = {\n        brick: \"forms.general-textarea\",\n        properties: {\n          ...commonProps,\n        },\n      };\n      break;\n    case \"ARRAY\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n        },\n      };\n      break;\n    case \"STRUCTURE\":\n    case \"STRUCTURE_ARRAY\":\n      defaultValue = {\n        brick: \"forms.cmdb-instance-select-panel\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n        },\n      };\n      break;\n    default:\n      defaultValue = {\n        brick: \"forms.general-input\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n        },\n      };\n  }\n  return defaultValue;\n}\n","import type {\n  BrickConf,\n  BrickConfInTemplate,\n  ContextConf,\n  MenuConf,\n  RouteConf,\n  SlotConfOfBricks,\n  SlotsConf,\n  StaticMenuConf,\n} from \"@next-core/types\";\nimport {\n  enqueueStableLoadBricks,\n  loadBricksImperatively,\n} from \"@next-core/loader\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { debounce } from \"lodash\";\nimport { asyncCheckBrickIf } from \"./compute/checkIf.js\";\nimport { asyncComputeRealProperties } from \"./compute/computeRealProperties.js\";\nimport { resolveData } from \"./data/resolveData.js\";\nimport { asyncComputeRealValue } from \"./compute/computeRealValue.js\";\nimport { preCheckPermissionsForBrickOrRoute } from \"./checkPermissions.js\";\nimport {\n  TrackingContextItem,\n  listenOnTrackingContext,\n} from \"./compute/listenOnTrackingContext.js\";\nimport { RendererContext } from \"./RendererContext.js\";\nimport { matchRoutes } from \"./matchRoutes.js\";\nimport {\n  symbolForAsyncComputedPropsFromHost,\n  symbolForTPlExternalForEachItem,\n  symbolForTplStateStoreId,\n} from \"./CustomTemplates/constants.js\";\nimport { expandCustomTemplate } from \"./CustomTemplates/expandCustomTemplate.js\";\nimport type {\n  RenderBrick,\n  RenderNode,\n  RuntimeBrickConfWithSymbols,\n  RuntimeContext,\n} from \"./interfaces.js\";\nimport {\n  getTagNameOfCustomTemplate,\n  getTplStateStore,\n} from \"./CustomTemplates/utils.js\";\nimport { customTemplates } from \"../CustomTemplates.js\";\nimport type { NextHistoryState } from \"./historyExtended.js\";\nimport { getBrickPackages } from \"./Runtime.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { getTracks } from \"./compute/getTracks.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../isStrictMode.js\";\nimport {\n  FORM_RENDERER,\n  symbolForFormStateStoreId,\n} from \"./FormRenderer/constants.js\";\nimport { expandFormRenderer } from \"./FormRenderer/expandFormRenderer.js\";\n\nexport interface RenderOutput {\n  node?: RenderBrick;\n  unauthenticated?: boolean;\n  redirect?: {\n    path: string;\n    state?: NextHistoryState;\n  };\n  route?: RouteConf;\n  blockingList: (Promise<unknown> | undefined)[];\n  menuRequests: (Promise<StaticMenuConf | undefined> | undefined)[];\n  hasTrackingControls?: boolean;\n}\n\nexport async function renderRoutes(\n  returnNode: RenderNode,\n  routes: RouteConf[],\n  _runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  slotId?: string\n): Promise<RenderOutput> {\n  const matched = await matchRoutes(routes, _runtimeContext);\n  const output: RenderOutput = {\n    blockingList: [],\n    menuRequests: [],\n  };\n  switch (matched) {\n    case \"missed\":\n      break;\n    case \"unauthenticated\":\n      output.unauthenticated = true;\n      break;\n    default: {\n      const route = (output.route = matched.route);\n      const runtimeContext = {\n        ..._runtimeContext,\n        match: matched.match,\n      };\n      runtimeContext.ctxStore.define(route.context, runtimeContext);\n      runtimeContext.pendingPermissionsPreCheck.push(\n        preCheckPermissionsForBrickOrRoute(route, runtimeContext)\n      );\n      switch (route.type) {\n        case \"redirect\": {\n          let redirectTo: unknown;\n          if (typeof route.redirect === \"string\") {\n            redirectTo = await asyncComputeRealValue(\n              route.redirect,\n              runtimeContext\n            );\n          } else {\n            const resolved = (await resolveData(\n              {\n                transform: \"redirect\",\n                ...route.redirect,\n              },\n              runtimeContext\n            )) as { redirect?: unknown };\n            redirectTo = resolved.redirect;\n          }\n          if (typeof redirectTo !== \"string\") {\n            // eslint-disable-next-line no-console\n            console.error(\"Unexpected redirect result:\", redirectTo);\n            throw new Error(\n              `Unexpected type of redirect result: ${typeof redirectTo}`\n            );\n          }\n          output.redirect = { path: redirectTo };\n          break;\n        }\n        case \"routes\": {\n          output.menuRequests.push(loadMenu(route.menu, runtimeContext));\n          const newOutput = await renderRoutes(\n            returnNode,\n            route.routes,\n            runtimeContext,\n            rendererContext,\n            slotId\n          );\n          mergeRenderOutput(output, newOutput);\n          break;\n        }\n        default: {\n          output.menuRequests.push(loadMenu(route.menu, runtimeContext));\n          const newOutput = await renderBricks(\n            returnNode,\n            route.bricks,\n            runtimeContext,\n            rendererContext,\n            slotId\n          );\n          mergeRenderOutput(output, newOutput);\n        }\n      }\n    }\n  }\n  return output;\n}\n\nexport async function renderBricks(\n  returnNode: RenderNode,\n  bricks: BrickConf[],\n  runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  slotId?: string,\n  tplStack?: Map<string, number>,\n  noMemoize?: boolean\n): Promise<RenderOutput> {\n  const output: RenderOutput = {\n    blockingList: [],\n    menuRequests: [],\n  };\n  // 多个构件并行异步转换，但转换的结果按原顺序串行合并。\n  const rendered = await Promise.all(\n    bricks.map((brickConf, index) =>\n      renderBrick(\n        returnNode,\n        brickConf,\n        runtimeContext,\n        rendererContext,\n        slotId,\n        index,\n        tplStack && new Map(tplStack)\n      )\n    )\n  );\n\n  rendered.forEach((item, index) => {\n    if (!noMemoize && item.hasTrackingControls) {\n      // Memoize a render node before it's been merged.\n      rendererContext.memoizeControlNode(slotId, index, item.node, returnNode);\n    }\n    mergeRenderOutput(output, item);\n  });\n\n  return output;\n}\n\nexport async function renderBrick(\n  returnNode: RenderNode,\n  brickConf: RuntimeBrickConfWithSymbols,\n  _runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  slotId?: string,\n  key?: number,\n  tplStack = new Map<string, number>()\n): Promise<RenderOutput> {\n  const output: RenderOutput = {\n    blockingList: [],\n    menuRequests: [],\n  };\n\n  if (!brickConf.brick) {\n    if ((brickConf as { template?: string }).template) {\n      // eslint-disable-next-line no-console\n      console.error(\"Legacy templates are dropped in v3:\", brickConf);\n    } else {\n      // eslint-disable-next-line no-console\n      console.error(\"Invalid brick:\", brickConf);\n    }\n    return output;\n  }\n\n  const tplStateStoreId = brickConf[symbolForTplStateStoreId];\n  const formStateStoreId = brickConf[symbolForFormStateStoreId];\n  const runtimeContext = {\n    ..._runtimeContext,\n    tplStateStoreId,\n    formStateStoreId,\n  };\n\n  if (hasOwnProperty(brickConf, symbolForTPlExternalForEachItem)) {\n    // The external bricks of a template should restore their `forEachItem`\n    // from their host.\n    runtimeContext.forEachItem = brickConf[symbolForTPlExternalForEachItem];\n  }\n\n  const { context } = brickConf as { context?: ContextConf[] };\n  // istanbul ignore next\n  if (Array.isArray(context) && context.length > 0) {\n    const strict = isStrictMode(runtimeContext);\n    warnAboutStrictMode(\n      strict,\n      \"Defining context on bricks\",\n      \"check your brick:\",\n      brickConf\n    );\n    if (!strict) {\n      runtimeContext.ctxStore.define(context, runtimeContext);\n    }\n  }\n\n  runtimeContext.pendingPermissionsPreCheck.push(\n    preCheckPermissionsForBrickOrRoute(brickConf, runtimeContext)\n  );\n\n  if (!(await asyncCheckBrickIf(brickConf, runtimeContext))) {\n    return output;\n  }\n\n  const brickName = brickConf.brick;\n  if (brickName.startsWith(\":\")) {\n    ensureValidControlBrick(brickName);\n\n    const { dataSource } = brickConf;\n\n    const renderControlNode = async () => {\n      // First, compute the `dataSource`\n      const computedDataSource = await asyncComputeRealValue(\n        dataSource,\n        runtimeContext\n      );\n\n      // Then, get the matched slot.\n      const slot =\n        brickName === \":forEach\"\n          ? \"\"\n          : brickName === \":switch\"\n          ? String(computedDataSource)\n          : computedDataSource\n          ? \"\"\n          : \"else\";\n\n      // Don't forget to transpile children to slots.\n      const slots = childrenToSlots(brickConf.children, brickConf.slots);\n\n      // Then, get the bricks in that matched slot.\n      const bricks =\n        slots &&\n        hasOwnProperty(slots, slot) &&\n        (slots[slot] as SlotConfOfBricks)?.bricks;\n\n      if (!Array.isArray(bricks)) {\n        return output;\n      }\n\n      switch (brickName) {\n        case \":forEach\": {\n          if (!Array.isArray(computedDataSource)) {\n            return output;\n          }\n          return renderForEach(\n            returnNode,\n            computedDataSource,\n            bricks,\n            runtimeContext,\n            rendererContext,\n            slotId,\n            tplStack\n          );\n        }\n        case \":if\":\n        case \":switch\": {\n          return renderBricks(\n            returnNode,\n            bricks,\n            runtimeContext,\n            rendererContext,\n            slotId,\n            tplStack,\n            true\n          );\n        }\n      }\n    };\n\n    const controlledOutput = await renderControlNode();\n\n    const { contextNames, stateNames } = getTracks(dataSource);\n    if (contextNames || stateNames) {\n      controlledOutput.hasTrackingControls = true;\n      let renderId = 0;\n      const listener = async () => {\n        const currentRenderId = ++renderId;\n        const output = await renderControlNode();\n        output.blockingList.push(\n          ...[\n            ...runtimeContext.tplStateStoreMap.values(),\n            ...runtimeContext.formStateStoreMap.values(),\n          ].map((store) => store.waitForAll()),\n          ...runtimeContext.pendingPermissionsPreCheck\n        );\n        await Promise.all(output.blockingList);\n        // Ignore stale renders\n        if (renderId === currentRenderId) {\n          rendererContext.rerenderControlNode(\n            slotId,\n            key as number,\n            output.node,\n            returnNode\n          );\n        }\n      };\n      const debouncedListener = debounce(listener);\n      if (contextNames) {\n        for (const contextName of contextNames) {\n          runtimeContext.ctxStore.onChange(contextName, debouncedListener);\n        }\n      }\n      if (stateNames) {\n        for (const contextName of stateNames) {\n          const tplStateStore = getTplStateStore(\n            runtimeContext,\n            \"STATE\",\n            `: \"${dataSource}\"`\n          );\n          tplStateStore.onChange(contextName, debouncedListener);\n        }\n      }\n    }\n\n    return controlledOutput;\n  }\n\n  // Widgets need to be defined before rendering.\n  if (/\\.tpl-/.test(brickName) && !customTemplates.get(brickName)) {\n    await catchLoadBrick(\n      loadBricksImperatively([brickName], getBrickPackages()),\n      brickName,\n      rendererContext.unknownBricks\n    );\n  }\n\n  const tplTagName = getTagNameOfCustomTemplate(\n    brickName,\n    runtimeContext.app?.id\n  );\n\n  if (tplTagName) {\n    const tplCount = tplStack.get(tplTagName) ?? 0;\n    if (tplCount >= 10) {\n      throw new Error(\n        `Maximum custom template stack overflowed: \"${tplTagName}\"`\n      );\n    }\n    tplStack.set(tplTagName, tplCount + 1);\n  } else if (brickName.includes(\"-\") && !customElements.get(brickName)) {\n    if (brickName === FORM_RENDERER) {\n      customElements.define(\n        FORM_RENDERER,\n        class FormRendererElement extends HTMLElement {\n          get $$typeof(): string {\n            return \"form-renderer\";\n          }\n        }\n      );\n    } else {\n      output.blockingList.push(\n        catchLoadBrick(\n          enqueueStableLoadBricks([brickName], getBrickPackages()),\n          brickName,\n          rendererContext.unknownBricks\n        )\n      );\n    }\n  }\n\n  const brick: RenderBrick = {\n    tag: RenderTag.BRICK,\n    type: tplTagName || brickName,\n    return: returnNode,\n    slotId,\n    events: brickConf.events,\n    runtimeContext,\n    portal: brickConf.portal,\n    iid: brickConf.iid,\n    ref: (brickConf as BrickConfInTemplate).ref,\n  };\n\n  output.node = brick;\n\n  // const confProps = brickConf.properties;\n  let formData: unknown;\n  let confProps: Record<string, unknown> | undefined;\n  if (brickName === FORM_RENDERER) {\n    ({ formData, ...confProps } = brickConf.properties ?? {});\n  } else {\n    confProps = brickConf.properties;\n  }\n\n  // 加载构件属性和加载子构件等任务，可以并行。\n  const blockingList: Promise<unknown>[] = [];\n\n  const trackingContextList: TrackingContextItem[] = [];\n  const loadProperties = async () => {\n    brick.properties = await asyncComputeRealProperties(\n      confProps,\n      runtimeContext,\n      trackingContextList\n    );\n    const computedPropsFromHost =\n      brickConf[symbolForAsyncComputedPropsFromHost];\n    if (computedPropsFromHost) {\n      brick.properties ??= {};\n      const computed = await computedPropsFromHost;\n      for (const [propName, propValue] of Object.entries(computed)) {\n        brick.properties[propName] = propValue;\n      }\n    }\n    listenOnTrackingContext(brick, trackingContextList);\n    return brick.properties;\n  };\n  const asyncProperties = loadProperties();\n  blockingList.push(asyncProperties);\n\n  rendererContext.registerBrickLifeCycle(brick, brickConf.lifeCycle);\n\n  let expandedBrickConf = brickConf;\n  if (tplTagName) {\n    expandedBrickConf = expandCustomTemplate(\n      tplTagName,\n      brickConf,\n      brick,\n      asyncProperties\n    );\n  } else if (brickName === FORM_RENDERER) {\n    expandedBrickConf = expandFormRenderer(\n      formData,\n      brickConf,\n      brick,\n      asyncProperties\n    );\n  }\n\n  if (expandedBrickConf.portal) {\n    // A portal brick has no slotId.\n    brick.slotId = undefined;\n  }\n\n  let childRuntimeContext: RuntimeContext;\n  if (tplTagName) {\n    // There is a boundary for `forEachItem` between template internals and externals.\n    childRuntimeContext = {\n      ...runtimeContext,\n    };\n    delete childRuntimeContext.forEachItem;\n  } else {\n    childRuntimeContext = runtimeContext;\n  }\n\n  const loadChildren = async () => {\n    const slots = childrenToSlots(\n      expandedBrickConf.children,\n      expandedBrickConf.slots\n    );\n    if (!slots) {\n      return;\n    }\n    const rendered = await Promise.all(\n      Object.entries(slots).map(([childSlotId, slotConf]) =>\n        slotConf.type !== \"routes\"\n          ? renderBricks(\n              brick,\n              (slotConf as SlotConfOfBricks).bricks,\n              childRuntimeContext,\n              rendererContext,\n              childSlotId,\n              tplStack\n            )\n          : renderRoutes(\n              brick,\n              slotConf.routes,\n              childRuntimeContext,\n              rendererContext,\n              childSlotId\n            )\n      )\n    );\n\n    const childrenOutput: RenderOutput = {\n      ...output,\n      node: undefined,\n      blockingList: [],\n    };\n    for (const item of rendered) {\n      mergeRenderOutput(childrenOutput, item);\n    }\n    if (childrenOutput.node) {\n      brick.child = childrenOutput.node;\n    }\n    mergeRenderOutput(output, {\n      ...childrenOutput,\n      node: undefined,\n    });\n  };\n  blockingList.push(loadChildren());\n\n  await Promise.all(blockingList);\n\n  return output;\n}\n\ntype ValidControlBrick = \":forEach\" | \":if\" | \":switch\";\n\nfunction ensureValidControlBrick(\n  brick: string\n): asserts brick is ValidControlBrick {\n  if (brick !== \":forEach\" && brick !== \":if\" && brick !== \":switch\") {\n    throw new Error(`Unknown storyboard control node: \"${brick}\"`);\n  }\n}\n\nasync function renderForEach(\n  returnNode: RenderNode,\n  dataSource: unknown[],\n  bricks: BrickConf[],\n  runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  slotId: string | undefined,\n  tplStack?: Map<string, number>\n): Promise<RenderOutput> {\n  const output: RenderOutput = {\n    blockingList: [],\n    menuRequests: [],\n  };\n\n  const rendered = await Promise.all(\n    dataSource.map((item, i) =>\n      Promise.all(\n        bricks.map((brickConf, j) =>\n          renderBrick(\n            returnNode,\n            brickConf,\n            {\n              ...runtimeContext,\n              forEachItem: item,\n            },\n            rendererContext,\n            slotId,\n            i * j,\n            tplStack && new Map(tplStack)\n          )\n        )\n      )\n    )\n  );\n\n  // 多层构件并行异步转换，但转换的结果按原顺序串行合并。\n  for (const item of rendered.flat()) {\n    mergeRenderOutput(output, item);\n  }\n  return output;\n}\n\nfunction loadMenu(\n  menuConf: MenuConf | undefined,\n  runtimeContext: RuntimeContext\n) {\n  if (!menuConf) {\n    return;\n  }\n\n  // istanbul ignore next\n  if ((menuConf as { type?: \"brick\" }).type === \"brick\") {\n    // eslint-disable-next-line no-console\n    console.error(\"Set menu with brick is dropped in v3:\", menuConf);\n    throw new Error(\"Set menu with brick is dropped in v3\");\n  }\n\n  // istanbul ignore next\n  if (menuConf.type === \"resolve\") {\n    // eslint-disable-next-line no-console\n    console.warn(\"Set menu with resolve is not supported in v3 yet:\", menuConf);\n    return;\n  }\n\n  return asyncComputeRealValue(\n    menuConf,\n    runtimeContext\n  ) as Promise<StaticMenuConf>;\n}\n\nfunction mergeRenderOutput(\n  output: RenderOutput,\n  newOutput: RenderOutput\n): void {\n  const { blockingList, node, menuRequests, hasTrackingControls, ...rest } =\n    newOutput;\n  output.blockingList.push(...blockingList);\n  output.menuRequests.push(...menuRequests);\n\n  if (node) {\n    if (output.node) {\n      let last = output.node;\n      while (last.sibling) {\n        last = last.sibling;\n      }\n      last.sibling = node;\n    } else {\n      output.node = node;\n    }\n  }\n\n  Object.assign(output, rest);\n}\n\nexport function childrenToSlots(\n  children: BrickConf[] | undefined,\n  originalSlots: SlotsConf | undefined\n) {\n  let newSlots = originalSlots;\n  // istanbul ignore next\n  if (\n    process.env.NODE_ENV === \"development\" &&\n    children &&\n    !Array.isArray(children)\n  ) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      \"Specified brick children but not array:\",\n      `<${typeof children}>`,\n      children\n    );\n  }\n  if (Array.isArray(children) && !newSlots) {\n    newSlots = {};\n    for (const child of children) {\n      const slot = child.slot ?? \"\";\n      if (!hasOwnProperty(newSlots, slot)) {\n        newSlots[slot] = {\n          type: \"bricks\",\n          bricks: [],\n        };\n      }\n      (newSlots[slot] as SlotConfOfBricks).bricks.push(child);\n    }\n  }\n  return newSlots;\n}\n\nfunction catchLoadBrick(\n  promise: Promise<unknown>,\n  brickName: string,\n  unknownBricks: RendererContext[\"unknownBricks\"]\n) {\n  return unknownBricks === \"silent\"\n    ? promise.catch((e) => {\n        // eslint-disable-next-line no-console\n        console.error(`Load brick \"${brickName}\" failed:`, e);\n      })\n    : promise;\n}\n","import type { RuntimeBrick } from \"../interfaces.js\";\nimport { getTplStateStore } from \"./utils.js\";\n\nexport function bindTemplateProxy(brick: RuntimeBrick) {\n  const { ref, runtimeContext, element } = brick;\n\n  // Error recovering brick may have no runtimeContext.\n  if (!ref || !runtimeContext.tplStateStoreId) {\n    return;\n  }\n\n  const { hostBrick } = getTplStateStore(runtimeContext, \"bindTemplateProxy\");\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const tplHostMetadata = hostBrick!.tplHostMetadata!;\n\n  tplHostMetadata.internalBricksByRef.set(ref, brick);\n\n  const events = tplHostMetadata.proxy?.events;\n  if (events) {\n    for (const [from, to] of Object.entries(events)) {\n      if (to.ref === ref) {\n        const listener = (e: Event) => {\n          if (e.bubbles) {\n            e.stopPropagation();\n          }\n          hostBrick!.element!.dispatchEvent(\n            new CustomEvent(from, {\n              detail: (e as CustomEvent).detail,\n              bubbles: e.bubbles,\n              cancelable: e.cancelable,\n              composed: e.composed,\n            })\n          );\n        };\n        const eventType = to.refEvent ?? from;\n        element!.addEventListener(eventType, listener);\n        element!.$$proxyListeners ??= [];\n        element!.$$proxyListeners.push([eventType, listener]);\n      }\n    }\n  }\n}\n\nexport function unbindTemplateProxy(brick: RuntimeBrick) {\n  const { ref, runtimeContext, element } = brick;\n\n  if (!runtimeContext.tplStateStoreId || !ref) {\n    return;\n  }\n\n  const { hostBrick } = getTplStateStore(runtimeContext, \"unbindTemplateProxy\");\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const tplHostMetadata = hostBrick!.tplHostMetadata!;\n\n  tplHostMetadata.internalBricksByRef.delete(ref);\n\n  for (const [type, fn] of element!.$$proxyListeners ?? []) {\n    element!.removeEventListener(type, fn);\n  }\n  delete element!.$$proxyListeners;\n}\n","import { bindTemplateProxy } from \"./CustomTemplates/bindTemplateProxy.js\";\nimport { getTplStateStore } from \"./CustomTemplates/utils.js\";\nimport { bindListeners } from \"./bindListeners.js\";\nimport { setRealProperties } from \"./compute/setRealProperties.js\";\nimport { RenderTag } from \"./enums.js\";\nimport type {\n  RenderNode,\n  RenderRoot,\n  RuntimeBrickElement,\n} from \"./interfaces.js\";\n\nexport function unmountTree(mountPoint: HTMLElement) {\n  mountPoint.innerHTML = \"\";\n}\n\nexport function mountTree(\n  root: RenderRoot,\n  initializedElement?: RuntimeBrickElement\n): void {\n  let current = root.child;\n  const portalElements: RuntimeBrickElement[] = [];\n  while (current) {\n    const tagName = current.type;\n\n    if (tagName.includes(\"-\") && !customElements.get(tagName)) {\n      // eslint-disable-next-line no-console\n      console.error(`Undefined custom element: ${tagName}`);\n    }\n\n    // istanbul ignore if\n    if (tagName === \"basic-bricks.script-brick\") {\n      // eslint-disable-next-line no-console\n      console.warn(\n        \"`basic-bricks.script-brick` is deprecated, please take caution when using it\"\n      );\n    }\n\n    const element: RuntimeBrickElement =\n      initializedElement && current === root.child\n        ? initializedElement\n        : document.createElement(tagName);\n    current.element = element;\n\n    if (current.slotId) {\n      element.setAttribute(\"slot\", current.slotId);\n    }\n    if (current.iid) {\n      element.dataset.iid = current.iid;\n    }\n    setRealProperties(element, current.properties);\n    bindListeners(element, current.events, current.runtimeContext);\n    if (current.tplHostMetadata) {\n      // 先设置属性，再设置 `$$tplStateStore`，这样，当触发属性设置时，\n      // 避免初始化的一次 state update 操作及其 onChange 事件。\n      element.$$tplStateStore = getTplStateStore(\n        {\n          tplStateStoreId: current.tplHostMetadata.tplStateStoreId,\n          tplStateStoreMap: current.runtimeContext.tplStateStoreMap,\n        },\n        \"mount\"\n      );\n    }\n    bindTemplateProxy(current);\n\n    if (current.portal) {\n      portalElements.push(element);\n    } else if (current.return) {\n      if (!current.return.childElements) {\n        current.return.childElements = [];\n      }\n      current.return.childElements.push(element);\n    }\n\n    if (current.child) {\n      current = current.child;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderNode | null | undefined = current.return;\n      while (currentReturn) {\n        // Append elements inside out\n        if (currentReturn.childElements) {\n          if (currentReturn.tag === RenderTag.ROOT) {\n            currentReturn.container?.append(...currentReturn.childElements);\n          } else {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            currentReturn.element!.append(...currentReturn.childElements);\n          }\n          currentReturn.childElements = undefined;\n        }\n\n        if (currentReturn.tag === RenderTag.ROOT && portalElements.length > 0) {\n          const portal =\n            typeof currentReturn.createPortal === \"function\"\n              ? currentReturn.createPortal()\n              : currentReturn.createPortal;\n          portal.append(...portalElements);\n        }\n\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n}\n","import type {\n  BrickEventHandler,\n  BrickLifeCycle,\n  ScrollIntoViewConf,\n  UseBrickLifeCycle,\n} from \"@next-core/types\";\nimport type { Action } from \"history\";\nimport { isEmpty, remove } from \"lodash\";\nimport { listenerFactory } from \"./bindListeners.js\";\nimport { NextLocation, getHistory } from \"../history.js\";\nimport { getReadOnlyProxy } from \"./proxyFactories.js\";\nimport { Media, mediaEventTarget } from \"./mediaQuery.js\";\nimport type { RenderBrick, RenderNode, RenderRoot } from \"./interfaces.js\";\nimport { mountTree } from \"./mount.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { unbindTemplateProxy } from \"./CustomTemplates/bindTemplateProxy.js\";\n\ntype MemoizedLifeCycle<T> = {\n  [Key in keyof T]: {\n    brick: RenderBrick;\n    handlers: T[Key];\n  }[];\n};\n\nconst commonLifeCycles = [\n  \"onMount\",\n  \"onUnmount\",\n  \"onMediaChange\",\n  \"onScrollIntoView\",\n] as const;\n\nconst pageOnlyLifeCycles = [\n  \"onBeforePageLoad\",\n  \"onPageLoad\",\n  \"onPageLeave\",\n  \"onBeforePageLeave\",\n  \"onAnchorLoad\",\n  \"onAnchorUnload\",\n] as const;\n\nexport interface RendererContextOptions {\n  unknownBricks?: \"silent\" | \"throw\";\n}\n\nexport class RendererContext {\n  /**\n   * - page: render as whole page, triggering page life cycles.\n   * - fragment: render as fragment, not triggering page life cycles.\n   */\n  public readonly scope: \"page\" | \"fragment\";\n\n  public readonly unknownBricks: \"silent\" | \"throw\";\n\n  constructor(scope: \"page\" | \"fragment\", options?: RendererContextOptions) {\n    this.scope = scope;\n    this.unknownBricks = options?.unknownBricks ?? \"throw\";\n  }\n\n  #memoizedLifeCycle: MemoizedLifeCycle<\n    Required<\n      Pick<\n        BrickLifeCycle,\n        | \"onBeforePageLoad\"\n        | \"onPageLoad\"\n        | \"onPageLeave\"\n        | \"onBeforePageLeave\"\n        | \"onAnchorLoad\"\n        | \"onAnchorUnload\"\n        | \"onMediaChange\"\n        | \"onScrollIntoView\"\n        | \"onMount\"\n        | \"onUnmount\"\n        // Omitted:\n        // \"onMessage\"\n        // \"onMessageClose\"\n      >\n    >\n  > = {\n    onBeforePageLoad: [],\n    onPageLoad: [],\n    onPageLeave: [],\n    onBeforePageLeave: [],\n    onAnchorLoad: [],\n    onAnchorUnload: [],\n    onMediaChange: [],\n    onScrollIntoView: [],\n    onMount: [],\n    onUnmount: [],\n  };\n  // #observers: IntersectionObserver[] = [];\n  #observers = new Map<RenderBrick, IntersectionObserver[]>();\n  #mediaListener: EventListener | undefined;\n\n  #memoizedControlNodes?: WeakMap<\n    RenderNode,\n    Map<\n      string,\n      {\n        node?: RenderBrick;\n        last?: RenderBrick;\n        lastNormal?: RenderBrick | undefined;\n        lastPortal?: RenderBrick | undefined;\n      }\n    >\n  >;\n\n  registerBrickLifeCycle(\n    brick: RenderBrick,\n    lifeCycle: BrickLifeCycle | UseBrickLifeCycle | undefined\n  ): void {\n    if (!lifeCycle) {\n      return;\n    }\n    const lifeCycleTypes = [\n      ...commonLifeCycles,\n      ...(this.scope === \"page\" ? pageOnlyLifeCycles : []),\n    ];\n    for (const key of lifeCycleTypes) {\n      const handlers = (lifeCycle as BrickLifeCycle)[key as \"onPageLoad\"];\n      if (handlers) {\n        this.#memoizedLifeCycle[key as \"onPageLoad\"].push({\n          brick,\n          handlers: handlers as BrickEventHandler | BrickEventHandler[],\n        });\n      }\n    }\n    // istanbul ignore next\n    if (!isEmpty((lifeCycle as { useResolves?: unknown }).useResolves)) {\n      // eslint-disable-next-line no-console\n      console.error(\"`lifeCycle.useResolves` is dropped in v3:\", lifeCycle);\n    }\n  }\n\n  #unmountBricks(bricks: Set<RenderBrick>): void {\n    const lifeCycleTypes = [\n      ...commonLifeCycles,\n      ...(this.scope === \"page\" ? pageOnlyLifeCycles : []),\n    ];\n    const unmountList: {\n      brick: RenderBrick;\n      handlers: BrickEventHandler | BrickEventHandler[];\n    }[] = [];\n\n    // Clear life cycle handlers, record `onUnmount` at the same time\n    for (const key of lifeCycleTypes) {\n      const removed = remove(\n        this.#memoizedLifeCycle[key as \"onPageLoad\"],\n        (item) => bricks.has(item.brick)\n      );\n      if (key === \"onUnmount\") {\n        unmountList.push(...removed);\n      }\n    }\n\n    // Clear intersection observers\n    for (const brick of bricks) {\n      const observers = this.#observers.get(brick);\n      if (observers?.length) {\n        for (const observer of observers) {\n          observer.disconnect();\n        }\n        observers.length = 0;\n        this.#observers.delete(brick);\n      }\n\n      unbindTemplateProxy(brick);\n      delete brick.element?.$$tplStateStore;\n\n      // Also remove the element\n      brick.element?.remove();\n    }\n\n    // Dispatch unmount events\n    const unmountEvent = new CustomEvent(\"unmount\");\n    for (const { brick, handlers } of unmountList) {\n      listenerFactory(handlers, brick.runtimeContext, brick)(unmountEvent);\n    }\n  }\n\n  #initializeRerenderBricks(bricks: Set<RenderBrick>): void {\n    const mountEvent = new CustomEvent(\"mount\");\n    for (const { brick, handlers } of this.#memoizedLifeCycle.onMount) {\n      if (bricks.has(brick)) {\n        listenerFactory(handlers, brick.runtimeContext, brick)(mountEvent);\n      }\n    }\n\n    for (const { brick, handlers: conf } of this.#memoizedLifeCycle\n      .onScrollIntoView) {\n      if (bricks.has(brick)) {\n        this.#addObserver(brick, conf);\n      }\n    }\n  }\n\n  memoizeControlNode(\n    slotId: string | undefined,\n    key: number,\n    node: RenderBrick | undefined,\n    returnNode: RenderNode\n  ) {\n    if (!this.#memoizedControlNodes) {\n      this.#memoizedControlNodes = new WeakMap();\n    }\n    const memKey = `${slotId ?? \"\"}.${key}`;\n    let mem = this.#memoizedControlNodes.get(returnNode);\n    if (!mem) {\n      mem = new Map();\n      this.#memoizedControlNodes.set(returnNode, mem);\n    }\n\n    mem.set(memKey, {\n      node,\n      last: getLastNode(node),\n      lastNormal: getLastNormalNode(node),\n      lastPortal: getLastPortalNode(node),\n    });\n  }\n\n  rerenderControlNode(\n    slotId: string | undefined,\n    key: number,\n    node: RenderBrick | undefined,\n    returnNode: RenderNode\n  ) {\n    const memKey = `${slotId ?? \"\"}.${key}`;\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const memoized = this.#memoizedControlNodes!.get(returnNode)!.get(memKey)!;\n    const {\n      node: prevNode,\n      last: prevLast,\n      lastNormal: prevLastNormal,\n      lastPortal: prevLastPortal,\n    } = memoized;\n\n    const insertBeforeChild = prevLastNormal?.element?.nextSibling ?? null;\n    const insertPortalBeforeChild =\n      prevLastPortal?.element?.nextSibling ?? null;\n\n    const last = getLastNode(node);\n    memoized.node = node;\n    memoized.last = last;\n    memoized.lastNormal = getLastNormalNode(node);\n    memoized.lastPortal = getLastPortalNode(node);\n\n    // Figure out the unchanged prev sibling and next sibling\n    let prevSibling: RenderBrick | undefined;\n    let current = returnNode.child;\n    while (current && current !== prevLast) {\n      if (current.sibling === prevNode) {\n        prevSibling = current;\n        break;\n      }\n      current = current.sibling;\n    }\n\n    const fragment = document.createDocumentFragment();\n    const portalFragment = document.createDocumentFragment();\n    const renderRoot: RenderRoot = {\n      tag: RenderTag.ROOT,\n      container: fragment,\n      createPortal: portalFragment,\n      child: node,\n    };\n\n    // Override `return`\n    current = node;\n    while (current) {\n      current.return = renderRoot;\n      current = current.sibling;\n    }\n\n    // Unmount previous bricks, including their descendants\n    const removeBricks = getBrickRange(prevNode, prevLast);\n    this.#unmountBricks(removeBricks);\n\n    mountTree(renderRoot);\n\n    // Connect back\n    if (prevSibling) {\n      prevSibling.sibling = node;\n    } else {\n      returnNode.child = node;\n    }\n    if (last) {\n      last.sibling = prevLast?.sibling;\n    }\n\n    // Resume `return`\n    current = node;\n    while (current) {\n      current.return = returnNode;\n      current = current.sibling;\n    }\n\n    if (returnNode.tag === RenderTag.ROOT) {\n      returnNode.container?.insertBefore(fragment, insertBeforeChild);\n    } else {\n      returnNode.element?.insertBefore(fragment, insertBeforeChild);\n    }\n\n    if (portalFragment.childNodes.length > 0) {\n      let root: RenderNode | undefined = node;\n      while (root && root.return) {\n        root = root.return;\n      }\n      if (root?.tag !== RenderTag.ROOT) {\n        throw new Error(\"Cannot find render root node\");\n      }\n      const portal =\n        typeof root.createPortal === \"function\"\n          ? root.createPortal()\n          : root.createPortal;\n      portal.insertBefore(portalFragment, insertPortalBeforeChild);\n    }\n\n    const newBricks = getBrickRange(node, last);\n    this.#initializeRerenderBricks(newBricks);\n  }\n\n  dispose(): void {\n    for (const list of Object.values(this.#memoizedLifeCycle)) {\n      list.length = 0;\n    }\n    for (const list of this.#observers.values()) {\n      for (const observer of list) {\n        observer.disconnect();\n      }\n      list.length = 0;\n    }\n    this.#observers.clear();\n    if (this.#mediaListener) {\n      mediaEventTarget.removeEventListener(\"change\", this.#mediaListener);\n      this.#mediaListener = undefined;\n    }\n    this.#memoizedControlNodes = undefined;\n  }\n\n  // Note: no `onScrollIntoView`\n  #dispatchGeneralLifeCycle(\n    type:\n      | \"onBeforePageLoad\"\n      | \"onPageLoad\"\n      | \"onPageLeave\"\n      | \"onBeforePageLeave\"\n      | \"onAnchorLoad\"\n      | \"onAnchorUnload\"\n      | \"onMediaChange\"\n      | \"onMount\"\n      | \"onUnmount\",\n    event: CustomEvent\n  ): void {\n    // istanbul ignore next\n    if (\n      process.env.NODE_ENV === \"development\" &&\n      this.scope === \"fragment\" &&\n      pageOnlyLifeCycles.includes(type as \"onPageLoad\")\n    ) {\n      throw new Error(\n        `\\`lifeCycle.${type}\\` cannot be used in ${this.scope}.\\nThis is a bug of Brick Next, please report it.`\n      );\n    }\n    for (const { brick, handlers } of this.#memoizedLifeCycle[type]) {\n      listenerFactory(handlers, brick.runtimeContext, brick)(event);\n    }\n  }\n\n  dispatchBeforePageLoad(): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onBeforePageLoad\",\n      new CustomEvent(\"page.beforeLoad\")\n    );\n  }\n\n  dispatchPageLoad(): void {\n    const event = new CustomEvent(\"page.load\");\n    this.#dispatchGeneralLifeCycle(\"onPageLoad\", event);\n    // Currently only for e2e testing\n    window.dispatchEvent(event);\n  }\n\n  dispatchBeforePageLeave(detail: {\n    location?: NextLocation;\n    action?: Action;\n  }): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onBeforePageLeave\",\n      new CustomEvent(\"page.beforeLeave\", { detail })\n    );\n  }\n\n  dispatchPageLeave(): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onPageLeave\",\n      new CustomEvent(\"page.leave\")\n    );\n  }\n\n  dispatchAnchorLoad(): void {\n    const { hash } = getHistory().location;\n    if (hash && hash !== \"#\") {\n      this.#dispatchGeneralLifeCycle(\n        \"onAnchorLoad\",\n        new CustomEvent(\"anchor.load\", {\n          detail: {\n            hash,\n            anchor: hash.substring(1),\n          },\n        })\n      );\n    } else {\n      this.#dispatchGeneralLifeCycle(\n        \"onAnchorUnload\",\n        new CustomEvent(\"anchor.unload\")\n      );\n    }\n  }\n\n  initializeScrollIntoView(): void {\n    for (const { brick, handlers: conf } of this.#memoizedLifeCycle\n      .onScrollIntoView) {\n      this.#addObserver(brick, conf);\n    }\n  }\n\n  #addObserver(brick: RenderBrick, conf: ScrollIntoViewConf) {\n    const threshold = conf.threshold ?? 0.1;\n    const observer = new IntersectionObserver(\n      (entries, observer) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            if (entry.intersectionRatio >= threshold) {\n              listenerFactory(\n                conf.handlers,\n                brick.runtimeContext,\n                brick\n              )(new CustomEvent(\"scroll.into.view\"));\n              observer.disconnect();\n            }\n          }\n        });\n      },\n      {\n        threshold,\n      }\n    );\n    observer.observe(brick.element!);\n    let list = this.#observers.get(brick);\n    if (!list) {\n      list = [];\n      this.#observers.set(brick, list);\n    }\n    list.push(observer);\n  }\n\n  initializeMediaChange(): void {\n    this.#mediaListener = (event) => {\n      this.#dispatchGeneralLifeCycle(\n        \"onMediaChange\",\n        new CustomEvent(\"media.change\", {\n          detail: getReadOnlyProxy((event as CustomEvent<Media>).detail),\n        })\n      );\n    };\n    mediaEventTarget.addEventListener(\"change\", this.#mediaListener);\n  }\n\n  dispatchOnMount(): void {\n    this.#dispatchGeneralLifeCycle(\"onMount\", new CustomEvent(\"mount\"));\n  }\n\n  dispatchOnUnmount(): void {\n    this.#dispatchGeneralLifeCycle(\"onUnmount\", new CustomEvent(\"unmount\"));\n  }\n}\n\nfunction getLastNode(node: RenderBrick | undefined): RenderBrick | undefined {\n  let last = node;\n  while (last?.sibling) {\n    last = last.sibling;\n  }\n  return last;\n}\n\nfunction getLastNormalNode(\n  node: RenderBrick | undefined\n): RenderBrick | undefined {\n  let last: RenderBrick | undefined;\n  let current = node;\n  while (current) {\n    if (!current.portal) {\n      last = current;\n    }\n    current = current.sibling;\n  }\n  return last;\n}\n\nfunction getLastPortalNode(\n  node: RenderBrick | undefined\n): RenderBrick | undefined {\n  let last: RenderBrick | undefined;\n  let current = node;\n  while (current) {\n    if (current.portal) {\n      last = current;\n    }\n    if (current.child) {\n      current = current.child;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderNode | null | undefined = current.return;\n      while (currentReturn) {\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n  return last;\n}\n\nfunction getBrickRange(\n  from: RenderBrick | undefined,\n  to: RenderBrick | undefined\n): Set<RenderBrick> {\n  const range = new Set<RenderBrick>();\n  let current = from;\n  while (current) {\n    range.add(current);\n    if (current.child) {\n      current = current.child;\n    } else if (current === to) {\n      break;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderNode | null | undefined = current.return;\n      while (currentReturn && currentReturn !== to) {\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      if (currentReturn === to) {\n        break;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n  return range;\n}\n","import { getBasePath } from \"./getBasePath.js\";\n\nlet misc: PageInfo;\n\n/** 运行时页面信息。*/\nexport interface PageInfo {\n  /** 当前是否处于 iframe 模式。 */\n  isInIframe: boolean;\n\n  /** 当前是否处于同域的 iframe 模式。 */\n  isInIframeOfSameSite: boolean;\n\n  /** 当前是否处于新框架下的 iframe 模式。 */\n  isInIframeOfNext: boolean;\n\n  /** 当前是否处于 Visual Builder 预览的 iframe 模式。 */\n  isInIframeOfVisualBuilder: boolean;\n\n  /** 当前是否处于老 console 下的 iframe 模式。 */\n  isInIframeOfLegacyConsole: boolean;\n}\n\nexport function getPageInfo(): PageInfo {\n  if (!misc) {\n    misc = {\n      isInIframe: false,\n      isInIframeOfSameSite: false,\n      isInIframeOfNext: false,\n      isInIframeOfVisualBuilder: false,\n      isInIframeOfLegacyConsole: false,\n    };\n\n    if (window !== window.parent) {\n      misc.isInIframe = true;\n      try {\n        // Handle:\n        // - Previewing in visual builder by iframe.\n        // - Nesting next in next.\n        // - Nesting console in next.\n        if (window.origin === window.parent.origin) {\n          misc.isInIframeOfSameSite = true;\n          const selfIsNext = getBasePath() === \"/next/\";\n          const parentPathname = window.parent.location.pathname;\n          const parentIsNext = parentPathname.startsWith(\"/next/\");\n          misc.isInIframeOfNext =\n            (Number(selfIsNext) ^ Number(parentIsNext)) === 0;\n          misc.isInIframeOfVisualBuilder = parentPathname.startsWith(\n            `${parentIsNext ? \"/next\" : \"\"}/visual-builder/`\n          );\n          misc.isInIframeOfLegacyConsole = selfIsNext && !parentIsNext;\n        }\n      } catch (e) {\n        // do nothing\n      }\n    }\n\n    Object.freeze(misc);\n  }\n\n  return misc;\n}\n","import { isObject } from \"@next-core/utils/general\";\n\nlet computed = new WeakSet();\n\n// The computed (or transformed) result should never be *computed* again.\n// So does the fetched data from a remote api.\nexport function markAsComputed(value: unknown): void {\n  if (isObject(value)) {\n    if (!hasBeenComputed(value)) {\n      computed.add(value);\n      if (Array.isArray(value)) {\n        value.forEach(markAsComputed);\n      } else {\n        // Only mark pure objects.\n        const proto = Object.getPrototypeOf(value);\n        if (!proto || proto.constructor === Object) {\n          Object.values(value).forEach(markAsComputed);\n        }\n      }\n    }\n  }\n}\n\nexport function hasBeenComputed(object: unknown): boolean {\n  return computed.has(object as object);\n}\n\nexport function resetAllComputedMarks(): void {\n  computed = new WeakSet();\n}\n","import { http } from \"@next-core/http\";\n\nlet nativeController: AbortController;\n\nexport function initAbortController() {\n  if (!window.AbortController) {\n    return;\n  }\n\n  nativeController = new AbortController();\n\n  http.interceptors.request.use((config) => {\n    return {\n      ...config,\n      options: {\n        ...config.options,\n        signal: config.options?.noAbortOnRouteChange\n          ? null\n          : nativeController.signal,\n      },\n    };\n  });\n}\n\nexport function abortPendingRequest() {\n  if (nativeController) {\n    nativeController.abort();\n    nativeController = new AbortController();\n  }\n}\n","import { RuntimeStoryboard } from \"@next-core/types\";\nimport { customTemplates } from \"../CustomTemplates.js\";\n\nexport function registerCustomTemplates(storyboard: RuntimeStoryboard) {\n  if (storyboard.$$registerCustomTemplateProcessed) {\n    return;\n  }\n  storyboard.$$registerCustomTemplateProcessed = true;\n  const templates = storyboard.meta?.customTemplates;\n  if (Array.isArray(templates)) {\n    for (const tpl of templates) {\n      const tagName = tpl.name.includes(\".\")\n        ? tpl.name\n        : `${storyboard.app.id}.${tpl.name}`;\n      customTemplates.define(tagName, tpl);\n    }\n  }\n}\n","import type { RuntimeStoryboard } from \"@next-core/types\";\nimport { hooks } from \"./Runtime.js\";\nimport { registerAppI18n } from \"./registerAppI18n.js\";\n\nexport async function fulfilStoryboard(storyboard: RuntimeStoryboard) {\n  if (storyboard.$$fulfilled) {\n    return;\n  }\n  if (!storyboard.$$fulfilling) {\n    storyboard.$$fulfilling = doFulfilStoryboard(storyboard);\n  }\n  return storyboard.$$fulfilling;\n}\n\nasync function doFulfilStoryboard(storyboard: RuntimeStoryboard) {\n  await hooks?.fulfilStoryboard?.(storyboard);\n  registerAppI18n(storyboard);\n  Object.assign(storyboard, {\n    $$fulfilled: true,\n    $$fulfilling: null,\n  });\n}\n","import type { Identifier } from \"@babel/types\";\nimport type { EstreeLiteral, EstreeParent } from \"@next-core/cook\";\n\nexport interface MemberCallUsage {\n  usedArgs: Set<string>;\n  hasNonStaticUsage?: boolean;\n}\n\nfunction collectMemberCallUsageFactory(object: string, property: string) {\n  return function collectMemberCallUsage(\n    usage: MemberCallUsage,\n    node: Identifier,\n    parent: EstreeParent\n  ) {\n    if (node.name === object) {\n      const memberParent = parent[parent.length - 1];\n      const callParent = parent[parent.length - 2];\n      if (\n        callParent?.node.type === \"CallExpression\" &&\n        callParent?.key === \"callee\" &&\n        memberParent?.node.type === \"MemberExpression\" &&\n        memberParent.key === \"object\" &&\n        (memberParent.node.computed\n          ? (memberParent.node.property as any).type === \"Literal\" &&\n            (memberParent.node.property as any).value === property\n          : memberParent.node.property.type === \"Identifier\" &&\n            memberParent.node.property.name === property)\n      ) {\n        const args = callParent.node.arguments as unknown as EstreeLiteral[];\n        if (args.length > 0) {\n          const firstArg = args[0];\n          if (\n            firstArg.type === \"Literal\" &&\n            typeof firstArg.value === \"string\"\n          ) {\n            usage.usedArgs.add(firstArg.value);\n          } else {\n            usage.hasNonStaticUsage = true;\n          }\n        }\n      }\n    }\n  };\n}\n\nexport const collectAppGetMenuUsage = collectMemberCallUsageFactory(\n  \"APP\",\n  \"getMenu\"\n);\n\nexport const collectInstalledAppsHasUsage = collectMemberCallUsageFactory(\n  \"INSTALLED_APPS\",\n  \"has\"\n);\n","import type { MicroApp, Storyboard } from \"@next-core/types\";\nimport { traverseStoryboardExpressions } from \"@next-core/utils/storyboard\";\nimport { RuntimeApi_searchMicroAppStandalone } from \"@next-api-sdk/micro-app-standalone-sdk\";\nimport { type CompareOperator, compare } from \"compare-versions\";\nimport {\n  MemberCallUsage,\n  collectInstalledAppsHasUsage,\n} from \"./compute/collectMemberCallUsage.js\";\nimport { _internalApiGetAppInBootstrapData } from \"./Runtime.js\";\n\ntype AppForCheck = Pick<MicroApp, \"id\" | \"currentVersion\" | \"installStatus\">;\n\nconst checkingApps = new Map<string, Promise<AppForCheck | undefined>>();\nconst checkedApps = new Map<string, AppForCheck | undefined>();\n\nexport function preCheckInstalledApps(storyboard: Storyboard) {\n  if (window.STANDALONE_MICRO_APPS && !window.NO_AUTH_GUARD) {\n    const appIds = scanInstalledAppsUsage(storyboard);\n    const searchIds: string[] = [];\n    for (const appId of appIds) {\n      // Do not check these apps already checking or in bootstrap.\n      if (\n        !checkingApps.has(appId) &&\n        !_internalApiGetAppInBootstrapData(appId)\n      ) {\n        searchIds.push(appId);\n      }\n    }\n    if (searchIds.length === 0) {\n      return;\n    }\n    const promise = RuntimeApi_searchMicroAppStandalone({\n      query: { appId: { $in: searchIds } },\n      fields: [\"appId\", \"currentVersion\", \"installStatus\"],\n    }).catch((error) => {\n      // Allow search micro app to fail, and\n      // make it not crash when the backend service is not updated.\n      // eslint-disable-next-line no-console\n      console.error(\"Get off site standalone micro-apps failed\", error);\n    });\n    for (const appId of searchIds) {\n      checkingApps.set(\n        appId,\n        promise.then((result) => {\n          const app = result?.list?.find((item) => item.appId === appId);\n          const checkedApp = app\n            ? {\n                ...app,\n                id: appId,\n              }\n            : undefined;\n          checkedApps.set(appId, checkedApp);\n          return checkedApp;\n        })\n      );\n    }\n  }\n}\n\nexport function waitForCheckingApps(appIds: string[]) {\n  return Promise.all(appIds.map((appId) => checkingApps.get(appId)));\n}\n\nexport function hasInstalledApp(appId: string, matchVersion?: string): boolean {\n  // First, check whether the app is in bootstrap already.\n  let app = _internalApiGetAppInBootstrapData(appId) as AppForCheck | undefined;\n  if (!app && window.STANDALONE_MICRO_APPS) {\n    app = checkedApps.get(appId);\n  }\n  if (!app || app.installStatus === \"running\") {\n    return false;\n  }\n  // Todo: `currentVersion` maybe `\"\"`\n  if (!matchVersion || !app.currentVersion) {\n    return true;\n  }\n  // Valid `matchVersion`:\n  //   >=1.2.3\n  //   >1.2.3\n  //   =1.2.3\n  //   <=1.2.3\n  //   <1.2.3\n  const matches = matchVersion.match(/^([><]=?|=)(.*)$/);\n  try {\n    if (!matches) {\n      throw new TypeError(`Invalid match version: ${matchVersion}`);\n    }\n    return compare(\n      app.currentVersion,\n      matches[2],\n      matches[1] as CompareOperator\n    );\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error);\n  }\n  return false;\n}\n\nfunction scanInstalledAppsUsage(storyboard: Storyboard) {\n  const usage: MemberCallUsage = {\n    usedArgs: new Set(),\n  };\n  // `INSTALLED_APPS.has(...)` is not available in storyboard functions\n  const { customTemplates, menus } = storyboard.meta ?? {};\n  traverseStoryboardExpressions(\n    [storyboard.routes, customTemplates, menus],\n    (node, parent) => {\n      collectInstalledAppsHasUsage(usage, node, parent);\n    },\n    \"INSTALLED_APPS\"\n  );\n  return [...usage.usedArgs];\n}\n","import { findLastIndex } from \"lodash\";\nimport type { RouteConf } from \"@next-core/types\";\n\nexport function insertPreviewRoutes(routes: RouteConf[]): RouteConf[] {\n  // Insert preview routes for iframe only.\n  if (window.parent === window) {\n    return routes;\n  }\n\n  let mergedRoutes = routes;\n\n  const specificTemplatePreviewIndex = findLastIndex(mergedRoutes, (route) =>\n    route.path.startsWith(\"${APP.homepage}/_dev_only_/template-preview/\")\n  );\n  mergedRoutes = [\n    ...mergedRoutes.slice(0, specificTemplatePreviewIndex + 1),\n    {\n      path: \"${APP.homepage}/_dev_only_/template-preview/:templateId\",\n      bricks: [{ brick: \"span\" }],\n      menu: false,\n      exact: true,\n    } as RouteConf,\n    ...mergedRoutes.slice(specificTemplatePreviewIndex + 1),\n  ];\n\n  const specificSnippetPreviewIndex = findLastIndex(mergedRoutes, (route) =>\n    route.path.startsWith(\"${APP.homepage}/_dev_only_/snippet-preview/\")\n  );\n  mergedRoutes = [\n    ...mergedRoutes.slice(0, specificSnippetPreviewIndex + 1),\n    {\n      path: \"${APP.homepage}/_dev_only_/snippet-preview/:snippetId\",\n      bricks: [{ brick: \"span\" }],\n      menu: false,\n      exact: true,\n    } as RouteConf,\n    ...mergedRoutes.slice(specificSnippetPreviewIndex + 1),\n  ];\n\n  return mergedRoutes;\n}\n","import { Action, locationsAreEqual } from \"history\";\nimport { flushStableLoadBricks } from \"@next-core/loader\";\nimport type {\n  BreadcrumbItemConf,\n  MicroApp,\n  StaticMenuConf,\n  Storyboard,\n} from \"@next-core/types\";\nimport { HttpAbortError } from \"@next-core/http\";\nimport { uniqueId } from \"lodash\";\nimport { NextHistoryState, NextLocation, getHistory } from \"../history.js\";\nimport { RenderOutput, renderRoutes } from \"./Renderer.js\";\nimport { DataStore } from \"./data/DataStore.js\";\nimport { clearResolveCache } from \"./data/resolveData.js\";\nimport { mountTree, unmountTree } from \"./mount.js\";\nimport { isOutsideApp, matchStoryboard } from \"./matchStoryboard.js\";\nimport { registerStoryboardFunctions } from \"./compute/StoryboardFunctions.js\";\nimport { preCheckPermissions } from \"./checkPermissions.js\";\nimport { RendererContext } from \"./RendererContext.js\";\nimport {\n  applyMode,\n  applyTheme,\n  getLocalAppsTheme,\n  setMode,\n  setTheme,\n} from \"../themeAndMode.js\";\nimport { getRuntime } from \"./Runtime.js\";\nimport { getAuth, isLoggedIn } from \"../auth.js\";\nimport { getPageInfo } from \"../getPageInfo.js\";\nimport type { RenderBrick, RenderRoot, RuntimeContext } from \"./interfaces.js\";\nimport { resetAllComputedMarks } from \"./compute/markAsComputed.js\";\nimport {\n  handleHttpError,\n  httpErrorToString,\n  isUnauthenticatedError,\n} from \"../handleHttpError.js\";\nimport { abortPendingRequest, initAbortController } from \"./abortController.js\";\nimport { registerCustomTemplates } from \"./registerCustomTemplates.js\";\nimport {\n  clearCollectWidgetContract,\n  collectContract,\n} from \"./data/CollectContracts.js\";\nimport { fulfilStoryboard } from \"./fulfilStoryboard.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { preCheckInstalledApps } from \"./checkInstalledApps.js\";\nimport { insertPreviewRoutes } from \"./insertPreviewRoutes.js\";\n\nexport class Router {\n  readonly #storyboards: Storyboard[];\n  #rendering = false;\n  #prevLocation!: NextLocation;\n  #nextLocation?: NextLocation;\n  #runtimeContext?: RuntimeContext;\n  #rendererContext?: RendererContext;\n  #rendererContextTrashCan = new Set<RendererContext | undefined>();\n  #redirectCount = 0;\n  #renderId?: string;\n  #currentApp?: MicroApp;\n  #previousApp?: MicroApp;\n  #navConfig?: {\n    breadcrumb?: BreadcrumbItemConf[];\n  };\n\n  constructor(storyboards: Storyboard[]) {\n    this.#storyboards = storyboards;\n\n    const history = getHistory();\n    window.addEventListener(\"beforeunload\", (event) => {\n      const message = this.#getBlockMessageBeforePageLave({});\n      // See examples in https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload\n      if (message) {\n        // Cancel the event\n        // If you prevent default behavior in Mozilla Firefox prompt will always be shown\n        event.preventDefault();\n        // Chrome requires returnValue to be set\n        event.returnValue = \"\";\n      } else {\n        // the absence of a returnValue property on the event will guarantee the browser unload happens\n        delete event.returnValue;\n      }\n    });\n\n    history.block((location, action) =>\n      this.#getBlockMessageBeforePageLave({ location, action })\n    );\n  }\n\n  getRenderId() {\n    return this.#renderId;\n  }\n\n  getRuntimeContext() {\n    return this.#runtimeContext;\n  }\n\n  getRecentApps() {\n    return {\n      currentApp: this.#currentApp,\n      previousApp: this.#previousApp,\n    };\n  }\n\n  getNavConfig() {\n    return this.#navConfig;\n  }\n\n  #getBlockMessageBeforePageLave(detail: {\n    location?: NextLocation;\n    action?: Action;\n  }): string | undefined {\n    const history = getHistory();\n    const previousMessage = history.getBlockMessage();\n    this.#rendererContext?.dispatchBeforePageLeave(detail);\n    const message = history.getBlockMessage();\n    if (!previousMessage && message) {\n      // Auto unblock only if new block was introduced by `onBeforePageLeave`.\n      history.unblock();\n    }\n    return message;\n  }\n\n  #safeRedirect(\n    to: string,\n    state: NextHistoryState | undefined,\n    from: NextLocation\n  ): void {\n    if (this.#redirectCount++ > 10) {\n      const message = `Infinite redirect detected: from \"${from.pathname}${from.search}${from.hash}\" to \"${to}\"`;\n      // istanbul ignore else: error cannot be caught in test\n      if (process.env.NODE_ENV === \"test\") {\n        // eslint-disable-next-line no-console\n        console.error(message);\n        return;\n      } else {\n        throw new Error(message);\n      }\n    }\n    getHistory().replace(to, state);\n  }\n\n  bootstrap() {\n    initAbortController();\n    const history = getHistory();\n    this.#prevLocation = history.location;\n    history.listen((location, action) => {\n      let ignoreRendering = false;\n      const omittedLocationProps: Partial<NextLocation> = {\n        hash: undefined,\n        state: undefined,\n      };\n      // Omit the \"key\" when checking whether locations are equal in certain situations.\n      if (\n        // When current location is triggered by browser action of hash link.\n        location.key === undefined ||\n        // When current location is triggered by browser action of non-push-or-replace,\n        // such as goBack or goForward,\n        (action === \"POP\" &&\n          // and the previous location was triggered by hash link,\n          (this.#prevLocation.key === undefined ||\n            // or the previous location specified notify false.\n            this.#prevLocation.state?.notify === false))\n      ) {\n        omittedLocationProps.key = undefined;\n      }\n      if (\n        locationsAreEqual(\n          { ...this.#prevLocation, ...omittedLocationProps },\n          { ...location, ...omittedLocationProps }\n        ) ||\n        (action !== \"POP\" && location.state?.notify === false)\n      ) {\n        // Ignore rendering if location not changed except hash, state and optional key.\n        // Ignore rendering if notify is `false`.\n        ignoreRendering = true;\n      }\n      if (ignoreRendering) {\n        this.#prevLocation = location;\n        return;\n      }\n      abortPendingRequest();\n      this.#prevLocation = location;\n      this.#rendererContext?.dispatchPageLeave();\n      // this.locationContext.messageDispatcher.reset();\n\n      if (action === \"POP\") {\n        const storyboard = matchStoryboard(\n          this.#storyboards,\n          location.pathname\n        );\n        // When a browser action of goBack or goForward is performing,\n        // force reload when the target page is a page of an outside app.\n        if (isOutsideApp(storyboard)) {\n          window.location.reload();\n          return;\n        }\n      }\n\n      if (this.#rendering) {\n        this.#nextLocation = location;\n      } else {\n        // devtoolsHookEmit(\"locationChange\");\n        this.#queuedRender(location).catch(handleHttpError);\n      }\n    });\n    return this.#queuedRender(history.location);\n  }\n\n  async #queuedRender(location: NextLocation): Promise<void> {\n    this.#rendering = true;\n    try {\n      await this.#render(location);\n    } finally {\n      this.#rendering = false;\n      if (this.#nextLocation) {\n        const nextLocation = this.#nextLocation;\n        this.#nextLocation = undefined;\n        await this.#queuedRender(nextLocation);\n      }\n    }\n  }\n\n  async #render(location: NextLocation): Promise<void> {\n    this.#renderId = uniqueId(\"render-id-1\");\n\n    resetAllComputedMarks();\n    clearResolveCache();\n    clearCollectWidgetContract();\n\n    const history = getHistory();\n    history.unblock();\n\n    const storyboard = matchStoryboard(this.#storyboards, location.pathname);\n\n    const previousApp = this.#runtimeContext?.app;\n    if (storyboard?.app) {\n      await fulfilStoryboard(storyboard);\n    }\n    const currentApp = (this.#currentApp = storyboard?.app);\n\n    // Storyboard maybe re-assigned, e.g. when open launchpad.\n    const appChanged =\n      previousApp && currentApp\n        ? previousApp.id !== currentApp.id\n        : previousApp !== currentApp;\n\n    // TODO: handle favicon\n\n    // Set `Router::#currentApp` before calling `getFeatureFlags()`\n    const flags = getRuntime().getFeatureFlags();\n    const prevRendererContext = this.#rendererContext;\n\n    const redirectTo = (to: string, state?: NextHistoryState): void => {\n      this.#rendererContextTrashCan.add(prevRendererContext);\n      this.#safeRedirect(to, state, location);\n    };\n\n    const redirectToLogin = (): void => {\n      const to = flags[\"sso-enabled\"] ? \"/sso-auth/login\" : \"/auth/login\";\n      redirectTo(to, { from: location });\n    };\n\n    const main = document.querySelector(\"#main-mount-point\") as HTMLElement;\n    const portal = document.querySelector(\"#portal-mount-point\") as HTMLElement;\n\n    const renderRoot: RenderRoot = {\n      tag: RenderTag.ROOT,\n      container: main,\n      createPortal: portal,\n    };\n\n    const cleanUpPreviousRender = (): void => {\n      unmountTree(main);\n      unmountTree(portal);\n\n      // Note: redirects can lead to multiple trash renderer contexts.\n      this.#rendererContextTrashCan.add(prevRendererContext);\n      for (const item of this.#rendererContextTrashCan) {\n        if (item) {\n          item.dispatchOnUnmount();\n          item.dispose();\n        }\n      }\n      this.#rendererContextTrashCan.clear();\n\n      setTheme(\n        (currentApp &&\n          (getLocalAppsTheme()[currentApp.id] || currentApp.theme)) ||\n          \"light\"\n      );\n      setMode(\"default\");\n\n      if (appChanged) {\n        this.#previousApp = previousApp;\n        window.dispatchEvent(\n          new CustomEvent(\"app.change\", {\n            detail: {\n              previousApp,\n              currentApp,\n            },\n          })\n        );\n      }\n    };\n\n    if (currentApp) {\n      preCheckInstalledApps(storyboard);\n\n      const runtimeContext: RuntimeContext = (this.#runtimeContext = {\n        app: currentApp,\n        location,\n        query: new URLSearchParams(location.search),\n        flags,\n        sys: {\n          ...getAuth(),\n          ...getPageInfo(),\n        },\n        ctxStore: new DataStore(\"CTX\"),\n        pendingPermissionsPreCheck: [preCheckPermissions(storyboard)],\n        tplStateStoreMap: new Map<string, DataStore<\"STATE\">>(),\n        formStateStoreMap: new Map<string, DataStore<\"FORM_STATE\">>(),\n      });\n\n      const rendererContext = (this.#rendererContext = new RendererContext(\n        \"page\"\n      ));\n      this.#navConfig = undefined;\n\n      registerCustomTemplates(storyboard);\n      registerStoryboardFunctions(storyboard.meta?.functions, currentApp);\n      collectContract(storyboard.meta?.contracts);\n\n      let failed = false;\n      let output: RenderOutput;\n      try {\n        output = await renderRoutes(\n          renderRoot,\n          insertPreviewRoutes(storyboard.routes),\n          runtimeContext,\n          rendererContext\n        );\n        if (output.unauthenticated) {\n          redirectToLogin();\n          return;\n        }\n        if (output.redirect) {\n          redirectTo(output.redirect.path, output.redirect.state);\n          return;\n        }\n        // Reset redirect count if no redirect is set.\n        this.#redirectCount = 0;\n\n        flushStableLoadBricks();\n\n        await Promise.all([\n          ...output.blockingList,\n          ...[\n            runtimeContext.ctxStore,\n            ...runtimeContext.tplStateStoreMap.values(),\n            ...runtimeContext.formStateStoreMap.values(),\n          ].map((store) => store.waitForAll()),\n          // Todo: load processors only when they would used in current rendering.\n          // loadProcessorsImperatively(\n          //   strictCollectMemberUsage(\n          //     [storyboard.routes, storyboard.meta?.customTemplates],\n          //     \"PROCESSORS\",\n          //     2\n          //   ),\n          //   getBrickPackages()\n          // ),\n          ...runtimeContext.pendingPermissionsPreCheck,\n        ]);\n\n        const menuConfs = await Promise.all(output.menuRequests);\n        this.#navConfig = mergeMenuConfs(menuConfs);\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error(\"Router failed:\", error);\n\n        if (isUnauthenticatedError(error) && !window.NO_AUTH_GUARD) {\n          redirectToLogin();\n          return;\n        } else if (error instanceof HttpAbortError) {\n          this.#rendererContextTrashCan.add(prevRendererContext);\n          return;\n        } else {\n          failed = true;\n          output = {\n            node: {\n              tag: RenderTag.BRICK,\n              type: \"div\",\n              properties: {\n                textContent: httpErrorToString(error),\n              },\n              runtimeContext: null!,\n              return: renderRoot,\n            },\n            blockingList: [],\n            menuRequests: [],\n          };\n        }\n      }\n      renderRoot.child = output.node;\n\n      cleanUpPreviousRender();\n\n      if ((output.route && output.route.type !== \"routes\") || failed) {\n        if (!failed) {\n          // There is a window to set theme and mode by `lifeCycle.onBeforePageLoad`.\n          rendererContext.dispatchBeforePageLoad();\n        }\n        applyTheme();\n        applyMode();\n\n        mountTree(renderRoot);\n\n        // Scroll to top after each rendering.\n        // See https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/docs/guides/scroll-restoration.md\n        window.scrollTo(0, 0);\n\n        if (!failed) {\n          rendererContext.dispatchPageLoad();\n          rendererContext.dispatchAnchorLoad();\n          rendererContext.dispatchOnMount();\n          rendererContext.initializeScrollIntoView();\n          rendererContext.initializeMediaChange();\n        }\n\n        return;\n      }\n    } else if (!window.NO_AUTH_GUARD && !isLoggedIn()) {\n      // Todo(steve): refine after api-gateway supports fetching storyboards before logged in.\n      // Redirect to login if no storyboard is matched.\n      redirectToLogin();\n      return;\n    } else {\n      cleanUpPreviousRender();\n    }\n\n    applyTheme();\n    applyMode();\n\n    const node: RenderBrick = {\n      tag: RenderTag.BRICK,\n      type: \"div\",\n      properties: {\n        textContent: \"Page not found\",\n      },\n      runtimeContext: null!,\n      return: renderRoot,\n    };\n    renderRoot.child = node;\n\n    mountTree(renderRoot);\n\n    // Scroll to top after each rendering.\n    window.scrollTo(0, 0);\n  }\n}\n\nfunction mergeMenuConfs(menuConfs: (StaticMenuConf | undefined)[]) {\n  const navConfig = {\n    breadcrumb: [] as BreadcrumbItemConf[],\n  };\n  for (const menuConf of menuConfs) {\n    if (menuConf) {\n      const { breadcrumb } = menuConf;\n      if (breadcrumb) {\n        if (breadcrumb.overwrite) {\n          navConfig.breadcrumb = breadcrumb.items;\n        } else {\n          navConfig.breadcrumb.push(...breadcrumb.items);\n        }\n      }\n    }\n  }\n  return navConfig;\n}\n","import type { BrickPackage } from \"@next-core/types\";\n\n// Allow inject brick packages in a runtime other than Brick Next.\nexport const injectedBrickPackages: BrickPackage[] =\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  typeof BRICK_PACKAGES !== \"undefined\" ? BRICK_PACKAGES : [];\n","import { StoryboardFunction } from \"@next-core/types\";\nimport {\n  ReadonlyStoryboardFunctions,\n  StoryboardFunctionRegistryFactory,\n} from \"../../StoryboardFunctionRegistry.js\";\n\nconst widgetFunctionRegistry = new Map<string, ReadonlyStoryboardFunctions>();\n\nexport const widgetFunctions = new Proxy(Object.freeze({}), {\n  get(target, key: string) {\n    return widgetFunctionRegistry.get(key);\n  },\n}) as Readonly<Record<string, ReadonlyStoryboardFunctions>>;\n\nexport function registerWidgetFunctions(\n  widgetId: string,\n  functions: StoryboardFunction[],\n  widgetVersion?: string\n): void {\n  if (widgetFunctionRegistry.has(widgetId)) {\n    // eslint-disable-next-line no-console\n    throw new Error(`Widget functions of \"${widgetId}\" already registered`);\n  }\n  const { storyboardFunctions, registerStoryboardFunctions } =\n    StoryboardFunctionRegistryFactory({ widgetId, widgetVersion });\n  widgetFunctionRegistry.set(widgetId, storyboardFunctions);\n  registerStoryboardFunctions(functions);\n}\n","export const symbolAppId = Symbol(\"appId\");\nexport const symbolMenuI18nNamespace = Symbol(\"menuI18nNamespace\");\nexport const symbolOverrideApp = Symbol(\"overrideApp\");\n","import type { MenuItemRawData, MenuRawData } from \"./interfaces.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { _internalApiGetAppInBootstrapData } from \"../Runtime.js\";\nimport { resolveData } from \"../data/resolveData.js\";\n\nexport async function loadDynamicMenuItems(\n  menu: MenuRawData,\n  runtimeContext: RuntimeContext,\n  menuWithI18n: WeakMap<MenuRawData, string>\n): Promise<void> {\n  if (menu.dynamicItems && menu.itemsResolve) {\n    const overrideAppId = menu.app[0].appId;\n    let newRuntimeContext = runtimeContext;\n    if (overrideAppId !== runtimeContext.app.id) {\n      const overrideApp = window.STANDALONE_MICRO_APPS\n        ? menu.overrideApp\n        : _internalApiGetAppInBootstrapData(overrideAppId);\n      newRuntimeContext = {\n        ...runtimeContext,\n        overrideApp,\n        appendI18nNamespace: menuWithI18n.get(menu),\n      };\n    }\n    const resolved = (await resolveData(\n      {\n        transform: \"items\",\n        ...menu.itemsResolve,\n      },\n      newRuntimeContext\n    )) as { items: MenuItemRawData[] };\n    menu.items = resolved.items;\n  }\n}\n","import { i18n } from \"@next-core/i18n\";\nimport { getI18nNamespace } from \"../registerAppI18n.js\";\nimport {\n  symbolAppId,\n  symbolMenuI18nNamespace,\n  symbolOverrideApp,\n} from \"./constants.js\";\nimport type {\n  MenuItemRawData,\n  MenuRawData,\n  RuntimeMenuItemRawData,\n  RuntimeMenuRawData,\n} from \"./interfaces.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { loadDynamicMenuItems } from \"./loadDynamicMenuItems.js\";\n\nexport async function mergeMenu(\n  menuList: MenuRawData[],\n  runtimeContext: RuntimeContext\n): Promise<RuntimeMenuRawData | undefined> {\n  const mainMenu = menuList.find((menu) => menu.type !== \"inject\");\n  if (!mainMenu) {\n    return undefined;\n  }\n  const validMenuList: MenuRawData[] = [];\n  const injectWithMenus = new Map<string, MenuRawData[]>();\n  const menuWithI18n = new WeakMap<MenuRawData, string>();\n\n  for (const menu of menuList) {\n    if (menu.i18n) {\n      const menuI18nNamespace = getI18nNamespace(\n        \"menu\",\n        `${menu.menuId}~${menu.app[0].appId}+${\n          (menu as { instanceId?: string }).instanceId\n        }`\n      );\n      // Support any language in `menu.i18n`.\n      Object.entries(menu.i18n).forEach(([lang, resources]) => {\n        i18n.addResourceBundle(lang, menuI18nNamespace, resources);\n      });\n      menuWithI18n.set(menu, menuI18nNamespace);\n    }\n  }\n\n  await Promise.all(\n    menuList.map((menu) =>\n      loadDynamicMenuItems(menu, runtimeContext, menuWithI18n)\n    )\n  );\n\n  for (const menu of menuList) {\n    if (menu.items?.length) {\n      if (menu.type === \"inject\" && menu.injectMenuGroupId) {\n        let injectingMenus = injectWithMenus.get(menu.injectMenuGroupId);\n        if (!injectingMenus) {\n          injectingMenus = [];\n          injectWithMenus.set(menu.injectMenuGroupId, injectingMenus);\n        }\n        injectingMenus.push(menu);\n      } else {\n        validMenuList.push(menu);\n      }\n    }\n  }\n\n  return {\n    ...mainMenu,\n    items: validMenuList.flatMap(\n      (menu) =>\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        processGroupInject(menu.items, menu, injectWithMenus, menuWithI18n)!\n    ),\n    [symbolMenuI18nNamespace]: menuWithI18n.get(mainMenu),\n    [symbolOverrideApp]: mainMenu.overrideApp,\n  };\n}\n\nfunction processGroupInject(\n  items: MenuItemRawData[] | undefined,\n  menu: MenuRawData,\n  injectWithMenus: Map<string, MenuRawData[]>,\n  menuWithI18n: WeakMap<MenuRawData, string>\n): RuntimeMenuItemRawData[] | undefined {\n  return items?.map((item) => {\n    const foundInjectingMenus =\n      item.groupId && injectWithMenus.get(item.groupId);\n    if (foundInjectingMenus) {\n      // Each menu to be injected with should be injected only once.\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      injectWithMenus.delete(item.groupId!);\n    }\n    return {\n      ...item,\n      children: (\n        processGroupInject(\n          item.children,\n          menu,\n          injectWithMenus,\n          menuWithI18n\n        ) ?? ([] as RuntimeMenuItemRawData[])\n      ).concat(\n        foundInjectingMenus\n          ? foundInjectingMenus.flatMap(\n              (injectingMenu) =>\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                processGroupInject(\n                  injectingMenu.items,\n                  injectingMenu,\n                  injectWithMenus,\n                  menuWithI18n\n                )!\n            )\n          : ([] as RuntimeMenuItemRawData[])\n      ),\n      [symbolAppId]: menu.app[0].appId,\n      [symbolMenuI18nNamespace]: menuWithI18n.get(menu),\n      [symbolOverrideApp]: menu.overrideApp,\n    };\n  });\n}\n","import { sortBy } from \"lodash\";\nimport { MenuItemRawData, MenuRawData } from \"./interfaces.js\";\n\nexport function reorderMenuItems(menuData: MenuRawData): void {\n  menuData.items = sortMenuItems(menuData.items).map((item) => ({\n    ...item,\n    children: sortMenuItems(item.children) as MenuItemRawData[],\n  }));\n}\n\nfunction sortMenuItems(list: MenuItemRawData[] | undefined): MenuItemRawData[] {\n  return sortBy(list, (item) => item.sort ?? -Infinity);\n}\n","import { asyncComputeRealValue } from \"../compute/computeRealValue.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport type {\n  RuntimeMenuItemRawData,\n  RuntimeMenuRawData,\n} from \"./interfaces.js\";\nimport { _internalApiGetAppInBootstrapData } from \"../Runtime.js\";\nimport {\n  symbolAppId,\n  symbolMenuI18nNamespace,\n  symbolOverrideApp,\n} from \"./constants.js\";\n\ntype RuntimeMenuRestRawData = Omit<RuntimeMenuRawData, \"app\" | \"items\">;\ntype RuntimeMenuItemRestRawData = Omit<RuntimeMenuItemRawData, \"children\">;\n\nexport function computeMenuData<\n  T extends RuntimeMenuRestRawData | RuntimeMenuItemRestRawData\n>(data: T, overrideAppId: string, runtimeContext: RuntimeContext): Promise<T> {\n  let newRuntimeContext = runtimeContext;\n  if (overrideAppId !== runtimeContext.app.id) {\n    const overrideApp = window.STANDALONE_MICRO_APPS\n      ? data[symbolOverrideApp]\n      : _internalApiGetAppInBootstrapData(overrideAppId);\n    newRuntimeContext = {\n      ...runtimeContext,\n      overrideApp,\n      appendI18nNamespace: data[symbolMenuI18nNamespace],\n    };\n  }\n  return asyncComputeRealValue(data, newRuntimeContext, {\n    ignoreSymbols: true,\n  }) as Promise<T>;\n}\n\nexport function computeMenuItems(\n  items: RuntimeMenuItemRawData[],\n  runtimeContext: RuntimeContext\n): Promise<RuntimeMenuItemRawData[]> {\n  return Promise.all(\n    items.map(async ({ children, ...rest }) => {\n      const [computedRest, computedChildren] = await Promise.all([\n        computeMenuData(rest, rest[symbolAppId], runtimeContext),\n        children && (await computeMenuItems(children, runtimeContext)),\n      ]);\n      return {\n        ...computedRest,\n        children: computedChildren,\n      };\n    })\n  );\n}\n","import { isEmpty } from \"lodash\";\nimport { InstanceApi_getDetail } from \"@next-api-sdk/cmdb-sdk\";\nimport type { MenuRawData } from \"./interfaces.js\";\n\nconst menuTitleCache = new Map<string, string>();\n\nexport async function fetchMenuTitle(\n  menuData: Pick<MenuRawData, \"title\" | \"titleDataSource\">\n) {\n  if (menuData.title || isEmpty(menuData.titleDataSource)) {\n    return menuData.title;\n  }\n  const cacheKey = JSON.stringify(menuData.titleDataSource);\n  if (menuTitleCache.has(cacheKey)) {\n    return menuTitleCache.get(cacheKey);\n  }\n  const { objectId, instanceId, attributeId } = menuData.titleDataSource;\n  const attr = attributeId ?? \"name\";\n  const instanceData = await InstanceApi_getDetail(objectId, instanceId, {\n    fields: attr,\n  });\n  let title: string;\n  if (attributeId === \"#showKey\" && Array.isArray(instanceData[attr])) {\n    const [primary, ...rest] = instanceData[attr];\n    title = rest.length > 0 ? `${primary}(${rest.join(\",\")})` : String(primary);\n  } else {\n    title = String(instanceData[attr]);\n  }\n  menuTitleCache.set(cacheKey, title);\n  return title;\n}\n","import { _internalApiGetStoryboardInBootstrapData } from \"../Runtime.js\";\nimport { MenuRawData } from \"./interfaces.js\";\n\nexport function getMenusOfStandaloneApp(\n  menuId: string,\n  appId: string\n): MenuRawData[] {\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const storyboard = _internalApiGetStoryboardInBootstrapData(appId)!;\n  const menus = (storyboard.meta?.injectMenus ??\n    storyboard.meta?.menus ??\n    []) as MenuRawData[];\n\n  return menus\n    .filter((menu) => menu.menuId === menuId)\n    .map((menu) => ({\n      ...menu,\n      ...(menu.app?.[0]?.appId ? {} : { app: [{ appId }] }),\n    }));\n\n  // Todo: maybe: fetch menus from STANDALONE_MENU@EASYOPS\n}\n","import { InstanceApi_postSearch } from \"@next-api-sdk/cmdb-sdk\";\nimport { pick } from \"lodash\";\nimport { mergeMenu } from \"./mergeMenu.js\";\nimport { reorderMenuItems } from \"./reorderMenuItems.js\";\nimport { preCheckPermissionsForAny } from \"../checkPermissions.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport type { MenuRawData } from \"./interfaces.js\";\nimport { checkIfOfComputed } from \"../compute/checkIf.js\";\nimport { computeMenuItems, computeMenuData } from \"./computeMenuData.js\";\nimport { fetchMenuTitle } from \"./fetchMenuTitle.js\";\nimport { getMenusOfStandaloneApp } from \"./getMenusOfStandaloneApp.js\";\n\nconst menuPromises = new Map<string, Promise<void>>();\n\nconst menuCache = new Map<string, unknown>();\n\nexport function getMenuById(menuId: string) {\n  return menuCache.get(menuId);\n}\n\nexport function fetchMenuById(menuId: string, runtimeContext: RuntimeContext) {\n  let promise = menuPromises.get(menuId);\n  if (!promise) {\n    promise = _fetchMenuById(menuId, runtimeContext);\n  }\n  return promise;\n}\n\nasync function _fetchMenuById(menuId: string, runtimeContext: RuntimeContext) {\n  const menuList = window.STANDALONE_MICRO_APPS\n    ? getMenusOfStandaloneApp(menuId, runtimeContext.app.id)\n    : ((\n        await InstanceApi_postSearch(\"EASYOPS_STORYBOARD_MENU\", {\n          page: 1,\n          page_size: 200,\n          fields: {\n            menuId: true,\n            title: true,\n            icon: true,\n            link: true,\n            titleDataSource: true,\n            defaultCollapsed: true,\n            defaultCollapsedBreakpoint: true,\n            type: true,\n            injectMenuGroupId: true,\n            dynamicItems: true,\n            itemsResolve: true,\n            items: true,\n            i18n: true,\n            \"items.children\": true,\n            \"app.appId\": true,\n          },\n          query: {\n            menuId: {\n              $eq: menuId,\n            },\n            app: {\n              $size: {\n                $gt: 0,\n              },\n            },\n          },\n        })\n      ).list as MenuRawData[]);\n\n  const menuData = await mergeMenu(menuList, runtimeContext);\n  if (!menuData) {\n    throw new Error(`Menu not found: ${menuId}`);\n  }\n\n  reorderMenuItems(menuData);\n\n  const { items, app, ...restMenuData } = menuData;\n  const newRuntimeContext: RuntimeContext = {\n    ...runtimeContext,\n    pendingPermissionsPreCheck: [\n      ...runtimeContext.pendingPermissionsPreCheck,\n      preCheckPermissionsForAny([items, restMenuData]),\n    ],\n  };\n  delete newRuntimeContext.tplStateStoreId;\n  delete newRuntimeContext.forEachItem;\n  const rootAppId = app[0].appId;\n\n  const [computedMenuData, computedMenuItems] = await Promise.all([\n    computeMenuData(restMenuData, rootAppId, newRuntimeContext),\n    computeMenuItems(items, newRuntimeContext),\n  ]);\n\n  const finalMenuData = {\n    title: await fetchMenuTitle(computedMenuData),\n    ...pick(computedMenuData, [\n      \"icon\",\n      \"link\",\n      \"defaultCollapsed\",\n      \"defaultCollapsedBreakpoint\",\n    ]),\n    menuItems: computedMenuItems.filter(checkIfOfComputed).map((item) => {\n      const children = item.children?.filter(checkIfOfComputed);\n      return item.type === \"group\"\n        ? {\n            type: \"group\",\n            title: item.text,\n            items: children,\n          }\n        : children?.length\n        ? {\n            type: \"subMenu\",\n            title: item.text,\n            icon: item.icon,\n            items: children,\n            defaultExpanded: item.defaultExpanded,\n          }\n        : item;\n    }),\n  };\n\n  // Todo(steve): reconsider the menu cache strategy\n  menuCache.set(menuId, finalMenuData);\n}\n","import { isEvaluable } from \"@next-core/cook\";\nimport { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport { transformAndInject, transform, inject } from \"@next-core/inject\";\nimport {\n  asyncEvaluate,\n  isPreEvaluated,\n  evaluate,\n  shouldDismissMarkingComputed,\n} from \"./evaluate.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport {\n  StateOfUseBrick,\n  getNextStateOfUseBrick,\n  isLazyContentInUseBrick,\n} from \"./getNextStateOfUseBrick.js\";\nimport { hasBeenComputed, markAsComputed } from \"./markAsComputed.js\";\n\nexport interface ComputeOptions {\n  $$lazyForUseBrick?: boolean;\n  $$stateOfUseBrick?: StateOfUseBrick;\n  ignoreSymbols?: boolean;\n  noInject?: boolean;\n}\n\nexport async function asyncComputeRealValue(\n  value: unknown,\n  runtimeContext: RuntimeContext,\n  internalOptions: ComputeOptions = {}\n): Promise<unknown> {\n  const preEvaluated = isPreEvaluated(value);\n\n  if (preEvaluated || typeof value === \"string\") {\n    // For `useBrick`, some fields such as `properties`/`transform`/`events`/`if`,\n    // are kept and to be evaluated later.\n    const lazy =\n      internalOptions.$$lazyForUseBrick &&\n      isLazyContentInUseBrick(internalOptions.$$stateOfUseBrick);\n\n    let result: unknown;\n    let dismissMarkingComputed = lazy;\n\n    if (preEvaluated || isEvaluable(value as string)) {\n      result = await asyncEvaluate(value, runtimeContext, { lazy });\n      dismissMarkingComputed = shouldDismissMarkingComputed(value);\n    } else {\n      result = lazy\n        ? value\n        : (hasOwnProperty(runtimeContext, \"data\")\n            ? internalOptions.noInject\n              ? transform\n              : transformAndInject\n            : internalOptions.noInject\n            ? identity\n            : inject)(value, runtimeContext);\n    }\n\n    if (!dismissMarkingComputed) {\n      markAsComputed(result);\n    }\n\n    return result;\n  }\n\n  if (!isObject(value) || hasBeenComputed(value)) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    const nextOptions = getNextComputeOptions(internalOptions, true);\n    return Promise.all(\n      value.map((v) => asyncComputeRealValue(v, runtimeContext, nextOptions))\n    );\n  }\n\n  return Object.fromEntries(\n    (\n      await Promise.all(\n        Object.entries(value).map(([k, v]) =>\n          Promise.all([\n            asyncComputeRealValue(k, runtimeContext),\n            asyncComputeRealValue(\n              v,\n              runtimeContext,\n              getNextComputeOptions(internalOptions, false, k)\n            ),\n          ])\n        )\n      )\n    ).concat(\n      internalOptions.ignoreSymbols\n        ? []\n        : Object.getOwnPropertySymbols(value).map((k) => [\n            k,\n            (value as Record<string | symbol, unknown>)[k],\n          ])\n    )\n  );\n}\n\nexport function computeRealValue(\n  value: unknown,\n  runtimeContext: RuntimeContext,\n  internalOptions: ComputeOptions = {}\n): unknown {\n  const preEvaluated = isPreEvaluated(value);\n\n  if (preEvaluated || typeof value === \"string\") {\n    // For `useBrick`, some fields such as `properties`/`transform`/`events`/`if`,\n    // are kept and to be evaluated later.\n    const lazy =\n      internalOptions.$$lazyForUseBrick &&\n      isLazyContentInUseBrick(internalOptions.$$stateOfUseBrick);\n\n    let result: unknown;\n    let dismissMarkingComputed = lazy;\n\n    if (preEvaluated || isEvaluable(value as string)) {\n      result = evaluate(value, runtimeContext);\n      dismissMarkingComputed = shouldDismissMarkingComputed(value);\n    } else {\n      result = lazy\n        ? value\n        : (hasOwnProperty(runtimeContext, \"data\")\n            ? internalOptions.noInject\n              ? transform\n              : transformAndInject\n            : internalOptions.noInject\n            ? identity\n            : inject)(value, runtimeContext);\n    }\n\n    if (!dismissMarkingComputed) {\n      markAsComputed(result);\n    }\n\n    return result;\n  }\n\n  if (!isObject(value) || hasBeenComputed(value)) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    const nextOptions = getNextComputeOptions(internalOptions, true);\n    return value.map((v) => computeRealValue(v, runtimeContext, nextOptions));\n  }\n\n  return Object.fromEntries(\n    Object.entries(value)\n      .map(([k, v]) => [\n        computeRealValue(k, runtimeContext),\n        computeRealValue(\n          v,\n          runtimeContext,\n          getNextComputeOptions(internalOptions, false, k)\n        ),\n      ])\n      .concat(\n        internalOptions.ignoreSymbols\n          ? []\n          : Object.getOwnPropertySymbols(value).map((k) => [\n              k,\n              (value as Record<string | symbol, unknown>)[k],\n            ])\n      )\n  );\n}\n\nfunction getNextComputeOptions(\n  internalOptions: ComputeOptions,\n  isArray: boolean,\n  key?: string\n): ComputeOptions {\n  return internalOptions.$$lazyForUseBrick\n    ? {\n        ...internalOptions,\n        $$stateOfUseBrick: getNextStateOfUseBrick(\n          internalOptions.$$stateOfUseBrick,\n          isArray,\n          key\n        ),\n      }\n    : internalOptions;\n}\n\nfunction identity<T>(value: T): T {\n  return value;\n}\n","import { difference } from \"lodash\";\nimport {\n  scanPermissionActionsInAny,\n  scanPermissionActionsInStoryboard,\n} from \"@next-core/utils/storyboard\";\nimport type { BrickConf, RouteConf, Storyboard } from \"@next-core/types\";\nimport { PermissionApi_validatePermissions } from \"@next-api-sdk/micro-app-sdk\";\nimport { getAuth, isLoggedIn } from \"../auth.js\";\nimport type { RuntimeContext } from \"./interfaces.js\";\nimport { asyncComputeRealValue } from \"./compute/computeRealValue.js\";\n\ntype PermissionStatus = \"authorized\" | \"unauthorized\" | \"undefined\";\n\nconst checkedPermissions: string[] = [];\nconst permissionMap = new Map<string, PermissionStatus>();\n\nexport function preCheckPermissions(\n  storyboard: Storyboard\n): Promise<void> | undefined {\n  if (isLoggedIn() && !getAuth().isAdmin) {\n    const usedActions = scanPermissionActionsInStoryboard(storyboard);\n    return validatePermissions(usedActions);\n  }\n}\n\nexport async function preCheckPermissionsForBrickOrRoute(\n  container: BrickConf | RouteConf,\n  runtimeContext: RuntimeContext\n) {\n  if (\n    isLoggedIn() &&\n    !getAuth().isAdmin &&\n    Array.isArray(container.permissionsPreCheck)\n  ) {\n    const actions = (await asyncComputeRealValue(\n      container.permissionsPreCheck,\n      runtimeContext\n    )) as string[];\n    return validatePermissions(actions);\n  }\n}\n\nexport function preCheckPermissionsForAny(\n  data: unknown\n): Promise<void> | undefined {\n  if (isLoggedIn() && !getAuth().isAdmin) {\n    const usedActions = scanPermissionActionsInAny(data);\n    return validatePermissions(usedActions);\n  }\n}\n\nexport async function validatePermissions(\n  usedActions: string[]\n): Promise<void> {\n  // Do not request known actions.\n  const actions = difference(usedActions, [...checkedPermissions]);\n  if (actions.length === 0) {\n    return;\n  }\n  checkedPermissions.push(...actions);\n  try {\n    const result = await PermissionApi_validatePermissions({ actions });\n    for (const item of result.actions!) {\n      permissionMap.set(item.action!, item.authorizationStatus!);\n      if (item.authorizationStatus === \"undefined\") {\n        // eslint-disable-next-line no-console\n        console.error(`Undefined permission action: \"${item.action}\"`);\n      }\n    }\n  } catch (error) {\n    // Allow pre-check to fail, and\n    // make it not crash when the backend service is not updated.\n    // eslint-disable-next-line no-console\n    console.error(\"Pre-check permissions failed\", error);\n  }\n}\n\n/**\n * Check the current logged-in user whether to have all\n * permissions of actions passed to it.\n *\n * @param actions - Required permission actions.\n */\nexport function checkPermissions(...actions: string[]): boolean {\n  if (!isLoggedIn()) {\n    return false;\n  }\n\n  if (getAuth().isAdmin) {\n    return true;\n  }\n\n  for (const action of actions) {\n    // Only **exclusively authorized** permissions are ok.\n    // Those scenarios below will fail:\n    // - unauthorized actions (pre-check results)\n    // - undefined actions (pre-check results)\n    // - Un-pre-checked or pre-check failed\n    switch (permissionMap.get(action)) {\n      case \"unauthorized\":\n      case \"undefined\":\n        return false;\n      case undefined:\n        // eslint-disable-next-line no-console\n        console.error(\n          `Un-checked permission action: \"${action}\", please make sure the permission to check is defined in permissionsPreCheck.`\n        );\n        return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Reset permission pre-checks after logged-out.\n */\nexport function resetPermissionPreChecks(): void {\n  checkedPermissions.length = 0;\n  permissionMap.clear();\n}\n","// import { userAnalytics } from \"@next-core/easyops-analytics\";\nimport type { AuthApi_CheckLoginResponseBody } from \"@next-api-sdk/api-gateway-sdk\";\nimport { resetPermissionPreChecks } from \"./internal/checkPermissions.js\";\n\nconst auth: AuthInfo = {};\n\n/** @internal */\nexport type AuthInfo = Omit<AuthApi_CheckLoginResponseBody, \"loggedIn\">;\n\n/** @internal */\nexport function authenticate(newAuth: AuthInfo): void {\n  Object.assign(auth, {\n    org: newAuth.org,\n    username: newAuth.username,\n    userInstanceId: newAuth.userInstanceId,\n    loginFrom: newAuth.loginFrom,\n    accessRule: newAuth.accessRule,\n    isAdmin: newAuth.isAdmin,\n    csrfToken: newAuth.csrfToken,\n    license: newAuth.license,\n    userShowValue: newAuth.userShowValue,\n  });\n\n  // re-init analytics to set user_id\n  // if (userAnalytics.initialized) {\n  //   userAnalytics.setUserId(newAuth.userInstanceId);\n  // }\n}\n\n/**\n * 获取当前登录认证信息。\n *\n * @returns 当前登录认证信息。\n */\nexport function getAuth(): AuthInfo {\n  return {\n    ...auth,\n  };\n}\n\n/** @internal */\nexport function logout(): void {\n  for (const key of Object.keys(auth) as (keyof AuthInfo)[]) {\n    auth[key] = undefined;\n  }\n  resetPermissionPreChecks();\n\n  // re-init analytics to clear user_id\n  // userAnalytics.setUserId();\n}\n\n/**\n * 查看当前是否已登录。\n *\n * @returns 当前是否已登录。\n */\nexport function isLoggedIn(): boolean {\n  return auth.username !== undefined;\n}\n","import { getProviderBrick } from \"./internal/data/getProviderBrick.js\";\nimport {\n  ResolveOptions,\n  resolveByProvider,\n} from \"./internal/data/resolveData.js\";\n\nexport async function fetchByProvider(\n  provider: string,\n  args: unknown[],\n  options?: ResolveOptions\n) {\n  const providerBrick = (await getProviderBrick(provider)) as unknown as Record<\n    string,\n    Function\n  >;\n  return resolveByProvider(providerBrick, provider, \"resolve\", args, options);\n}\n","import type {\n  BrickConf,\n  ContextConf,\n  CustomTemplate,\n  MetaI18n,\n  MicroApp,\n  SiteTheme,\n  Storyboard,\n  StoryboardFunction,\n} from \"@next-core/types\";\nimport { flushStableLoadBricks } from \"@next-core/loader\";\nimport { RenderOutput, renderBricks } from \"./internal/Renderer.js\";\nimport { RendererContext } from \"./internal/RendererContext.js\";\nimport { DataStore } from \"./internal/data/DataStore.js\";\nimport type { RenderRoot, RuntimeContext } from \"./internal/interfaces.js\";\nimport { mountTree, unmountTree } from \"./internal/mount.js\";\nimport { httpErrorToString } from \"./handleHttpError.js\";\nimport { applyMode, applyTheme, setMode, setTheme } from \"./themeAndMode.js\";\nimport { RenderTag } from \"./internal/enums.js\";\nimport { registerStoryboardFunctions } from \"./internal/compute/StoryboardFunctions.js\";\nimport { registerAppI18n } from \"./internal/registerAppI18n.js\";\nimport { registerCustomTemplates } from \"./internal/registerCustomTemplates.js\";\n\nexport interface CreateRootOptions {\n  portal?: HTMLElement;\n  /**\n   * Defaults to \"fragment\", only set it to \"page\" when the root is in a standalone iframe.\n   * - page: render as whole page, triggering page life cycles, and enable register of functions/templates/i18n.\n   * - fragment: render as fragment, not triggering page life cycles, and disable register of functions/templates/i18n.\n   */\n  scope?: \"page\" | \"fragment\";\n\n  /**\n   * Whether to throw error when encountering unknown bricks.\n   *\n   * Defaults to \"throw\".\n   */\n  unknownBricks?: \"silent\" | \"throw\";\n}\n\nexport interface RenderOptions {\n  theme?: SiteTheme;\n  context?: ContextConf[];\n  functions?: StoryboardFunction[];\n  templates?: CustomTemplate[];\n  i18n?: MetaI18n;\n}\n\nexport function unstable_createRoot(\n  container: HTMLElement,\n  { portal: _portal, scope = \"fragment\", unknownBricks }: CreateRootOptions = {}\n) {\n  let portal = _portal;\n  let createPortal: RenderRoot[\"createPortal\"];\n  if (_portal) {\n    createPortal = _portal;\n  } else {\n    // Create portal container when necessary.\n    createPortal = () => {\n      portal = document.createElement(\"div\");\n      portal.style.position = \"absolute\";\n      portal.style.width = portal.style.height = \"0\";\n      document.body.append(portal);\n      return portal;\n    };\n  }\n  let unmounted = false;\n  let rendererContext: RendererContext | undefined;\n  let clearI18nBundles: Function | undefined;\n\n  return {\n    async render(\n      brick: BrickConf | BrickConf[],\n      {\n        theme,\n        context,\n        functions,\n        templates,\n        i18n: i18nData,\n      }: RenderOptions = {}\n    ) {\n      if (unmounted) {\n        throw new Error(\n          \"The root is unmounted and cannot be rendered any more\"\n        );\n      }\n      const bricks = ([] as BrickConf[]).concat(brick);\n      const runtimeContext = {\n        ctxStore: new DataStore(\"CTX\"),\n        pendingPermissionsPreCheck: [],\n        tplStateStoreMap: new Map<string, DataStore<\"STATE\">>(),\n        formStateStoreMap: new Map<string, DataStore<\"FORM_STATE\">>(),\n      } as Partial<RuntimeContext> as RuntimeContext;\n\n      const previousRendererContext = rendererContext;\n      rendererContext = new RendererContext(scope, { unknownBricks });\n\n      const renderRoot: RenderRoot = {\n        tag: RenderTag.ROOT,\n        container,\n        createPortal,\n      };\n\n      if (scope === \"page\") {\n        const demoApp = {\n          id: \"demo\",\n          homepage: \"/demo\",\n        } as MicroApp;\n        runtimeContext.app = demoApp;\n        const demoStoryboard = {\n          app: demoApp,\n          meta: {\n            i18n: i18nData,\n            customTemplates: templates,\n          },\n        } as Storyboard;\n\n        // Register i18n.\n        clearI18nBundles?.();\n        clearI18nBundles = registerAppI18n(demoStoryboard);\n\n        // Register custom templates.\n        registerCustomTemplates(demoStoryboard);\n\n        // Register functions.\n        registerStoryboardFunctions(functions, demoApp);\n      }\n\n      runtimeContext.ctxStore.define(context, runtimeContext);\n\n      let failed = false;\n      let output: RenderOutput;\n      try {\n        output = await renderBricks(\n          renderRoot,\n          bricks,\n          runtimeContext,\n          rendererContext\n        );\n\n        flushStableLoadBricks();\n\n        await Promise.all([\n          ...output.blockingList,\n          runtimeContext.ctxStore.waitForAll(),\n          ...[\n            ...runtimeContext.tplStateStoreMap.values(),\n            ...runtimeContext.formStateStoreMap.values(),\n          ].map((store) => store.waitForAll()),\n          ...runtimeContext.pendingPermissionsPreCheck,\n        ]);\n      } catch (error) {\n        failed = true;\n        output = {\n          node: {\n            tag: RenderTag.BRICK,\n            type: \"div\",\n            properties: {\n              textContent: httpErrorToString(error),\n            },\n            return: renderRoot,\n            runtimeContext: null!,\n          },\n          blockingList: [],\n          menuRequests: [],\n        };\n      }\n\n      renderRoot.child = output.node;\n\n      previousRendererContext?.dispatchOnUnmount();\n      previousRendererContext?.dispose();\n      unmountTree(container);\n      if (portal) {\n        unmountTree(portal);\n      }\n\n      if (scope === \"page\") {\n        setTheme(theme ?? \"light\");\n        setMode(\"default\");\n\n        if (!failed) {\n          rendererContext.dispatchBeforePageLoad();\n        }\n\n        applyTheme();\n        applyMode();\n      }\n\n      mountTree(renderRoot);\n\n      if (scope === \"page\") {\n        window.scrollTo(0, 0);\n      }\n\n      if (!failed) {\n        if (scope === \"page\") {\n          rendererContext.dispatchPageLoad();\n          // rendererContext.dispatchAnchorLoad();\n        }\n        rendererContext.dispatchOnMount();\n        rendererContext.initializeScrollIntoView();\n        rendererContext.initializeMediaChange();\n      }\n    },\n    unmount() {\n      if (unmounted) {\n        return;\n      }\n      unmounted = true;\n      unmountTree(container);\n      if (portal) {\n        unmountTree(portal);\n        // Only remove the portal from its parent when it's dynamic created.\n        if (!_portal) {\n          portal.remove();\n        }\n      }\n    },\n  };\n}\n","import type {\n  BrickConf,\n  CustomTemplate,\n  RouteConf,\n  Storyboard,\n  UseSingleBrickConf,\n} from \"@next-core/types\";\nimport { flushStableLoadBricks } from \"@next-core/loader\";\nimport { pick } from \"lodash\";\nimport {\n  _internalApiGetRuntimeContext,\n  _internalApiGetStoryboardInBootstrapData,\n} from \"./Runtime.js\";\nimport { renderBrick } from \"./Renderer.js\";\nimport { RendererContext } from \"./RendererContext.js\";\nimport type { DataStore } from \"./data/DataStore.js\";\nimport type { RenderRoot, RuntimeContext } from \"./interfaces.js\";\nimport { mountTree, unmountTree } from \"./mount.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { computeRealValue } from \"./compute/computeRealValue.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../isStrictMode.js\";\nimport { customTemplates } from \"../CustomTemplates.js\";\nimport { registerAppI18n } from \"./registerAppI18n.js\";\n\nexport interface RenderUseBrickResult {\n  tagName: string | null;\n  renderRoot: RenderRoot;\n  rendererContext: RendererContext;\n}\n\nexport async function renderUseBrick(\n  useBrick: UseSingleBrickConf,\n  data: unknown\n): Promise<RenderUseBrickResult> {\n  const tplStateStoreScope: DataStore<\"STATE\">[] = [];\n  const formStateStoreScope: DataStore<\"FORM_STATE\">[] = [];\n  const runtimeContext: RuntimeContext = {\n    ..._internalApiGetRuntimeContext()!,\n    data,\n    pendingPermissionsPreCheck: [],\n    tplStateStoreScope,\n    formStateStoreScope,\n  };\n\n  runtimeContext.tplStateStoreMap ??= new Map();\n  runtimeContext.formStateStoreMap ??= new Map();\n\n  const rendererContext = new RendererContext(\"fragment\");\n\n  const renderRoot: RenderRoot = {\n    tag: RenderTag.ROOT,\n    // Will set during `mountUseBrick`\n    createPortal: null!,\n  };\n\n  const transform = (useBrick as { transform?: Record<string, unknown> })\n    .transform;\n  const strict = isStrictMode();\n  if (transform) {\n    warnAboutStrictMode(\n      strict,\n      \"`useBrick.transform`\",\n      'please use \"properties\" instead, check your useBrick:',\n      useBrick\n    );\n  }\n\n  const output = await renderBrick(\n    renderRoot,\n    strict\n      ? useBrick\n      : {\n          ...useBrick,\n          properties: {\n            ...useBrick.properties,\n            ...transform,\n          },\n        },\n    runtimeContext,\n    rendererContext\n  );\n\n  flushStableLoadBricks();\n\n  await Promise.all([\n    ...output.blockingList,\n    // Wait for local tpl state stores belong to current `useBrick` only.\n    ...[...tplStateStoreScope, ...formStateStoreScope].map((store) =>\n      store.waitForAll()\n    ),\n    ...runtimeContext.pendingPermissionsPreCheck,\n  ]);\n\n  if (output.node?.portal) {\n    throw new Error(\"The root brick of useBrick cannot be a portal brick\");\n  }\n\n  renderRoot.child = output.node;\n\n  const tagName = output.node ? output.node.type : null;\n\n  return { tagName, renderRoot, rendererContext };\n}\n\nexport interface MountUseBrickResult {\n  portal?: HTMLElement;\n}\n\nexport function mountUseBrick(\n  { renderRoot, rendererContext }: RenderUseBrickResult,\n  element: HTMLElement\n): MountUseBrickResult {\n  let portal: HTMLElement | undefined;\n  renderRoot.createPortal = () => {\n    const portalRoot = document.querySelector(\n      \"#portal-mount-point\"\n    ) as HTMLElement;\n    portal = document.createElement(\"div\");\n    portalRoot.appendChild(portal);\n    return portal;\n  };\n\n  mountTree(renderRoot, element);\n\n  rendererContext.dispatchOnMount();\n  rendererContext.initializeScrollIntoView();\n  rendererContext.initializeMediaChange();\n\n  return {\n    portal,\n  };\n}\n\nexport function unmountUseBrick(\n  { rendererContext }: RenderUseBrickResult,\n  mountResult: MountUseBrickResult\n): void {\n  // if (mountResult.mainBrick) {\n  //   mountResult.mainBrick.unmount();\n  // }\n  if (mountResult.portal) {\n    unmountTree(mountResult.portal);\n    mountResult.portal.remove();\n  }\n  rendererContext.dispatchOnUnmount();\n  rendererContext.dispose();\n}\n\nexport function legacyDoTransform(\n  data: unknown,\n  to: unknown,\n  options?: unknown\n) {\n  if (options) {\n    throw new Error(\"Legacy doTransform does not support options in v3\");\n  }\n  return computeRealValue(\n    to,\n    {\n      ..._internalApiGetRuntimeContext()!,\n      data,\n    },\n    {\n      noInject: true,\n    }\n  );\n}\n\nexport function updateStoryboard(\n  appId: string,\n  storyboardPatch: Partial<Storyboard>\n): void {\n  const storyboard = _internalApiGetStoryboardInBootstrapData(appId)!;\n  Object.assign(storyboard, {\n    ...storyboardPatch,\n    $$fulfilling: null,\n    $$fulfilled: true,\n    $$registerCustomTemplateProcessed: false,\n  });\n  registerAppI18n(storyboard);\n}\n\nexport function updateStoryboardByRoute(appId: string, newRoute: RouteConf) {\n  const storyboard = _internalApiGetStoryboardInBootstrapData(appId)!;\n  let match = false;\n  const getKey = (route: RouteConf): string => `${route.path}.${route.exact}`;\n  const replaceRoute = (routes: RouteConf[], key: string): RouteConf[] => {\n    return routes.map((route) => {\n      const routeKey = getKey(route);\n      if (route.type === \"routes\") {\n        route.routes = replaceRoute(route.routes, key);\n        return route;\n      } else if (routeKey === key) {\n        match = true;\n        return newRoute;\n      } else {\n        return route;\n      }\n    });\n  };\n  storyboard.routes = replaceRoute(storyboard.routes, getKey(newRoute));\n  if (!match) {\n    storyboard.routes.unshift(newRoute);\n  }\n}\n\nexport function updateStoryboardByTemplate(\n  appId: string,\n  newTemplate: CustomTemplate,\n  settings: unknown\n): void {\n  const tplName = `${appId}.${newTemplate.name}`;\n  // customTemplateRegistry.delete(tplName);\n  customTemplates.define(tplName, {\n    bricks: newTemplate.bricks,\n    proxy: newTemplate.proxy,\n    state: newTemplate.state,\n  });\n  updateTemplatePreviewSettings(appId, newTemplate.name, settings);\n}\n\nexport function updateTemplatePreviewSettings(\n  appId: string,\n  templateId: string,\n  settings?: unknown\n): void {\n  _updatePreviewSettings(\n    appId,\n    `\\${APP.homepage}/_dev_only_/template-preview/${templateId}`,\n    [\n      {\n        brick: templateId,\n        ...pick(settings, \"properties\", \"events\", \"lifeCycle\", \"context\"),\n      },\n    ]\n  );\n}\n\nexport function updateStoryboardBySnippet(\n  appId: string,\n  snippetData: {\n    snippetId: string;\n    bricks?: BrickConf[];\n  }\n): void {\n  _updatePreviewSettings(\n    appId,\n    `\\${APP.homepage}/_dev_only_/snippet-preview/${snippetData.snippetId}`,\n    snippetData.bricks?.length ? snippetData.bricks : [{ brick: \"span\" }]\n  );\n}\n\nexport const updateSnippetPreviewSettings = updateStoryboardBySnippet;\n\nfunction _updatePreviewSettings(\n  appId: string,\n  path: string,\n  bricks: BrickConf[]\n) {\n  const { routes } = _internalApiGetStoryboardInBootstrapData(appId)!;\n  const previewRouteIndex = routes.findIndex((route) => route.path === path);\n  const newPreviewRoute: RouteConf = {\n    path,\n    bricks,\n    menu: false,\n    exact: true,\n  };\n  if (previewRouteIndex === -1) {\n    routes.unshift(newPreviewRoute);\n  } else {\n    routes.splice(previewRouteIndex, 1, newPreviewRoute);\n  }\n}\n","interface ProviderElement<T extends unknown[], U> extends HTMLElement {\n  resolve(...args: T): U;\n}\n\ninterface ProviderConstructor<T extends unknown[], U> {\n  new (): ProviderElement<T, U>;\n}\n\nexport function createProviderClass<T extends unknown[], U>(\n  api: (...args: T) => U\n): ProviderConstructor<T, U> {\n  return class extends HTMLElement {\n    get $$typeof(): string {\n      return \"provider\";\n    }\n\n    resolve(...args: T): U {\n      return api(...args);\n    }\n  };\n}\n","// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze\n\n/** @internal */\nexport function deepFreeze<T>(object: T): T {\n  // Retrieve the property names defined on object\n  const propNames = Object.getOwnPropertyNames(object);\n\n  // Freeze properties before freezing self\n\n  for (const name of propNames) {\n    const value = (object as Record<string, unknown>)[name];\n\n    if (value && typeof value === \"object\") {\n      deepFreeze(value);\n    }\n  }\n\n  return Object.freeze(object);\n}\n","export function hasOwnProperty(\n  object: object,\n  property: string | number | symbol\n): boolean {\n  return Object.prototype.hasOwnProperty.call(object, property);\n}\n","// Ref https://github.com/lodash/lodash/blob/4.17.11/lodash.js#L11744\nexport function isObject(value: unknown): value is Record<string, unknown> {\n  const type = typeof value;\n  return value != null && (type == \"object\" || type == \"function\");\n}\n","// This is copied from\n// [@next-libs/storage](https://github.com/easyops-cn/next-libs/tree/master/libs/storage),\n// and the types is refined.\n// The usage of JsonStorage from @next-libs/storage should be deprecated,\n// and migrated to from @next-core/brick-utils.\nexport class JsonStorage<U = Record<string, unknown>> {\n  constructor(\n    private storage: Storage,\n    private prefix: string = \"brick-next-\"\n  ) {}\n\n  setItem<T extends string & keyof U>(name: T, value: U[T]): void {\n    this.storage.setItem(this.prefix + name, JSON.stringify(value));\n  }\n\n  getItem<T extends string & keyof U>(name: T): U[T] {\n    return JSON.parse(\n      this.storage.getItem(this.prefix + name) ?? \"null\"\n    ) as U[T];\n  }\n\n  removeItem<T extends string & keyof U>(name: T): void {\n    return this.storage.removeItem(this.prefix + name);\n  }\n\n  clear(): void {\n    return this.storage.clear();\n  }\n}\n","const pool = new Map<string, HTMLElement>();\n\nfunction getProviderBrick(provider: string) {\n  let brick = pool.get(provider);\n  if (brick) {\n    return brick;\n  }\n  brick = document.createElement(provider);\n  pool.set(provider, brick);\n  return brick;\n}\n\nexport function unwrapProvider<T extends (...args: any[]) => any>(\n  provider: string\n): (...args: Parameters<T>) => ReturnType<T> {\n  return function (...args: Parameters<T>): ReturnType<T> {\n    const brick = getProviderBrick(provider) as unknown as {\n      resolve(...args: Parameters<T>): ReturnType<T>;\n    };\n    return brick.resolve(...args);\n  };\n}\n","import type { Identifier } from \"@babel/types\";\nimport type { EstreeParent } from \"@next-core/cook\";\n\nexport interface MemberUsage {\n  usedProperties: Set<string>;\n  hasNonStaticUsage: boolean;\n}\n\nexport type BeforeVisitGlobal = (\n  node: Identifier,\n  parent: EstreeParent\n) => void;\n\nexport function beforeVisitGlobalMember(\n  usage: MemberUsage,\n  objectName: string | string[],\n  level: 1 | 2 = 1,\n  rememberObjectName = false\n): BeforeVisitGlobal {\n  return function beforeVisitGlobal(node, parent): void {\n    if (\n      typeof objectName === \"string\"\n        ? node.name === objectName\n        : objectName.includes(node.name)\n    ) {\n      const segments: string[] = [];\n      for (let i = 1; i <= level; i++) {\n        const memberParent = parent[parent.length - i];\n        if (\n          memberParent?.node.type === \"MemberExpression\" &&\n          memberParent.key === \"object\"\n        ) {\n          const memberNode = memberParent.node;\n          if (\n            !memberNode.computed &&\n            memberNode.property.type === \"Identifier\"\n          ) {\n            segments.push(\n              rememberObjectName\n                ? `${node.name}.${memberNode.property.name}`\n                : memberNode.property.name\n            );\n          } else if (\n            memberNode.computed &&\n            (memberNode.property as any).type === \"Literal\" &&\n            typeof (memberNode.property as any).value === \"string\"\n          ) {\n            segments.push(\n              rememberObjectName\n                ? `${node.name}.${(memberNode.property as any).value}`\n                : (memberNode.property as any).value\n            );\n          } else {\n            usage.hasNonStaticUsage = true;\n          }\n        } else {\n          usage.hasNonStaticUsage = true;\n        }\n      }\n      if (segments.length === level) {\n        usage.usedProperties.add(segments.join(\".\"));\n      }\n    }\n  };\n}\n","import { Identifier } from \"@babel/types\";\nimport { isEvaluable, preevaluate, type EstreeParent } from \"@next-core/cook\";\nimport { isObject } from \"@next-core/utils/general\";\n\nexport interface TraverseStoryboardExpressionsOptions {\n  matchExpressionString: (v: string) => boolean;\n  visitNotMatchedExpressionString?: (v: string) => unknown;\n  visitNonExpressionString?: (v: string) => unknown;\n  visitObject?: (v: unknown[] | Record<string, unknown>) => unknown;\n}\n\nexport type BeforeVisitGlobalWithExpr = (\n  node: Identifier,\n  parent: EstreeParent,\n  expr: string\n) => void;\n\nexport function traverseStoryboardExpressions(\n  data: unknown,\n  beforeVisitGlobal: BeforeVisitGlobalWithExpr,\n  // If `options` is a string, it means the *keyword*.\n  options: string | TraverseStoryboardExpressionsOptions\n): void {\n  const memo = new WeakSet();\n  const {\n    matchExpressionString,\n    visitNotMatchedExpressionString,\n    visitNonExpressionString,\n    visitObject,\n  } =\n    typeof options === \"string\"\n      ? ({\n          matchExpressionString: (v: string) => v.includes(options),\n        } as TraverseStoryboardExpressionsOptions)\n      : options;\n  function traverse(value: unknown): void {\n    if (typeof value === \"string\") {\n      if (isEvaluable(value)) {\n        if (matchExpressionString(value)) {\n          try {\n            preevaluate(value, {\n              withParent: true,\n              hooks: {\n                beforeVisitGlobal(node, parent) {\n                  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                  beforeVisitGlobal(node, parent!, value);\n                },\n              },\n            });\n          } catch (error) {\n            // eslint-disable-next-line no-console\n            console.error(\"Parse storyboard expression failed:\", error);\n          }\n        } else {\n          visitNotMatchedExpressionString?.(value);\n        }\n      } else {\n        visitNonExpressionString?.(value);\n      }\n    } else if (isObject(value)) {\n      // Avoid call stack overflow.\n      if (memo.has(value)) {\n        return;\n      }\n      memo.add(value);\n      visitObject?.(value);\n      for (const item of Array.isArray(value) ? value : Object.values(value)) {\n        traverse(item);\n      }\n    }\n  }\n  traverse(data);\n}\n","import {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"./beforeVisitGlobalMember.js\";\nimport { traverseStoryboardExpressions } from \"./traverse.js\";\n\nexport interface MemberUsageInExpressions extends MemberUsage {\n  nonStaticUsage?: string;\n}\n\nexport function strictCollectMemberUsage(\n  data: unknown,\n  objectName: string,\n  level: 1 | 2 = 1\n): Set<string> {\n  const { hasNonStaticUsage, nonStaticUsage, usedProperties } =\n    collectMemberUsage(data, objectName, level);\n  if (hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of ${objectName} is prohibited, check your expression: \"${nonStaticUsage}\"`\n    );\n  }\n  return usedProperties;\n}\n\nexport function collectMemberUsage(\n  data: unknown,\n  objectName: string,\n  level: 1 | 2 = 1\n): MemberUsageInExpressions {\n  const usage: MemberUsageInExpressions = {\n    usedProperties: new Set(),\n    hasNonStaticUsage: false,\n  };\n  const beforeVisitGlobal = beforeVisitGlobalMember(usage, objectName, level);\n  traverseStoryboardExpressions(\n    data,\n    (node, parent, expr) => {\n      beforeVisitGlobal(node, parent);\n      if (usage.hasNonStaticUsage) {\n        usage.nonStaticUsage = expr;\n      }\n    },\n    objectName\n  );\n  return usage;\n}\n","import { preevaluate } from \"@next-core/cook\";\nimport {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"./beforeVisitGlobalMember.js\";\n\ninterface trackAllResult {\n  context: string[] | false;\n  state: string[] | false;\n  formState: string[] | false;\n}\n\nexport function track(\n  raw: string,\n  trackText: string,\n  variableName: string\n): Set<string> | false {\n  if (raw.includes(trackText)) {\n    const usage: MemberUsage = {\n      usedProperties: new Set(),\n      hasNonStaticUsage: false,\n    };\n    const { expression } = preevaluate(raw, {\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal: beforeVisitGlobalMember(usage, variableName),\n      },\n    });\n    let trackCtxExp: any;\n    if (\n      expression.type === \"SequenceExpression\" &&\n      (trackCtxExp = expression.expressions[0] as unknown) &&\n      trackCtxExp.type === \"Literal\" &&\n      trackCtxExp.value === trackText\n    ) {\n      if (usage.usedProperties.size > 0) {\n        return usage.usedProperties;\n      } else {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `You are using \"${trackText}\" but no \\`${variableName}\\` usage found in your expression: ${JSON.stringify(\n            raw\n          )}`\n        );\n      }\n    }\n  }\n  return false;\n}\n\nexport function trackAll(raw: string): trackAllResult | false {\n  if (raw) {\n    const usage: MemberUsage = {\n      usedProperties: new Set(),\n      hasNonStaticUsage: false,\n    };\n    preevaluate(raw, {\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal: beforeVisitGlobalMember(\n          usage,\n          [\"CTX\", \"STATE\", \"FORM_STATE\"],\n          1,\n          true\n        ),\n      },\n    });\n    if (usage.usedProperties.size > 0) {\n      const usedProperites = [...usage.usedProperties];\n      const result: trackAllResult = {\n        context: false,\n        state: false,\n        formState: false,\n      };\n      const keyMap: Record<string, keyof trackAllResult> = {\n        CTX: \"context\",\n        STATE: \"state\",\n        FORM_STATE: \"formState\",\n      };\n      usedProperites.forEach((item) => {\n        const [key, name] = item.split(\".\");\n        if (!result[keyMap[key]]) {\n          result[keyMap[key]] = [];\n        }\n        (result[keyMap[key]] as string[]).push(name);\n      });\n      return result;\n    } else {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `You are using track all but no \"CTX\" or \"STATE\" or \"FORM_STATE\" usage found in your expression: ${JSON.stringify(\n          raw\n        )}`\n      );\n    }\n  }\n  return false;\n}\n","import type { StoryboardFunction } from \"@next-core/types\";\nimport { precookFunction } from \"@next-core/cook\";\nimport { BeforeVisitGlobal } from \"../index.js\";\n\nexport function traverseStoryboardFunctions(\n  functions: StoryboardFunction[] | null | undefined,\n  beforeVisitGlobal: BeforeVisitGlobal\n): void {\n  if (Array.isArray(functions)) {\n    for (const fn of functions) {\n      traverseStoryboardFunction(fn, beforeVisitGlobal);\n    }\n  }\n}\n\nexport function traverseStoryboardFunction(\n  fn: StoryboardFunction,\n  beforeVisitGlobal: BeforeVisitGlobal\n): void {\n  try {\n    precookFunction(fn.source, {\n      typescript: fn.typescript,\n      withParent: true,\n      hooks: { beforeVisitGlobal },\n    });\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(`Parse storyboard function \"${fn.name}\" failed:`, error);\n  }\n}\n","import type { StoryboardFunction } from \"@next-core/types\";\nimport {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"../expressions/beforeVisitGlobalMember.js\";\nimport { traverseStoryboardFunction } from \"./traverse.js\";\n\nexport function strictCollectMemberUsageInFunction(\n  fn: StoryboardFunction,\n  objectName: string,\n  level: 1 | 2 = 1\n): Set<string> {\n  const { hasNonStaticUsage, usedProperties } = collectMemberUsageInFunction(\n    fn,\n    objectName,\n    level\n  );\n  if (hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of ${objectName} is prohibited, check your function: \"${fn.name}\"`\n    );\n  }\n  return usedProperties;\n}\n\nexport function collectMemberUsageInFunction(\n  fn: StoryboardFunction,\n  objectName: string,\n  level: 1 | 2 = 1\n): MemberUsage {\n  const usage: MemberUsage = {\n    usedProperties: new Set(),\n    hasNonStaticUsage: false,\n  };\n\n  traverseStoryboardFunction(\n    fn,\n    beforeVisitGlobalMember(usage, objectName, level)\n  );\n\n  usage.usedProperties.delete(fn.name);\n\n  return usage;\n}\n","import type { Storyboard } from \"@next-core/types\";\nimport type { EstreeLiteral } from \"@next-core/cook\";\nimport {\n  traverseStoryboardExpressions,\n  BeforeVisitGlobal,\n} from \"./expressions/index.js\";\nimport { traverseStoryboardFunctions } from \"./functions/index.js\";\n\nconst PERMISSIONS = \"PERMISSIONS\";\nconst check = \"check\";\n\nexport function scanPermissionActionsInStoryboard(\n  storyboard: Storyboard\n): string[] {\n  const collection = new Set<string>();\n  const beforeVisitPermissions = beforeVisitPermissionsFactory(collection);\n  const { customTemplates, functions } = storyboard.meta ?? {};\n  traverseStoryboardExpressions(\n    [storyboard.routes, customTemplates],\n    beforeVisitPermissions,\n    PERMISSIONS\n  );\n  traverseStoryboardFunctions(functions, beforeVisitPermissions);\n  return Array.from(collection);\n}\n\nexport function scanPermissionActionsInAny(data: unknown): string[] {\n  const collection = new Set<string>();\n  traverseStoryboardExpressions(\n    data,\n    beforeVisitPermissionsFactory(collection),\n    PERMISSIONS\n  );\n  return Array.from(collection);\n}\n\nfunction beforeVisitPermissionsFactory(\n  collection: Set<string>\n): BeforeVisitGlobal {\n  return function beforeVisitPermissions(node, parent): void {\n    if (node.name === PERMISSIONS) {\n      const memberParent = parent[parent.length - 1];\n      const callParent = parent[parent.length - 2];\n      if (\n        callParent?.node.type === \"CallExpression\" &&\n        callParent?.key === \"callee\" &&\n        memberParent?.node.type === \"MemberExpression\" &&\n        memberParent.key === \"object\" &&\n        (memberParent.node.computed\n          ? (memberParent.node.property as any).type === \"Literal\" &&\n            (memberParent.node.property as any).value === check\n          : memberParent.node.property.type === \"Identifier\" &&\n            memberParent.node.property.name === check)\n      ) {\n        for (const arg of callParent.node\n          .arguments as unknown as EstreeLiteral[]) {\n          if (arg.type === \"Literal\" && typeof arg.value === \"string\") {\n            collection.add(arg.value);\n          }\n        }\n      }\n    }\n  };\n}\n"],"names":["http","config","_config$options","_config$options$inter","options","interceptorParams","ignoreLoadingBar","window","dispatchEvent","Event","response","error","Promise","reject","loadingBar","document","querySelector","classList","add","loading","count","updateLoadingStatus","hasRemainingRequests","addEventListener","requestStart","requestEnd","nextRequest","runtime","createRuntime","container","portal","root","unstable_createRoot","scope","unknownBricks","bootstrap","BOOTSTRAP_FILE","responseType","then","data","initialize","rendering","queuedRender","_x","_queuedRender","apply","arguments","_asyncToGenerator","request","type","sources","render","req","undefined","_preview_only_render","initialized","_x2","_x3","_render","_ref","yaml","html","javascript","theme","context","functions","templates","i18n","styleText","templatesAreArrayOfYaml","length","body","applyTheme","remove","parser","DOMParser","dom","parseFromString","nodes","querySelectorAll","bricks","Set","node","tagName","includes","lowerTagName","toLowerCase","loadBricks","textContent","append","childNodes","scriptTag","createElement","text","appendChild","parsed","safeLoad","schema","JSON_SCHEMA","json","concat","push","brick","properties","parsedContext","loadYaml","parsedFunctions","parsedTemplates","parsedI18n","e","console","String","content","map","item","_objectSpread","name","ExecutionContext","constructor","_defineProperty","EnvironmentRecord","outer","Map","this","OuterEnv","HasBinding","bindingMap","has","CreateMutableBinding","deletable","set","mutable","NormalCompletion","CreateImmutableBinding","strict","InitializeBinding","value","binding","get","Object","assign","SetMutableBinding","ReferenceError","TypeError","GetBindingValue","DeclarativeEnvironment","FunctionEnvironment","SourceNode","Symbol","for","FormalParameters","ECMAScriptCode","Environment","IsConstructor","ReferenceRecord","base","referenceName","Base","ReferenceName","Strict","CompletionRecord","Type","Value","Empty","collectBoundNames","names","collect","Array","isArray","n","declarations","id","elements","left","argument","from","containsExpression","some","computed","collectScopedDeclarations","nextOptions","var","Number","topLevel","kind","consequent","alternate","init","cases","block","handler","finalizer","IsPropertyReference","V","InitializeReferencedBinding","W","CopyDataProperties","target","source","excludedItems","keys","getOwnPropertyNames","getOwnPropertySymbols","nextKey","desc","getOwnPropertyDescriptor","enumerable","ForDeclarationBindingInstantiation","forDeclaration","env","isConst","LoopContinues","completion","UpdateEmpty","GetValue","ToPropertyKey","arg","GetV","P","PutValue","CreateListIteratorRecord","args","cooked","iterator","RequireObjectCoercible","GetIdentifierReference","ApplyStringOrNumericBinaryOperator","leftValue","operator","rightValue","SyntaxError","ApplyStringOrNumericAssignment","substr","ApplyUnaryOperator","reservedObjects","WeakSet","Function","prototype","self","global","Error","getGlobal","sanitize","allowedConstructors","URLSearchParams","WeakMap","isAllowedConstructor","Date","cook","rootAst","codeSource","_hooks$beforeEvaluate3","rules","globalVariables","hooks","expressionOnly","rootEnv","rootContext","VariableEnvironment","LexicalEnvironment","executionContextStack","key","entries","TemplateMap","GetTemplateObject","templateLiteral","memo","rawObj","quasis","quasi","raw","template","freeze","defineProperty","writable","configurable","Evaluate","optionalChainRef","_hooks$beforeEvaluate","_hooks$beforeBranch","_hooks$beforeBranch2","beforeEvaluate","call","array","element","spreadValues","ThrowIfFunctionIsInvalid","InstantiateArrowFunctionExpression","rightRef","right","funcName","substring","start","end","thisValue","ref","callee","func","optional","skipped","EvaluateCall","expression","test","ResolveBinding","regex","flags","_leftValue","baseValue","object","_result","EvaluatePropertyAccessWithExpressionKey","property","EvaluatePropertyAccessWithIdentifierKey","EvaluateNew","prop","propName","EvaluateComputedPropertyName","_result2","expr","expressions","chunks","index","_expr","val","join","tagRef","tag","tagFunc","_lref","_rval","_rval2","DestructuringAssignmentEvaluation","lref","lval","rval","r","oldEnv","getRunningContext","blockEnv","BlockDeclarationInstantiation","blockValue","EvaluateStatementList","EvaluateBreakableStatement","DoWhileLoopEvaluation","ForInOfLoopEvaluation","ForLoopEvaluation","InstantiateOrdinaryFunctionExpression","beforeBranch","v","lhs","oldValue","newValue","prefix","switchValue","discriminant","_oldEnv","_blockEnv","R","CaseBlockEvaluation","_R","_hooks$beforeEvaluate2","CatchClauseEvaluation","F","_result3","declarator","_lhs2","_value","_rval3","BindingInitialization","WhileLoopEvaluation","thrownValue","param","catchEnv","argName","B","stmtResult","input","defaultCaseIndex","findIndex","switchCase","hasDefaultCase","A","slice","found","C","CaseClauseIsSelected","_R2","foundInB","_C","_R3","_C2","_R4","lhsKind","uninitializedBoundNames","iterationKind","keyResult","ForInOfHeadEvaluation","ForInOfBodyEvaluation","runningContext","newEnv","exprRef","exprValue","EnumerateObjectProperties","stmt","iteratorRecord","destructuring","done","nextValue","next","lhsRef","iterationEnv","lhsName","result","status","return","innerResult","_key","_node$init","ForBodyEvaluation","update","loopEnv","boundNames","dn","perIterationLets","bodyResult","increment","perIterationBindings","CreatePerIterationEnvironment","lastIterationEnv","thisIterationEnv","bn","lastValue","pattern","PropertyDestructuringAssignmentEvaluation","IteratorDestructuringAssignmentEvaluation","excludedNames","valueTarget","KeyedDestructuringAssignmentEvaluation","RestDestructuringAssignmentEvaluation","propertyName","assignmentTarget","isObjectOrArray","rhsValue","restProperty","_value2","_done","_nextValue","propertyKey","identifier","propertyNameString","code","d","IsConstantDeclaration","_fn","_fo","InstantiateFunctionObject","argList","ArgumentListEvaluation","constructExpr","constructorName","_constructorName","CallFunction","closure","_hooks$beforeCall","beforeCall","PrepareForOrdinaryCall","OrdinaryCallEvaluateBody","pop","calleeContext","localEnv","EvaluateFunctionBody","FunctionDeclarationInstantiation","statements","s","formals","parameterNames","hasParameterExpressions","varDeclarations","varNames","functionNames","functionsToInitialize","i","_fn2","unshift","noVar","varEnv","paramName","IteratorBindingInitialization","_n","initialValue","lexEnv","lexDeclarations","_d","f","_fn3","_fo2","OrdinaryFunctionCreate","functionExpression","funcEnv","arrowFunction","sourceNode","isConstructor","defineProperties","params","environment","InitializeBoundName","PropertyBindingInitialization","RestBindingInitialization","KeyedBindingInitialization","restObj","_node","_value3","_A","_n2","_done2","_value4","bindingElement","_done3","_value5","_lhs3","_v","_done4","_value6","_v2","async","generator","fn","fo","hasOwnProperty","AnalysisContext","AnalysisEnvironment","bindingSet","CreateBinding","precook","visitors","withParent","attemptToVisitGlobals","analysisContextStack","visit","EvaluateChildren","parent","forEach","_hooks$beforeVisit","_hooks$beforeVisitUnk","beforeVisit","_hooks$beforeVisitGlo","beforeVisitGlobal","_runningContext","BoundNamesInstantiation","lexicalBinding","_runningContext2","_oldEnv2","_lexicalBinding","_runningContext3","_oldEnv3","_env","_runningContext4","_oldEnv4","beforeVisitUnknown","warn","PrepareOrdinaryCall","parseAsEstree","typescript","file","parse","plugins","filter","Boolean","strictMode","attachComment","program","jsNodes","startsWith","precookFunction","restOptions","_objectWithoutProperties","_excluded","function","preevaluate","fixes","replace","m","parseExpression","proposal","parseAsEstreeExpression","suffix","isEvaluable","shouldAllowRecursiveEvaluations","isTrackAll","fetch","Request","credentials","HttpFetchError","message","super","captureStackTrace","HttpResponseError","responseJson","statusText","HttpParseError","HttpAbortError","InterceptorManager","use","onFulfilled","onRejected","handlers","fulfilled","rejected","eject","isNil","fullBaseHref","href","location","origin","isHttpAbortError","DOMException","createError","url","_ref2","resolve","toString","ok","headers","_x4","_x5","getUrlWithParams","parsedUrl","URL","searchParams","_ref3","getBodyAndHeaders","parsedHeaders","Headers","contentTypeHeader","FormData","JSON","stringify","defaultAdapter","method","simpleRequest","_ref4","observe","noAbortOnRouteChange","useCache","requestInit","requestWithBody","_ref5","_excluded2","_adapter","_fetch","Http","_config","_this","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","_ref6","_ref7","_excluded3","_classPrivateMethodGet","_fetch2","_x6","_x7","_x8","interceptors","adapter","_classPrivateFieldSet","delete","head","post","put","patch","chain","promise","interceptor","_classPrivateFieldGet","_response$config$opti","shift","createHttpInstance","initializedNamespaces","initializeI18n","NS","locales","LanguageDetector","fallbackLng","debug","process","supportedLngs","nonExplicitSupportedLngs","interpolation","escapeValue","react","useSuspense","compatibilityJSON","resources","lang","i18nText","_i18n$language","language","primaryLanguage","split","i18next","PipeRegistry","pipes","processPipes","pipe","registeredPipe","parameters","LexicalStatus","TokenType","JsonValueType","getRegExpOfPlaceholder","symbols","RegExp","symbol","escapeRegExp","eatOptionalRawAndOptionalPlaceholderBegin","_subRaw$match","subRaw","getSubRaw","matchedPlaceholder","match","beginPlaceholder","subCursor","indexOf","charAt","nextCursor","cursor","tokens","Raw","BeginPlaceHolder","loc","ExpectField","eatWhitespace","eatField","Field","ExpectOptionalBeginDefault","eatOptionalDefault","BeginDefault","ExpectDefaultValue","ExpectOptionalBeginPipe","eatDefaultValue","eatJsonValueOrLiteralString","eatOptionalBeginPipe","BeginPipe","ExpectPipeIdentifier","ExpectPlaceholderEnd","eatPipeIdentifier","matches","PipeIdentifier","ExpectOptionalBeginPipeParameter","eatOptionalBeginPipeParameter","BeginPipeParameter","ExpectPipeParameter","eatPipeParameter","eatPlaceholderEnd","EndPlaceHolder","Initial","jsonLiteralMap","nextStatus","firstChar","valueType","Others","objectBracesToMatch","arrayBracketsToMatch","stringQuotesToClose","stringBackslashToEscape","matched","char","JsonValue","eatJsonValue","LiteralString","transform","compile","inject","transformAndInject","isInjectable","values","transformNode","field","defaultValue","injectNode","_context$overrideApp","_context$overrideApp2","namespace","subField","SimpleContextMap","SYS","FLAGS","query","getAll","event","overrideApp","app","hash","anchor","original","injectNodeFactory","token","tree","optionalToken","acceptToken","placeholder","parseTokens","tokenize","parseInjectableString","cache","loadScript","src","all","fixedSrc","cachedPromise","script","onload","onerror","firstScript","currentScript","getElementsByTagName","parentNode","insertBefore","resolveBasicPkg","loadSharedModule","_loadSharedModule","module","__webpack_init_sharing__","__webpack_share_scopes__","default","v2AdapterPromise","basicPkgWillBeResolved","waitBasicPkg","flushStableLoadBricks","enqueueStableLoadBricks","brickPackages","dispatchRequestStatus","enqueueStableLoad","enqueueStableLoadProcessors","processors","loadBricksImperatively","_loadBricksImperatively","loadProcessorsImperatively","V2_ADAPTER_LOAD_BRICKS","getItemsByPkg","list","brickPackagesMap","itemsByPkg","listToLoad","_pkg$dependencies","pkg","itemName","pkgId","toLocaleLowerCase","p","_p$elements","groupItems","deps","dependencies","dep","loadBrickModule","_loadBrickModule","moduleName","loadRestBricks","pkgs","itemsMap","_window$PUBLIC_ROOT","filePath","PUBLIC_ROOT","_x9","_enqueueStableLoad","_pkg$id","getPkgIdByFilePath","foundBasicPkg","maybeV2Adapter","v2Packages","v3PackagesOtherThanBasic","_pkg","basicPkgPromise","v2Adapter","basicPkg","_window$PUBLIC_ROOT2","tempPromise","pkgPromises","v2AdapterItemsByPkg","v2AdapterPackages","loadV2Adapter","pkgNamespace","dll","_x10","_dispatchRequestStatus","customProcessors","_registry","define","processorFullName","processorFunc","processorName","registerAppI18n","meta","i18nNamespace","getI18nNamespace","languages","registerWidgetI18n","widgetId","i18nData","ns","widgetI18nFactory","widgetImagesFactory","widgetVersion","PUBLIC_ROOT_WITH_VERSION","getDevHook","__BRICK_NEXT_DEVTOOLS_HOOK__","THROW","readOnlyHandler","deleteProperty","setPrototypeOf","getReadOnlyProxy","Proxy","getDynamicReadOnlyProxy","ownKeys","fromEntries","storage","JsonStorage","localStorage","LOCAL_STORAGE_APPS_THEME_KEY","setTheme","getTheme","getCurrentTheme","documentElement","dataset","CustomEvent","detail","batchSetAppsLocalTheme","appsTheme","setItem","getLocalAppsTheme","getItem","_unused","mode","setMode","getCurrentMode","applyMode","getCssPropertyValue","_window$getComputedSt","el","getComputedStyle","getPropertyValue","getBasePath","getAttribute","getGeneralGlobals","variableName","variable","getIndividualGlobal","appId","isBuildPush","collectCoverage","appendI18nNamespace","storyboardFunctions","isStoryboardFunction","APP_ROOT","identity","fakeI18nText","check","fakeCheckPermissions","checkPermissions","host","hostname","en","StoryboardFunctionRegistryFactory","currentApp","registeredFunctions","getStoryboardFunction","registerStoryboardFunctions","clear","strictCollectMemberUsageInFunction","hasPermissionsCheck","processed","collector","createCollector","precooked","supply","updateStoryboardFunction","newFn","checkPermissionsUsage","checkedFunctions","MediaBreakpoint","mediaBreakpointMinWidthMap","xLarge","large","medium","small","xSmall","mediaEventTarget","EventTarget","breakpointMatchesMap","MEDIA","handleMatchesChange","breakpoint","changed","_breakpoint","minWidth","mediaQueryList","matchMedia","addListener","getMedia","getStorageItem","storageType","_storage$getItem","sessionStorage","matchStoryboard","storyboards","pathname","sortedStoryboards","orderBy","storyboard","_storyboard$app$homep","_storyboard$app","_storyboard$app$homep2","homepage","isOutsideApp","_getRuntime$getCurren","getRuntime","getCurrentApp","STANDALONE_MICRO_APPS","standaloneMode","history","blocked","getUserConfirmation","callback","confirm","createHistory","browserHistory","createBrowserHistory","basename","blockMessage","originalPush","originalReplace","state","updateQueryFactory","extraQuery","keepHash","urlSearchParams","search","pushQuery","replaceQuery","pushAnchor","notify","reload","setBlockMessage","getBlockMessage","unblock","updateFactory","path","pathIsString","parsePath","_bootstrapData$storyb","_bootstrapData8","bootstrapData","_internalApiMatchStoryboard","createHref","historyOverridden","historyExtended","getHistory","contractsMap","widgetContractMap","addContract","contracts","contract","namespaceId","collectContract","clearCollectWidgetContract","getContract","flowApiDefinitionPromiseMap","isFlowApiProvider","provider","getArgsOfFlowApi","_getArgsOfFlowApi","originalArgs","apiDefinition","fetchFlowApiDefinition","getApiArgsFromApiProfile","getApiProfileFromApiDefinition","fileName","uri","apiMethod","ext_fields","serviceName","responseWrapper","version","isFileType","isDownload","restArgs","getTransformedUriAndRestArgs","originalUri","api","_contract$endpoint","_contract$response","endpoint","wrapper","_fetchFlowApiDefinition2","_fetchFlowApiDefinition","namespaceName","nameWithVersion","_contractData$namespa","_contractData$namespa2","contractData","ContractApi_searchSingleContract","contractName","FLOW_API_PROVIDER","hasFields","processExtFields","hasQueryParams","hasBodyParams","_len","_data","_params","_options","_options2","hasFileType","processFields","fields","isEmpty","transformFormData","formData","_loop","isObject","Blob","k","callFlowApi","_callFlowApi","isSimpleRequest","defaultOptions","_len2","_key2","_originalUri$match$le","_originalUri$match","_request$fields$lengt","_request$fields","noParams","isUploadType","registerFlowApiProvider","customElements","createProviderClass","pool","getProviderBrick","_getProviderBrick","getBrickPackages","resolveData","_resolveData","resolveConf","runtimeContext","useProvider","onReject","legacyProvider","providerBrick","actualArgs","asyncComputeRealValue","resolveByProvider","isHandleRejectByTransform","clearResolveCache","_resolveByProvider","cacheKey","finalArgs","asyncCheckIf","_asyncCheckIf","ifContainer","if","isPreEvaluated","checkIf","computeRealValue","checkIfOfComputed","asyncCheckBrickIf","_asyncCheckBrickIf","brickConf","checkIfByTransform","StateOfUseBrick","isLazyContentInUseBrick","USE_BRICK_PROPERTIES","USE_BRICK_TRANSFORM","USE_BRICK_EVENTS","USE_BRICK_IF","USE_BRICK_LIFECYCLE","USE_BRICK_DATA_SOURCE","getNextStateOfUseBrick","USE_BRICK","USE_BRICK_ITEM","USE_BRICK_SLOTS_ITEM_BRICKS","USE_BRICK_SLOTS_ITEM_BRICKS_ITEM","INITIAL","USE_BRICK_SLOTS","USE_BRICK_SLOTS_ITEM","getTracks","contextNames","stateNames","formStateNames","symbolForRaw","trackAll","formState","track","asyncComputeRealProperties","_asyncComputeRealProperties","trackingContextList","propValue","realValue","$$lazyForUseBrick","$$stateOfUseBrick","setRealProperties","realProps","setProperties","computeRealProperties","isStrictMode","_getRuntime","getFeatureFlags","warnAboutStrictMode","extraLogs","punctuation","allowedNativeProps","customTemplates","_constructor$proxy$pr","_constructor$proxy","_compatibleConstructo","_compatibleConstructo2","registered","proxyProperties","proxy","validProxyProps","legacyTplVariables","asVariable","mergeProperty","refTransform","compatibleConstructor","expose","tpl","_state$filter$map","exposedStates","uniq","proxyMethods","methods","props","entry","nativeProps","HTMLElement","TplElement","$$typeof","_dev_only_definedProperties","_dev_only_definedMethods","$$getElementByRef","_this$$$tplStateStore","_this$$$tplStateStore2","_this$$$tplStateStore3","_this$$$tplStateStore4","$$tplStateStore","hostBrick","tplHostMetadata","internalBricksByRef","connectedCallback","shadowRoot","attachShadow","fragment","createDocumentFragment","style","slot","disconnectedCallback","getValue","_this$$$tplStateStore5","updateValue","_loop2","to","_to$refProperty","refProperty","_this$$$getElementByR","_to$refProperty2","_loop3","_from","_to","_to$refMethod","refMethod","getTplStateStore","using","extraInfo","tplStateStoreId","tplStateStoreMap","store","getTplHostElement","hostElement","getTagNameOfCustomTemplate","getFormStateStore","formStateStoreId","formStateStoreMap","listenOnTrackingContext","listener","contextName","ctxStore","onChange","tplStateStore","stateName","formStateStore","_stateName","cacheCount","matchPath","exact","sensitive","reduce","regexp","pathCache","cacheResult","pathToRegexp","compilePath","exec","isExact","matchRoutes","_matchRoutes","routes","route","routePath","noAuthGuard","public","isLoggedIn","symbolForAsyncComputedPropsFromHost","symbolForTplStateStoreId","symbolForTPlExternalForEachItem","timeoutIdList","startPoll","task","currentTimeoutId","progress","success","finally","finallyCallback","interval","leadingRequestDelay","continueOnError","delegateLoadingBar","expectPollEnd","expectPollStopImmediately","currentRenderId","_internalApiGetRenderId","poll","_poll","shouldStop","delayedPoll","delay","setTimeout","K","REQUEST_FAILED","SOMETHING_WENT_WRONG","LOGIN_TIMEOUT_MESSAGE","NETWORK_ERROR","zh","Dialog","show","alert","httpErrorToString","HTMLScriptElement","msg","isUnauthenticatedError","lastErrorMessage","unauthenticatedConfirming","handleHttpError","NO_AUTH_GUARD","ssoEnabled","title","contentStyle","whiteSpace","Notification","bindListeners","eventsMap","eventType","listenerFactory","$$listeners","$$eventListeners","isBuiltinHandler","action","isUseProviderHandler","isCustomHandler","targetRef","runtimeBrick","handleHistoryAction","handleWindowAction","handleLocationAction","handleStorageAction","preventDefault","handleConsoleAction","handleMessageAction","handleContextAction","handleTplStateAction","argsFactory","handleFormStateAction","handleUseProviderAction","handleCustomAction","_handleUseProviderAction","brickCallback","targets","rawTarget","rawTargetRef","computedTarget","multiple","computedTargetRef","targetRefs","tplHostElement","_tplHostElement$$$get","isExecuteCustomHandler","useEventAsDefault","isSetPropsCustomHandler","_x11","_brickCallback","computedArgs","callbackFactory","eventCallbackFactory","pollableCallback","enabled","err","baseArgsLength","hasCallback","overrideMethod","useEventDetailAsDefault","features","open","removeItem","predicateNextResolveFactory","pendingDeps","scheduleAsSerial","usedProperties","getDependencyMapOfContext","contextConfs","keyword","depsMap","_contextConf","stats","collectMemberUsage","detectCircularContexts","dependencyMap","duplicatedMap","contextConf","processedAtLeastOne","_contextConf2","size","DataStore","changeEventType","_this$data$get","callbackRuntimeContext","eventTarget","load","loaded","dataConfs","asyncHostProperties","pending","resolveContext","_pendingDeps$get","hasNonStaticUsage","deferredContexts","pendingContexts","wrapResolve","_pendingDeps$get2","resolved","scheduleNext","_scheduleNext","readyContexts","pendingResult","deferred","catch","resolveDataStore","dataConf","pendingStack","dataName","_this$data$get2","waitFor","dataNames","ctx","waitForAll","_this2","_this3","hostProps","isLazyResolve","lazy","newData","strictCollectMemberUsage","setupTemplateProxy","hostContext","slots","asyncComputedProps","reversedProxies","externalSlots","propertyProxies","slotProxies","quasisMap","_externalSlots$from$b","_externalSlots$from","_to$refSlot","_to$refPosition","insertBricks","refToSlot","refSlot","expandableSlot","refPosition","clamp","setupTemplateExternalBricks","forEachItem","slotName","slotConf","flatMap","_brick$slots","_slotConf$bricks","setupTemplateExternalRoutes","setupUseBrickInTemplate","walk","setup","originalSlots","children","restConf","transpiledSlots","childrenToSlots","expandCustomTemplate","tplTagName","uniqueId","tplStateStoreScope","collectWidgetContract","originalExternalSlots","externalChildren","restBrickConf","newBrickConf","proxies","_proxies","expandBrickInTemplate","brickConfInTemplate","slotsInTemplate","childrenInTemplate","restBrickConfInTemplate","RenderTag","FORM_RENDERER","symbolForFormStateStoreId","expandFormRenderer","hostBrickConf","_normalizedFormData$c","_hostBrickConf$proper","normalizedFormData","formStateStoreScope","formConf","formSchemaToBrick","formSchema","events","targetEvents","sourceEvents","flat","mergeEvents","renderRoot","padding","mountPoint","instanceId","iid","find","fieldId","defaults","commonProps","label","testid","getReadOnlyAndRequired","_field$limit","_field$limit2","readOnly","limit","required","fieldType","description","precision","inputBoxStyle","width","getDefaultProperties","formSchemasToBricks","schemas","renderRoutes","_renderRoutes","returnNode","_runtimeContext","rendererContext","slotId","output","blockingList","menuRequests","unauthenticated","pendingPermissionsPreCheck","preCheckPermissionsForBrickOrRoute","redirectTo","redirect","loadMenu","menu","mergeRenderOutput","renderBricks","_x12","_renderBricks","tplStack","noMemoize","renderBrick","hasTrackingControls","memoizeControlNode","_x13","_x14","_x15","_x16","_x17","_x18","_renderBrick","_runtimeContext$app","brickName","ensureValidControlBrick","dataSource","renderControlNode","_slots$slot","computedDataSource","renderForEach","controlledOutput","renderId","rerenderControlNode","debouncedListener","debounce","_contextName","catchLoadBrick","_tplStack$get","tplCount","confProps","BRICK","_brickConf$properties","loadProperties","computedPropsFromHost","_brick$properties","asyncProperties","registerBrickLifeCycle","lifeCycle","childRuntimeContext","expandedBrickConf","loadChildren","rendered","childSlotId","childrenOutput","child","_x19","_x20","_x21","_x22","_x23","_x24","_x25","_renderForEach","j","menuConf","newOutput","rest","last","sibling","newSlots","_child$slot","bindTemplateProxy","_tplHostMetadata$prox","_to$refEvent","_ref$$$proxyListeners","bubbles","stopPropagation","cancelable","composed","refEvent","$$proxyListeners","unbindTemplateProxy","_$$proxyListeners","removeEventListener","unmountTree","innerHTML","mountTree","initializedElement","current","portalElements","setAttribute","childElements","_currentReturn","currentReturn","_currentReturn$contai","ROOT","createPortal","misc","commonLifeCycles","pageOnlyLifeCycles","_memoizedLifeCycle","_observers","_mediaListener","_memoizedControlNodes","_unmountBricks","_initializeRerenderBricks","_dispatchGeneralLifeCycle","_addObserver","RendererContext","_options$unknownBrick","onBeforePageLoad","onPageLoad","onPageLeave","onBeforePageLeave","onAnchorLoad","onAnchorUnload","onMediaChange","onScrollIntoView","onMount","onUnmount","lifeCycleTypes","useResolves","memKey","mem","getLastNode","lastNormal","getLastNormalNode","lastPortal","getLastPortalNode","_prevLastNormal$eleme","_prevLastNormal$eleme2","_prevLastPortal$eleme","_prevLastPortal$eleme2","prevSibling","memoized","prevNode","prevLast","prevLastNormal","prevLastPortal","insertBeforeChild","nextSibling","insertPortalBeforeChild","portalFragment","_returnNode$container","_returnNode$element","removeBricks","getBrickRange","_unmountBricks2","_root","newBricks","_initializeRerenderBricks2","dispose","_list","observer","disconnect","dispatchBeforePageLoad","_dispatchGeneralLifeCycle2","dispatchPageLoad","dispatchBeforePageLeave","dispatchPageLeave","dispatchAnchorLoad","initializeScrollIntoView","conf","_addObserver2","initializeMediaChange","dispatchOnMount","dispatchOnUnmount","unmountList","removed","_brick$element","_brick$element2","observers","unmountEvent","_brick","mountEvent","_brick2","_conf$threshold","threshold","IntersectionObserver","isIntersecting","intersectionRatio","_last","range","_currentReturn2","getPageInfo","isInIframe","isInIframeOfSameSite","isInIframeOfNext","isInIframeOfVisualBuilder","isInIframeOfLegacyConsole","selfIsNext","parentPathname","parentIsNext","nativeController","markAsComputed","hasBeenComputed","proto","getPrototypeOf","resetAllComputedMarks","registerCustomTemplates","_storyboard$meta","$$registerCustomTemplateProcessed","fulfilStoryboard","_fulfilStoryboard","$$fulfilled","$$fulfilling","doFulfilStoryboard","_doFulfilStoryboard","_hooks$fulfilStoryboa","collectMemberCallUsageFactory","usage","memberParent","callParent","firstArg","usedArgs","collectAppGetMenuUsage","collectInstalledAppsHasUsage","checkingApps","checkedApps","preCheckInstalledApps","appIds","menus","traverseStoryboardExpressions","scanInstalledAppsUsage","searchIds","_internalApiGetAppInBootstrapData","RuntimeApi_searchMicroAppStandalone","$in","_appId","_result$list","checkedApp","waitForCheckingApps","hasInstalledApp","matchVersion","installStatus","currentVersion","compare","insertPreviewRoutes","mergedRoutes","specificTemplatePreviewIndex","findLastIndex","specificSnippetPreviewIndex","_storyboards","_rendering","_prevLocation","_nextLocation","_rendererContext","_rendererContextTrashCan","_redirectCount","_renderId","_currentApp","_previousApp","_navConfig","_getBlockMessageBeforePageLave","_safeRedirect","Router","_history","_getBlockMessageBeforePageLave2","returnValue","getRenderId","getRuntimeContext","getRecentApps","previousApp","getNavConfig","AbortController","signal","listen","_classPrivateFieldGet2","_location$state","_classPrivateFieldGet3","ignoreRendering","omittedLocationProps","locationsAreEqual","abort","_queuedRender2","_classPrivateFieldGet4","previousMessage","_safeRedirect2","_this$redirectCount","_this$redirectCount2","_queuedRender3","_render2","nextLocation","_render3","_classPrivateFieldGet5","appChanged","prevRendererContext","redirectToLogin","main","cleanUpPreviousRender","_storyboard$meta2","sys","getAuth","preCheckPermissions","failed","menuConfs","mergeMenuConfs","scrollTo","navConfig","breadcrumb","overwrite","items","router","injectedBrickPackages","BRICK_PACKAGES","moment","Runtime","_initialized","_bootstrapped","localeName","settings","deepFreeze","normalizeBootstrapData","loadNotificationService","loader","loadDialogService","_router$getRecentApps","_router","_router2","_bootstrapData","_bootstrapData$settin","_router3","_router3$getRecentApp","_router3$getRecentApp2","_router3$getRecentApp3","featureFlags","getMiscSettings","_bootstrapData2","_bootstrapData2$setti","_router4","_router4$getRecentApp","_router4$getRecentApp2","_router4$getRecentApp3","getBrandSettings","_bootstrapData3","_bootstrapData3$setti","base_title","brand","getLaunchpadSettings","_bootstrapData4","_bootstrapData4$setti","columns","rows","launchpad","getDesktops","_bootstrapData$deskto","_bootstrapData5","desktops","getLaunchpadSiteMap","_bootstrapData$siteSo","_bootstrapData6","siteSort","toggleLaunchpadEffect","toggle","applyPageTitle","pageTitle","baseTitle","_router5","_bootstrapData$brickP","_bootstrapData7","_router6","_internalApiGetRuntimeContext","_router7","_internalApiGetStoryboardInBootstrapData","_bootstrapData9","_bootstrapData9$story","_internalApiGetStoryb","widgetFunctionRegistry","widgetFunctions","registerWidgetFunctions","symbolAppId","symbolMenuI18nNamespace","symbolOverrideApp","loadDynamicMenuItems","_loadDynamicMenuItems","menuWithI18n","dynamicItems","itemsResolve","overrideAppId","newRuntimeContext","mergeMenu","_mergeMenu","menuList","mainMenu","validMenuList","injectWithMenus","menuI18nNamespace","menuId","_menu","_menu$items","injectMenuGroupId","injectingMenus","processGroupInject","_processGroupInject","foundInjectingMenus","groupId","injectingMenu","reorderMenuItems","menuData","sortMenuItems","sortBy","_item$sort","sort","computeMenuData","ignoreSymbols","computeMenuItems","computedRest","computedChildren","menuTitleCache","fetchMenuTitle","_fetchMenuTitle","titleDataSource","objectId","attributeId","attr","instanceData","InstanceApi_getDetail","primary","getMenusOfStandaloneApp","_storyboard$meta$inje","injectMenus","_menu$app","_menu$app$","menuPromises","menuCache","getMenuById","fetchMenuById","_fetchMenuById2","_fetchMenuById","InstanceApi_postSearch","page","page_size","icon","link","defaultCollapsed","defaultCollapsedBreakpoint","$eq","$size","$gt","restMenuData","preCheckPermissionsForAny","rootAppId","computedMenuData","computedMenuItems","finalMenuData","pick","menuItems","_item$children","defaultExpanded","symbolForContext","shouldDismissMarkingComputed","possibleErrorConstructs","getCookErrorConstructor","asyncEvaluate","_asyncEvaluate","run","lowLevelEvaluate","evaluate","isAsync","passByRuntimeContext","omit","menuUsage","hasAppUsage","errorConstructor","usedCtx","usedProcessors","usedStates","usedFormStates","devHook","usedTpls","attemptToCheckPermissions","usedFunctions","usedMenuIds","_runtimeContext$overr","_match$params","cloneDeep","getMenu","t","_message","_asyncComputeRealValue","internalOptions","preEvaluated","dismissMarkingComputed","noInject","getNextComputeOptions","checkedPermissions","permissionMap","isAdmin","validatePermissions","scanPermissionActionsInStoryboard","_preCheckPermissionsForBrickOrRoute","permissionsPreCheck","scanPermissionActionsInAny","_validatePermissions","usedActions","actions","difference","PermissionApi_validatePermissions","authorizationStatus","auth","authenticate","newAuth","org","username","userInstanceId","loginFrom","accessRule","csrfToken","license","userShowValue","logout","fetchByProvider","_fetchByProvider","_portal","position","height","clearI18nBundles","unmounted","_arguments","previousRendererContext","_clearI18nBundles","demoApp","demoStoryboard","unmount","renderUseBrick","_renderUseBrick","useBrick","_runtimeContext$tplSt","_runtimeContext$formS","_output$node","mountUseBrick","portalRoot","unmountUseBrick","mountResult","legacyDoTransform","updateStoryboard","storyboardPatch","updateStoryboardByRoute","newRoute","getKey","replaceRoute","routeKey","updateStoryboardByTemplate","newTemplate","tplName","updateTemplatePreviewSettings","templateId","_updatePreviewSettings","updateStoryboardBySnippet","snippetData","_snippetData$bricks","snippetId","updateSnippetPreviewSettings","previewRouteIndex","newPreviewRoute","splice","providedGlobalVariables","mock","supplyIndividual","shouldOmitInLodash","shouldOmitInMoment","allowedGlobalObjects","lodash","tagUrlFactory","ignoreSlashes","strings","partials","str","encodeURIComponent","propNames","_this$storage$getItem","unwrapProvider","beforeVisitGlobalMember","objectName","level","rememberObjectName","segments","memberNode","matchExpressionString","visitNotMatchedExpressionString","visitNonExpressionString","visitObject","traverse","nonStaticUsage","trackText","trackCtxExp","usedProperites","keyMap","CTX","STATE","FORM_STATE","traverseStoryboardFunctions","traverseStoryboardFunction","collectMemberUsageInFunction","PERMISSIONS","collection","beforeVisitPermissions","beforeVisitPermissionsFactory"],"sourceRoot":""}